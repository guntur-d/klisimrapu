(()=>{var Ii=Object.create;var Fa=Object.defineProperty;var Ei=Object.getOwnPropertyDescriptor;var Ti=Object.getOwnPropertyNames;var Mi=Object.getPrototypeOf,Fi=Object.prototype.hasOwnProperty;var Li=(e,r)=>()=>(e&&(r=e(e=0)),r);var wr=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),Ri=(e,r)=>{for(var f in r)Fa(e,f,{get:r[f],enumerable:!0})},Ki=(e,r,f,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of Ti(r))!Fi.call(e,i)&&i!==f&&Fa(e,i,{get:()=>r[i],enumerable:!(a=Ei(r,i))||a.enumerable});return e};var sr=(e,r,f)=>(f=e!=null?Ii(Mi(e)):{},Ki(r||!e||!e.__esModule?Fa(f,"default",{value:e,enumerable:!0}):f,e));var la=wr((Xo,sn)=>{"use strict";function pa(e,r,f,a,i,t){return{tag:e,key:r,attrs:f,children:a,text:i,dom:t,is:void 0,domSize:void 0,state:void 0,events:void 0,instance:void 0}}pa.normalize=function(e){return Array.isArray(e)?pa("[",void 0,void 0,pa.normalizeChildren(e),void 0,void 0):e==null||typeof e=="boolean"?null:typeof e=="object"?e:pa("#",void 0,void 0,String(e),void 0,void 0)};pa.normalizeChildren=function(e){var r=[];if(e.length){for(var f=e[0]!=null&&e[0].key!=null,a=1;a<e.length;a++)if((e[a]!=null&&e[a].key!=null)!==f)throw new TypeError(f&&(e[a]==null||typeof e[a]=="boolean")?"In fragments, vnodes must either all have keys or none have keys. You may wish to consider using an explicit keyed empty fragment, m.fragment({key: ...}), instead of a hole.":"In fragments, vnodes must either all have keys or none have keys.");for(var a=0;a<e.length;a++)r[a]=pa.normalize(e[a])}return r};sn.exports=pa});var La=wr((Zo,ln)=>{"use strict";var Ni=la();ln.exports=function(e,r){return e==null||typeof e=="object"&&e.tag==null&&!Array.isArray(e)?r.length===1&&Array.isArray(r[0])&&(r=r[0]):(r=r.length===0&&Array.isArray(e)?e:[e,...r],e=void 0),Ni("",e&&e.key,e,r)}});var ja=wr((es,un)=>{"use strict";un.exports={}.hasOwnProperty});var Ra=wr((ts,cn)=>{"use strict";cn.exports={}});var Ka=wr((rs,dn)=>{"use strict";var Bi=Ra();dn.exports=new Map([[Bi,!0]])});var Ba=wr((as,gn)=>{"use strict";var Ui=la(),Ci=La(),Na=ja(),fn=Ra(),Vi=Ka(),qi=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,pn=Object.create(null);function zi(e){for(var r in e)if(Na.call(e,r))return!1;return!0}function Ji(e){return e==="value"||e==="checked"||e==="selectedIndex"||e==="selected"}function Yi(e){for(var r,f="div",a=[],i={},t=!0;r=qi.exec(e);){var n=r[1],c=r[2];if(n===""&&c!=="")f=c;else if(n==="#")i.id=c;else if(n===".")a.push(c);else if(r[3][0]==="["){var b=r[6];b&&(b=b.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),r[4]==="class"?a.push(b):(i[r[4]]=b===""?b:b||!0,Ji(r[4])&&(t=!1))}}return a.length>0&&(i.className=a.join(" ")),zi(i)?i=fn:Vi.set(i,t),pn[e]={tag:f,attrs:i,is:i.is}}function Gi(e,r){r.tag=e.tag;var f=r.attrs;if(f==null)return r.attrs=e.attrs,r.is=e.is,r;var a=Na.call(f,"class"),i=a?f.class:f.className;return e.attrs!==fn?(f=Object.assign({},e.attrs,f),(i!=null||e.attrs.className!=null)&&(f.className=i!=null?e.attrs.className!=null?String(e.attrs.className)+" "+String(i):i:e.attrs.className)):i!=null&&(f.className=i),a&&(f.class=null),e.tag==="input"&&Na.call(f,"type")&&(f=Object.assign({type:f.type},f)),r.is=f.is,r.attrs=f,r}function Hi(e,r,...f){if(e==null||typeof e!="string"&&typeof e!="function"&&typeof e.view!="function")throw Error("The selector must be either a string or a component.");var a=Ci(r,f);return typeof e=="string"&&(a.children=Ui.normalizeChildren(a.children),e!=="[")?Gi(pn[e]||Yi(e),a):(a.attrs==null&&(a.attrs={}),a.tag=e,a)}gn.exports=Hi});var mn=wr((ns,hn)=>{"use strict";var Wi=la();hn.exports=function(e){return e==null&&(e=""),Wi("<",void 0,void 0,e,void 0,void 0)}});var yn=wr((is,bn)=>{"use strict";var Qi=la(),Xi=La();bn.exports=function(e,...r){var f=Xi(e,r);return f.attrs==null&&(f.attrs={}),f.tag="[",f.children=Qi.normalizeChildren(f.children),f}});var xn=wr((os,vn)=>{"use strict";var Ua=Ba();Ua.trust=mn();Ua.fragment=yn();vn.exports=Ua});var Va=wr((ss,wn)=>{"use strict";var Ca=new WeakMap;function*Zi(e){var r=e.dom,f=e.domSize,a=Ca.get(r);if(r!=null)do{var i=r.nextSibling;Ca.get(r)===a&&(yield r,f--),r=i}while(f)}wn.exports={delayedRemoval:Ca,domFor:Zi}});var _n=wr((ls,Pn)=>{"use strict";var qa=la(),Sn=Va(),eo=Sn.delayedRemoval,za=Sn.domFor,kn=Ka();Pn.exports=function(){var e={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},r,f;function a(q){return q.ownerDocument}function i(q){return q.attrs&&q.attrs.xmlns||e[q.tag]}function t(q,B){if(q.state!==B)throw new Error("'vnode.state' must not be modified.")}function n(q){var B=q.state;try{return this.apply(B,arguments)}finally{t(q,B)}}function c(q){try{return a(q).activeElement}catch{return null}}function b(q,B,te,T,Y,ie,me){for(var ne=te;ne<T;ne++){var ye=B[ne];ye!=null&&x(q,ye,Y,me,ie)}}function x(q,B,te,T,Y){var ie=B.tag;if(typeof ie=="string")switch(B.state={},B.attrs!=null&&E(B.attrs,B,te),ie){case"#":w(q,B,Y);break;case"<":o(q,B,T,Y);break;case"[":u(q,B,te,T,Y);break;default:h(q,B,te,T,Y)}else d(q,B,te,T,Y)}function w(q,B,te){B.dom=a(q).createTextNode(B.children),K(q,B.dom,te)}var g={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function o(q,B,te,T){var Y=B.children.match(/^\s*?<(\w+)/im)||[],ie=a(q).createElement(g[Y[1]]||"div");te==="http://www.w3.org/2000/svg"?(ie.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+B.children+"</svg>",ie=ie.firstChild):ie.innerHTML=B.children,B.dom=ie.firstChild,B.domSize=ie.childNodes.length;for(var me=a(q).createDocumentFragment(),ne;ne=ie.firstChild;)me.appendChild(ne);K(q,me,T)}function u(q,B,te,T,Y){var ie=a(q).createDocumentFragment();if(B.children!=null){var me=B.children;b(ie,me,0,me.length,te,null,T)}B.dom=ie.firstChild,B.domSize=ie.childNodes.length,K(q,ie,Y)}function h(q,B,te,T,Y){var ie=B.tag,me=B.attrs,ne=B.is;T=i(B)||T;var ye=T?ne?a(q).createElementNS(T,ie,{is:ne}):a(q).createElementNS(T,ie):ne?a(q).createElement(ie,{is:ne}):a(q).createElement(ie);if(B.dom=ye,me!=null&&J(B,me,T),K(q,ye,Y),!H(B)&&B.children!=null){var Re=B.children;b(ye,Re,0,Re.length,te,null,T),B.tag==="select"&&me!=null&&N(B,me)}}function l(q,B){var te;if(typeof q.tag.view=="function"){if(q.state=Object.create(q.tag),te=q.state.view,te.$$reentrantLock$$!=null)return;te.$$reentrantLock$$=!0}else{if(q.state=void 0,te=q.tag,te.$$reentrantLock$$!=null)return;te.$$reentrantLock$$=!0,q.state=q.tag.prototype!=null&&typeof q.tag.prototype.view=="function"?new q.tag(q):q.tag(q)}if(E(q.state,q,B),q.attrs!=null&&E(q.attrs,q,B),q.instance=qa.normalize(n.call(q.state.view,q)),q.instance===q)throw Error("A view cannot return the vnode it received as argument");te.$$reentrantLock$$=null}function d(q,B,te,T,Y){l(B,te),B.instance!=null?(x(q,B.instance,te,T,Y),B.dom=B.instance.dom,B.domSize=B.dom!=null?B.instance.domSize:0):B.domSize=0}function _(q,B,te,T,Y,ie){if(!(B===te||B==null&&te==null))if(B==null||B.length===0)b(q,te,0,te.length,T,Y,ie);else if(te==null||te.length===0)Q(q,B,0,B.length);else{var me=B[0]!=null&&B[0].key!=null,ne=te[0]!=null&&te[0].key!=null,ye=0,Re=0;if(!me)for(;Re<B.length&&B[Re]==null;)Re++;if(!ne)for(;ye<te.length&&te[ye]==null;)ye++;if(me!==ne)Q(q,B,Re,B.length),b(q,te,ye,te.length,T,Y,ie);else if(ne){for(var je=B.length-1,Be=te.length-1,Me,qe,vt,jt,wt,ft;je>=Re&&Be>=ye&&(jt=B[je],wt=te[Be],jt.key===wt.key);)jt!==wt&&p(q,jt,wt,T,Y,ie),wt.dom!=null&&(Y=wt.dom),je--,Be--;for(;je>=Re&&Be>=ye&&(qe=B[Re],vt=te[ye],qe.key===vt.key);)Re++,ye++,qe!==vt&&p(q,qe,vt,T,M(B,Re,Y),ie);for(;je>=Re&&Be>=ye&&!(ye===Be||qe.key!==wt.key||jt.key!==vt.key);)ft=M(B,Re,Y),V(q,jt,ft),jt!==vt&&p(q,jt,vt,T,ft,ie),++ye<=--Be&&V(q,qe,Y),qe!==wt&&p(q,qe,wt,T,Y,ie),wt.dom!=null&&(Y=wt.dom),Re++,je--,jt=B[je],wt=te[Be],qe=B[Re],vt=te[ye];for(;je>=Re&&Be>=ye&&jt.key===wt.key;)jt!==wt&&p(q,jt,wt,T,Y,ie),wt.dom!=null&&(Y=wt.dom),je--,Be--,jt=B[je],wt=te[Be];if(ye>Be)Q(q,B,Re,je+1);else if(Re>je)b(q,te,ye,Be+1,T,Y,ie);else{var fr=Y,Nt=Be-ye+1,Bt=new Array(Nt),Ht=0,Lt=0,qt=2147483647,Ir=0,Me,ze;for(Lt=0;Lt<Nt;Lt++)Bt[Lt]=-1;for(Lt=Be;Lt>=ye;Lt--){Me==null&&(Me=j(B,Re,je+1)),wt=te[Lt];var br=Me[wt.key];br!=null&&(qt=br<qt?br:-1,Bt[Lt-ye]=br,jt=B[br],B[br]=null,jt!==wt&&p(q,jt,wt,T,Y,ie),wt.dom!=null&&(Y=wt.dom),Ir++)}if(Y=fr,Ir!==je-Re+1&&Q(q,B,Re,je+1),Ir===0)b(q,te,ye,Be+1,T,Y,ie);else if(qt===-1)for(ze=A(Bt),Ht=ze.length-1,Lt=Be;Lt>=ye;Lt--)vt=te[Lt],Bt[Lt-ye]===-1?x(q,vt,T,ie,Y):ze[Ht]===Lt-ye?Ht--:V(q,vt,Y),vt.dom!=null&&(Y=te[Lt].dom);else for(Lt=Be;Lt>=ye;Lt--)vt=te[Lt],Bt[Lt-ye]===-1&&x(q,vt,T,ie,Y),vt.dom!=null&&(Y=te[Lt].dom)}}else{var Ie=B.length<te.length?B.length:te.length;for(ye=ye<Re?ye:Re;ye<Ie;ye++)qe=B[ye],vt=te[ye],!(qe===vt||qe==null&&vt==null)&&(qe==null?x(q,vt,T,ie,M(B,ye+1,Y)):vt==null?W(q,qe):p(q,qe,vt,T,M(B,ye+1,Y),ie));B.length>Ie&&Q(q,B,ye,B.length),te.length>Ie&&b(q,te,ye,te.length,T,Y,ie)}}}function p(q,B,te,T,Y,ie){var me=B.tag,ne=te.tag;if(me===ne&&B.is===te.is){if(te.state=B.state,te.events=B.events,X(te,B))return;if(typeof me=="string")switch(te.attrs!=null&&z(te.attrs,te,T),me){case"#":m(B,te);break;case"<":y(q,B,te,ie,Y);break;case"[":k(q,B,te,T,Y,ie);break;default:v(B,te,T,ie)}else D(q,B,te,T,Y,ie)}else W(q,B),x(q,te,T,ie,Y)}function m(q,B){q.children.toString()!==B.children.toString()&&(q.dom.nodeValue=B.children),B.dom=q.dom}function y(q,B,te,T,Y){B.children!==te.children?($(q,B),o(q,te,T,Y)):(te.dom=B.dom,te.domSize=B.domSize)}function k(q,B,te,T,Y,ie){_(q,B.children,te.children,T,Y,ie);var me=0,ne=te.children;if(te.dom=null,ne!=null){for(var ye=0;ye<ne.length;ye++){var Re=ne[ye];Re!=null&&Re.dom!=null&&(te.dom==null&&(te.dom=Re.dom),me+=Re.domSize||1)}me!==1&&(te.domSize=me)}}function v(q,B,te,T){var Y=B.dom=q.dom;T=i(B)||T,(q.attrs!=B.attrs||B.attrs!=null&&!kn.get(B.attrs))&&G(B,q.attrs,B.attrs,T),H(B)||_(Y,q.children,B.children,te,null,T)}function D(q,B,te,T,Y,ie){if(te.instance=qa.normalize(n.call(te.state.view,te)),te.instance===te)throw Error("A view cannot return the vnode it received as argument");z(te.state,te,T),te.attrs!=null&&z(te.attrs,te,T),te.instance!=null?(B.instance==null?x(q,te.instance,T,ie,Y):p(q,B.instance,te.instance,T,Y,ie),te.dom=te.instance.dom,te.domSize=te.instance.domSize):B.instance!=null?(W(q,B.instance),te.dom=void 0,te.domSize=0):(te.dom=B.dom,te.domSize=B.domSize)}function j(q,B,te){for(var T=Object.create(null);B<te;B++){var Y=q[B];if(Y!=null){var ie=Y.key;ie!=null&&(T[ie]=B)}}return T}var S=[];function A(q){for(var B=[0],te=0,T=0,Y=0,ie=S.length=q.length,Y=0;Y<ie;Y++)S[Y]=q[Y];for(var Y=0;Y<ie;++Y)if(q[Y]!==-1){var me=B[B.length-1];if(q[me]<q[Y]){S[Y]=me,B.push(Y);continue}for(te=0,T=B.length-1;te<T;){var ne=(te>>>1)+(T>>>1)+(te&T&1);q[B[ne]]<q[Y]?te=ne+1:T=ne}q[Y]<q[B[te]]&&(te>0&&(S[Y]=B[te-1]),B[te]=Y)}for(te=B.length,T=B[te-1];te-- >0;)B[te]=T,T=S[T];return S.length=0,B}function M(q,B,te){for(;B<q.length;B++)if(q[B]!=null&&q[B].dom!=null)return q[B].dom;return te}function V(q,B,te){if(B.dom!=null){var T;if(B.domSize==null)T=B.dom;else{T=a(q).createDocumentFragment();for(var Y of za(B))T.appendChild(Y)}K(q,T,te)}}function K(q,B,te){te!=null?q.insertBefore(B,te):q.appendChild(B)}function H(q){if(q.attrs==null||q.attrs.contenteditable==null&&q.attrs.contentEditable==null)return!1;var B=q.children;if(B!=null&&B.length===1&&B[0].tag==="<"){var te=B[0].children;q.dom.innerHTML!==te&&(q.dom.innerHTML=te)}else if(B!=null&&B.length!==0)throw new Error("Child node of a contenteditable must be trusted.");return!0}function Q(q,B,te,T){for(var Y=te;Y<T;Y++){var ie=B[Y];ie!=null&&W(q,ie)}}function re(q,B,te,T){var Y=B.state,ie=n.call(te.onbeforeremove,B);if(ie!=null){var me=f;for(var ne of za(B))eo.set(ne,me);T.v++,Promise.resolve(ie).finally(function(){t(B,Y),ue(q,B,T)})}}function ue(q,B,te){--te.v===0&&(C(B),$(q,B))}function W(q,B){var te={v:1};typeof B.tag!="string"&&typeof B.state.onbeforeremove=="function"&&re(q,B,B.state,te),B.attrs&&typeof B.attrs.onbeforeremove=="function"&&re(q,B,B.attrs,te),ue(q,B,te)}function $(q,B){if(B.dom!=null)if(B.domSize==null)q.removeChild(B.dom);else for(var te of za(B))q.removeChild(te)}function C(q){if(typeof q.tag!="string"&&typeof q.state.onremove=="function"&&n.call(q.state.onremove,q),q.attrs&&typeof q.attrs.onremove=="function"&&n.call(q.attrs.onremove,q),typeof q.tag!="string")q.instance!=null&&C(q.instance);else{q.events!=null&&(q.events._=null);var B=q.children;if(Array.isArray(B))for(var te=0;te<B.length;te++){var T=B[te];T!=null&&C(T)}}}function J(q,B,te){for(var T in B)F(q,T,null,B[T],te)}function F(q,B,te,T,Y){if(!(B==="key"||T==null||ce(B)||te===T&&!ae(q,B)&&typeof T!="object")){if(B[0]==="o"&&B[1]==="n")return he(q,B,T);if(B.slice(0,6)==="xlink:")q.dom.setAttributeNS("http://www.w3.org/1999/xlink",B.slice(6),T);else if(B==="style")oe(q.dom,te,T);else if(Se(q,B,Y)){if(B==="value"){if((q.tag==="input"||q.tag==="textarea")&&q.dom.value===""+T||q.tag==="select"&&te!==null&&q.dom.value===""+T||q.tag==="option"&&te!==null&&q.dom.value===""+T)return;if(q.tag==="input"&&q.attrs.type==="file"&&""+T!=""){console.error("`value` is read-only on file inputs!");return}}q.tag==="input"&&B==="type"?q.dom.setAttribute(B,T):q.dom[B]=T}else typeof T=="boolean"?T?q.dom.setAttribute(B,""):q.dom.removeAttribute(B):q.dom.setAttribute(B==="className"?"class":B,T)}}function I(q,B,te,T){if(!(B==="key"||te==null||ce(B)))if(B[0]==="o"&&B[1]==="n")he(q,B,void 0);else if(B==="style")oe(q.dom,te,null);else if(Se(q,B,T)&&B!=="className"&&B!=="title"&&!(B==="value"&&(q.tag==="option"||q.tag==="select"&&q.dom.selectedIndex===-1&&q.dom===c(q.dom)))&&!(q.tag==="input"&&B==="type"))q.dom[B]=null;else{var Y=B.indexOf(":");Y!==-1&&(B=B.slice(Y+1)),te!==!1&&q.dom.removeAttribute(B==="className"?"class":B)}}function N(q,B){if("value"in B)if(B.value===null)q.dom.selectedIndex!==-1&&(q.dom.value=null);else{var te=""+B.value;(q.dom.value!==te||q.dom.selectedIndex===-1)&&(q.dom.value=te)}"selectedIndex"in B&&F(q,"selectedIndex",null,B.selectedIndex,void 0)}function G(q,B,te,T){var Y;if(B!=null){B===te&&!kn.has(te)&&console.warn("Don't reuse attrs object, use new object for every redraw, this will throw in next major");for(var ie in B)(Y=B[ie])!=null&&(te==null||te[ie]==null)&&I(q,ie,Y,T)}if(te!=null)for(var ie in te)F(q,ie,B&&B[ie],te[ie],T)}function ae(q,B){return B==="value"||B==="checked"||B==="selectedIndex"||B==="selected"&&(q.dom===c(q.dom)||q.tag==="option"&&q.dom.parentNode===c(q.dom))}function ce(q){return q==="oninit"||q==="oncreate"||q==="onupdate"||q==="onremove"||q==="onbeforeremove"||q==="onbeforeupdate"}function Se(q,B,te){return te===void 0&&(q.tag.indexOf("-")>-1||q.is||B!=="href"&&B!=="list"&&B!=="form"&&B!=="width"&&B!=="height")&&B in q.dom}function oe(q,B,te){if(B!==te)if(te==null)q.style="";else if(typeof te!="object")q.style=te;else if(B==null||typeof B!="object"){q.style="";for(var T in te){var Y=te[T];Y!=null&&(T.includes("-")?q.style.setProperty(T,String(Y)):q.style[T]=String(Y))}}else{for(var T in B)B[T]!=null&&te[T]==null&&(T.includes("-")?q.style.removeProperty(T):q.style[T]="");for(var T in te){var Y=te[T];Y!=null&&(Y=String(Y))!==String(B[T])&&(T.includes("-")?q.style.setProperty(T,Y):q.style[T]=Y)}}}function Z(){this._=r}Z.prototype=Object.create(null),Z.prototype.handleEvent=function(q){var B=this["on"+q.type],te;typeof B=="function"?te=B.call(q.currentTarget,q):typeof B.handleEvent=="function"&&B.handleEvent(q);var T=this;T._!=null&&(q.redraw!==!1&&(0,T._)(),te!=null&&typeof te.then=="function"&&Promise.resolve(te).then(function(){T._!=null&&q.redraw!==!1&&(0,T._)()})),te===!1&&(q.preventDefault(),q.stopPropagation())};function he(q,B,te){if(q.events!=null){if(q.events._=r,q.events[B]===te)return;te!=null&&(typeof te=="function"||typeof te=="object")?(q.events[B]==null&&q.dom.addEventListener(B.slice(2),q.events,!1),q.events[B]=te):(q.events[B]!=null&&q.dom.removeEventListener(B.slice(2),q.events,!1),q.events[B]=void 0)}else te!=null&&(typeof te=="function"||typeof te=="object")&&(q.events=new Z,q.dom.addEventListener(B.slice(2),q.events,!1),q.events[B]=te)}function E(q,B,te){typeof q.oninit=="function"&&n.call(q.oninit,B),typeof q.oncreate=="function"&&te.push(n.bind(q.oncreate,B))}function z(q,B,te){typeof q.onupdate=="function"&&te.push(n.bind(q.onupdate,B))}function X(q,B){do{if(q.attrs!=null&&typeof q.attrs.onbeforeupdate=="function"){var te=n.call(q.attrs.onbeforeupdate,q,B);if(te!==void 0&&!te)break}if(typeof q.tag!="string"&&typeof q.state.onbeforeupdate=="function"){var te=n.call(q.state.onbeforeupdate,q,B);if(te!==void 0&&!te)break}return!1}while(!1);return q.dom=B.dom,q.domSize=B.domSize,q.instance=B.instance,q.attrs=B.attrs,q.children=B.children,q.text=B.text,!0}var de;return function(q,B,te){if(!q)throw new TypeError("DOM element being rendered to does not exist.");if(de!=null&&q.contains(de))throw new TypeError("Node is currently being rendered to and thus is locked.");var T=r,Y=de,ie=[],me=c(q),ne=q.namespaceURI;de=q,r=typeof te=="function"?te:void 0,f={};try{q.vnodes==null&&(q.textContent=""),B=qa.normalizeChildren(Array.isArray(B)?B:[B]),_(q,q.vnodes,B,ie,null,ne==="http://www.w3.org/1999/xhtml"?void 0:ne),q.vnodes=B,me!=null&&c(q)!==me&&typeof me.focus=="function"&&me.focus();for(var ye=0;ye<ie.length;ye++)ie[ye]()}finally{r=T,de=Y}}}});var Ja=wr((us,Dn)=>{"use strict";Dn.exports=_n()(typeof window<"u"?window:null)});var $n=wr((cs,On)=>{"use strict";var jn=la();On.exports=function(e,r,f){var a=[],i=!1,t=-1;function n(){for(t=0;t<a.length;t+=2)try{e(a[t],jn(a[t+1]),c)}catch(x){f.error(x)}t=-1}function c(){i||(i=!0,r(function(){i=!1,n()}))}c.sync=n;function b(x,w){if(w!=null&&w.view==null&&typeof w!="function")throw new TypeError("m.mount expects a component, not a vnode.");var g=a.indexOf(x);g>=0&&(a.splice(g,2),g<=t&&(t-=2),e(x,[])),w!=null&&(a.push(x,w),e(x,jn(w),c))}return{mount:b,redraw:c}}});var Oa=wr((ds,An)=>{"use strict";var to=Ja();An.exports=$n()(to,typeof requestAnimationFrame<"u"?requestAnimationFrame:null,typeof console<"u"?console:null)});var Ya=wr((fs,In)=>{"use strict";In.exports=function(e){if(Object.prototype.toString.call(e)!=="[object Object]")return"";var r=[];for(var f in e)a(f,e[f]);return r.join("&");function a(i,t){if(Array.isArray(t))for(var n=0;n<t.length;n++)a(i+"["+n+"]",t[n]);else if(Object.prototype.toString.call(t)==="[object Object]")for(var n in t)a(i+"["+n+"]",t[n]);else r.push(encodeURIComponent(i)+(t!=null&&t!==""?"="+encodeURIComponent(t):""))}}});var $a=wr((ps,En)=>{"use strict";var ro=Ya();En.exports=function(e,r){if(/:([^\/\.-]+)(\.{3})?:/.test(e))throw new SyntaxError("Template parameter names must be separated by either a '/', '-', or '.'.");if(r==null)return e;var f=e.indexOf("?"),a=e.indexOf("#"),i=a<0?e.length:a,t=f<0?i:f,n=e.slice(0,t),c={};Object.assign(c,r);var b=n.replace(/:([^\/\.-]+)(\.{3})?/g,function(l,d,_){return delete c[d],r[d]==null?l:_?r[d]:encodeURIComponent(String(r[d]))}),x=b.indexOf("?"),w=b.indexOf("#"),g=w<0?b.length:w,o=x<0?g:x,u=b.slice(0,o);f>=0&&(u+=e.slice(f,i)),x>=0&&(u+=(f<0?"?":"&")+b.slice(x,g));var h=ro(c);return h&&(u+=(f<0&&x<0?"?":"&")+h),a>=0&&(u+=e.slice(a)),w>=0&&(u+=(a<0?"":"&")+b.slice(w)),u}});var Fn=wr((gs,Mn)=>{"use strict";var ao=$a(),Tn=ja();Mn.exports=function(e,r){function f(t){return new Promise(t)}function a(t,n){return new Promise(function(c,b){t=ao(t,n.params);var x=n.method!=null?n.method.toUpperCase():"GET",w=n.body,g=(n.serialize==null||n.serialize===JSON.serialize)&&!(w instanceof e.FormData||w instanceof e.URLSearchParams),o=n.responseType||(typeof n.extract=="function"?"":"json"),u=new e.XMLHttpRequest,h=!1,l=!1,d=u,_,p=u.abort;u.abort=function(){h=!0,p.call(this)},u.open(x,t,n.async!==!1,typeof n.user=="string"?n.user:void 0,typeof n.password=="string"?n.password:void 0),g&&w!=null&&!i(n,"content-type")&&u.setRequestHeader("Content-Type","application/json; charset=utf-8"),typeof n.deserialize!="function"&&!i(n,"accept")&&u.setRequestHeader("Accept","application/json, text/*"),n.withCredentials&&(u.withCredentials=n.withCredentials),n.timeout&&(u.timeout=n.timeout),u.responseType=o;for(var m in n.headers)Tn.call(n.headers,m)&&u.setRequestHeader(m,n.headers[m]);u.onreadystatechange=function(y){if(!h&&y.target.readyState===4)try{var k=y.target.status>=200&&y.target.status<300||y.target.status===304||/^file:\/\//i.test(t),v=y.target.response,D;if(o==="json"){if(!y.target.responseType&&typeof n.extract!="function")try{v=JSON.parse(y.target.responseText)}catch{v=null}}else(!o||o==="text")&&v==null&&(v=y.target.responseText);if(typeof n.extract=="function"?(v=n.extract(y.target,n),k=!0):typeof n.deserialize=="function"&&(v=n.deserialize(v)),k){if(typeof n.type=="function")if(Array.isArray(v))for(var j=0;j<v.length;j++)v[j]=new n.type(v[j]);else v=new n.type(v);c(v)}else{var S=function(){try{D=y.target.responseText}catch{D=v}var A=new Error(D);A.code=y.target.status,A.response=v,b(A)};u.status===0?setTimeout(function(){l||S()}):S()}}catch(A){b(A)}},u.ontimeout=function(y){l=!0;var k=new Error("Request timed out");k.code=y.target.status,b(k)},typeof n.config=="function"&&(u=n.config(u,n,t)||u,u!==d&&(_=u.abort,u.abort=function(){h=!0,_.call(this)})),w==null?u.send():typeof n.serialize=="function"?u.send(n.serialize(w)):w instanceof e.FormData||w instanceof e.URLSearchParams?u.send(w):u.send(JSON.stringify(w))})}f.prototype=Promise.prototype,f.__proto__=Promise;function i(t,n){for(var c in t.headers)if(Tn.call(t.headers,c)&&c.toLowerCase()===n)return!0;return!1}return{request:function(t,n){typeof t!="string"?(n=t,t=t.url):n==null&&(n={});var c=a(t,n);if(n.background===!0)return c;var b=0;function x(){--b===0&&typeof r=="function"&&r()}return w(c);function w(g){var o=g.then;return g.constructor=f,g.then=function(){b++;var u=o.apply(g,arguments);return u.then(x,function(h){if(x(),b===0)throw h}),w(u)},g}}}}});var Rn=wr((hs,Ln)=>{"use strict";var no=Oa();Ln.exports=Fn()(typeof window<"u"?window:null,no.redraw)});var Ga=wr((ms,Nn)=>{"use strict";function Kn(e){try{return decodeURIComponent(e)}catch{return e}}Nn.exports=function(e){if(e===""||e==null)return{};e.charAt(0)==="?"&&(e=e.slice(1));for(var r=e.split("&"),f={},a={},i=0;i<r.length;i++){var t=r[i].split("="),n=Kn(t[0]),c=t.length===2?Kn(t[1]):"";c==="true"?c=!0:c==="false"&&(c=!1);var b=n.split(/\]\[?|\[/),x=a;n.indexOf("[")>-1&&b.pop();for(var w=0;w<b.length;w++){var g=b[w],o=b[w+1],u=o==""||!isNaN(parseInt(o,10));if(g===""){var n=b.slice(0,w).join();f[n]==null&&(f[n]=Array.isArray(x)?x.length:0),g=f[n]++}else if(g==="__proto__")break;if(w===b.length-1)x[g]=c;else{var h=Object.getOwnPropertyDescriptor(x,g);h!=null&&(h=h.value),h==null&&(x[g]=h=u?[]:{}),x=h}}}return a}});var Aa=wr((bs,Bn)=>{"use strict";var io=Ga();Bn.exports=function(e){var r=e.indexOf("?"),f=e.indexOf("#"),a=f<0?e.length:f,i=r<0?a:r,t=e.slice(0,i).replace(/\/{2,}/g,"/");return t?t[0]!=="/"&&(t="/"+t):t="/",{path:t,params:r<0?{}:io(e.slice(r+1,a))}}});var Cn=wr((ys,Un)=>{"use strict";var oo=Aa();Un.exports=function(e){var r=oo(e),f=Object.keys(r.params),a=[],i=new RegExp("^"+r.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(t,n,c){return n==null?"\\"+t:(a.push({k:n,r:c==="..."}),c==="..."?"(.*)":c==="."?"([^/]+)\\.":"([^/]+)"+(c||""))})+"\\/?$");return function(t){for(var n=0;n<f.length;n++)if(r.params[f[n]]!==t.params[f[n]])return!1;if(!a.length)return i.test(t.path);var c=i.exec(t.path);if(c==null)return!1;for(var n=0;n<a.length;n++)t.params[a[n].k]=a[n].r?c[n+1]:decodeURIComponent(c[n+1]);return!0}}});var Ha=wr((vs,zn)=>{"use strict";var Vn=ja(),qn=new RegExp("^(?:key|oninit|oncreate|onbeforeupdate|onupdate|onbeforeremove|onremove)$");zn.exports=function(e,r){var f={};if(r!=null)for(var a in e)Vn.call(e,a)&&!qn.test(a)&&r.indexOf(a)<0&&(f[a]=e[a]);else for(var a in e)Vn.call(e,a)&&!qn.test(a)&&(f[a]=e[a]);return f}});var Hn=wr((xs,Gn)=>{"use strict";var so=la(),lo=Ba(),Jn=$a(),Yn=Aa(),uo=Cn(),co=Ha();function fo(e){try{return decodeURIComponent(e)}catch{return e}}Gn.exports=function(e,r){var f=e==null?null:typeof e.setImmediate=="function"?e.setImmediate:e.setTimeout,a=Promise.resolve(),i=!1,t=!1,n=!1,c,b,x,w,g,o,u,h,l={onremove:function(){t=n=!1,e.removeEventListener("popstate",p,!1)},view:function(){var y=so(g,o.key,o);return w?w.render(y):[y]}},d=m.SKIP={};function _(){i=!1;var y=e.location.hash;m.prefix[0]!=="#"&&(y=e.location.search+y,m.prefix[0]!=="?"&&(y=e.location.pathname+y,y[0]!=="/"&&(y="/"+y)));var k=y.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,fo).slice(m.prefix.length),v=Yn(k);Object.assign(v.params,e.history.state);function D(S){console.error(S),m.set(x,null,{replace:!0})}j(0);function j(S){for(;S<b.length;S++)if(b[S].check(v)){var A=b[S].component,M=b[S].route,V=A,K=h=function(H){if(K===h){if(H===d)return j(S+1);g=H!=null&&(typeof H.view=="function"||typeof H=="function")?H:"div",o=v.params,u=k,h=null,w=A.render?A:null,n?r.redraw():(n=!0,r.mount(c,l))}};A.view||typeof A=="function"?(A={},K(V)):A.onmatch?a.then(function(){return A.onmatch(v.params,k,M)}).then(K,k===x?null:D):K();return}if(k===x)throw new Error("Could not resolve default route "+x+".");m.set(x,null,{replace:!0})}}function p(){i||(i=!0,f(_))}function m(y,k,v){if(!y)throw new TypeError("DOM element being rendered to does not exist.");if(b=Object.keys(v).map(function(j){if(j[0]!=="/")throw new SyntaxError("Routes must start with a '/'.");if(/:([^\/\.-]+)(\.{3})?:/.test(j))throw new SyntaxError("Route parameter names must be separated with either '/', '.', or '-'.");return{route:j,component:v[j],check:uo(j)}}),x=k,k!=null){var D=Yn(k);if(!b.some(function(j){return j.check(D)}))throw new ReferenceError("Default route doesn't match any known routes.")}c=y,e.addEventListener("popstate",p,!1),t=!0,_()}return m.set=function(y,k,v){if(h!=null&&(v=v||{},v.replace=!0),h=null,y=Jn(y,k),t){p();var D=v?v.state:null,j=v?v.title:null;v&&v.replace?e.history.replaceState(D,j,m.prefix+y):e.history.pushState(D,j,m.prefix+y)}else e.location.href=m.prefix+y},m.get=function(){return u},m.prefix="#!",m.Link={view:function(y){var k=lo(y.attrs.selector||"a",co(y.attrs,["options","params","selector","onclick"]),y.children),v,D,j;return(k.attrs.disabled=!!k.attrs.disabled)?(k.attrs.href=null,k.attrs["aria-disabled"]="true"):(v=y.attrs.options,D=y.attrs.onclick,j=Jn(k.attrs.href,y.attrs.params),k.attrs.href=m.prefix+j,k.attrs.onclick=function(S){var A;typeof D=="function"?A=D.call(S.currentTarget,S):D==null||typeof D!="object"||typeof D.handleEvent=="function"&&D.handleEvent(S),A!==!1&&!S.defaultPrevented&&(S.button===0||S.which===0||S.which===1)&&(!S.currentTarget.target||S.currentTarget.target==="_self")&&!S.ctrlKey&&!S.metaKey&&!S.shiftKey&&!S.altKey&&(S.preventDefault(),S.redraw=!1,m.set(j,null,v))}),k}},m.param=function(y){return o&&y!=null?o[y]:o},m}});var Qn=wr((ws,Wn)=>{"use strict";var po=Oa();Wn.exports=Hn()(typeof window<"u"?window:null,po)});var lr=wr((ks,Zn)=>{"use strict";var Ia=xn(),go=Rn(),Xn=Oa(),ho=Va(),Cr=function(){return Ia.apply(this,arguments)};Cr.m=Ia;Cr.trust=Ia.trust;Cr.fragment=Ia.fragment;Cr.Fragment="[";Cr.mount=Xn.mount;Cr.route=Qn();Cr.render=Ja();Cr.redraw=Xn.redraw;Cr.request=go.request;Cr.parseQueryString=Ga();Cr.buildQueryString=Ya();Cr.parsePathname=Aa();Cr.buildPathname=$a();Cr.vnode=la();Cr.censor=Ha();Cr.domFor=ho.domFor;Zn.exports=Cr});var ri={};Ri(ri,{default:()=>ct,showConfirmation:()=>ia,showPrompt:()=>Wa,showToast:()=>bo});function ei(){let r=0;for(let f=ba.length-1;f>=0;f--){let a=ba[f];a.style.bottom=`${20+r}px`,a.style.right="20px",a.style.zIndex="9999",r+=a.offsetHeight+10}}var na,ba,Ea,ma,ia,Wa,ti,bo,ct,Wr=Li(()=>{na=e=>document.createElement(e),ba=[],Ea=new Set,ma=(e,r="info",f=5e3)=>{let a=na("div"),i={success:"bg-[#93DA97] border border-[#93DA97] text-green-900",warning:"bg-[#E3DE61] border border-[#E3DE61] text-yellow-900",error:"bg-[#C51605] border border-[#C51605] text-white",info:"bg-[#3876BF] border border-[#3876BF] text-white",notification:"bg-[#C7BCA1] border border-[#C7BCA1] text-gray-900",prompt:"bg-[#495371] border border-[#495371] text-white"},t=i[r]||i.info;a.className=`toast ${r} fixed px-4 py-3 rounded-lg shadow-lg transition-all duration-300 ease-in-out transform ${t} max-w-md z-50`,a.textContent=e,document.body.appendChild(a),ba.push(a),Ea.add(a),ei(),setTimeout(()=>{a.style.transform="translateX(0)",a.style.opacity="1"},10);let n=()=>{a.style.transform="translateX(100%)",a.style.opacity="0",setTimeout(()=>{if(a.parentNode){let c=ba.indexOf(a);c>-1&&ba.splice(c,1),Ea.delete(a),a.parentNode.removeChild(a),ei()}},300)};return setTimeout(n,f),a.removeToast=n,a};ia=(e,r,f)=>{let a=na("div");a.className="toast toast-confirmation fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#FF6B35] border-2 border-[#FF6B35] rounded-lg shadow-lg p-4 max-w-md z-50";let i=na("div");i.className="toast-message mb-4 text-white text-lg",i.textContent=e;let t=na("div");t.className="toast-buttons flex justify-end space-x-2";let n=na("button");n.className="toast-button toast-button-yes px-4 py-2 bg-white text-[#FF6B35] rounded hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 transition-colors",n.textContent="Ya",n.onclick=()=>{a.parentNode&&a.parentNode.removeChild(a),r&&r()};let c=na("button");c.className="toast-button toast-button-no px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 transition-colors",c.textContent="Tidak",c.onclick=()=>{a.parentNode&&a.parentNode.removeChild(a),f&&f()},t.append(n,c),a.append(i,t),document.body.appendChild(a)},Wa=(e,r,f,a={})=>{let i=na("div");i.className="toast toast-prompt-centered fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-[#DC143C] border border-[#DC143C] rounded-lg shadow-xl p-6 max-w-md z-50";let t=na("div");t.className="toast-message mb-4 text-white font-medium",t.textContent=e;let n=na("form");n.className="toast-form",n.onsubmit=g=>{g.preventDefault(),x.click()};let c=na("input");c.className="toast-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mb-4 text-white bg-[#464E2E]",c.type=a.type||"text",c.placeholder=a.placeholder||"",a.required&&(c.required=!0);let b=na("div");b.className="toast-buttons flex justify-end space-x-2";let x=na("button");x.className="toast-button toast-button-yes px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-colors",x.textContent=a.confirmText||"Lanjut",x.type="button",x.onclick=()=>{if(a.required&&!c.value.trim()){c.focus(),c.classList.add("border-red-500"),setTimeout(()=>c.classList.remove("border-red-500"),2e3);return}i.parentNode&&i.parentNode.removeChild(i),r&&r(c.value)};let w=na("button");return w.className="toast-button toast-button-no px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 transition-colors",w.textContent=a.cancelText||"Batal",w.type="button",w.onclick=()=>{i.parentNode&&i.parentNode.removeChild(i),f&&f()},c.addEventListener("keypress",g=>{g.key==="Enter"&&x.click()}),n.append(c),b.append(x,w),i.append(t,n,b),document.body.appendChild(i),c.focus(),i},ti={show:(e,r="info",f=5e3)=>ma(e,r,f),success:(e,r=5e3)=>ma(e,"success",r),error:(e,r=5e3)=>ma(e,"error",r),warning:(e,r=4e3)=>ma(e,"warning",r),info:(e,r=3e3)=>ma(e,"info",r),notification:(e,r=5e3)=>ma(e,"notification",r),clear:()=>{Ea.forEach(e=>{e.removeToast?e.removeToast():e.parentNode&&e.parentNode.removeChild(e)}),Ea.clear(),ba=[]}},bo=ti.show,ct=ti});var si=wr((Sa,Qa)=>{(function(e,r){typeof Sa=="object"&&typeof Qa=="object"?Qa.exports=r():typeof define=="function"&&define.amd?define([],r):typeof Sa=="object"?Sa.mongoose=r():e.mongoose=r()})(typeof self<"u"?self:Sa,()=>(()=>{var e={118:a=>{"use strict";a.exports=function(i){return i!=i}},170:(a,i,t)=>{"use strict";function n(j){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},n(j)}var c=t(3609),b=t(8995),x=t(7768),w=t(7236),g=new Set(["$and","$or"]),o=new Set(["$cmp","$eq","$lt","$lte","$gt","$gte"]),u=new Set(["$multiply","$divide","$log","$mod","$trunc","$avg","$max","$min","$stdDevPop","$stdDevSamp","$sum"]),h=new Set(["$abs","$exp","$ceil","$floor","$ln","$log10","$sqrt","$sin","$cos","$tan","$asin","$acos","$atan","$atan2","$asinh","$acosh","$atanh","$sinh","$cosh","$tanh","$degreesToRadians","$radiansToDegrees"]),l=new Set(["$arrayElemAt","$first","$last"]),d=new Set(["$year","$month","$week","$dayOfMonth","$dayOfYear","$hour","$minute","$second","$isoDayOfWeek","$isoWeekYear","$isoWeek","$millisecond"]),_=new Set(["$not"]);function p(j,S,A){if(v(j)||j===null)return j;j.$cond!=null?Array.isArray(j.$cond)?j.$cond=j.$cond.map(function(Q){return p(Q,S,A)}):(j.$cond.if=p(j.$cond.if,S,A),j.$cond.then=p(j.$cond.then,S,A),j.$cond.else=p(j.$cond.else,S,A)):j.$ifNull!=null?j.$ifNull.map(function(Q){return p(Q,S,A)}):j.$switch!=null&&(Array.isArray(j.$switch.branches)&&(j.$switch.branches=j.$switch.branches.map(function(Q){return p(Q,S,A)})),"default"in j.$switch&&(j.$switch.default=p(j.$switch.default,S,A)));for(var M=0,V=Object.keys(j);M<V.length;M++){var K=V[M];g.has(K)?j[K]=j[K].map(function(Q){return p(Q,S,A)}):o.has(K)?j[K]=k(j[K],S,A):u.has(K)?j[K]=y(j[K]):h.has(K)?j[K]=m(j[K]):_.has(K)&&(j[K]=p(j[K],S,A))}if(j.$in&&(j.$in=function(Q,re,ue){var W=Q[1];if(!v(W))return Q;var $=Q[0],C=re.path(W.slice(1));if(C!==null){if(!C.$isMongooseArray)throw new Error("Path must be an array for $in");return[C.$isMongooseDocumentArray?C.$embeddedSchemaType.cast($):C.caster.cast($),W]}if(ue===!1)return Q;if(ue==="throw")throw new b("$in")}(j.$in,S,A)),j.$size&&(j.$size=m(j.$size)),j.$round){var H=j.$round;if(!Array.isArray(H)||H.length<1||H.length>2)throw new c("Array",H,"$round");j.$round=H.map(function(Q){return m(Q)})}return w(j),j}function m(j){if(!D(j))return j;try{return x(j)}catch{throw new c("Number",j)}}function y(j){if(!Array.isArray(j)){if(!D(j))return j;try{return x(j)}catch{throw new c("Number",j)}}return j.map(function(S){if(!D(S))return S;try{return x(S)}catch{throw new c("Number",S)}})}function k(j,S,A){if(!Array.isArray(j)||j.length!==2)throw new Error("Comparison operator must be an array of length 2");j[0]=p(j[0],S,A);var M=j[0];if(D(j[1])){var V=null,K=null,H=null;if(v(M))V=M.slice(1),K=S.path(V);else if(n(M)==="object"&&M!=null)for(var Q=0,re=Object.keys(M);Q<re.length;Q++){var ue=re[Q];d.has(ue)&&v(M[ue])?(V=M[ue].slice(1)+"."+ue,H=x):l.has(ue)&&v(M[ue])&&(V=M[ue].slice(1)+"."+ue,(K=S.path(M[ue].slice(1)))!=null&&(K.$isMongooseDocumentArray?K=K.$embeddedSchemaType:K.$isMongooseArray&&(K=K.caster)))}var W=n(j[1])==="object"&&j[1]!=null&&j[1].$literal!=null;if(K!=null)j[1]=W?{$literal:K.cast(j[1].$literal)}:K.cast(j[1]);else if(H!=null)if(W)try{j[1]={$literal:H(j[1].$literal)}}catch{throw new c(H.name.replace(/^cast/,""),j[1],V+".$literal")}else try{j[1]=H(j[1])}catch{throw new c(H.name.replace(/^cast/,""),j[1],V)}else{if(V!=null&&A===!0)return;if(V!=null&&A==="throw")throw new b(V)}}else j[1]=p(j[1]);return j}function v(j){return typeof j=="string"&&j[0]==="$"}function D(j){return!(typeof j=="string"&&j[0]==="$"||n(j)==="object"&&j!==null&&Object.keys(j).find(function(S){return S[0]==="$"})&&j.$literal==null)}a.exports=function(j,S,A){if(typeof j=="boolean")return j;if(n(j)!=="object"||j===null)throw new Error("`$expr` must be an object or boolean literal");return p(j,S,A)}},209:(a,i,t)=>{"use strict";function n(w){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},n(w)}var c=t(2403),b=t(5825),x=t(6583);a.exports=c?function(w){return c(w)}:b?function(w){if(!w||n(w)!=="object"&&typeof w!="function")throw new TypeError("getProto: not an object");return b(w)}:x?function(w){return x(w)}:null},241:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}function c(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!o})()}function b(o){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},b(o)}function x(o,u){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,l){return h.__proto__=l,h},x(o,u)}var w=function(o){function u(){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,u),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,u,arguments)}return function(l,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(d&&d.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),d&&x(l,d)}(u,o),h=u,Object.defineProperty(h,"prototype",{writable:!1}),h;var h}(t(8879)),g=t(5761);Object.defineProperty(w.prototype,"of",g),a.exports=w},354:a=>{function i(g){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},i(g)}var t=1e3,n=60*t,c=60*n,b=24*c,x=7*b;function w(g,o,u,h){var l=o>=1.5*u;return Math.round(g/u)+" "+h+(l?"s":"")}a.exports=function(g,o){o=o||{};var u,h,l=i(g);if(l==="string"&&g.length>0)return function(d){if(!((d=String(d)).length>100)){var _=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(_){var p=parseFloat(_[1]);switch((_[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*p;case"weeks":case"week":case"w":return p*x;case"days":case"day":case"d":return p*b;case"hours":case"hour":case"hrs":case"hr":case"h":return p*c;case"minutes":case"minute":case"mins":case"min":case"m":return p*n;case"seconds":case"second":case"secs":case"sec":case"s":return p*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return p;default:return}}}}(g);if(l==="number"&&isFinite(g))return o.long?(u=g,(h=Math.abs(u))>=b?w(u,h,b,"day"):h>=c?w(u,h,c,"hour"):h>=n?w(u,h,n,"minute"):h>=t?w(u,h,t,"second"):u+" ms"):function(d){var _=Math.abs(d);return _>=b?Math.round(d/b)+"d":_>=c?Math.round(d/c)+"h":_>=n?Math.round(d/n)+"m":_>=t?Math.round(d/t)+"s":d+"ms"}(g);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(g))}},433:(a,i,t)=>{"use strict";function n(p){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},n(p)}function c(p,m){var y=Object.keys(p);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(p);m&&(k=k.filter(function(v){return Object.getOwnPropertyDescriptor(p,v).enumerable})),y.push.apply(y,k)}return y}function b(p){for(var m=1;m<arguments.length;m++){var y=arguments[m]!=null?arguments[m]:{};m%2?c(Object(y),!0).forEach(function(k){x(p,k,y[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(y)):c(Object(y)).forEach(function(k){Object.defineProperty(p,k,Object.getOwnPropertyDescriptor(y,k))})}return p}function x(p,m,y){return(m=function(k){var v=function(D){if(n(D)!="object"||!D)return D;var j=D[Symbol.toPrimitive];if(j!==void 0){var S=j.call(D,"string");if(n(S)!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(D)}(k);return n(v)=="symbol"?v:v+""}(m))in p?Object.defineProperty(p,m,{value:y,enumerable:!0,configurable:!0,writable:!0}):p[m]=y,p}var w=t(3609),g=t(6426),o=t(5413),u=t(4327),h=t(9460);function l(p,m){g.call(this,p,m,"Int32")}l.schemaName="Int32",l.defaultOptions={},l.prototype=Object.create(g.prototype),l.prototype.constructor=l,l._cast=o,l.set=g.set,l.setters=[],l.get=g.get,l._defaultCaster=function(p){if(p!=null&&(typeof p!="number"||p!==(0|p)||p<-2147483648||p>2147483647))throw new Error;return p},l.cast=function(p){return arguments.length===0||(p===!1&&(p=this._defaultCaster),this._cast=p),this._cast},l._checkRequired=function(p){return p!=null},l.checkRequired=g.checkRequired,l.prototype.checkRequired=function(p){return this.constructor._checkRequired(p)},l.prototype.cast=function(p){var m;m=typeof this._castFunction=="function"?this._castFunction:typeof this.constructor.cast=="function"?this.constructor.cast():l.cast();try{return m(p)}catch(y){throw new w("Int32",p,this.path,y,this)}};var d=b(b({},g.prototype.$conditionalHandlers),{},{$gt:_,$gte:_,$lt:_,$lte:_,$bitsAllClear:h,$bitsAnyClear:h,$bitsAllSet:h,$bitsAnySet:h});function _(p,m){return this.castForQuery(null,p,m)}Object.defineProperty(l.prototype,"$conditionalHandlers",{enumerable:!1,value:d}),l.prototype.castForQuery=function(p,m,y){var k;if(p!=null)return(k=this.$conditionalHandlers[p])?k.call(this,m):this.applySetters(m,y);try{return this.applySetters(m,y)}catch(v){throw v instanceof w&&v.path===this.path&&this.$fullPath!=null&&(v.path=this.$fullPath),v}},l.prototype.toJSONSchema=function(p){var m=this.options.required&&typeof this.options.required!="function";return u("number","int",p?.useBsonType,m)},l.prototype.autoEncryptionType=function(){return"int"},a.exports=l},486:a=>{"use strict";a.exports=function(i){var t={_id:{auto:!0}};t._id[i.options.typeKey]="ObjectId",i.add(t)}},533:(a,i,t)=>{"use strict";var n=t(8213),c=t(7352);a.exports=function(b,x){if(typeof b!="string"&&typeof b!="function")throw new n('Invalid ref at path "'+x+'". Got '+c.inspect(b,{depth:0}))}},542:a=>{"use strict";function i(t){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i(t)}a.exports=function(t){return!!t&&(i(t)==="object"||typeof t=="function")&&typeof t.then=="function"}},608:(a,i,t)=>{"use strict";var n=t(5832).hp;a.exports=function(c){return n.isBuffer(c)||Object.prototype.toString.call(c)==="[object Object]"}},622:(a,i,t)=>{"use strict";function n(o,u){var h=typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(!h){if(Array.isArray(o)||(h=function(y,k){if(y){if(typeof y=="string")return c(y,k);var v={}.toString.call(y).slice(8,-1);return v==="Object"&&y.constructor&&(v=y.constructor.name),v==="Map"||v==="Set"?Array.from(y):v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v)?c(y,k):void 0}}(o))||u&&o&&typeof o.length=="number"){h&&(o=h);var l=0,d=function(){};return{s:d,n:function(){return l>=o.length?{done:!0}:{done:!1,value:o[l++]}},e:function(y){throw y},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _,p=!0,m=!1;return{s:function(){h=h.call(o)},n:function(){var y=h.next();return p=y.done,y},e:function(y){m=!0,_=y},f:function(){try{p||h.return==null||h.return()}finally{if(m)throw _}}}}function c(o,u){(u==null||u>o.length)&&(u=o.length);for(var h=0,l=Array(u);h<u;h++)l[h]=o[h];return l}var b=t(4009),x=t(8768),w=t(7930).modelSymbol;function g(o,u){this.path=u,this.getters=[],this.setters=[],this.options=Object.assign({},o)}g.prototype._applyDefaultGetters=function(){if(!(this.getters.length>0||this.setters.length>0)){var o="$"+this.path;this.getters.push(function(){return this.$locals[o]}),this.setters.push(function(u){this.$locals[o]=u})}},g.prototype.clone=function(){var o=new g(this.options,this.path);return o.getters=[].concat(this.getters),o.setters=[].concat(this.setters),o},g.prototype.get=function(o){return this.getters.push(o),this},g.prototype.set=function(o){return this.setters.push(o),this},g.prototype.applyGetters=function(o,u){x.hasUserDefinedProperty(this.options,["ref","refPath"])&&u.$$populatedVirtuals&&u.$$populatedVirtuals.hasOwnProperty(this.path)&&(o=u.$$populatedVirtuals[this.path]);var h,l=o,d=n(this.getters);try{for(d.s();!(h=d.n()).done;)l=h.value.call(u,l,this,u)}catch(_){d.e(_)}finally{d.f()}return l},g.prototype.applySetters=function(o,u){var h,l=o,d=n(this.setters);try{for(d.s();!(h=d.n()).done;)l=h.value.call(u,l,this,u)}catch(_){d.e(_)}finally{d.f()}return l},g.prototype._getModelNamesForPopulate=function(o){if(this.options.refPath)return b(this.options.refPath,o,this.path);var u;return(u=typeof this.options.ref!="function"||this.options.ref[w]?this.options.ref:this.options.ref.call(o,o))==null||Array.isArray(u)?u:[u]},a.exports=g},668:(a,i,t)=>{"use strict";var n=Array.prototype.slice,c=t(6312),b=Object.keys,x=b?function(g){return b(g)}:t(6544),w=Object.keys;x.shim=function(){if(Object.keys){var g=function(){var o=Object.keys(arguments);return o&&o.length===arguments.length}(1,2);g||(Object.keys=function(o){return c(o)?w(n.call(o)):w(o)})}else Object.keys=x;return Object.keys||x},a.exports=x},674:(a,i,t)=>{"use strict";var n=t(3414);a.exports=function(c){return n(c)||c===0?c:c<0?-1:1}},766:(a,i)=>{"use strict";var t=a.exports={};t.DocumentNotFoundError=null,t.general={},t.general.default="Validator failed for path `{PATH}` with value `{VALUE}`",t.general.required="Path `{PATH}` is required.",t.Number={},t.Number.min="Path `{PATH}` ({VALUE}) is less than minimum allowed value ({MIN}).",t.Number.max="Path `{PATH}` ({VALUE}) is more than maximum allowed value ({MAX}).",t.Number.enum="`{VALUE}` is not a valid enum value for path `{PATH}`.",t.Date={},t.Date.min="Path `{PATH}` ({VALUE}) is before minimum allowed value ({MIN}).",t.Date.max="Path `{PATH}` ({VALUE}) is after maximum allowed value ({MAX}).",t.String={},t.String.enum="`{VALUE}` is not a valid enum value for path `{PATH}`.",t.String.match="Path `{PATH}` is invalid ({VALUE}).",t.String.minlength="Path `{PATH}` (`{VALUE}`, length {LENGTH}) is shorter than the minimum allowed length ({MINLENGTH}).",t.String.maxlength="Path `{PATH}` (`{VALUE}`, length {LENGTH}) is longer than the maximum allowed length ({MAXLENGTH})."},783:a=>{"use strict";a.exports=ReferenceError},791:(a,i,t)=>{"use strict";function n(x,w){var g=typeof Symbol<"u"&&x[Symbol.iterator]||x["@@iterator"];if(!g){if(Array.isArray(x)||(g=function(_,p){if(_){if(typeof _=="string")return c(_,p);var m={}.toString.call(_).slice(8,-1);return m==="Object"&&_.constructor&&(m=_.constructor.name),m==="Map"||m==="Set"?Array.from(_):m==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m)?c(_,p):void 0}}(x))||w&&x&&typeof x.length=="number"){g&&(x=g);var o=0,u=function(){};return{s:u,n:function(){return o>=x.length?{done:!0}:{done:!1,value:x[o++]}},e:function(_){throw _},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h,l=!0,d=!1;return{s:function(){g=g.call(x)},n:function(){var _=g.next();return l=_.done,_},e:function(_){d=!0,h=_},f:function(){try{l||g.return==null||g.return()}finally{if(d)throw h}}}}function c(x,w){(w==null||w>x.length)&&(w=x.length);for(var g=0,o=Array(w);g<w;g++)o[g]=x[g];return o}var b=t(3703);a.exports=function(x,w,g){var o,u=g!=null?Object.keys(b(x.tree,g,{})):Object.keys(x.tree),h=new Set(Object.keys(w));if(h.size>1){o=new Set;var l,d=n(u);try{for(d.s();!(l=d.n()).done;){var _=l.value;h.has(_)&&o.add(_)}}catch(k){d.e(k)}finally{d.f()}var p,m=n(h);try{for(m.s();!(p=m.n()).done;){var y=p.value;o.has(y)||o.add(y)}}catch(k){m.e(k)}finally{m.f()}o=Array.from(o)}else o=Array.from(h);return o}},863:(a,i,t)=>{"use strict";var n=t(3305),c=t(5549);a.exports=function(b){if(b==null||n(b,"ObjectId"))return b;if(b._id){if(n(b._id,"ObjectId"))return b._id;if(b._id.toString instanceof Function)return new c(b._id.toString())}return b.toString instanceof Function?new c(b.toString()):new c(b)}},953:(a,i,t)=>{"use strict";var n=t(5484);a.exports=function(){return n()&&!!Symbol.toStringTag}},988:a=>{"use strict";var i=Object.defineProperty||!1;if(i)try{i({},"a",{value:1})}catch{i=!1}a.exports=i},1007:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}function c(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!o})()}function b(o){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},b(o)}function x(o,u){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,l){return h.__proto__=l,h},x(o,u)}var w=function(o){function u(){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,u),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,u,arguments)}return function(l,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(d&&d.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),d&&x(l,d)}(u,o),h=u,Object.defineProperty(h,"prototype",{writable:!1}),h;var h}(t(8879)),g=t(5761);Object.defineProperty(w.prototype,"min",g),Object.defineProperty(w.prototype,"max",g),Object.defineProperty(w.prototype,"enum",g),Object.defineProperty(w.prototype,"populate",g),a.exports=w},1058:(a,i,t)=>{"use strict";var n=t(2696);a.exports=function(c,b){if(c==null)return null;for(var x=0,w=Object.keys(c);x<w.length;x++){var g=c[w[x]];if(g.schema&&g.schema.discriminatorMapping&&n(g.schema.discriminatorMapping.value,b))return g}return null}},1091:a=>{"use strict";function i(t){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i(t)}a.exports=function(t){return t!=null&&i(t)==="object"&&t.$slice==null&&t.$elemMatch==null&&t.$meta==null&&t.$==null}},1129:(a,i,t)=>{"use strict";function n(u){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},n(u)}function c(){try{var u=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!u})()}function b(u){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(h){return h.__proto__||Object.getPrototypeOf(h)},b(u)}function x(u,h){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,d){return l.__proto__=d,l},x(u,h)}var w=t(8213),g=t(7352),o=function(u){function h(d,_,p,m){var y;(function(v,D){if(!(v instanceof D))throw new TypeError("Cannot call a class as a function")})(this,h);var k=w.messages;return(y=function(v,D,j){return D=b(D),function(S,A){if(A&&(n(A)=="object"||typeof A=="function"))return A;if(A!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(M){if(M===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M}(S)}(v,c()?Reflect.construct(D,j||[],b(v).constructor):D.apply(v,j))}(this,h,[k.DocumentNotFoundError!=null?typeof k.DocumentNotFoundError=="function"?k.DocumentNotFoundError(d,_):k.DocumentNotFoundError:'No document found for query "'+g.inspect(d)+'" on model "'+_+'"'])).result=m,y.numAffected=p,y.filter=d,y.query=d,y}return function(d,_){if(typeof _!="function"&&_!==null)throw new TypeError("Super expression must either be null or a function");d.prototype=Object.create(_&&_.prototype,{constructor:{value:d,writable:!0,configurable:!0}}),Object.defineProperty(d,"prototype",{writable:!1}),_&&x(d,_)}(h,u),l=h,Object.defineProperty(l,"prototype",{writable:!1}),l;var l}(w);Object.defineProperty(o.prototype,"name",{value:"DocumentNotFoundError"}),a.exports=o},1199:a=>{"use strict";a.exports=function(i,t){var n=Object.keys(i),c=Object.keys(t);if(n.length!==c.length)return!1;for(var b=0;b<n.length;b++){var x=n[b];if(x!==c[b]||i[x]!==t[x])return!1}return!0}},1226:a=>{"use strict";a.exports=function(i){return i==null?null:Object.keys(i)[0]}},1243:(a,i)=>{"use strict";i.isMongooseArray=function(t){return Array.isArray(t)&&t.isMongooseArray}},1244:(a,i,t)=>{"use strict";var n=t(3609);a.exports=function(c,b){if(c==null)return c;if(c._id&&typeof c._id=="string")return c._id;if(c.toString&&c.toString!==Object.prototype.toString&&!Array.isArray(c))return c.toString();throw new n("string",c,b)}},1260:(a,i)=>{"use strict";var t=Object.freeze(["countDocuments","distinct","estimatedDocumentCount","find","findOne","findOneAndReplace","findOneAndUpdate","replaceOne","updateMany","updateOne","deleteMany","deleteOne","findOneAndDelete"]).concat(["validate"]);i.Ut=t},1313:(a,i,t)=>{"use strict";var n=t(486);a.exports=function(c,b){return b==null||b._id==null||(c=c.clone(),b._id?c.paths._id||(n(c),c.options._id=!0):(c.remove("_id"),c.options._id=!1)),c}},1344:(a,i,t)=>{"use strict";a.exports=t(6353).UUID},1347:(a,i)=>{"use strict";i.isMongooseDocumentArray=function(t){return Array.isArray(t)&&t.isMongooseDocumentArray}},1350:(a,i,t)=>{"use strict";function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}function c(){try{var g=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!g})()}function b(g){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},b(g)}function x(g,o){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},x(g,o)}var w=function(g){function o(h,l,d){return function(_,p){if(!(_ instanceof p))throw new TypeError("Cannot call a class as a function")}(this,o),function(_,p,m){return p=b(p),function(y,k){if(k&&(n(k)=="object"||typeof k=="function"))return k;if(k!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(v){if(v===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v}(y)}(_,c()?Reflect.construct(p,m||[],b(_).constructor):p.apply(_,m))}(this,o,['Parameter "'+l+'" to '+d+'() must be an object, got "'+h.toString()+'" (type '+n(h)+")"])}return function(h,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(l&&l.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),l&&x(h,l)}(o,g),u=o,Object.defineProperty(u,"prototype",{writable:!1}),u;var u}(t(8213));Object.defineProperty(w.prototype,"name",{value:"ObjectParameterError"}),a.exports=w},1417:(a,i,t)=>{"use strict";function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}function c(){try{var g=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!g})()}function b(g){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},b(g)}function x(g,o){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},x(g,o)}var w=function(g){function o(h){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,o),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,o,["For your own good, using `document.save()` to update an array which was selected using an $elemMatch projection OR populated using skip, limit, query conditions, or exclusion of the _id field when the operation results in a $pop or $set of the entire array is not supported. The following path(s) would have been modified unsafely:\n  "+h.join(`
  `)+`
Use Model.updateOne() to update these arrays instead.`])}return function(h,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(l&&l.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),l&&x(h,l)}(o,g),u=o,Object.defineProperty(u,"prototype",{writable:!1}),u;var u}(t(8213));Object.defineProperty(w.prototype,"name",{value:"DivergentArrayError"}),a.exports=w},1464:(a,i,t)=>{"use strict";var n=t(5807);if(n)try{n([],"length")}catch{n=null}a.exports=n},1469:(a,i,t)=>{"use strict";function n(D){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(j){return typeof j}:function(j){return j&&typeof Symbol=="function"&&j.constructor===Symbol&&j!==Symbol.prototype?"symbol":typeof j},n(D)}function c(D,j){var S=Object.keys(D);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(D);j&&(A=A.filter(function(M){return Object.getOwnPropertyDescriptor(D,M).enumerable})),S.push.apply(S,A)}return S}function b(D,j,S){return(j=function(A){var M=function(V){if(n(V)!="object"||!V)return V;var K=V[Symbol.toPrimitive];if(K!==void 0){var H=K.call(V,"string");if(n(H)!="object")return H;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(V)}(A);return n(M)=="symbol"?M:M+""}(j))in D?Object.defineProperty(D,j,{value:S,enumerable:!0,configurable:!0,writable:!0}):D[j]=S,D}function x(){var D,j,S=typeof Symbol=="function"?Symbol:{},A=S.iterator||"@@iterator",M=S.toStringTag||"@@toStringTag";function V(C,J,F,I){var N=J&&J.prototype instanceof H?J:H,G=Object.create(N.prototype);return w(G,"_invoke",function(ae,ce,Se){var oe,Z,he,E=0,z=Se||[],X=!1,de={p:0,n:0,v:D,a:q,f:q.bind(D,4),d:function(B,te){return oe=B,Z=0,he=D,de.n=te,K}};function q(B,te){for(Z=B,he=te,j=0;!X&&E&&!T&&j<z.length;j++){var T,Y=z[j],ie=de.p,me=Y[2];B>3?(T=me===te)&&(he=Y[(Z=Y[4])?5:(Z=3,3)],Y[4]=Y[5]=D):Y[0]<=ie&&((T=B<2&&ie<Y[1])?(Z=0,de.v=te,de.n=Y[1]):ie<me&&(T=B<3||Y[0]>te||te>me)&&(Y[4]=B,Y[5]=te,de.n=me,Z=0))}if(T||B>1)return K;throw X=!0,te}return function(B,te,T){if(E>1)throw TypeError("Generator is already running");for(X&&te===1&&q(te,T),Z=te,he=T;(j=Z<2?D:he)||!X;){oe||(Z?Z<3?(Z>1&&(de.n=-1),q(Z,he)):de.n=he:de.v=he);try{if(E=2,oe){if(Z||(B="next"),j=oe[B]){if(!(j=j.call(oe,he)))throw TypeError("iterator result is not an object");if(!j.done)return j;he=j.value,Z<2&&(Z=0)}else Z===1&&(j=oe.return)&&j.call(oe),Z<2&&(he=TypeError("The iterator does not provide a '"+B+"' method"),Z=1);oe=D}else if((j=(X=de.n<0)?he:ae.call(ce,de))!==K)break}catch(Y){oe=D,Z=1,he=Y}finally{E=1}}return{value:j,done:X}}}(C,F,I),!0),G}var K={};function H(){}function Q(){}function re(){}j=Object.getPrototypeOf;var ue=[][A]?j(j([][A]())):(w(j={},A,function(){return this}),j),W=re.prototype=H.prototype=Object.create(ue);function $(C){return Object.setPrototypeOf?Object.setPrototypeOf(C,re):(C.__proto__=re,w(C,M,"GeneratorFunction")),C.prototype=Object.create(W),C}return Q.prototype=re,w(W,"constructor",re),w(re,"constructor",Q),Q.displayName="GeneratorFunction",w(re,M,"GeneratorFunction"),w(W),w(W,M,"Generator"),w(W,A,function(){return this}),w(W,"toString",function(){return"[object Generator]"}),(x=function(){return{w:V,m:$}})()}function w(D,j,S,A){var M=Object.defineProperty;try{M({},"",{})}catch{M=0}w=function(V,K,H,Q){function re(ue,W){w(V,ue,function($){return this._invoke(ue,W,$)})}K?M?M(V,K,{value:H,enumerable:!Q,configurable:!Q,writable:!Q}):V[K]=H:(re("next",0),re("throw",1),re("return",2))},w(D,j,S,A)}function g(D){return function(j){if(Array.isArray(j))return h(j)}(D)||function(j){if(typeof Symbol<"u"&&j[Symbol.iterator]!=null||j["@@iterator"]!=null)return Array.from(j)}(D)||u(D)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function o(D,j){var S=typeof Symbol<"u"&&D[Symbol.iterator]||D["@@iterator"];if(!S){if(Array.isArray(D)||(S=u(D))||j&&D&&typeof D.length=="number"){S&&(D=S);var A=0,M=function(){};return{s:M,n:function(){return A>=D.length?{done:!0}:{done:!1,value:D[A++]}},e:function(Q){throw Q},f:M}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var V,K=!0,H=!1;return{s:function(){S=S.call(D)},n:function(){var Q=S.next();return K=Q.done,Q},e:function(Q){H=!0,V=Q},f:function(){try{K||S.return==null||S.return()}finally{if(H)throw V}}}}function u(D,j){if(D){if(typeof D=="string")return h(D,j);var S={}.toString.call(D).slice(8,-1);return S==="Object"&&D.constructor&&(S=D.constructor.name),S==="Map"||S==="Set"?Array.from(D):S==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(S)?h(D,j):void 0}}function h(D,j){(j==null||j>D.length)&&(j=D.length);for(var S=0,A=Array(j);S<j;S++)A[S]=D[S];return A}var l=t(5022),d=t(8442),_=t(4450),p=t(2068).X,m=t(3703),y=t(8768),k=t(4301),v={toJSON:!0,toObject:!0,_id:!0,id:!0,virtuals:!0,methods:!0,statics:!0};a.exports=function(D,j,S,A,M,V,K){if(!S||!S.instanceOfSchema)throw new Error("You must pass a valid discriminator Schema");if(V=V==null||V,D.schema.discriminatorMapping&&!D.schema.discriminatorMapping.isRoot)throw new Error('Discriminator "'+j+'" can only be a discriminator of the root model');if(M){var H=m(D.base,"options.applyPluginsToDiscriminators",!1)||!V;D.base._applyPlugins(S,{skipTopLevel:!H})}else V||d(S);var Q=D.schema.options.discriminatorKey,re=D.schema.path(Q);if(re!=null)y.hasUserDefinedProperty(re.options,"select")||(re.options.select=!0),re.options.$skipDiscriminatorCheck=!0;else{var ue={};ue[Q]={default:void 0,select:!0,$skipDiscriminatorCheck:!0},ue[Q][D.schema.options.typeKey]=String,D.schema.add(ue),p({prop:Q,prototype:D.prototype,options:D.schema.options})}if(S.path(Q)&&S.path(Q).options.$skipDiscriminatorCheck!==!0)throw new Error('Discriminator "'+j+'" cannot have field with name "'+Q+'"');var W=j;if((typeof A=="string"&&A.length||A!=null)&&(W=A),function($,C){var J=x().m(ae);if($.encryptionType()!=null||C.encryptionType()!=null){var F,I=o(ae(G($),G(C)));try{for(I.s();!(F=I.n()).done;){var N=F.value;if($._hasEncryptedField(N)&&C._hasEncryptedField(N))throw new Error("encrypted fields cannot be declared on both the base schema and the child schema in a discriminator. path=".concat(N));if($._hasEncryptedField(N)||C._hasEncryptedField(N))throw new Error("encrypted fields cannot have the same path as a non-encrypted field for discriminators. path=".concat(N))}}catch(ce){I.e(ce)}finally{I.f()}}function G(ce){return[].concat(g(Object.keys(ce.paths)),g(Object.keys(ce.singleNestedPaths)))}function ae(ce,Se){var oe,Z,he,E,z;return x().w(function(X){for(;;)switch(X.p=X.n){case 0:oe=new Set(ce),Z=o(Se),X.p=1,Z.s();case 2:if((he=Z.n()).done){X.n=4;break}if(E=he.value,!oe.has(E)){X.n=3;break}return X.n=3,E;case 3:X.n=2;break;case 4:X.n=6;break;case 5:X.p=5,z=X.v,Z.e(z);case 6:return X.p=6,Z.f(),X.f(6);case 7:return X.a(2)}},J,null,[[1,5,6,7]])}}(D.schema,S),function($,C){$._baseSchema=C,C.paths._id&&C.paths._id.options&&!C.paths._id.options.auto&&$.remove("_id");for(var J=[],F=0,I=Object.keys(C.paths);F<I.length;F++){var N=I[F];if($.nested[N])J.push(N);else if(N.indexOf(".")!==-1){var G,ae="",ce=o(N.split(".").slice(0,-1));try{for(ce.s();!(G=ce.n()).done;){var Se=G.value;ae+=(ae.length?".":"")+Se,($.paths[ae]instanceof l||$.singleNestedPaths[ae]instanceof l)&&J.push(N)}}catch(Re){ce.e(Re)}finally{ce.f()}}}$.obj=function(Re){for(var Ie=1;Ie<arguments.length;Ie++){var je=arguments[Ie]!=null?arguments[Ie]:{};Ie%2?c(Object(je),!0).forEach(function(Be){b(Re,Be,je[Be])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Re,Object.getOwnPropertyDescriptors(je)):c(Object(je)).forEach(function(Be){Object.defineProperty(Re,Be,Object.getOwnPropertyDescriptor(je,Be))})}return Re}({},$.obj),k($,C),$._gatherChildSchemas();for(var oe=0,Z=J;oe<Z.length;oe++){var he=Z[oe];delete $.paths[he]}$.childSchemas.forEach(function(Re){Re.model.prototype.$__setSchema(Re.schema)});var E={};E[Q]={default:W,select:!0,set:function(Re){if(Re===W||Array.isArray(W)&&y.deepEqual(Re,W))return W;throw new Error(`Can't set discriminator key "`+Q+'"')},$skipDiscriminatorCheck:!0},E[Q][$.options.typeKey]=re?re.options[$.options.typeKey]:String,$.add(E),$.discriminatorMapping={key:Q,value:W,isRoot:!1},C.options.collection&&($.options.collection=C.options.collection);var z=$.options.toJSON,X=$.options.toObject,de=$.options._id,q=$.options.id,B=Object.keys($.options);$.options.discriminatorKey=C.options.discriminatorKey;for(var te=$._userProvidedOptions,T=0,Y=B;T<Y.length;T++){var ie=Y[T];if(!v[ie]&&ie in te&&!y.deepEqual($.options[ie],C.options[ie]))throw new Error("Can't customize discriminator option "+ie+" (can only modify "+Object.keys(v).join(", ")+")")}$.options=_(C.options);for(var me=0,ne=Object.keys(te);me<ne.length;me++){var ye=ne[me];$.options[ye]=te[ye]}z&&($.options.toJSON=z),X&&($.options.toObject=X),de!==void 0&&($.options._id=de),$.options.id=q,V&&($.s.hooks=D.schema.s.hooks.merge($.s.hooks)),M&&($.plugins=Array.prototype.slice.call(C.plugins)),$.callQueue=C.callQueue.concat($.callQueue),delete $._requiredpaths}(S,D.schema),D.discriminators||(D.discriminators={}),D.schema.discriminatorMapping||(D.schema.discriminatorMapping={key:Q,value:null,isRoot:!0}),D.schema.discriminators||(D.schema.discriminators={}),D.schema.discriminators[j]=S,D.discriminators[j]&&!S.options.overwriteModels&&!K)throw new Error('Discriminator with name "'+j+'" already exists');return S}},1505:a=>{"use strict";a.exports=function(i,t,n,c,b){var x=t!=null&&t.updatedAt===!1,w=t!=null&&t.createdAt===!1,g=n!=null?n():i.ownerDocument().constructor.base.now();if(!w&&(i.isNew||i.$isSubdocument)&&c&&!i.$__getValue(c)&&i.$__isSelected(c)&&i.$set(c,g,void 0,{overwriteImmutable:!0}),!x&&b&&(i.isNew||i.$isModified())){var o=g;i.isNew&&c!=null&&(o=i.$__getValue(c)),i.$set(b,o)}}},1635:(a,i,t)=>{"use strict";function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}function c(){try{var g=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!g})()}function b(g){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},b(g)}function x(g,o){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},x(g,o)}var w=function(g){function o(h){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,o),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,o,["Can't validate() the same doc multiple times in parallel. Document: "+h._doc._id])}return function(h,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(l&&l.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),l&&x(h,l)}(o,g),u=o,Object.defineProperty(u,"prototype",{writable:!1}),u;var u}(t(8213));Object.defineProperty(w.prototype,"name",{value:"ParallelValidateError"}),a.exports=w},1679:a=>{typeof Object.create=="function"?a.exports=function(i,t){t&&(i.super_=t,i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}))}:a.exports=function(i,t){if(t){i.super_=t;var n=function(){};n.prototype=t.prototype,i.prototype=new n,i.prototype.constructor=i}}},1697:a=>{"use strict";a.exports=Math.max},1732:(a,i,t)=>{"use strict";function n(_){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},n(_)}function c(_,p){var m=Object.keys(_);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(_);p&&(y=y.filter(function(k){return Object.getOwnPropertyDescriptor(_,k).enumerable})),m.push.apply(m,y)}return m}function b(_){for(var p=1;p<arguments.length;p++){var m=arguments[p]!=null?arguments[p]:{};p%2?c(Object(m),!0).forEach(function(y){x(_,y,m[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(m)):c(Object(m)).forEach(function(y){Object.defineProperty(_,y,Object.getOwnPropertyDescriptor(m,y))})}return _}function x(_,p,m){return(p=function(y){var k=function(v){if(n(v)!="object"||!v)return v;var D=v[Symbol.toPrimitive];if(D!==void 0){var j=D.call(v,"string");if(n(j)!="object")return j;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(v)}(y);return n(k)=="symbol"?k:k+""}(p))in _?Object.defineProperty(_,p,{value:m,enumerable:!0,configurable:!0,writable:!0}):_[p]=m,_}var w=t(3609),g=t(6426),o=t(3704),u=t(4327);function h(_,p){g.call(this,_,p,"Double")}function l(_){return this.cast(_)}h.schemaName="Double",h.defaultOptions={},h.prototype=Object.create(g.prototype),h.prototype.constructor=h,h._cast=o,h.set=g.set,h.setters=[],h.get=g.get,h._defaultCaster=function(_){if(_!=null&&_._bsontype!=="Double")throw new Error;return _},h.cast=function(_){return arguments.length===0||(_===!1&&(_=this._defaultCaster),this._cast=_),this._cast},h._checkRequired=function(_){return _!=null},h.checkRequired=g.checkRequired,h.prototype.checkRequired=function(_){return this.constructor._checkRequired(_)},h.prototype.cast=function(_){var p;p=typeof this._castFunction=="function"?this._castFunction:typeof this.constructor.cast=="function"?this.constructor.cast():h.cast();try{return p(_)}catch(m){throw new w("Double",_,this.path,m,this)}};var d=b(b({},g.prototype.$conditionalHandlers),{},{$gt:l,$gte:l,$lt:l,$lte:l});Object.defineProperty(h.prototype,"$conditionalHandlers",{enumerable:!1,value:d}),h.prototype.toJSONSchema=function(_){var p=this.options.required&&typeof this.options.required!="function";return u("number","double",_?.useBsonType,p)},h.prototype.autoEncryptionType=function(){return"double"},a.exports=h},1793:(a,i,t)=>{"use strict";var n=t(7300),c=t(2789);a.exports=function b(x){if(x==null)return null;var w=Object.keys(x),g=null;if(w.length===1&&w[0]==="_id")g=!x._id;else for(var o=0;o<w.length;++o){var u,h=w[o];if(h!=="_id"&&n(x[h])&&(g=c(x[h])?(u=b(x[h]))!==null&&u!==void 0?u:g:!x[h])!=null)break}return g}},1824:(a,i,t)=>{"use strict";function n(b){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},n(b)}var c=t(3703);a.exports=function(b,x,w,g,o,u){var h=g,l=h,d=c(o,"timestamps",!0);if(!d||h==null)return g;var _,p,m,y=d!=null&&d.createdAt===!1,k=d!=null&&d.updatedAt===!1;if(u)return g&&g.$set&&(g=g.$set,h.$set={},l=h.$set),k||!w||g[w]||(l[w]=b),y||!x||g[x]||(l[x]=b),h;if(g=g||{},Array.isArray(h))return w==null||h.push({$set:(_={},p=w,m=b,(p=function(re){var ue=function(W){if(n(W)!="object"||!W)return W;var $=W[Symbol.toPrimitive];if($!==void 0){var C=$.call(W,"string");if(n(C)!="object")return C;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(W)}(re);return n(ue)=="symbol"?ue:ue+""}(p))in _?Object.defineProperty(_,p,{value:m,enumerable:!0,configurable:!0,writable:!0}):_[p]=m,_)}),h;if(h.$set=h.$set||{},!k&&w&&(!g.$currentDate||!g.$currentDate[w])){var v=!1;if(w.indexOf(".")!==-1)for(var D=w.split("."),j=1;j<D.length;++j){var S=D.slice(-j).join("."),A=D.slice(0,-j).join(".");if(g[A]!=null){g[A][S]=b,v=!0;break}if(g.$set&&g.$set[A]){g.$set[A][S]=b,v=!0;break}}v||(h.$set[w]=b),h.hasOwnProperty(w)&&delete h[w]}if(!y&&x){g[x]&&delete g[x],g.$set&&g.$set[x]&&delete g.$set[x];var M=!1;if(x.indexOf(".")!==-1)for(var V=x.split("."),K=1;K<V.length;++K){var H=V.slice(-K).join("."),Q=V.slice(0,-K).join(".");if(g[Q]!=null){g[Q][H]=b,M=!0;break}if(g.$set&&g.$set[Q]){g.$set[Q][H]=b,M=!0;break}}M||(h.$setOnInsert=h.$setOnInsert||{},h.$setOnInsert[x]=b)}return Object.keys(h.$set).length===0&&delete h.$set,h}},1849:(a,i,t)=>{"use strict";function n(b,x){(x==null||x>b.length)&&(x=b.length);for(var w=0,g=Array(x);w<x;w++)g[w]=b[w];return g}var c=t(8768);a.exports=function(b,x){if(b._doc._id!=null&&x!=null&&x.length!==0){var w,g=String(b._doc._id),o=function(y,k){var v=typeof Symbol<"u"&&y[Symbol.iterator]||y["@@iterator"];if(!v){if(Array.isArray(y)||(v=function(V,K){if(V){if(typeof V=="string")return n(V,K);var H={}.toString.call(V).slice(8,-1);return H==="Object"&&V.constructor&&(H=V.constructor.name),H==="Map"||H==="Set"?Array.from(V):H==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(H)?n(V,K):void 0}}(y))||k&&y&&typeof y.length=="number"){v&&(y=v);var D=0,j=function(){};return{s:j,n:function(){return D>=y.length?{done:!0}:{done:!1,value:y[D++]}},e:function(V){throw V},f:j}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var S,A=!0,M=!1;return{s:function(){v=v.call(y)},n:function(){var V=v.next();return A=V.done,V},e:function(V){M=!0,S=V},f:function(){try{A||v.return==null||v.return()}finally{if(M)throw S}}}}(x);try{for(o.s();!(w=o.n()).done;){var u=w.value;if(!u.isVirtual)for(var h=u.path.split("."),l=0;l<h.length-1;++l){var d=h.slice(0,l+1).join("."),_=h.slice(l+1).join("."),p=b.get(d);if(p!=null&&c.isMongooseDocumentArray(p)){for(var m=0;m<p.length;++m)p[m]&&p[m].populated(_,u._docs[g]==null?void 0:u._docs[g][m],u);break}}}}catch(y){o.e(y)}finally{o.f()}}}},1875:a=>{"use strict";a.exports=function(i){for(var t,n=Object.keys(i.errors||{}),c=n.length,b=[],x=0;x<c;++x)t=n[x],i!==i.errors[t]&&b.push(t+": "+i.errors[t].message);return b.join(", ")}},1898:(a,i,t)=>{"use strict";i.saveSubdocs=t(4432),i.sharding=t(2824),i.trackTransaction=t(5889),i.validateBeforeSave=t(9848)},1905:(a,i,t)=>{"use strict";var n=t(3071),c=t(2724)(/^\s*(?:function)?\*/),b=t(953)(),x=t(209),w=n("Object.prototype.toString"),g=n("Function.prototype.toString"),o=t(8690);a.exports=function(u){if(typeof u!="function")return!1;if(c(g(u)))return!0;if(!b)return w(u)==="[object GeneratorFunction]";if(!x)return!1;var h=o();return h&&x(u)===h.prototype}},2003:(a,i,t)=>{"use strict";var n=t(3703),c=t(608),b=t(2423);a.exports=function(x){var w=[],g=new WeakMap,o=x.constructor.indexTypes,u=new Map;return function h(l,d,_){if(!g.has(l)){g.set(l,!0),d=d||"";for(var p=0,m=Object.keys(l.paths);p<m.length;p++){var y=m[p],k=l.paths[y];if(_==null||!_.paths[y]){if(k._duplicateKeyErrorMessage!=null&&(l._duplicateKeyErrorMessagesByPath=l._duplicateKeyErrorMessagesByPath||{},l._duplicateKeyErrorMessagesByPath[y]=k._duplicateKeyErrorMessage),k.$isMongooseDocumentArray||k.$isSingleNested){if(n(k,"options.excludeIndexes")!==!0&&n(k,"schemaOptions.excludeIndexes")!==!0&&n(k,"schema.options.excludeIndexes")!==!0&&h(k.schema,d+y+"."),k.schema.discriminators!=null)for(var v=k.schema.discriminators,D=0,j=Object.keys(v);D<j.length;D++)h(v[j[D]],d+y+".",k.schema);if(k.$isMongooseDocumentArray)continue}var S=k._index||k.caster&&k.caster._index;if(S!==!1&&S!=null){var A={},M=c(S),V=M?S:{},K=typeof S=="string"?S:!!M&&S.type;if(K&&o.indexOf(K)!==-1)A[d+y]=K;else if(V.text)A[d+y]="text",delete V.text;else{var H;H=S==="descending"||S==="desc"||S!=="ascending"&&S!=="asc"&&Number(S)===-1,A[d+y]=H?-1:1}delete V.type,"background"in V||(V.background=!0),l.options.autoIndex!=null&&(V._autoIndex=l.options.autoIndex);var Q=V&&V.name;typeof Q=="string"&&u.has(Q)?Object.assign(u.get(Q),A):(w.push([A,V]),u.set(Q,A))}}}g.delete(l),d?function(re,ue){for(var W=re._indexes,$=W.length,C=0;C<$;++C){for(var J=W[C][0],F=W[C][1],I=Object.keys(J),N=I.length,G={},ae=0;ae<N;++ae){var ce=I[ae];G[ue+ce]=J[ce]}var Se=Object.assign({},F);if(F!=null&&F.partialFilterExpression!=null){Se.partialFilterExpression={};for(var oe=F.partialFilterExpression,Z=0,he=Object.keys(oe);Z<he.length;Z++){var E=he[Z];Se.partialFilterExpression[ue+E]=oe[E]}}w.push([G,Se])}}(l,d):(l._indexes.forEach(function(re){var ue=re[1];"background"in ue||(ue.background=!0),b(l,ue)}),w=w.concat(l._indexes))}}(x),w}},2064:(a,i,t)=>{"use strict";var n=t(2273),c=t(9122),b=t(4756),x=t(2481),w=t(9247),g=c(x(),Object);n(g,{getPolyfill:x,implementation:b,shim:w}),a.exports=g},2068:(a,i,t)=>{"use strict";var n,c=t(4450),b=t(7930).documentSchemaSymbol,x=t(3303)._,w=t(8768),g=t(7930).getSymbol,o=t(7930).scopeSymbol,u=w.isPOJO;i.w=d,i.X=_;var h=Object.freeze({minimize:!0,virtuals:!1,getters:!1,transform:!1}),l=Object.freeze({noDottedPath:!0});function d(p,m,y,k){n=n||t(2400);for(var v=k.typeKey,D=0,j=Object.keys(p);D<j.length;D++){var S=j[D],A=p[S];_({prop:S,subprops:u(A)&&Object.keys(A).length>0&&(!A[v]||v==="type"&&u(A.type)&&A.type.type)?A:null,prototype:m,prefix:y,options:k})}}function _(p){var m=p.prop,y=p.subprops,k=p.prototype,v=p.prefix,D=p.options;n=n||t(2400);var j=(v?v+".":"")+m,S=(v=v||"")?Object.freeze({}):l;y?Object.defineProperty(k,m,{enumerable:!0,configurable:!0,get:function(){var A,M,V=this;if(this.$__.getters||(this.$__.getters={}),!this.$__.getters[j]){var K=Object.create(n.prototype,(A=this,M={},Object.getOwnPropertyNames(A).forEach(function(H){["isNew","$__","$errors","errors","_doc","$locals","$op","__parentArray","__index","$isDocumentArrayElement"].indexOf(H)===-1||(M[H]=Object.getOwnPropertyDescriptor(A,H),M[H].enumerable=!1)}),M));v||(K.$__[o]=this),K.$__.nestedPath=j,Object.defineProperty(K,"schema",{enumerable:!1,configurable:!0,writable:!1,value:k.schema}),Object.defineProperty(K,"$__schema",{enumerable:!1,configurable:!0,writable:!1,value:k.schema}),Object.defineProperty(K,b,{enumerable:!1,configurable:!0,writable:!1,value:k.schema}),Object.defineProperty(K,"toObject",{enumerable:!1,configurable:!0,writable:!1,value:function(){return c(V.get(j,null,{virtuals:this&&this.schema&&this.schema.options&&this.schema.options.toObject&&this.schema.options.toObject.virtuals||null}))}}),Object.defineProperty(K,"$__get",{enumerable:!1,configurable:!0,writable:!1,value:function(){return V.get(j,null,{virtuals:this&&this.schema&&this.schema.options&&this.schema.options.toObject&&this.schema.options.toObject.virtuals||null})}}),Object.defineProperty(K,"toJSON",{enumerable:!1,configurable:!0,writable:!1,value:function(){return V.get(j,null,{virtuals:this&&this.schema&&this.schema.options&&this.schema.options.toJSON&&this.schema.options.toJSON.virtuals||null})}}),Object.defineProperty(K,"$__isNested",{enumerable:!1,configurable:!0,writable:!1,value:!0}),Object.defineProperty(K,"$isEmpty",{enumerable:!1,configurable:!0,writable:!1,value:function(){return Object.keys(this.get(j,null,h)||{}).length===0}}),Object.defineProperty(K,"$__parent",{enumerable:!1,configurable:!0,writable:!1,value:this}),d(y,K,j,D),this.$__.getters[j]=K}return this.$__.getters[j]},set:function(A){A!=null&&A.$__isNested?A=A.$__get():A instanceof n&&!A.$__isNested&&(A=A.$toObject(x)),(this.$__[o]||this).$set(j,A)}}):Object.defineProperty(k,m,{enumerable:!0,configurable:!0,get:function(){return this[g].call(this.$__[o]||this,j,null,S)},set:function(A){this.$set.call(this.$__[o]||this,j,A)}})}},2069:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}function c(o,u){for(var h=0;h<u.length;h++){var l=u[h];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(o,x(l.key),l)}}function b(o,u,h){return u&&c(o.prototype,u),h&&c(o,h),Object.defineProperty(o,"prototype",{writable:!1}),o}function x(o){var u=function(h){if(n(h)!="object"||!h)return h;var l=h[Symbol.toPrimitive];if(l!==void 0){var d=l.call(h,"string");if(n(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(h)}(o);return n(u)=="symbol"?u:u+""}var w=t(5761),g=b(function o(u){(function(h,l){if(!(h instanceof l))throw new TypeError("Cannot call a class as a function")})(this,o),Object.assign(this,u),u!=null&&u.options!=null&&(this.options=Object.assign({},u.options))});Object.defineProperty(g.prototype,"ref",w),Object.defineProperty(g.prototype,"refPath",w),Object.defineProperty(g.prototype,"localField",w),Object.defineProperty(g.prototype,"foreignField",w),Object.defineProperty(g.prototype,"justOne",w),Object.defineProperty(g.prototype,"count",w),Object.defineProperty(g.prototype,"match",w),Object.defineProperty(g.prototype,"options",w),Object.defineProperty(g.prototype,"skip",w),Object.defineProperty(g.prototype,"limit",w),Object.defineProperty(g.prototype,"perDocumentLimit",w),a.exports=g},2073:a=>{"use strict";a.exports=function i(t){if(!Array.isArray(t))return{min:0,max:0,containsNonArrayItem:!0};if(t.length===0)return{min:1,max:1,containsNonArrayItem:!1};if(t.length===1&&!Array.isArray(t[0]))return{min:1,max:1,containsNonArrayItem:!1};for(var n=i(t[0]),c=1;c<t.length;++c){var b=i(t[c]);b.min<n.min&&(n.min=b.min),b.max>n.max&&(n.max=b.max),n.containsNonArrayItem=n.containsNonArrayItem||b.containsNonArrayItem}return n.min=n.min+1,n.max=n.max+1,n}},2081:(a,i,t)=>{"use strict";function n(H){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Q){return typeof Q}:function(Q){return Q&&typeof Symbol=="function"&&Q.constructor===Symbol&&Q!==Symbol.prototype?"symbol":typeof Q},n(H)}function c(H,Q){var re=typeof Symbol<"u"&&H[Symbol.iterator]||H["@@iterator"];if(!re){if(Array.isArray(H)||(re=function(F,I){if(F){if(typeof F=="string")return b(F,I);var N={}.toString.call(F).slice(8,-1);return N==="Object"&&F.constructor&&(N=F.constructor.name),N==="Map"||N==="Set"?Array.from(F):N==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(N)?b(F,I):void 0}}(H))||Q&&H&&typeof H.length=="number"){re&&(H=re);var ue=0,W=function(){};return{s:W,n:function(){return ue>=H.length?{done:!0}:{done:!1,value:H[ue++]}},e:function(F){throw F},f:W}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var $,C=!0,J=!1;return{s:function(){re=re.call(H)},n:function(){var F=re.next();return C=F.done,F},e:function(F){J=!0,$=F},f:function(){try{C||re.return==null||re.return()}finally{if(J)throw $}}}}function b(H,Q){(Q==null||Q>H.length)&&(Q=H.length);for(var re=0,ue=Array(Q);re<Q;re++)ue[re]=H[re];return ue}function x(H,Q){for(var re=0;re<Q.length;re++){var ue=Q[re];ue.enumerable=ue.enumerable||!1,ue.configurable=!0,"value"in ue&&(ue.writable=!0),Object.defineProperty(H,w(ue.key),ue)}}function w(H){var Q=function(re){if(n(re)!="object"||!re)return re;var ue=re[Symbol.toPrimitive];if(ue!==void 0){var W=ue.call(re,"string");if(n(W)!="object")return W;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(re)}(H);return n(Q)=="symbol"?Q:Q+""}function g(H,Q,re,ue){var W=o(d(1&ue?H.prototype:H),Q,re);return 2&ue&&typeof W=="function"?function($){return W.apply(re,$)}:W}function o(){return o=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(H,Q,re){var ue=function($,C){for(;!{}.hasOwnProperty.call($,C)&&($=d($))!==null;);return $}(H,Q);if(ue){var W=Object.getOwnPropertyDescriptor(ue,Q);return W.get?W.get.call(arguments.length<3?H:re):W.value}},o.apply(null,arguments)}function u(H){var Q=typeof Map=="function"?new Map:void 0;return u=function(re){if(re===null||!function(W){try{return Function.toString.call(W).indexOf("[native code]")!==-1}catch{return typeof W=="function"}}(re))return re;if(typeof re!="function")throw new TypeError("Super expression must either be null or a function");if(Q!==void 0){if(Q.has(re))return Q.get(re);Q.set(re,ue)}function ue(){return function(W,$,C){if(h())return Reflect.construct.apply(null,arguments);var J=[null];J.push.apply(J,$);var F=new(W.bind.apply(W,J));return C&&l(F,C.prototype),F}(re,arguments,d(this).constructor)}return ue.prototype=Object.create(re.prototype,{constructor:{value:ue,enumerable:!1,writable:!0,configurable:!0}}),l(ue,re)},u(H)}function h(){try{var H=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(h=function(){return!!H})()}function l(H,Q){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(re,ue){return re.__proto__=ue,re},l(H,Q)}function d(H){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(Q){return Q.__proto__||Object.getPrototypeOf(Q)},d(H)}var _=t(5022),p=t(8213),m=t(4450),y=t(8768).deepEqual,k=t(8260),v=t(3216),D=t(7352),j=t(2793),S=t(3305),A=t(4473),M=t(7930).populateModelSymbol,V=function(H){function Q(W,$,C,J,F){var I,N;return function(G,ae){if(!(G instanceof ae))throw new TypeError("Cannot call a class as a function")}(this,Q),k(W)==="Object"&&(W=Object.keys(W).reduce(function(G,ae){return G.concat([[ae,W[ae]]])},[])),(N=function(G,ae,ce){return ae=d(ae),function(Se,oe){if(oe&&(n(oe)=="object"||typeof oe=="function"))return oe;if(oe!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(Z){if(Z===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Z}(Se)}(G,h()?Reflect.construct(ae,ce||[],d(G).constructor):ae.apply(G,ce))}(this,Q,[W])).$__parent=C!=null&&C.$__!=null?C:null,(I=N.$__parent)!==null&&I!==void 0&&I.$isSingleNested&&N.$__parent.$basePath?(N.$__path=N.$__parent.$basePath+"."+$,N.$__pathRelativeToParent=$):F!=null&&F.path?(N.$__path=F.path,N.$__pathRelativeToParent=null):(N.$__path=$,N.$__pathRelativeToParent=null),N.$__schemaType=J??new _($),N.$__runDeferred(),N}return function(W,$){if(typeof $!="function"&&$!==null)throw new TypeError("Super expression must either be null or a function");W.prototype=Object.create($&&$.prototype,{constructor:{value:W,writable:!0,configurable:!0}}),Object.defineProperty(W,"prototype",{writable:!1}),$&&l(W,$)}(Q,H),re=Q,ue=[{key:"$init",value:function(W,$){K(W),g(Q,"set",this,3)([W,$]),$!=null&&$.$isSingleNested&&($.$basePath=this.$__path+"."+W,this.$__pathRelativeToParent!=null?$.$pathRelativeToParent=this.$__pathRelativeToParent+"."+W:$.$pathRelativeToParent=this.$__path+"."+W)}},{key:"$__set",value:function(W,$){g(Q,"set",this,3)([W,$])}},{key:"get",value:function(W,$){return S(W,"ObjectId")&&(W=W.toString()),($=$||{}).getters===!1?g(Q,"get",this,3)([W]):this.$__schemaType.applyGetters(g(Q,"get",this,3)([W]),this.$__parent)}},{key:"set",value:function(W,$){if(S(W,"ObjectId")&&(W=W.toString()),K(W),$=v($),this.$__schemaType==null)return this.$__deferred=this.$__deferred||[],void this.$__deferred.push({key:W,value:$});var C,J,F=this.$__parent,I=F!=null&&F.$__&&F.$__.populated?F.$populated(ae.call(this),!0)||F.$populated(this.$__path,!0):null,N=this.get(W);if(I!=null){if(this.$__schemaType.$isSingleNested)throw new p("Cannot manually populate single nested subdoc underneath Map "+'at path "'.concat(this.$__path,'". Try using an array instead of a Map.'));Array.isArray($)&&this.$__schemaType.$isMongooseArray?$=$.map(function(ce){return ce.$__==null&&(ce=new I.options[M](ce)),ce.$__.wasPopulated={value:ce._doc._id},ce}):$!=null&&($.$__==null&&($=new I.options[M]($)),$.$__.wasPopulated={value:$._doc._id})}else try{var G=null;(this.$__schemaType.$isMongooseDocumentArray||this.$__schemaType.$isSingleNested||this.$__schemaType.$isMongooseArray||this.$__schemaType.$isSchemaMap)&&(G={path:ae.call(this)},this.$__schemaType.$isSingleNested&&(G.pathRelativeToParent=this.$__pathRelativeToParent!=null?this.$__pathRelativeToParent+"."+W:this.$__path+"."+W)),$=this.$__schemaType.applySetters($,this.$__parent,!1,this.get(W),G)}catch(ce){if(this.$__parent!=null&&this.$__parent.$__!=null)return void this.$__parent.invalidate(ae.call(this),ce);throw ce}function ae(){return C||(C=this.$__path+"."+W)}g(Q,"set",this,3)([W,$]),$!=null&&$.$isSingleNested&&(this.$__pathRelativeToParent!=null?$.$pathRelativeToParent=this.$__pathRelativeToParent+"."+W:$.$pathRelativeToParent=this.$__path+"."+W),F==null||F.$__==null||y($,N)||(J=this.$__pathRelativeToParent!=null?this.$__pathRelativeToParent+"."+W:ae.call(this),F.markModified(J),(this.$__schemaType.$isMongooseDocumentArray||this.$__schemaType.$isSingleNested)&&A(F,J))}},{key:"clear",value:function(){g(Q,"clear",this,3)([]);var W=this.$__parent;W?.markModified(this.$__path)}},{key:"delete",value:function(W){return S(W,"ObjectId")&&(W=W.toString()),this.set(W,void 0),g(Q,"delete",this,3)([W])}},{key:"toBSON",value:function(){return new Map(this)}},{key:"toObject",value:function(W){if(W&&W.flattenMaps){var $,C={},J=c(this.keys());try{for(J.s();!($=J.n()).done;){var F=$.value;C[F]=m(this.get(F),W)}}catch(I){J.e(I)}finally{J.f()}return C}return new Map(this)}},{key:"$toObject",value:function(){return this.constructor.prototype.toObject.apply(this,arguments)}},{key:"toJSON",value:function(W){if(typeof(W&&W.flattenMaps)!="boolean"||W.flattenMaps){var $,C={},J=c(this.keys());try{for(J.s();!($=J.n()).done;){var F=$.value;C[F]=m(this.get(F),W)}}catch(I){J.e(I)}finally{J.f()}return C}return new Map(this)}},{key:"inspect",value:function(){return new Map(this)}},{key:"$__runDeferred",value:function(){if(this.$__deferred){var W,$=c(this.$__deferred);try{for($.s();!(W=$.n()).done;){var C=W.value;this.set(C.key,C.value)}}catch(J){$.e(J)}finally{$.f()}this.$__deferred=null}}}],ue&&x(re.prototype,ue),Object.defineProperty(re,"prototype",{writable:!1}),re;var re,ue}(u(Map));function K(H){var Q=n(H);if(Q!=="string")throw new TypeError("Mongoose maps only support string keys, got ".concat(Q));if(H.startsWith("$"))throw new Error('Mongoose maps do not support keys that start with "$", got "'.concat(H,'"'));if(H.includes("."))throw new Error('Mongoose maps do not support keys that contain ".", got "'.concat(H,'"'));if(j.has(H))throw new Error('Mongoose maps do not support reserved key name "'.concat(H,'"'))}D.inspect.custom&&Object.defineProperty(V.prototype,D.inspect.custom,{enumerable:!1,writable:!1,configurable:!1,value:V.prototype.inspect}),Object.defineProperty(V.prototype,"$__set",{enumerable:!1,writable:!0,configurable:!1}),Object.defineProperty(V.prototype,"$__parent",{enumerable:!1,writable:!0,configurable:!1}),Object.defineProperty(V.prototype,"$__path",{enumerable:!1,writable:!0,configurable:!1}),Object.defineProperty(V.prototype,"$__schemaType",{enumerable:!1,writable:!0,configurable:!1}),Object.defineProperty(V.prototype,"$isMongooseMap",{enumerable:!1,writable:!1,configurable:!1,value:!0}),Object.defineProperty(V.prototype,"$__deferredCalls",{enumerable:!1,writable:!1,configurable:!1,value:!0}),a.exports=V},2097:(a,i,t)=>{"use strict";function n(d){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},n(d)}function c(d,_){(_==null||_>d.length)&&(_=d.length);for(var p=0,m=Array(_);p<_;p++)m[p]=d[p];return m}function b(d,_,p){return(_=function(m){var y=function(k){if(n(k)!="object"||!k)return k;var v=k[Symbol.toPrimitive];if(v!==void 0){var D=v.call(k,"string");if(n(D)!="object")return D;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(k)}(m);return n(y)=="symbol"?y:y+""}(_))in d?Object.defineProperty(d,_,{value:p,enumerable:!0,configurable:!0,writable:!0}):d[_]=p,d}var x=t(9166),w=t(1824),g=t(3703),o=t(3696),u=t(1505),h=t(7160),l=new Set(["replaceOne","findOneAndReplace"]);a.exports=function(d,_){var p=d.childSchemas.find(function(M){return!!M.schema.options.timestamps});if(_||p){var m=o(_,"createdAt"),y=o(_,"updatedAt"),k=_!=null&&_.hasOwnProperty("currentTime")?_.currentTime:null,v={};if(d.$timestamps={createdAt:m,updatedAt:y},m&&!d.paths[m]){var D=d.base!=null?d.base.get("timestamps.createdAt.immutable"):null,j=D==null||D;v[m]=b(b({},d.options.typeKey||"type",Date),"immutable",j)}y&&!d.paths[y]&&(v[y]=Date),d.add(v),d.pre("save",function(M){var V=g(this,"$__.saveOptions.timestamps");if(V===!1)return M();u(this,V,k,m,y),M()}),d.methods.initializeTimestamps=function(){var M=k!=null?k():this.constructor.base.now();if(m&&!this.get(m)&&this.$set(m,M),y&&!this.get(y)&&this.$set(y,M),this.$isSubdocument)return this;var V,K=function(Q,re){var ue=typeof Symbol<"u"&&Q[Symbol.iterator]||Q["@@iterator"];if(!ue){if(Array.isArray(Q)||(ue=function(I,N){if(I){if(typeof I=="string")return c(I,N);var G={}.toString.call(I).slice(8,-1);return G==="Object"&&I.constructor&&(G=I.constructor.name),G==="Map"||G==="Set"?Array.from(I):G==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(G)?c(I,N):void 0}}(Q))||re&&Q&&typeof Q.length=="number"){ue&&(Q=ue);var W=0,$=function(){};return{s:$,n:function(){return W>=Q.length?{done:!0}:{done:!1,value:Q[W++]}},e:function(I){throw I},f:$}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var C,J=!0,F=!1;return{s:function(){ue=ue.call(Q)},n:function(){var I=ue.next();return J=I.done,I},e:function(I){F=!0,C=I},f:function(){try{J||ue.return==null||ue.return()}finally{if(F)throw C}}}}(this.$getAllSubdocs());try{for(K.s();!(V=K.n()).done;){var H=V.value;H.initializeTimestamps&&H.initializeTimestamps()}}catch(Q){K.e(Q)}finally{K.f()}return this},A[h.builtInMiddleware]=!0;var S={query:!0,model:!1};d.pre("findOneAndReplace",S,A),d.pre("findOneAndUpdate",S,A),d.pre("replaceOne",S,A),d.pre("update",S,A),d.pre("updateOne",S,A),d.pre("updateMany",S,A)}function A(M){var V=k!=null?k():this.model.base.now();l.has(this.op)&&this.getUpdate()==null&&this.setUpdate({}),w(V,m,y,this.getUpdate(),this._mongooseOptions,l.has(this.op)),x(V,this.getUpdate(),this.model.schema),M()}}},2134:(a,i,t)=>{"use strict";var n=t(5832).hp;function c(S){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},c(S)}function b(S,A){var M=Object.keys(S);if(Object.getOwnPropertySymbols){var V=Object.getOwnPropertySymbols(S);A&&(V=V.filter(function(K){return Object.getOwnPropertyDescriptor(S,K).enumerable})),M.push.apply(M,V)}return M}function x(S){for(var A=1;A<arguments.length;A++){var M=arguments[A]!=null?arguments[A]:{};A%2?b(Object(M),!0).forEach(function(V){w(S,V,M[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(M)):b(Object(M)).forEach(function(V){Object.defineProperty(S,V,Object.getOwnPropertyDescriptor(M,V))})}return S}function w(S,A,M){return(A=function(V){var K=function(H){if(c(H)!="object"||!H)return H;var Q=H[Symbol.toPrimitive];if(Q!==void 0){var re=Q.call(H,"string");if(c(re)!="object")return re;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(H)}(V);return c(K)=="symbol"?K:K+""}(A))in S?Object.defineProperty(S,A,{value:M,enumerable:!0,configurable:!0,writable:!0}):S[A]=M,S}var g=t(6365),o=t(6426),u=o.CastError,h=t(8250),l=t(4327),d=t(8768),_=t(9460),p=h.UUID_FORMAT,m=g.Binary;function y(S){var A;return typeof S!="string"&&S!=null?(A=S.toString("hex")).substring(0,8)+"-"+A.substring(8,12)+"-"+A.substring(12,16)+"-"+A.substring(16,20)+"-"+A.substring(20,32):S}function k(S,A){o.call(this,S,A,"UUID"),this.getters.push(function(M){return M!=null&&M.$__!=null?M:n.isBuffer(M)?y(M):M instanceof m?y(M.buffer):d.isPOJO(M)&&M.type==="Buffer"&&Array.isArray(M.data)?y(n.from(M.data)):M})}function v(S){return this.cast(S)}function D(S){var A=this;return S.map(function(M){return A.cast(M)})}k.schemaName="UUID",k.defaultOptions={},k.prototype=Object.create(o.prototype),k.prototype.constructor=k,k._cast=h,k.get=o.get,k.set=o.set,k.setters=[],k.cast=function(S){return arguments.length===0||(S===!1&&(S=this._defaultCaster),this._cast=S),this._cast},k._checkRequired=function(S){return S!=null},k.checkRequired=o.checkRequired,k.prototype.checkRequired=function(S){return n.isBuffer(S)&&(S=y(S)),S!=null&&p.test(S)},k.prototype.cast=function(S,A,M,V,K){if(d.isNonBuiltinObject(S)&&o._isRef(this,S,A,M))return this._castRef(S,A,M,K);var H;H=typeof this._castFunction=="function"?this._castFunction:typeof this.constructor.cast=="function"?this.constructor.cast():k.cast();try{return H(S)}catch(Q){throw new u(k.schemaName,S,this.path,Q,this)}};var j=x(x({},o.prototype.$conditionalHandlers),{},{$bitsAllClear:_,$bitsAnyClear:_,$bitsAllSet:_,$bitsAnySet:_,$all:D,$gt:v,$gte:v,$in:D,$lt:v,$lte:v,$ne:v,$nin:D});Object.defineProperty(k.prototype,"$conditionalHandlers",{enumerable:!1,value:j}),k.prototype.castForQuery=function(S,A,M){var V;if(S!=null){if(!(V=this.$conditionalHandlers[S]))throw new Error("Can't use "+S+" with UUID.");return V.call(this,A,M)}try{return this.applySetters(A,M)}catch(K){throw K instanceof u&&K.path===this.path&&this.$fullPath!=null&&(K.path=this.$fullPath),K}},k.prototype.toJSONSchema=function(S){var A=this.options.required&&typeof this.options.required!="function";return l("string","binData",S?.useBsonType,A)},k.prototype.autoEncryptionType=function(){return"binData"},a.exports=k},2151:a=>{"use strict";a.exports=Math.round},2268:a=>{"use strict";a.exports=TypeError},2273:(a,i,t)=>{"use strict";function n(l){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},n(l)}var c=t(668),b=typeof Symbol=="function"&&n(Symbol("foo"))==="symbol",x=Object.prototype.toString,w=Array.prototype.concat,g=t(6750),o=t(3191)(),u=function(l,d,_,p){if(d in l){if(p===!0){if(l[d]===_)return}else if(typeof(m=p)!="function"||x.call(m)!=="[object Function]"||!p())return}var m;o?g(l,d,_,!0):g(l,d,_)},h=function(l,d){var _=arguments.length>2?arguments[2]:{},p=c(d);b&&(p=w.call(p,Object.getOwnPropertySymbols(d)));for(var m=0;m<p.length;m+=1)u(l,p[m],d[p[m]],_[p[m]])};h.supportsDescriptors=!!o,a.exports=h},2307:(a,i,t)=>{"use strict";var n=t(5832).hp;function c(v,D){var j=Object.keys(v);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(v);D&&(S=S.filter(function(A){return Object.getOwnPropertyDescriptor(v,A).enumerable})),j.push.apply(j,S)}return j}function b(v){for(var D=1;D<arguments.length;D++){var j=arguments[D]!=null?arguments[D]:{};D%2?c(Object(j),!0).forEach(function(S){x(v,S,j[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(j)):c(Object(j)).forEach(function(S){Object.defineProperty(v,S,Object.getOwnPropertyDescriptor(j,S))})}return v}function x(v,D,j){return(D=function(S){var A=function(M){if(w(M)!="object"||!M)return M;var V=M[Symbol.toPrimitive];if(V!==void 0){var K=V.call(M,"string");if(w(K)!="object")return K;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(M)}(S);return w(A)=="symbol"?A:A+""}(D))in v?Object.defineProperty(v,D,{value:j,enumerable:!0,configurable:!0,writable:!0}):v[D]=j,v}function w(v){return w=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},w(v)}var g=t(6365),o=t(2945),u=t(6426),h=t(4327),l=t(9460),d=t(8768),_=g.Binary,p=u.CastError;function m(v,D){u.call(this,v,D,"Buffer")}function y(v,D){return this.castForQuery(null,v,D)}m.schemaName="Buffer",m.defaultOptions={},m.prototype=Object.create(u.prototype),m.prototype.constructor=m,m.prototype.OptionsConstructor=o,m._checkRequired=function(v){return!(!v||!v.length)},m.set=u.set,m.setters=[],m.get=u.get,m.checkRequired=u.checkRequired,m.prototype.checkRequired=function(v,D){return u._isRef(this,v,D,!0)?!!v:this.constructor._checkRequired(v)},m.prototype.cast=function(v,D,j,S,A){var M;if(u._isRef(this,v,D,j)){if(v&&v.isMongooseBuffer)return v;if(n.isBuffer(v))return v&&v.isMongooseBuffer||(v=new g(v,[this.path,D]),this.options.subtype!=null&&(v._subtype=this.options.subtype)),v;if(v instanceof _){if(M=new g(v.value(!0),[this.path,D]),typeof v.sub_type!="number")throw new p("Buffer",v,this.path,null,this);return M._subtype=v.sub_type,M}if(v==null||d.isNonBuiltinObject(v))return this._castRef(v,D,j,A)}if(v&&v._id&&(v=v._id),v&&v.isMongooseBuffer)return v;if(n.isBuffer(v))return v&&v.isMongooseBuffer||(v=new g(v,[this.path,D]),this.options.subtype!=null&&(v._subtype=this.options.subtype)),v;if(v instanceof _){if(M=new g(v.value(!0),[this.path,D]),typeof v.sub_type!="number")throw new p("Buffer",v,this.path,null,this);return M._subtype=v.sub_type,M}if(v===null)return v;var V=w(v);if(V==="string"||V==="number"||Array.isArray(v)||V==="object"&&v.type==="Buffer"&&Array.isArray(v.data))return V==="number"&&(v=[v]),M=new g(v,[this.path,D]),this.options.subtype!=null&&(M._subtype=this.options.subtype),M;if(d.isPOJO(v)&&(v.$binary instanceof _||typeof v.$binary=="string")){var K=this.cast(n.from(v.$binary,"base64"));if(v.$type!=null)return K._subtype=v.$type,K}throw new p("Buffer",v,this.path,null,this)},m.prototype.subtype=function(v){return this.options.subtype=v,this};var k=b(b({},u.prototype.$conditionalHandlers),{},{$bitsAllClear:l,$bitsAnyClear:l,$bitsAllSet:l,$bitsAnySet:l,$gt:y,$gte:y,$lt:y,$lte:y});Object.defineProperty(m.prototype,"$conditionalHandlers",{enumerable:!1,value:k}),m.prototype.castForQuery=function(v,D,j){var S,A;if(v!=null){if(!(S=this.$conditionalHandlers[v]))throw new Error("Can't use "+v+" with Buffer.");return S.call(this,D)}try{A=this.applySetters(D,j)}catch(M){throw M instanceof p&&M.path===this.path&&this.$fullPath!=null&&(M.path=this.$fullPath),M}return A&&A.toObject({transform:!1,virtuals:!1})},m.prototype.toJSONSchema=function(v){var D=this.options.required&&typeof this.options.required!="function";return h("string","binData",v?.useBsonType,D)},m.prototype.autoEncryptionType=function(){return"binData"},a.exports=m},2345:(a,i,t)=>{"use strict";function n(k,v){var D=Object.keys(k);if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(k);v&&(j=j.filter(function(S){return Object.getOwnPropertyDescriptor(k,S).enumerable})),D.push.apply(D,j)}return D}function c(k){for(var v=1;v<arguments.length;v++){var D=arguments[v]!=null?arguments[v]:{};v%2?n(Object(D),!0).forEach(function(j){b(k,j,D[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(D)):n(Object(D)).forEach(function(j){Object.defineProperty(k,j,Object.getOwnPropertyDescriptor(D,j))})}return k}function b(k,v,D){return(v=function(j){var S=function(A){if(x(A)!="object"||!A)return A;var M=A[Symbol.toPrimitive];if(M!==void 0){var V=M.call(A,"string");if(x(V)!="object")return V;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(A)}(j);return x(S)=="symbol"?S:S+""}(v))in k?Object.defineProperty(k,v,{value:D,enumerable:!0,configurable:!0,writable:!0}):k[v]=D,k}function x(k){return x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},x(k)}var w=t(3672),g=t(3731),o=t(6426),u=t(2477),h=t(4327),l=t(8260),d=t(8768),_=o.CastError;function p(k,v){o.call(this,k,v,"Date")}function m(k){return this.cast(k)}p.schemaName="Date",p.defaultOptions={},p.prototype=Object.create(o.prototype),p.prototype.constructor=p,p.prototype.OptionsConstructor=g,p._cast=u,p.set=o.set,p.setters=[],p.get=o.get,p.cast=function(k){return arguments.length===0||(k===!1&&(k=this._defaultCaster),this._cast=k),this._cast},p._defaultCaster=function(k){if(k!=null&&!(k instanceof Date))throw new Error;return k},p.prototype.expires=function(k){return l(this._index)!=="Object"&&(this._index={}),this._index.expires=k,d.expires(this._index),this},p._checkRequired=function(k){return k instanceof Date},p.checkRequired=o.checkRequired,p.prototype.checkRequired=function(k,v){return x(k)==="object"&&o._isRef(this,k,v,!0)?k!=null:(typeof this.constructor.checkRequired=="function"?this.constructor.checkRequired():p.checkRequired())(k)},p.prototype.min=function(k,v){if(this.minValidator&&(this.validators=this.validators.filter(function(S){return S.validator!==this.minValidator},this)),k){var D=v||w.messages.Date.min;typeof D=="string"&&(D=D.replace(/{MIN}/,k===Date.now?"Date.now()":k.toString()));var j=this;this.validators.push({validator:this.minValidator=function(S){var A=k;typeof k=="function"&&k!==Date.now&&(A=A.call(this));var M=A===Date.now?A():j.cast(A);return S===null||S.valueOf()>=M.valueOf()},message:D,type:"min",min:k})}return this},p.prototype.max=function(k,v){if(this.maxValidator&&(this.validators=this.validators.filter(function(S){return S.validator!==this.maxValidator},this)),k){var D=v||w.messages.Date.max;typeof D=="string"&&(D=D.replace(/{MAX}/,k===Date.now?"Date.now()":k.toString()));var j=this;this.validators.push({validator:this.maxValidator=function(S){var A=k;typeof A=="function"&&A!==Date.now&&(A=A.call(this));var M=A===Date.now?A():j.cast(A);return S===null||S.valueOf()<=M.valueOf()},message:D,type:"max",max:k})}return this},p.prototype.cast=function(k){var v;v=typeof this._castFunction=="function"?this._castFunction:typeof this.constructor.cast=="function"?this.constructor.cast():p.cast();try{return v(k)}catch(D){throw new _("date",k,this.path,D,this)}};var y=c(c({},o.prototype.$conditionalHandlers),{},{$gt:m,$gte:m,$lt:m,$lte:m});Object.defineProperty(p.prototype,"$conditionalHandlers",{enumerable:!1,value:y}),p.prototype.castForQuery=function(k,v,D){if(k==null)try{return this.applySetters(v,D)}catch(S){throw S instanceof _&&S.path===this.path&&this.$fullPath!=null&&(S.path=this.$fullPath),S}var j=this.$conditionalHandlers[k];if(!j)throw new Error("Can't use "+k+" with Date.");return j.call(this,v)},p.prototype.toJSONSchema=function(k){var v=this.options.required&&typeof this.options.required!="function";return h("string","date",k?.useBsonType,v)},p.prototype.autoEncryptionType=function(){return"date"},a.exports=p},2354:(a,i,t)=>{"use strict";var n=t(6730);a.exports=Function.prototype.bind||n},2400:(a,i,t)=>{"use strict";var n=t(5832).hp;function c(R){return function(ee){if(Array.isArray(ee))return _(ee)}(R)||function(ee){if(typeof Symbol<"u"&&ee[Symbol.iterator]!=null||ee["@@iterator"]!=null)return Array.from(ee)}(R)||d(R)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function b(){var R,ee,fe=typeof Symbol=="function"?Symbol:{},ge=fe.iterator||"@@iterator",xe=fe.toStringTag||"@@toStringTag";function _e(lt,pt,xt,Dt){var Ot=pt&&pt.prototype instanceof Fe?pt:Fe,Wt=Object.create(Ot.prototype);return x(Wt,"_invoke",function(ur,Kt,or){var Qt,Ct,zt,Pr=0,vr=or||[],Ut=!1,nr={p:0,n:0,v:R,a:it,f:it.bind(R,4),d:function(Vt,tr){return Qt=Vt,Ct=0,zt=R,nr.n=tr,Le}};function it(Vt,tr){for(Ct=Vt,zt=tr,ee=0;!Ut&&Pr&&!Xt&&ee<vr.length;ee++){var Xt,rr=vr[ee],Lr=nr.p,jr=rr[2];Vt>3?(Xt=jr===tr)&&(zt=rr[(Ct=rr[4])?5:(Ct=3,3)],rr[4]=rr[5]=R):rr[0]<=Lr&&((Xt=Vt<2&&Lr<rr[1])?(Ct=0,nr.v=tr,nr.n=rr[1]):Lr<jr&&(Xt=Vt<3||rr[0]>tr||tr>jr)&&(rr[4]=Vt,rr[5]=tr,nr.n=jr,Ct=0))}if(Xt||Vt>1)return Le;throw Ut=!0,tr}return function(Vt,tr,Xt){if(Pr>1)throw TypeError("Generator is already running");for(Ut&&tr===1&&it(tr,Xt),Ct=tr,zt=Xt;(ee=Ct<2?R:zt)||!Ut;){Qt||(Ct?Ct<3?(Ct>1&&(nr.n=-1),it(Ct,zt)):nr.n=zt:nr.v=zt);try{if(Pr=2,Qt){if(Ct||(Vt="next"),ee=Qt[Vt]){if(!(ee=ee.call(Qt,zt)))throw TypeError("iterator result is not an object");if(!ee.done)return ee;zt=ee.value,Ct<2&&(Ct=0)}else Ct===1&&(ee=Qt.return)&&ee.call(Qt),Ct<2&&(zt=TypeError("The iterator does not provide a '"+Vt+"' method"),Ct=1);Qt=R}else if((ee=(Ut=nr.n<0)?zt:ur.call(Kt,nr))!==Le)break}catch(rr){Qt=R,Ct=1,zt=rr}finally{Pr=1}}return{value:ee,done:Ut}}}(lt,xt,Dt),!0),Wt}var Le={};function Fe(){}function Qe(){}function Ve(){}ee=Object.getPrototypeOf;var Ge=[][ge]?ee(ee([][ge]())):(x(ee={},ge,function(){return this}),ee),Ne=Ve.prototype=Fe.prototype=Object.create(Ge);function st(lt){return Object.setPrototypeOf?Object.setPrototypeOf(lt,Ve):(lt.__proto__=Ve,x(lt,xe,"GeneratorFunction")),lt.prototype=Object.create(Ne),lt}return Qe.prototype=Ve,x(Ne,"constructor",Ve),x(Ve,"constructor",Qe),Qe.displayName="GeneratorFunction",x(Ve,xe,"GeneratorFunction"),x(Ne),x(Ne,xe,"Generator"),x(Ne,ge,function(){return this}),x(Ne,"toString",function(){return"[object Generator]"}),(b=function(){return{w:_e,m:st}})()}function x(R,ee,fe,ge){var xe=Object.defineProperty;try{xe({},"",{})}catch{xe=0}x=function(_e,Le,Fe,Qe){function Ve(Ge,Ne){x(_e,Ge,function(st){return this._invoke(Ge,Ne,st)})}Le?xe?xe(_e,Le,{value:Fe,enumerable:!Qe,configurable:!Qe,writable:!Qe}):_e[Le]=Fe:(Ve("next",0),Ve("throw",1),Ve("return",2))},x(R,ee,fe,ge)}function w(R,ee,fe,ge,xe,_e,Le){try{var Fe=R[_e](Le),Qe=Fe.value}catch(Ve){return void fe(Ve)}Fe.done?ee(Qe):Promise.resolve(Qe).then(ge,xe)}function g(R){return function(){var ee=this,fe=arguments;return new Promise(function(ge,xe){var _e=R.apply(ee,fe);function Le(Qe){w(_e,ge,xe,Le,Fe,"next",Qe)}function Fe(Qe){w(_e,ge,xe,Le,Fe,"throw",Qe)}Le(void 0)})}}function o(R,ee){var fe=Object.keys(R);if(Object.getOwnPropertySymbols){var ge=Object.getOwnPropertySymbols(R);ee&&(ge=ge.filter(function(xe){return Object.getOwnPropertyDescriptor(R,xe).enumerable})),fe.push.apply(fe,ge)}return fe}function u(R){for(var ee=1;ee<arguments.length;ee++){var fe=arguments[ee]!=null?arguments[ee]:{};ee%2?o(Object(fe),!0).forEach(function(ge){h(R,ge,fe[ge])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(fe)):o(Object(fe)).forEach(function(ge){Object.defineProperty(R,ge,Object.getOwnPropertyDescriptor(fe,ge))})}return R}function h(R,ee,fe){return(ee=function(ge){var xe=function(_e){if(p(_e)!="object"||!_e)return _e;var Le=_e[Symbol.toPrimitive];if(Le!==void 0){var Fe=Le.call(_e,"string");if(p(Fe)!="object")return Fe;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(_e)}(ge);return p(xe)=="symbol"?xe:xe+""}(ee))in R?Object.defineProperty(R,ee,{value:fe,enumerable:!0,configurable:!0,writable:!0}):R[ee]=fe,R}function l(R,ee){var fe=typeof Symbol<"u"&&R[Symbol.iterator]||R["@@iterator"];if(!fe){if(Array.isArray(R)||(fe=d(R))||ee&&R&&typeof R.length=="number"){fe&&(R=fe);var ge=0,xe=function(){};return{s:xe,n:function(){return ge>=R.length?{done:!0}:{done:!1,value:R[ge++]}},e:function(Qe){throw Qe},f:xe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _e,Le=!0,Fe=!1;return{s:function(){fe=fe.call(R)},n:function(){var Qe=fe.next();return Le=Qe.done,Qe},e:function(Qe){Fe=!0,_e=Qe},f:function(){try{Le||fe.return==null||fe.return()}finally{if(Fe)throw _e}}}}function d(R,ee){if(R){if(typeof R=="string")return _(R,ee);var fe={}.toString.call(R).slice(8,-1);return fe==="Object"&&R.constructor&&(fe=R.constructor.name),fe==="Map"||fe==="Set"?Array.from(R):fe==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(fe)?_(R,ee):void 0}}function _(R,ee){(ee==null||ee>R.length)&&(ee=R.length);for(var fe=0,ge=Array(ee);fe<ee;fe++)ge[fe]=R[fe];return ge}function p(R){return p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ee){return typeof ee}:function(ee){return ee&&typeof Symbol=="function"&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee},p(R)}var m,y,k,v=t(1417),D=t(3550).EventEmitter,j=t(4224),S=t(6365),A=t(3672),M=t(5022),V=t(6140),K=t(3441),H=t(1350),Q=t(1635),re=t(7058),ue=t(8995),W=t(6949),$=t(9538),C=t(6814),J=t(5335),F=t(4473),I=t(4450),N=t(2068).w,G=t(2068).X,ae=t(1226),ce=t(7430).B,Se=t(5152),oe=t(791),Z=t(2692),he=t(3216),E=t(2746),z=t(3305),X=t(7300),de=t(1793),q=t(5188),B=t(7352).inspect,te=t(3303)._,T=t(1849),Y=t(6451),ie=t(5678),me=t(6223),ne=t(3892),ye=t(8768),Re=t(542),Ie=ye.deepEqual,je=ye.isMongooseObject,Be=t(7930).arrayAtomicsBackupSymbol,Me=t(7930).arrayAtomicsSymbol,qe=t(7930).documentArrayParent,vt=t(7930).documentIsModified,jt=t(7930).documentModifiedPaths,wt=t(7930).documentSchemaSymbol,ft=t(7930).getSymbol,fr=t(7930).modelSymbol,Nt=t(7930).populateModelSymbol,Bt=t(7930).scopeSymbol,Ht=t(7160).schemaMixedSymbol,Lt=t(5346),qt=t(7930).sessionNewDocuments,Ir=ye.specialProperties;function ze(R,ee,fe,ge){if(p(fe)==="object"&&fe!=null&&(fe=(ge=fe).skipId),ge=Object.assign({},ge),this.$__schema==null){var xe=ye.isObject(ee)&&!ee.instanceOfSchema?new re(ee):ee;this.$__setSchema(xe),ee=fe,fe=ge,ge=arguments[4]||{}}if(this.$__=new j,ge.isNew!=null&&ge.isNew!==!0&&(this.$isNew=ge.isNew),ge.priorDoc!=null&&(this.$__.priorDoc=ge.priorDoc),fe&&(this.$__.skipId=fe),R!=null&&p(R)!=="object")throw new H(R,"obj","Document");var _e=!0;ge.defaults!==void 0&&(this.$__.defaults=ge.defaults,_e=ge.defaults);var Le=this.$__schema;typeof ee=="boolean"||ee==="throw"?(ee!==!0&&(this.$__.strictMode=ee),ee=void 0):Le.options.strict!==!0&&(this.$__.strictMode=Le.options.strict);var Fe,Qe=l(Le.requiredPaths(!0));try{for(Qe.s();!(Fe=Qe.n()).done;){var Ve=Fe.value;this.$__.activePaths.require(Ve)}}catch(lt){Qe.e(lt)}finally{Qe.f()}var Ge=null;ye.isPOJO(ee)&&Object.keys(ee).length>0&&(Ge=de(ee),this.$__.selected=ee,this.$__.exclude=Ge);var Ne=Ge===!1&&ee?C(ee):null;if(this._doc==null&&(this.$__buildDoc(R,ee,fe,Ge,Ne,!1),_e&&J(this,ee,Ge,Ne,!0,null,{skipParentChangeTracking:!0})),R&&(this.$__original_set?this.$__original_set(R,void 0,!0,ge):this.$set(R,void 0,!0,ge),R instanceof ze&&(this.$isNew=R.$isNew)),ge.willInit&&_e?ge.skipDefaults&&(this.$__.skipDefaults=ge.skipDefaults):_e&&J(this,ee,Ge,Ne,!1,ge.skipDefaults),!this.$__.strictMode&&R){var st=this;Object.keys(this._doc).forEach(function(lt){lt in Le.tree||lt in Le.methods||lt in Le.virtuals||lt.startsWith("$")||G({prop:lt,subprops:null,prototype:st})})}(function(lt){var pt=lt.$__schema&&lt.$__schema.callQueue;if(pt.length){var xt,Dt=l(pt);try{for(Dt.s();!(xt=Dt.n()).done;){var Ot=xt.value;Ot[0]!=="pre"&&Ot[0]!=="post"&&Ot[0]!=="on"&&lt[Ot[0]].apply(lt,Ot[1])}}catch(Wt){Dt.e(Wt)}finally{Dt.f()}}})(this)}for(var br in ze.prototype.$isMongooseDocumentPrototype=!0,Object.defineProperty(ze.prototype,"isNew",{get:function(){return this.$isNew},set:function(R){this.$isNew=R}}),Object.defineProperty(ze.prototype,"errors",{get:function(){return this.$errors},set:function(R){this.$errors=R}}),ze.prototype.$isNew=!0,ye.each(["on","once","emit","listeners","removeListener","setMaxListeners","removeAllListeners","addListener"],function(R){ze.prototype[R]=function(){if(!this.$__.emitter){if(R==="emit")return;this.$__.emitter=new D,this.$__.emitter.setMaxListeners(0)}return this.$__.emitter[R].apply(this.$__.emitter,arguments)},ze.prototype["$".concat(R)]=ze.prototype[R]}),ze.prototype.constructor=ze,D.prototype)ze[br]=D.prototype[br];function yr(R,ee,fe){if(R!=null)for(var ge=Object.keys(fe.$__schema.paths),xe=ge.length,_e=ee.indexOf(".")===-1?[ee]:ee.split("."),Le=0;Le<xe;++Le){var Fe="",Qe=ge[Le];if(Qe.startsWith(ee+".")){var Ve=fe.$__schema.paths[Qe],Ge=Ve.splitPath().slice(_e.length),Ne=Ge.length;if(Ve.defaultValue!==void 0)for(var st=R,lt=0;lt<Ne&&st!=null;++lt){var pt=Ge[lt];if(lt===Ne-1){if(st[pt]!==void 0)break;try{var xt=Ve.getDefault(fe,!1);xt!==void 0&&(st[pt]=xt)}catch(Dt){fe.invalidate(ee+"."+Fe,Dt);break}break}Fe+=(Fe.length?".":"")+pt,st[pt]=st[pt]||{},st=st[pt]}}}}function Ae(R,ee,fe,ge,xe){xe=xe||"",ee.$__!=null&&(ee=ee._doc);for(var _e,Le,Fe,Qe=Object.keys(ee),Ve=Qe.length,Ge=R.$__.strictMode,Ne=R.$__schema,st=0;st<Ve;++st)if(Fe=Qe[st],!Ir.has(Fe)&&(Le=xe?xe+Fe:Fe,_e=Ne.path(Le),!Ne.$isRootDiscriminator||R.$__isSelected(Le))){var lt=ee[Fe];if(!_e&&ye.isPOJO(lt))fe[Fe]||(fe[Fe]={},Ge||Fe in Ne.tree||Fe in Ne.methods||Fe in Ne.virtuals?ge!=null&&ge.virtuals&&Fe in Ne.virtuals&&(R[Fe]=fe[Fe]):R[Fe]=fe[Fe]),Ae(R,lt,fe[Fe],ge,Le+".");else if(_e){if(fe.hasOwnProperty(Fe)&&lt!==void 0&&!ge.hydratedPopulatedDocs&&delete fe[Fe],lt===null)fe[Fe]=_e._castNullish(null);else if(lt!==void 0){var pt=lt.$__==null?null:lt.$__.wasPopulated;if(!_e||pt||ge.hydratedPopulatedDocs)if(_e&&ge.hydratedPopulatedDocs){var xt;fe[Fe]=_e.cast(lt,R,!0,void 0,{hydratedPopulatedDocs:!0}),fe[Fe]&&fe[Fe].$__&&fe[Fe].$__.wasPopulated?R.$populated(Le,fe[Fe].$__.wasPopulated.value,fe[Fe].$__.wasPopulated.options):Array.isArray(fe[Fe])&&fe[Fe].length&&(xt=fe[Fe][0])!==null&&xt!==void 0&&(xt=xt.$__)!==null&&xt!==void 0&&xt.wasPopulated&&R.$populated(Le,fe[Fe].map(function(Dt){var Ot;return Dt==null||(Ot=Dt.$__)===null||Ot===void 0||(Ot=Ot.wasPopulated)===null||Ot===void 0?void 0:Ot.value}).filter(function(Dt){return Dt!=null}),fe[Fe][0].$__.wasPopulated.options)}else fe[Fe]=lt;else try{ge&&ge.setters?fe[Fe]=_e.applySetters(lt,R,!1,null,ge):fe[Fe]=_e.cast(lt,R,!0,void 0,ge)}catch(Dt){R.invalidate(Dt.path,new $({path:Dt.path,message:Dt.message,type:"cast",value:Dt.value,reason:Dt}))}}R.$isModified(Le)||R.$__.activePaths.init(Le)}else fe[Fe]=lt,Ge||xe?ge!=null&&ge.virtuals&&Fe in Ne.virtuals&&(R[Fe]=lt):R[Fe]=lt}}function Nr(R){if(R==null)return!0;if(p(R)!=="object"||Array.isArray(R))return!1;for(var ee=0,fe=Object.keys(R);ee<fe.length;ee++)if(!Nr(R[fe[ee]]))return!1;return!0}function sa(R,ee,fe,ge){var xe={};(function(It){var xr=Object.keys(It.$__.activePaths.getStatePaths("require")),pr=0,ir=xr.length;for(pr=0;pr<ir;++pr){var Zt=xr[pr],Yt=It.$__schema.path(Zt);if(Yt!=null&&typeof Yt.originalRequiredValue=="function"){It.$__.cachedRequired=It.$__.cachedRequired||{};try{It.$__.cachedRequired[Zt]=Yt.originalRequiredValue.call(It,It)}catch(Er){It.invalidate(Zt,Er)}}}})(R);var _e=new Set(Object.keys(R.$__.activePaths.getStatePaths("require")).filter(function(It){return!(!R.$__isSelected(It)&&!R.$isModified(It))&&!It.endsWith(".$*")&&(R.$__.cachedRequired==null||!(It in R.$__.cachedRequired)||R.$__.cachedRequired[It])}));function Le(It){It.endsWith(".$*")||_e.add(It)}if(Object.keys(R.$__.activePaths.getStatePaths("init")).forEach(Le),Object.keys(R.$__.activePaths.getStatePaths("modify")).forEach(Le),Object.keys(R.$__.activePaths.getStatePaths("default")).forEach(Le),!ge){for(var Fe=[],Qe=0,Ve=Object.keys(R.$__schema.paths);Qe<Ve.length;Qe++){var Ge=Ve[Qe],Ne=R.$__schema.path(Ge);if(Ne.$isSingleNested){var st=R.$get(Ge);st&&Fe.push(st)}else if(Ne.$isMongooseDocumentArray){var lt=R.$get(Ge);if(lt&&lt.length){var pt,xt=l(lt);try{for(xt.s();!(pt=xt.n()).done;){var Dt=pt.value;Dt&&Fe.push(Dt)}}catch(It){xt.e(It)}finally{xt.f()}}}}for(var Ot=R.modifiedPaths(),Wt=0,ur=Fe;Wt<ur.length;Wt++){var Kt=ur[Wt];if(Kt.$basePath){var or,Qt=Kt.$__pathRelativeToParent(),Ct=l(Kt.modifiedPaths());try{for(Ct.s();!(or=Ct.n()).done;){var zt=or.value;_e.delete(Qt+"."+zt)}}catch(It){Ct.e(It)}finally{Ct.f()}var Pr=Kt.$parent();if(Pr==null)throw new Error("Cannot validate subdocument that does not have a parent");!R.$isModified(Qt,null,Ot)||Pr.$__.activePaths.getStatePaths("modify").hasOwnProperty(Qt)||Pr.$isDefault(Qt)||(_e.add(Qt),R.$__.pathsToScopes==null&&(R.$__.pathsToScopes={}),R.$__.pathsToScopes[Qt]=Kt.$isDocumentArrayElement?Kt.__parentArray:Kt.$parent(),xe[Qt]={skipSchemaValidators:!0},Kt.$isDocumentArrayElement&&Kt.__index!=null&&(xe[Qt].index=Kt.__index))}}}var vr,Ut=l(_e);try{for(Ut.s();!(vr=Ut.n()).done;){var nr=vr.value,it=R.$__schema.path(nr);if(it){if(it.$isMongooseDocumentArray){var Vt,tr=l(_e);try{for(tr.s();!(Vt=tr.n()).done;){var Xt=Vt.value;(Xt==null||Xt.startsWith(it.path+"."))&&_e.delete(Xt)}}catch(It){tr.e(It)}finally{tr.f()}}(it.caster||it.validators.length!==0||it.$parentSchemaDocArray)&&(!it.$isMongooseArray||it.$isMongooseDocumentArray||it.$embeddedSchemaType.$isMongooseArray||it.validators.length!==0||it.$embeddedSchemaType.validators.length!==0)||_e.delete(nr)}}}catch(It){Ut.e(It)}finally{Ut.f()}Array.isArray(ee)?_e=function(It,xr){var pr,ir=new Set(xr),Zt=new Map([]),Yt=l(xr);try{for(Yt.s();!(pr=Yt.n()).done;){var Er=pr.value;if(Er.indexOf(".")!==-1)for(var Dr=Er.split("."),aa=Dr[0],qr=1;qr<Dr.length;++qr)Zt.set(aa,Er),aa=aa+"."+Dr[qr]}}catch(da){Yt.e(da)}finally{Yt.f()}var Hr,zr=new Set,Tr=l(It);try{for(Tr.s();!(Hr=Tr.n()).done;){var ea=Hr.value;ir.has(ea)?zr.add(ea):Zt.has(ea)&&zr.add(Zt.get(ea))}}catch(da){Tr.e(da)}finally{Tr.f()}return zr}(_e,ee):Array.isArray(fe)&&(_e=function(It,xr){return xr=new Set(xr),It=Array.from(It).filter(function(pr){return!xr.has(pr)}),new Set(It)}(_e,fe)),function(It,xr){var pr,ir=l(xr);try{for(ir.s();!(pr=ir.n()).done;){var Zt=pr.value,Yt=It.$__schema.path(Zt);Yt&&Yt.$isMongooseArray&&(Array.isArray(Yt)||!Yt.$isMongooseDocumentArray||Yt&&Yt.schemaOptions&&Yt.schemaOptions.required)&&(!Yt.$isMongooseArray||Yt.$isMongooseDocumentArray||Yt.$embeddedSchemaType.$isMongooseArray||Yt.$embeddedSchemaType.validators.length!==0)&&Yr(It.$__getValue(Zt),xr,Zt)}}catch(Er){ir.e(Er)}finally{ir.f()}}(R,_e);var rr,Lr={skipArrays:!0},jr=l(_e);try{for(jr.s();!(rr=jr.n()).done;){var ta=rr.value;if(R.$__schema.nested[ta]){var Gr=R.$__getValue(ta);je(Gr)&&(Gr=Gr.toObject({transform:!1}));var ra=ce(Gr,ta,Lr,R.$__schema);Object.keys(ra).filter(function(It){return!R.$__schema.singleNestedPaths.hasOwnProperty(It)}).forEach(Le)}}}catch(It){jr.e(It)}finally{jr.f()}var Zr,dr=l(_e);try{for(dr.s();!(Zr=dr.n()).done;){var Or=Zr.value,_r=R.$__schema.path(Or);if(_r&&(_r.$parentSchemaDocArray&&typeof _r.$parentSchemaDocArray.path=="string"&&_e.add(_r.$parentSchemaDocArray.path),_r.$isSchemaMap)){var $r=R.$__getValue(Or);if($r!=null){var cr,Sr=l($r.keys());try{for(Sr.s();!(cr=Sr.n()).done;){var Rr=cr.value;_e.add(Or+"."+Rr)}}catch(It){Sr.e(It)}finally{Sr.f()}}}}}catch(It){dr.e(It)}finally{dr.f()}return[_e=Array.from(_e),xe]}function Yr(R,ee,fe){if(R!=null)for(var ge=R.length,xe=0;xe<ge;++xe)Array.isArray(R[xe])?Yr(R[xe],ee,fe+"."+xe):ee.add(fe+"."+xe)}function kr(R,ee,fe,ge){var xe,_e,Le,Fe=R.$__schema,Qe=Fe.virtuals,Ve=Object.keys(Qe),Ge=Ve.length,Ne=Ge,st=R._doc,lt=typeof(ge&&ge.aliases)!="boolean"||ge.aliases;fe=fe||{};var pt=null;if(Array.isArray(fe.virtuals))pt=new Set(fe.virtuals);else if(fe.virtuals&&fe.virtuals.pathsToSkip){pt=new Set(Ve);for(var xt=0;xt<fe.virtuals.pathsToSkip.length;xt++)pt.has(fe.virtuals.pathsToSkip[xt])&&pt.delete(fe.virtuals.pathsToSkip[xt])}if(!st)return ee;for(Ge=0;Ge<Ne;++Ge)if(xe=Ve[Ge],(pt==null||pt.has(xe))&&(lt||!Fe.aliases.hasOwnProperty(xe))){if(_e=xe,fe.path!=null){if(!xe.startsWith(fe.path+"."))continue;_e=xe.substring(fe.path.length+1)}if(_e.indexOf(".")!==-1||_e!==xe){var Dt=_e.split(".");if((Le=I(R.get(xe),fe))!==void 0){var Ot=Dt.length;st=ee;for(var Wt=0;Wt<Ot-1;++Wt)st[Dt[Wt]]=st[Dt[Wt]]||{},st=st[Dt[Wt]];st[Dt[Ot-1]]=Le}}else{if((Le=Qe[xe].applyGetters(void 0,R))===void 0)continue;Le=I(Le,fe),ee[_e]=Le}}return ee}function Vr(R,ee){if(Re(ee))throw new Error("`transform` function must be synchronous, but the transform on path `"+R+"` returned a promise.")}function ua(R,ee,fe){var ge=R.$populated(ee,!0);if(!ge&&R.$__.selected){var xe=ee.split(".")[0];if(R.$__.selected[xe+".$"])return xe}if(ge&&ye.isMongooseArray(fe)&&(ge.options.match||ge.options.options&&ye.object.hasOwnProperty(ge.options.options,"limit")||ge.options.options&&ge.options.options.skip||ge.options.select&&(ge.options.select._id===0||/\s?-_id\s?/.test(ge.options.select)))){var _e=fe[Me];if(Object.keys(_e).length===0||_e.$set||_e.$pop)return ee}}function Xr(R,ee,fe,ge,xe,_e){if(_e||(_e="$set"),fe[_e]||(fe[_e]={}),fe[_e][ge.path]=xe,R.$__schema.options.versionKey!==!1&&!function(Le,Fe){var Qe=Le.$__schema.options.skipVersioning;return!!Qe&&Qe[Fe=Fe.replace(/\.\d+\./,".")]}(R,ge.path)&&3&~R.$__.version&&!R.$__schema.options.optimisticConcurrency){switch(_e){case"$set":case"$unset":case"$pop":case"$pull":case"$pullAll":case"$push":case"$addToSet":case"$inc":break;default:return}_e==="$push"||_e==="$addToSet"||_e==="$pullAll"||_e==="$pull"?/\.\d+\.|\.\d+$/.test(ge.path)?R.$__.version=3:R.$__.version=2:/^\$p/.test(_e)||Array.isArray(xe)?R.$__.version=3:/\.\d+\.|\.\d+$/.test(ge.path)&&(R.$__.version=1)}}function ca(R,ee,fe,ge,xe){if(!fe.$set||!fe.$set[ge.path])if(typeof xe.$__getAtomics!="function"){var _e,Le,Fe=xe[Me],Qe=Object.keys(Fe),Ve=Qe.length;if(Ve===0)return ye.isMongooseObject(xe)?xe=xe.toObject({depopulate:1,_isNested:!0}):xe.valueOf&&(xe=xe.valueOf()),Xr(R,0,fe,ge,xe);for(;Ve--;)_e=Fe[Le=Qe[Ve]],ye.isMongooseObject(_e)?_e=_e.toObject({depopulate:!0,transform:!1,_isNested:!0}):Array.isArray(_e)?_e=_e.map(Ge):_e.valueOf&&(_e=_e.valueOf()),Le==="$addToSet"&&(_e={$each:_e}),Xr(R,0,fe,ge,_e,Le)}else xe.$__getAtomics().forEach(function(Ne){var st=Ne[0],lt=Ne[1];Xr(R,0,fe,ge,lt,st)});function Ge(Ne){return ye.isMongooseObject(Ne)?Ne.toObject({depopulate:1,_isNested:!0}):Ne}}ze.prototype.$__schema,ze.prototype.schema,Object.defineProperty(ze.prototype,"$locals",{configurable:!1,enumerable:!1,get:function(){return this.$__.locals==null&&(this.$__.locals={}),this.$__.locals},set:function(R){this.$__.locals=R}}),ze.prototype.isNew,Object.defineProperty(ze.prototype,"$where",{configurable:!1,enumerable:!1,writable:!0}),ze.prototype.id,ze.prototype.$errors,Object.defineProperty(ze.prototype,"$op",{get:function(){return this.$__.op||null},set:function(R){this.$__.op=R}}),ze.prototype.$__buildDoc=function(R,ee,fe,ge,xe){for(var _e={},Le=Object.keys(this.$__schema.paths).filter(function(Wt){return!Wt.includes("$*")}),Fe=Le.length,Qe=0;Qe<Fe;++Qe){var Ve=Le[Qe];if(!(Ve==="_id"&&(fe||R&&"_id"in R)))for(var Ge=this.$__schema.paths[Ve].splitPath(),Ne=Ge.length,st=Ne-1,lt="",pt=_e,xt=!1,Dt=0;Dt<Ne;++Dt){var Ot=Ge[Dt];if(lt.length?lt+="."+Ot:lt=Ot,ge===!0){if(lt in ee)break}else if(ge===!1&&ee&&!xt){if(lt in ee)xt=!0;else if(!xe[lt])break}Dt<st&&(pt=pt[Ot]||(pt[Ot]={}))}}this._doc=_e},ze.prototype.toBSON=function(){return this.toObject(te)},ze.prototype.init=function(R,ee,fe){return typeof ee=="function"&&(fe=ee,ee=null),this.$__init(R,ee),fe&&fe(null,this),this},ze.prototype.$init=function(){return this.constructor.prototype.init.apply(this,arguments)},ze.prototype.$__init=function(R,ee){if(this.$isNew=!1,ee=ee||{},R._id!=null&&ee.populated&&ee.populated.length){var fe,ge=String(R._id),xe=l(ee.populated);try{for(xe.s();!(fe=xe.n()).done;){var _e=fe.value;if(_e.isVirtual?this.$populated(_e.path,ye.getValue(_e.path,R),_e):this.$populated(_e.path,_e._docs[ge],_e),_e._childDocs!=null){var Le,Fe=l(_e._childDocs);try{for(Fe.s();!(Le=Fe.n()).done;){var Qe=Le.value;Qe!=null&&Qe.$__!=null&&(Qe.$__.parent=this)}}catch(Ge){Fe.e(Ge)}finally{Fe.f()}_e._childDocs=[]}}}catch(Ge){xe.e(Ge)}finally{xe.f()}}Ae(this,R,this._doc,ee),T(this,ee.populated),this.$emit("init",this),this.constructor.emit("init",this);var Ve=this.$__.exclude===!1&&this.$__.selected?C(this.$__.selected):null;return J(this,this.$__.selected,this.$__.exclude,Ve,!1,this.$__.skipDefaults),this},ze.prototype.updateOne=function(R,ee,fe){var ge=this.constructor.updateOne({_id:this._doc._id},R,ee),xe=this;return ge.pre(function(_e){xe.constructor._middleware.execPre("updateOne",xe,[xe],_e)}),ge.post(function(_e){xe.constructor._middleware.execPost("updateOne",xe,[xe],{},_e)}),this.$session()!=null&&("session"in ge.options||(ge.options.session=this.$session())),fe!=null?ge.exec(fe):ge},ze.prototype.replaceOne=function(){var R=Array.prototype.slice.call(arguments);return R.unshift({_id:this._doc._id}),this.constructor.replaceOne.apply(this.constructor,R)},ze.prototype.$session=function(R){if(arguments.length===0)return this.$__.session!=null&&this.$__.session.hasEnded?(this.$__.session=null,null):this.$__.session;if(R!=null&&R.hasEnded)throw new A("Cannot set a document's session to a session that has ended. Make sure you haven't called `endSession()` on the session you are passing to `$session()`.");if(R!=null||this.$__.session!=null){if(this.$__.session=R,!this.$isSubdocument){var ee,fe=l(this.$getAllSubdocs());try{for(fe.s();!(ee=fe.n()).done;)ee.value.$session(R)}catch(ge){fe.e(ge)}finally{fe.f()}}return R}},ze.prototype.$timestamps=function(R){return arguments.length===0?this.$__.timestamps!=null?this.$__.timestamps:this.$__schema?this.$__schema.options.timestamps:void 0:(R!==this.$timestamps()&&(this.$__.timestamps=R),this)},ze.prototype.overwrite=function(R){for(var ee=0,fe=Array.from(new Set(Object.keys(this._doc).concat(Object.keys(R))));ee<fe.length;ee++){var ge=fe[ee];ge!=="_id"&&(this.$__schema.options.versionKey&&ge===this.$__schema.options.versionKey||this.$__schema.options.discriminatorKey&&ge===this.$__schema.options.discriminatorKey||this.$set(ge,R[ge]))}return this},ze.prototype.$set=function(R,ee,fe,ge){var xe=this;ye.isPOJO(fe)&&(ge=fe,fe=void 0);var _e,Le,Fe,Qe,Ve=ge&&ge.merge,Ge=fe&&fe!==!0,Ne=fe===!0,st=0,lt=ge&&"strict"in ge,pt=lt?ge.strict:this.$__.strictMode;if(Ge&&((this.$__.adhocPaths||(this.$__.adhocPaths={}))[R]=this.$__schema.interpretAsType(R,fe,this.$__schema.options)),R==null){var xt=[ee,R];R=xt[0],ee=xt[1]}else if(typeof R!="string"){if(R instanceof ze&&(R=R.$__isNested?R.toObject():R.$__schema===this.$__schema?kr(R,u({},R._doc)):R._doc),R==null){var Dt=[ee,R];R=Dt[0],ee=Dt[1]}Qe=ee?ee+".":"";var Ot=(_e=oe(this.$__schema,R)).length,Wt=ge&&ge._skipMinimizeTopLevel||!1;if(Ot===0&&Wt)return delete ge._skipMinimizeTopLevel,ee&&this.$set(ee,{}),this;ge=Object.assign({},ge,{_skipMinimizeTopLevel:!1});for(var ur=0;ur<Ot;++ur){Fe=_e[ur];var Kt=Qe?Qe+Fe:Fe;Le=this.$__schema.pathType(Kt);var or=R[Fe];if(fe!==!0||Qe||or==null||Le!=="nested"||this._doc[Fe]==null||delete this._doc[Fe],ye.isNonBuiltinObject(or)&&Le==="nested")this.$set(Kt,or,Ne,ge),yr(this.$get(Kt),Kt,this);else if(pt){if(Ne&&or===void 0&&this.$get(Kt)!==void 0)continue;if(Le==="adhocOrUndefined"&&(Le=Se(this,Kt,{typeOnly:!0})),Le==="real"||Le==="virtual")this.$set(Kt,or,Ne,ge);else if(Le==="nested"&&or instanceof ze)this.$set(Kt,or.toObject({transform:!1}),Ne,ge);else{if(pt==="throw")throw Le==="nested"?new K(Fe,or):new ue(Fe);Le==="nested"&&or==null&&this.$set(Kt,or,Ne,ge)}}else this.$set(Kt,or,Ne,ge)}for(var Qt={},Ct=Object.keys(this.$__schema.tree),zt=0,Pr=Ct.length;zt<Pr;++zt)(Fe=Ct[zt])&&this._doc.hasOwnProperty(Fe)&&(Qt[Fe]=void 0);return this._doc=Object.assign(Qt,this._doc),this}var vr=this.$__schema.pathType(R),Ut=null;if(vr==="adhocOrUndefined"&&(Ut=R.indexOf(".")===-1?[R]:R.split("."),vr=Se(this,Ut,{typeOnly:!0})),vr==="adhocOrUndefined"&&!lt){Ut==null&&(Ut=R.indexOf(".")===-1?[R]:R.split("."));var nr=Z(this.$__schema,Ut);nr!==void 0&&(pt=nr)}ee=he(ee,!0);var it,Vt=xe.$__.priorDoc!=null?xe.$__.priorDoc.$__getValue(R):Ne?void 0:xe.$__getValue(R);if(vr==="nested"&&ee){if(p(ee)==="object"&&ee!=null){if(ee.$__!=null&&(ee=ee.toObject(te)),ee==null)return this.invalidate(R,new A.CastError("Object",ee,R)),this;var tr=this.$isModified(R),Xt=this.$__.savedState!=null&&this.$__.savedState.hasOwnProperty(R);if(this.$__.savedState!=null&&!this.$isNew&&!this.$__.savedState.hasOwnProperty(R)){var rr=this.$__getValue(R);this.$__.savedState[R]=rr;for(var Lr=0,jr=Object.keys(rr||{});Lr<jr.length;Lr++){var ta=jr[Lr];this.$__.savedState[R+"."+ta]=rr[ta]}}if(Ve)return this.$set(ee,R,Ne,ge);this.$__setValue(R,null),F(this,R);var Gr=oe(this.$__schema,ee,R);this.$__setValue(R,{});var ra,Zr=l(Gr);try{for(Zr.s();!(ra=Zr.n()).done;){var dr=ra.value;this.$set(R+"."+dr,ee[dr],Ne,u(u({},ge),{},{_skipMarkModified:!0}))}}catch(ke){Zr.e(ke)}finally{Zr.f()}return Vt==null||tr&&!Xt||!ye.deepEqual(Xt?this.$__.savedState[R]:Vt,ee)?this.markModified(R):this.unmarkModified(R),this}return this.invalidate(R,new A.CastError("Object",ee,R)),this}if(Ut==null&&(Ut=R.indexOf(".")===-1?[R]:R.split(".")),typeof this.$__schema.aliases[Ut[0]]=="string"&&(Ut[0]=this.$__schema.aliases[Ut[0]]),vr==="adhocOrUndefined"&&pt){var Or;for(st=0;st<Ut.length;++st){var _r=Ut.slice(0,st+1).join(".");if(st+1<Ut.length&&this.$__schema.pathType(_r)==="virtual")return ie.set(R,ee,this),this;if((it=this.$__schema.path(_r))!=null){if(it instanceof M){Or=!0;break}if(it.$isSchemaMap&&it.$__schemaType instanceof M&&st<Ut.length-1){Or=!0,it=it.$__schemaType;break}}}if(it==null&&(it=Se(this,R)),!Or&&!it){if(pt==="throw")throw new ue(R);return this}}else{if(vr==="virtual")return(it=this.$__schema.virtualpath(R)).applySetters(ee,this),this;it=this.$__path(R)}var $r,cr=this._doc,Sr="";for(st=0;st<Ut.length-1;++st)cr=cr instanceof Map?cr.get(Ut[st]):cr[Ut[st]],Sr+=(Sr.length!==0?".":"")+Ut[st],cr||(this.$set(Sr,{}),this.$__isSelected(Sr)||this.unmarkModified(Sr),cr=this.$__getValue(Sr));if(Ut.length<=1)$r=R;else{var Rr=Ut.length;for(st=0;st<Rr;++st){var It=Ut.slice(0,st+1).join(".");if(this.$get(It,null,{getters:!1})===null){$r=It;break}}$r||($r=R)}if(!it)return this.$__set($r,R,ge,Ne,Ut,it,ee,Vt),vr==="nested"&&ee==null&&F(this,R),this;if((it.$isSingleNested||it.$isMongooseArray)&&function(ke,Ze){if(ke.$__.validationError){for(var We=0,Oe=Object.keys(ke.$__.validationError.errors);We<Oe.length;We++){var St=Oe[We];St.startsWith(Ze+".")&&delete ke.$__.validationError.errors[St]}Object.keys(ke.$__.validationError.errors).length===0&&(ke.$__.validationError=null)}}(this,R),ee!=null&&Ve&&it.$isSingleNested){ee instanceof ze&&(ee=ee.toObject({virtuals:!1,transform:!1}));for(var xr=0,pr=Object.keys(ee);xr<pr.length;xr++){var ir=pr[xr];this.$set(R+"."+ir,ee[ir],Ne,ge)}return this}var Zt=!0;try{var Yt,Er=function(){if(it.options==null||!(ee instanceof ze))return!1;var ke=ee.constructor,Ze=typeof it.options.ref!="function"||it.options.ref[fr]?it.options.ref:it.options.ref.call(xe,xe),We=Ze?.modelName||Ze;if(We!=null&&(We===ke.modelName||We===ke.baseModelName))return!0;var Oe=it.options.refPath;if(Oe==null)return!1;var St=ee.get(Oe);return St===ke.modelName||St===ke.baseModelName}(),Dr=!1;if(Er&&ee instanceof ze&&(!ee.$__.wasPopulated||ye.deepEqual(ee.$__.wasPopulated.value,ee._doc._id))){var aa=it&&it.$isSingleNested?it.cast(ee,this):ee._doc._id;this.$populated(R,aa,h({},Nt,ee.constructor)),ee.$__.wasPopulated={value:aa},Dr=!0}var qr=this.$__schema.options.typeKey;if(it.options&&Array.isArray(it.options[qr])&&it.options[qr].length&&it.options[qr][0]&&it.options[qr][0].ref&&function(ke,Ze){if(!Array.isArray(ke)||ke.length===0)return!1;var We,Oe=l(ke);try{for(Oe.s();!(We=Oe.n()).done;){var St=We.value;if(!(St instanceof ze)||St.constructor.modelName==null||St.constructor.modelName!=Ze&&St.constructor.baseModelName!=Ze)return!1}}catch(ut){Oe.e(ut)}finally{Oe.f()}return!0}(ee,it.options[qr][0].ref)){Yt=h({},Nt,ee[0].constructor),this.$populated(R,ee.map(function(ke){return ke._doc._id}),Yt);var Hr,zr=l(ee);try{for(zr.s();!(Hr=zr.n()).done;){var Tr=Hr.value;Tr.$__.wasPopulated={value:Tr._doc._id}}}catch(ke){zr.e(ke)}finally{zr.f()}Dr=!0}if(!Er||!it.$isSingleNested||!ee.$__){var ea=this;this.$__schema.singleNestedPaths[R]!=null&&Ut.length>1&&(ea=Lt(this,Ut,this.schema)),ee=ge!=null&&ge.overwriteImmutable?it.applySetters(ee,ea,!1,Vt,{path:R,overwriteImmutable:!0}):it.applySetters(ee,ea,!1,Vt,{path:R})}if(Array.isArray(ee)&&!Array.isArray(it)&&it.$isMongooseDocumentArray&&ee.length!==0&&ee[0]!=null&&ee[0].$__!=null&&ee[0].$__.populated!=null){for(var da=Object.keys(ee[0].$__.populated),_a=function(){var ke=ya[ha];xe.$populated(R+"."+ke,ee.map(function(Ze){return Ze.$populated(ke)}),ee[0].$__.populated[ke].options)},ha=0,ya=da;ha<ya.length;ha++)_a();Dr=!0}if(!Dr&&this.$__.populated){if(Array.isArray(ee)&&this.$__.populated[R])for(var fa=0;fa<ee.length;++fa)ee[fa]instanceof ze&&ee.set(fa,ee[fa]._doc._id,!0);delete this.$__.populated[R]}ee!=null&&it.$isSingleNested&&function(ke,Ze,We){var Oe=Ze.schema;if(Oe!=null)for(var St=0,ut=Object.keys(Oe.paths);St<ut.length;St++){var Ye=ut[St],ot=Oe.paths[Ye];if(ot.$immutableSetter!=null){var At=We?.$__getValue(Ye);ot.$immutableSetter.call(ke,At)}}}(ee,it,Vt),this.$markValid(R)}catch(ke){ke instanceof A.StrictModeError&&ke.isImmutableError?this.invalidate(R,ke):ke instanceof A.CastError?(this.invalidate(ke.path,ke),ke.$originalErrorPath&&this.invalidate(R,new A.CastError(it.instance,ee,R,ke.$originalErrorPath))):this.invalidate(R,new A.CastError(it.instance,ee,R,ke)),Zt=!1}if(Zt){var va,O=null,s=null;if(!Ne){var U=this.$isSubdocument?this.ownerDocument():this;O=U.$__.savedState,s=this.$isSubdocument?this.$__.fullPath+"."+R:R,U.$__saveInitialState(s)}this.$__set($r,R,ge,Ne,Ut,it,ee,Vt);var L=!((va=this.$__.session)===null||va===void 0||!va.transaction),Pe=this.$__.session&&this.$__.session[qt]&&this.$__.session[qt].has(this)&&this.$__.session[qt].get(this).modifiedPaths&&!this.$__.session[qt].get(this).modifiedPaths.has(s);O!=null&&O.hasOwnProperty(s)&&(!L||Pe)&&ye.deepEqual(ee,O[s])&&this.unmarkModified(R)}return(it.$isSingleNested&&(this.isDirectModified(R)||ee==null)||it.$isSchemaMap&&ee==null)&&F(this,R),this},ze.prototype.set=ze.prototype.$set,ze.prototype.$__shouldModify=function(R,ee,fe,ge,xe,_e,Le,Fe){return!(fe&&fe._skipMarkModified||!this.$isNew&&!(ee in this.$__.activePaths.getStatePaths("modify"))&&(Le!==void 0||this.$__isSelected(ee))&&(Le===void 0&&ee in this.$__.activePaths.getStatePaths("default")||this.$populated(ee)&&Le instanceof ze&&Ie(Le._doc._id,Fe)||Ie(Le,Fe!==void 0?Fe:ye.getValue(ee,this))&&(ge||Le==null||!(ee in this.$__.activePaths.getStatePaths("default"))||!Ie(Le,_e.getDefault(this,ge)))))},ze.prototype.$__set=function(R,ee,fe,ge,xe,_e,Le,Fe){k=k||t(6547);var Qe=this.$__shouldModify(R,ee,fe,ge,xe,_e,Le,Fe);Qe?(this.$__.primitiveAtomics&&this.$__.primitiveAtomics[ee]&&(delete this.$__.primitiveAtomics[ee],Object.keys(this.$__.primitiveAtomics).length===0&&delete this.$__.primitiveAtomics),this.markModified(R),y||(y=t(7557)),Le&&ye.isMongooseArray(Le)&&(Le._registerAtomic("$set",Le),ye.isMongooseDocumentArray(Le)&&Le.forEach(function(Dt){Dt&&Dt.__parentArray&&(Dt.__parentArray=Le)}))):Array.isArray(Le)&&Array.isArray(Fe)&&ye.isMongooseArray(Le)&&ye.isMongooseArray(Fe)&&(Le[Me]=Fe[Me],Le[Be]=Fe[Be],ye.isMongooseDocumentArray(Le)&&Le.forEach(function(Dt){Dt!=null&&(Dt.$isNew=!1)}));for(var Ve=this._doc,Ge=0,Ne=xe.length,st="";Ge<Ne;Ge++){var lt=Ge+1===Ne;if(st+=st?"."+xe[Ge]:xe[Ge],!Ir.has(xe[Ge]))if(lt)Ve instanceof Map?Ve.set(xe[Ge],Le):Ve.$isSingleNested?(xe[Ge]in Ve||(Ve[xe[Ge]]=Le),Ve._doc[xe[Ge]]=Le,Qe&&Ve.markModified(xe[Ge])):Ve[xe[Ge]]=Le;else{var pt=Ve instanceof Map,xt=pt?Ve.get(xe[Ge]):Ve[xe[Ge]];ye.isPOJO(xt)||xt&&xt instanceof k||xt&&!Array.isArray(xt)&&xt.$isSingleNested||xt&&Array.isArray(xt)||xt==null&&(xt={},pt?Ve.set(xe[Ge],xt):Ve[xe[Ge]]=xt),Ve=xt}}},ze.prototype.$__getValue=function(R){if(typeof R!="string"&&!Array.isArray(R))throw new TypeError('Invalid `path`. Must be either string or array. Got "'.concat(R,'" (type ').concat(p(R),")"));return ye.getValue(R,this._doc)},ze.prototype.$inc=function(R,ee){var fe=this;if(ee==null&&(ee=1),Array.isArray(R))return R.forEach(function(Qe){return fe.$inc(Qe,ee)}),this;var ge=this.$__path(R);if(ge==null){if(this.$__.strictMode==="throw")throw new ue(R);if(this.$__.strictMode===!0)return this}else if(ge.instance!=="Number")return this.invalidate(R,new A.CastError(ge.instance,ee,R)),this;var xe=this.$__getValue(R)||0,_e=!1,Le=null,Fe=ee;try{ee=ge.cast(ee),Fe=(Le=ge.applySetters(xe+ee,this))-xe,_e=!0}catch(Qe){this.invalidate(R,new A.CastError("number",ee,R,Qe))}return _e&&(this.$__.primitiveAtomics=this.$__.primitiveAtomics||{},this.$__.primitiveAtomics[R]==null?this.$__.primitiveAtomics[R]={$inc:Fe}:this.$__.primitiveAtomics[R].$inc+=Fe,this.markModified(R),this.$__setValue(R,Le)),this},ze.prototype.$__setValue=function(R,ee){return ye.setValue(R,ee,this._doc),this},ze.prototype.get=function(R,ee,fe){var ge;fe==null&&(fe={}),ee&&(ge=this.$__schema.interpretAsType(R,ee,this.$__schema.options));var xe=fe.noDottedPath,_e=xe?this.$__schema.paths[R]:this.$__path(R);if(_e==null&&(_e=this.$__schema.virtualpath(R))!=null)return _e.applyGetters(void 0,this);if(xe){var Le=this._doc[R];return ge&&(Le=ge.cast(Le)),_e!=null&&fe.getters!==!1?_e.applyGetters(Le,this):Le}if(_e!=null&&_e.instance==="Mixed"){var Fe=this.$__schema.virtualpath(R);Fe!=null&&(_e=Fe)}var Qe=R.indexOf(".")!==-1,Ve=this._doc,Ge=Qe?R.split("."):[R];typeof this.$__schema.aliases[Ge[0]]=="string"&&(Ge[0]=this.$__schema.aliases[Ge[0]]);for(var Ne=0,st=Ge.length;Ne<st;Ne++)Ve&&Ve._doc&&(Ve=Ve._doc),Ve=Ve==null?void 0:Ve instanceof Map?Ve.get(Ge[Ne],{getters:!1}):Ne===st-1?ye.getValue(Ge[Ne],Ve):Ve[Ge[Ne]];if(ge&&(Ve=ge.cast(Ve)),_e!=null&&fe.getters!==!1)Ve=_e.applyGetters(Ve,this);else if(this.$__schema.nested[R]&&fe.virtuals)return kr(this,I(Ve)||{},{path:R});return Ve},ze.prototype[ft]=ze.prototype.get,ze.prototype.$get=ze.prototype.get,ze.prototype.$__path=function(R){var ee=this.$__.adhocPaths;return(ee&&ee.hasOwnProperty(R)?ee[R]:null)||this.$__schema.path(R)},ze.prototype.markModified=function(R,ee){this.$__saveInitialState(R),this.$__.activePaths.modify(R),ee==null||this.$isSubdocument||(this.$__.pathsToScopes=this.$__pathsToScopes||{},this.$__.pathsToScopes[R]=ee)},ze.prototype.$__saveInitialState=function(R){var ee=this.$__.savedState,fe=R;if(ee!=null){var ge=fe.indexOf("."),xe=ge===-1?fe:fe.slice(0,ge);ee.hasOwnProperty(xe)||(ee[xe]=I(this.$__getValue(xe)))}},ze.prototype.unmarkModified=function(R){this.$__.activePaths.init(R),this.$__.pathsToScopes!=null&&delete this.$__.pathsToScopes[R]},ze.prototype.$ignore=function(R){this.$__.activePaths.ignore(R)},ze.prototype.directModifiedPaths=function(){return Object.keys(this.$__.activePaths.getStatePaths("modify"))},ze.prototype.$isEmpty=function(R){var ee={minimize:!0,virtuals:!1,getters:!1,transform:!1};if(arguments.length!==0){var fe=this.$get(R);return fe==null||p(fe)==="object"&&(ye.isPOJO(fe)?Nr(fe):Object.keys(fe.toObject(ee)).length===0)}return Object.keys(this.toObject(ee)).length===0},ze.prototype.modifiedPaths=function(R){R=R||{};var ee=Object.keys(this.$__.activePaths.getStatePaths("modify")),fe=new Set,ge=0,xe=0,_e=ee.length;for(ge=0;ge<_e;++ge){var Le=ee[ge],Fe=me(Le),Qe=Fe.length;for(xe=0;xe<Qe;++xe)fe.add(Fe[xe]);if(R.includeChildren){var Ve=0,Ge=this.$get(Le);if(p(Ge)==="object"&&Ge!==null){Ge._doc&&(Ge=Ge._doc);var Ne=Ge.length;if(Array.isArray(Ge))for(Ve=0;Ve<Ne;++Ve){var st=Le+"."+Ve;if(!fe.has(st)&&(fe.add(st),Ge[Ve]!=null&&Ge[Ve].$__)){var lt=Ge[Ve].modifiedPaths(),pt=0,xt=lt.length;for(pt=0;pt<xt;++pt)fe.add(st+"."+lt[pt])}}else{var Dt=Object.keys(Ge),Ot=0,Wt=Dt.length;for(Ot=0;Ot<Wt;++Ot)fe.add(Le+"."+Dt[Ot])}}}}return Array.from(fe)},ze.prototype[jt]=ze.prototype.modifiedPaths,ze.prototype.isModified=function(R,ee,fe){var ge=this;if(R){var xe=ee&&ee.ignoreAtomics,_e=this.$__.activePaths.states.modify;if(_e==null)return!1;typeof R=="string"&&(R=R.indexOf(" ")===-1?[R]:R.split(" "));var Le,Fe=l(R);try{for(Fe.s();!(Le=Fe.n()).done;)if(_e[Le.value]!=null)return!0}catch(Ne){Fe.e(Ne)}finally{Fe.f()}var Qe=fe||this[jt](),Ve=R.some(function(Ne){return!!~Qe.indexOf(Ne)}),Ge=Object.keys(_e);return xe&&(Ge=Ge.filter(function(Ne){var st=ge.$__getValue(Ne);return st==null||st[Me]==null||st[Me].$set!==void 0})),Ve||R.some(function(Ne){return Ge.some(function(st){return st===Ne||Ne.startsWith(st+".")})})}return this.$__.activePaths.some("modify")},ze.prototype.$isModified=ze.prototype.isModified,ze.prototype[vt]=ze.prototype.isModified,ze.prototype.$isDefault=function(R){var ee=this;if(R==null)return this.$__.activePaths.some("default");if(typeof R=="string"&&R.indexOf(" ")===-1)return this.$__.activePaths.getStatePaths("default").hasOwnProperty(R);var fe=R;return Array.isArray(fe)||(fe=fe.split(" ")),fe.some(function(ge){return ee.$__.activePaths.getStatePaths("default").hasOwnProperty(ge)})},ze.prototype.$isDeleted=function(R){return arguments.length===0?!!this.$__.isDeleted:(this.$__.isDeleted=!!R,this)},ze.prototype.isDirectModified=function(R){var ee=this;if(R==null)return this.$__.activePaths.some("modify");if(typeof R=="string"&&R.indexOf(" ")===-1){var fe=this.$__.activePaths.getStatePaths("modify").hasOwnProperty(R);if(fe||R.indexOf(".")===-1)return fe;for(var ge=R.split("."),xe=0;xe<ge.length-1;++xe){var _e=ge.slice(0,xe+1).join("."),Le=this.$get(_e);if(Le!=null&&Le.$__!=null&&Le.isDirectModified(ge.slice(xe+1).join(".")))return!0}return!1}var Fe=R;return typeof Fe=="string"&&(Fe=Fe.split(" ")),Fe.some(function(Qe){return ee.isDirectModified(Qe)})},ze.prototype.isInit=function(R){var ee=this;if(R==null)return this.$__.activePaths.some("init");if(typeof R=="string"&&R.indexOf(" ")===-1)return this.$__.activePaths.getStatePaths("init").hasOwnProperty(R);var fe=R;return Array.isArray(fe)||(fe=fe.split(" ")),fe.some(function(ge){return ee.$__.activePaths.getStatePaths("init").hasOwnProperty(ge)})},ze.prototype.isSelected=function(R){var ee=this;if(this.$__.selected==null)return!0;if(!R)return!1;if(R==="_id")return this.$__.selected._id!==0;if(R.indexOf(" ")!==-1&&(R=R.split(" ")),Array.isArray(R))return R.some(function(Ne){return ee.$__isSelected(Ne)});var fe=Object.keys(this.$__.selected),ge=null;if(fe.length===1&&fe[0]==="_id")return this.$__.selected._id===0;for(var xe=0,_e=fe;xe<_e.length;xe++){var Le=_e[xe];if(Le!=="_id"&&X(this.$__.selected[Le])){ge=!!this.$__.selected[Le];break}}if(ge===null)return!0;if(R in this.$__.selected)return ge;for(var Fe=R+".",Qe=0,Ve=fe;Qe<Ve.length;Qe++){var Ge=Ve[Qe];if(Ge!=="_id"){if(Ge.startsWith(Fe))return ge||Ge!==Fe;if(Fe.startsWith(Ge+"."))return ge}}return!ge},ze.prototype.$__isSelected=ze.prototype.isSelected,ze.prototype.isDirectSelected=function(R){var ee=this;if(this.$__.selected==null)return!0;if(R==="_id")return this.$__.selected._id!==0;if(R.indexOf(" ")!==-1&&(R=R.split(" ")),Array.isArray(R))return R.some(function(Fe){return ee.isDirectSelected(Fe)});var fe=Object.keys(this.$__.selected),ge=null;if(fe.length===1&&fe[0]==="_id")return this.$__.selected._id===0;for(var xe=0,_e=fe;xe<_e.length;xe++){var Le=_e[xe];if(Le!=="_id"&&X(this.$__.selected[Le])){ge=!!this.$__.selected[Le];break}}return ge===null||(this.$__.selected.hasOwnProperty(R)?ge:!ge)},ze.prototype.validate=function(){var R=g(b().m(function ee(fe,ge){var xe,_e,Le=this,Fe=arguments;return b().w(function(Qe){for(;;)switch(Qe.n){case 0:if(typeof fe!="function"&&typeof ge!="function"&&typeof Fe[2]!="function"){Qe.n=1;break}throw new A("Document.prototype.validate() no longer accepts a callback");case 1:if(this.$op="validate",Fe.length===1&&(p(Fe[0])!=="object"||Array.isArray(Fe[0])||(ge=Fe[0],fe=null)),ge&&typeof ge.pathsToSkip=="string"&&(xe=ge.pathsToSkip.indexOf(" ")===-1,ge.pathsToSkip=xe?[ge.pathsToSkip]:ge.pathsToSkip.split(" ")),_e=ge&&ge._skipParallelValidateCheck,this.$isSubdocument==null){Qe.n=2;break}Qe.n=4;break;case 2:if(!this.$__.validating||_e){Qe.n=3;break}throw new Q(this);case 3:_e||(this.$__.validating=!0);case 4:return Qe.a(2,new Promise(function(Ve,Ge){Le.$__validate(fe,ge,function(Ne){if(Le.$op=null,Le.$__.validating=null,Ne!=null)return Ge(Ne);Ve()})}))}},ee,this)}));return function(ee,fe){return R.apply(this,arguments)}}(),ze.prototype.$validate=ze.prototype.validate,ze.prototype.$__validate=function(R,ee,fe){var ge,xe=this;this.$__.saveOptions&&this.$__.saveOptions.pathsToSave&&!R?R=c(this.$__.saveOptions.pathsToSave):typeof R=="function"?(fe=R,ee=null,R=null):typeof ee=="function"&&(fe=ee,ee=null);var _e,Le=ee&&p(ee)==="object"&&"validateModifiedOnly"in ee,Fe=ee&&ee.pathsToSkip||null;_e=Le?!!ee.validateModifiedOnly:this.$__schema.options.validateModifiedOnly;var Qe=ee&&ee.validateAllPaths;if(Qe){if(Fe)throw new TypeError("Cannot set both `validateAllPaths` and `pathsToSkip`");if(R)throw new TypeError("Cannot set both `validateAllPaths` and `pathsToValidate`");if(Le&&_e)throw new TypeError("Cannot set both `validateAllPaths` and `validateModifiedOnly`")}var Ve,Ge,Ne=this,st=function(){var it=xe.$__.validationError;if(xe.$__.validationError=null,xe.$__.validating=null,_e&&it!=null){for(var Vt=0,tr=Object.keys(it.errors);Vt<tr.length;Vt++){var Xt=tr[Vt];xe.$isModified(Xt)||delete it.errors[Xt]}Object.keys(it.errors).length===0&&(it=void 0)}if(xe.$__.cachedRequired={},xe.$emit("validate",Ne),xe.constructor.emit("validate",Ne),it){for(var rr in it.errors)!xe[qe]&&it.errors[rr]instanceof A.CastError&&xe.invalidate(rr,it.errors[rr]);return it}};if(Qe){var lt,pt=l(Ve=new Set(Object.keys(this.$__schema.paths)));try{for(pt.s();!(lt=pt.n()).done;){var xt=lt.value,Dt=this.$__schema.path(xt);if(Dt&&Dt.$isMongooseArray){var Ot=this.$__getValue(xt);Ot&&Yr(Ot,Ve,xt)}}}catch(it){pt.e(it)}finally{pt.f()}Ve=c(Ve),Ge={}}else{var Wt=sa(this,R,Fe,ee&&ee._nestedValidate);Ve=_e?Wt[0].filter(function(it){return xe.$isModified(it)}):Wt[0],Ge=Wt[1]}if(typeof R=="string"&&(R=R.split(" ")),Ve.length===0)return E(function(){var it=st();if(it)return Ne.$__schema.s.hooks.execPost("validate:error",Ne,[Ne],{error:it},function(Vt){fe(Vt)});fe(null,Ne)});var ur={},Kt=0,or=(ge=this.$__.saveOptions)===null||ge===void 0?void 0:ge.pathsToSave;if(Array.isArray(or)){or=new Set(or);var Qt,Ct=l(Ve);try{for(Ct.s();!(Qt=Ct.n()).done;){var zt=Qt.value;or.has(zt)&&Ut(zt)}}catch(it){Ct.e(it)}finally{Ct.f()}}else{var Pr,vr=l(Ve);try{for(vr.s();!(Pr=vr.n()).done;)Ut(Pr.value)}catch(it){vr.e(it)}finally{vr.f()}}function Ut(it){it==null||ur[it]||(ur[it]=!0,Kt++,E(function(){var Vt=Ne.$__schema.path(it);if(!Vt)return--Kt||nr();if(Ne.$isValid(it)){if(Vt[Ht]!=null&&it!==Vt.path)return--Kt||nr();var tr,Xt=Ne.$__getValue(it);(tr=Ne.$populated(it))?Xt=tr:Xt!=null&&Xt.$__!=null&&Xt.$__.wasPopulated&&(Xt=Xt._doc._id);var rr=Ne.$__.pathsToScopes!=null&&it in Ne.$__.pathsToScopes?Ne.$__.pathsToScopes[it]:Ne,Lr=u(u({},Ge[it]),{},{path:it,validateAllPaths:Qe,_nestedValidate:!0});Vt.doValidate(Xt,function(jr){if(jr){if((Vt.$isSingleNested||Vt.$isArraySubdocument||Vt.$isMongooseDocumentArray)&&jr instanceof W)return--Kt||nr();Ne.invalidate(it,jr,void 0,!0)}--Kt||nr()},rr,Lr)}else--Kt||nr()}))}function nr(){var it=st();if(it)return Ne.$__schema.s.hooks.execPost("validate:error",Ne,[Ne],{error:it},function(Vt){fe(Vt)});fe(null,Ne)}},ze.prototype.validateSync=function(R,ee){var fe,ge=this,xe=this;arguments.length!==1||p(arguments[0])!=="object"||Array.isArray(arguments[0])||(ee=arguments[0],R=null),fe=ee&&p(ee)==="object"&&"validateModifiedOnly"in ee?!!ee.validateModifiedOnly:this.$__schema.options.validateModifiedOnly;var _e,Le,Fe=ee&&ee.pathsToSkip,Qe=ee&&ee.validateAllPaths;if(Qe){if(Fe)throw new TypeError("Cannot set both `validateAllPaths` and `pathsToSkip`");if(R)throw new TypeError("Cannot set both `validateAllPaths` and `pathsToValidate`")}if(typeof R=="string"){var Ve=R.indexOf(" ")===-1;R=Ve?[R]:R.split(" ")}else typeof Fe=="string"&&Fe.indexOf(" ")!==-1&&(Fe=Fe.split(" "));if(Qe){var Ge,Ne=l(_e=new Set(Object.keys(this.$__schema.paths)));try{for(Ne.s();!(Ge=Ne.n()).done;){var st=Ge.value,lt=this.$__schema.path(st);if(lt&&lt.$isMongooseArray){var pt=this.$__getValue(st);pt&&Yr(pt,_e,st)}}}catch(Pr){Ne.e(Pr)}finally{Ne.f()}_e=c(_e),Le={}}else{var xt=sa(this,R,Fe);_e=fe?xt[0].filter(function(Pr){return ge.$isModified(Pr)}):xt[0],Le=xt[1]}for(var Dt={},Ot=0,Wt=_e.length;Ot<Wt;++Ot){var ur=_e[Ot];if(!Dt[ur]){Dt[ur]=!0;var Kt=xe.$__schema.path(ur);if(Kt&&xe.$isValid(ur)){var or=xe.$__getValue(ur),Qt=Kt.doValidateSync(or,xe,{skipSchemaValidators:Le[ur],path:ur,validateModifiedOnly:fe,validateAllPaths:Qe});if(Qt){if((Kt.$isSingleNested||Kt.$isArraySubdocument||Kt.$isMongooseDocumentArray)&&Qt instanceof W)continue;xe.invalidate(ur,Qt,void 0,!0)}}}}var Ct=xe.$__.validationError;if(xe.$__.validationError=void 0,xe.$emit("validate",xe),xe.constructor.emit("validate",xe),Ct)for(var zt in Ct.errors)Ct.errors[zt]instanceof A.CastError&&xe.invalidate(zt,Ct.errors[zt]);return Ct},ze.prototype.invalidate=function(R,ee,fe,ge){if(this.$__.validationError||(this.$__.validationError=new W(this)),!this.$__.validationError.errors[R])return ee&&typeof ee!="string"||(ee=new $({path:R,message:ee,type:ge||"user defined",value:fe})),this.$__.validationError===ee||this.$__.validationError.addError(R,ee),this.$__.validationError},ze.prototype.$markValid=function(R){this.$__.validationError&&this.$__.validationError.errors[R]&&(delete this.$__.validationError.errors[R],Object.keys(this.$__.validationError.errors).length===0&&(this.$__.validationError=null))},ze.prototype.$isValid=function(R){var ee=this;return this.$__.validationError==null||Object.keys(this.$__.validationError.errors).length===0||R!=null&&(R.indexOf(" ")!==-1&&(R=R.split(" ")),Array.isArray(R)?R.some(function(fe){return ee.$__.validationError.errors[fe]==null}):this.$__.validationError.errors[R]==null)},ze.prototype.$__reset=function(){var R,ee=this.$isSubdocument?null:this.$getAllSubdocs({useCache:!0});if(ee&&ee.length>0){var fe,ge=l(ee);try{for(ge.s();!(fe=ge.n()).done;)fe.value.$__reset()}catch(xe){ge.e(xe)}finally{ge.f()}}return this.$__dirty().forEach(function(xe){var _e=xe.value;_e&&_e[Me]&&(_e[Be]=_e[Me],_e[Me]={})}),this.$__.backup={},this.$__.backup.activePaths={modify:Object.assign({},this.$__.activePaths.getStatePaths("modify")),default:Object.assign({},this.$__.activePaths.getStatePaths("default"))},this.$__.backup.validationError=this.$__.validationError,this.$__.backup.errors=this.$errors,this.$__.activePaths.clear("modify"),this.$__.activePaths.clear("default"),this.$__.validationError=void 0,this.$errors=void 0,R=this,this.$__schema.requiredPaths().forEach(function(xe){R.$__.activePaths.require(xe)}),this},ze.prototype.$__undoReset=function(){if(this.$__.backup!=null&&this.$__.backup.activePaths!=null){this.$__.activePaths.states.modify=this.$__.backup.activePaths.modify,this.$__.activePaths.states.default=this.$__.backup.activePaths.default,this.$__.validationError=this.$__.backup.validationError,this.$errors=this.$__.backup.errors;var R,ee=l(this.$__dirty());try{for(ee.s();!(R=ee.n()).done;){var fe=R.value.value;fe&&fe[Me]&&fe[Be]&&(fe[Me]=fe[Be])}}catch(_e){ee.e(_e)}finally{ee.f()}if(!this.$isSubdocument){var ge,xe=l(this.$getAllSubdocs());try{for(xe.s();!(ge=xe.n()).done;)ge.value.$__undoReset()}catch(_e){xe.e(_e)}finally{xe.f()}}}},ze.prototype.$__dirty=function(){var R=this,ee=this.$__.activePaths.map("modify",function(xe){return{path:xe,value:R.$__getValue(xe),schema:R.$__path(xe)}});ee=ee.concat(this.$__.activePaths.map("default",function(xe){if(xe!=="_id"&&R.$__getValue(xe)!=null)return{path:xe,value:R.$__getValue(xe),schema:R.$__path(xe)}}));var fe=new Map(ee.filter(function(xe){return xe!=null}).map(function(xe){return[xe.path,xe.value]})),ge=[];return ee.forEach(function(xe){if(xe){for(var _e=null,Le=me(xe.path),Fe=0;Fe<Le.length-1;Fe++)if(fe.has(Le[Fe])){_e=fe.get(Le[Fe]);break}_e==null?ge.push(xe):_e!=null&&_e[Me]!=null&&_e.hasAtomics()&&(_e[Me]={},_e[Me].$set=_e)}}),ge},ze.prototype.$__setSchema=function(R){N(R.tree,this,void 0,R.options);for(var ee=0,fe=Object.keys(R.virtuals);ee<fe.length;ee++){var ge=fe[ee];R.virtuals[ge]._applyDefaultGetters()}R.path("schema")==null&&(this.schema=R),this.$__schema=R,this[wt]=R},ze.prototype.$__getArrayPathsToValidate=function(){return m||(m=t(4878)),this.$__.activePaths.map("init","modify",function(R){return this.$__getValue(R)}.bind(this)).filter(function(R){return R&&Array.isArray(R)&&ye.isMongooseDocumentArray(R)&&R.length}).reduce(function(R,ee){return R.concat(ee)},[]).filter(function(R){return R})},ze.prototype.$getAllSubdocs=function(R){var ee;if(R!=null&&R.useCache&&(ee=this.$__.saveOptions)!==null&&ee!==void 0&&ee.__subdocs)return this.$__.saveOptions.__subdocs;m||(m=t(4878)),k=k||t(6547);var fe=[];return function ge(xe){var _e,Le=[],Fe=l(xe.$__schema.childSchemas);try{for(Fe.s();!(_e=Fe.n()).done;){var Qe=_e.value.model,Ve=xe.$__getValue(Qe.path);if(Ve!=null){if(Ve.$__&&Le.push(Ve),Array.isArray(Ve)){var Ge,Ne=l(Ve);try{for(Ne.s();!(Ge=Ne.n()).done;){var st=Ge.value;st!=null&&st.$__&&Le.push(st)}}catch(Wt){Ne.e(Wt)}finally{Ne.f()}}if(Ve instanceof Map){var lt,pt=l(Ve.values());try{for(pt.s();!(lt=pt.n()).done;){var xt=lt.value;xt!=null&&xt.$__&&Le.push(xt)}}catch(Wt){pt.e(Wt)}finally{pt.f()}}}}}catch(Wt){Fe.e(Wt)}finally{Fe.f()}for(var Dt=0,Ot=Le;Dt<Ot.length;Dt++)ge(Ot[Dt]);fe.push.apply(fe,Le)}(this),this.$__.saveOptions&&(this.$__.saveOptions.__subdocs=fe),fe},ze.prototype.$__handleReject=function(R){this.$listeners("error").length?this.$emit("error",R):this.constructor.listeners&&this.constructor.listeners("error").length&&this.constructor.emit("error",R)},ze.prototype.$toObject=function(R,ee){var fe,ge,xe,_e,Le,Fe,Qe,Ve,Ge,Ne,st,lt,pt,xt,Dt,Ot=this.$__schema._defaultToObjectOptions(ee),Wt=this.$__hasOnlyPrimitiveValues();(R=ye.isPOJO(R)?u({},R):{})._calledWithOptions=R._calledWithOptions||u({},R),Dt=R._calledWithOptions.minimize!=null?R.minimize:((fe=this.$__schemaTypeOptions)===null||fe===void 0?void 0:fe.minimize)!=null?this.$__schemaTypeOptions.minimize:Ot!=null&&Ot.minimize!=null?Ot.minimize:this.$__schema.options.minimize,R.minimize=Dt,Wt||(R._seen=R._seen||new Map);var ur=(ge=(xe=(_e=R._calledWithOptions.depopulate)!==null&&_e!==void 0?_e:Ot?.depopulate)!==null&&xe!==void 0?xe:R.depopulate)!==null&&ge!==void 0&&ge;if(ur&&R._isNested&&this.$__.wasPopulated)return I(this.$__.wasPopulated.value||this._doc._id,R);if(ur&&(R.depopulate=!0),Ot!=null)for(var Kt=0,or=Object.keys(Ot);Kt<or.length;Kt++){var Qt=or[Kt];R[Qt]==null&&(R[Qt]=Ot[Qt])}R._isNested=!0,R.json=ee,R.minimize=Dt;var Ct=R._parentOptions;R._parentOptions=this.$isSubdocument?R:null;var zt,Pr=(Le=(Fe=(Qe=R._calledWithOptions.schemaFieldsOnly)!==null&&Qe!==void 0?Qe:R.schemaFieldsOnly)!==null&&Fe!==void 0?Fe:Ot.schemaFieldsOnly)!==null&&Le!==void 0&&Le;if(Wt&&!R.flattenObjectIds)zt=this.$__toObjectShallow(Pr);else if(Pr){zt={};for(var vr=0,Ut=Object.keys(this.$__schema.paths);vr<Ut.length;vr++){var nr=Ut[vr],it=this.$__getValue(nr);if(it!==void 0){var Vt=nr,tr=zt;if(nr.indexOf(".")!==-1){var Xt=nr.split(".");Vt=Xt[Xt.length-1];for(var rr=0;rr<Xt.length-1;++rr){var Lr;tr[Xt[rr]]=(Lr=tr[Xt[rr]])!==null&&Lr!==void 0?Lr:{},tr=tr[Xt[rr]]}}tr[Vt]=it!==null?I(it,R):null}}}else zt=I(this._doc,R)||{};var jr=(Ve=(Ge=(Ne=R._calledWithOptions.getters)!==null&&Ne!==void 0?Ne:R.getters)!==null&&Ge!==void 0?Ge:Ot.getters)!==null&&Ve!==void 0&&Ve;jr&&(function(dr,Or){var _r,$r,cr=dr.$__schema,Sr=Object.keys(cr.paths),Rr=Sr.length,It=dr._doc;if(!It)return Or;for(;Rr--;){var xr=(_r=Sr[Rr]).split("."),pr=xr.length,ir=pr-1,Zt=Or,Yt=void 0;if(It=dr._doc,dr.$__isSelected(_r))for(var Er=0;Er<pr&&($r=It[Yt=xr[Er]],Zt==null||p(Zt)==="object");++Er){if(Er===ir){if(Zt[Yt]=cr.paths[_r].applyGetters(Zt[Yt],dr),Array.isArray(Zt[Yt])&&cr.paths[_r].$embeddedSchemaType)for(var Dr=0;Dr<Zt[Yt].length;++Dr)Zt[Yt][Dr]=cr.paths[_r].$embeddedSchemaType.applyGetters(Zt[Yt][Dr],dr)}else{if($r==null){Yt in It&&(Zt[Yt]=$r);break}Zt=Zt[Yt]||(Zt[Yt]={})}It=$r}}}(this,zt),R.minimize&&(zt=Y(zt)||{}));var ta=(st=(lt=(pt=R._calledWithOptions.virtuals)!==null&&pt!==void 0?pt:Ot.virtuals)!==null&&lt!==void 0?lt:Ct?.virtuals)!==null&&st!==void 0?st:void 0;(ta||jr&&ta!==!1)&&kr(this,zt,R,R),R.versionKey===!1&&this.$__schema.options.versionKey&&delete zt[this.$__schema.options.versionKey];var Gr=(xt=R._calledWithOptions.transform)===null||xt===void 0||xt,ra=void 0;if(Gr===!0?ra=Ot.transform:typeof Gr=="function"&&(ra=Gr),Gr&&function(dr,Or){var _r=dr.$__schema,$r=Object.keys(_r.paths||{});if(!dr._doc)return Or;for(var cr=0,Sr=$r;cr<Sr.length;cr++){var Rr,It,xr,pr,ir,Zt=Sr[cr],Yt=_r.paths[Zt],Er=(Rr=Yt.options.transform)!==null&&Rr!==void 0?Rr:(It=Yt.constructor)===null||It===void 0||(It=It.defaultOptions)===null||It===void 0?void 0:It.transform,Dr=(xr=(pr=Yt.$embeddedSchemaType)===null||pr===void 0||(pr=pr.options)===null||pr===void 0?void 0:pr.transform)!==null&&xr!==void 0?xr:(ir=Yt.$embeddedSchemaType)===null||ir===void 0||(ir=ir.constructor)===null||ir===void 0||(ir=ir.defaultOptions)===null||ir===void 0?void 0:ir.transform;if(typeof Er=="function"){var aa=dr.$get(Zt);if(aa===void 0)continue;var qr=Er.call(dr,aa);Vr(Zt,qr),ye.setValue(Zt,qr,Or)}else if(typeof Dr=="function"){var Hr=dr.$get(Zt);if(Hr===void 0)continue;for(var zr=[].concat(Hr),Tr=0;Tr<zr.length;++Tr){var ea=Dr.call(dr,zr[Tr]);zr[Tr]=ea,Vr(Zt,ea)}Or[Zt]=zr}}}(this,zt),R.useProjection&&function(dr,Or){var _r=dr.$__schema,$r=Object.keys(_r.paths||{});if(!dr._doc)return Or;var cr=dr.$__.selected;if(cr===void 0&&(cr={},ne.applyPaths(cr,_r)),cr==null||Object.keys(cr).length===0)return Or;for(var Sr=0,Rr=$r;Sr<Rr.length;Sr++){var It=Rr[Sr];cr[It]==null||cr[It]||delete Or[It]}}(this,zt),typeof ra=="function"){var Zr=ra(this,zt,R);Zr!==void 0&&(zt=Zr)}return zt},ze.prototype.$__toObjectShallow=function(R){var ee={};if(this._doc!=null){var fe,ge=l(Object.keys(R?this.$__schema.paths:this._doc));try{for(ge.s();!(fe=ge.n()).done;){var xe=fe.value,_e=this._doc[xe];_e instanceof Date?ee[xe]=new Date(_e):_e!==void 0&&(ee[xe]=_e)}}catch(Le){ge.e(Le)}finally{ge.f()}}return ee},ze.prototype.toObject=function(R){return this.$toObject(R)},ze.prototype.toJSON=function(R){return this.$toObject(R,!0)},ze.prototype.ownerDocument=function(){return this},ze.prototype.parent=function(){return this.$isSubdocument||this.$__.wasPopulated?this.$__.parent:this},ze.prototype.$parent=ze.prototype.parent,ze.prototype.inspect=function(R){var ee;ye.isPOJO(R)&&((ee=R).minimize=!1);var fe=arguments.length>0?this.toObject(ee):this.toObject();return fe??"MongooseDocument { "+fe+" }"},B.custom&&(ze.prototype[B.custom]=ze.prototype.inspect),ze.prototype.toString=function(){var R=this.inspect();return typeof R=="string"?R:B(R)},ze.prototype.equals=function(R){if(!R)return!1;var ee=this.$__getValue("_id"),fe=R.$__!=null?R.$__getValue("_id"):R;return ee||fe?ee&&ee.equals?ee.equals(fe):ee===fe:Ie(this,R)},ze.prototype.populate=function(){var R=g(b().m(function ee(){var fe,ge,xe,_e,Le,Fe,Qe,Ve,Ge,Ne,st=arguments;return b().w(function(lt){for(;;)switch(lt.n){case 0:if(fe={},typeof(ge=Array.prototype.slice.call(st))[ge.length-1]!="function"){lt.n=1;break}throw new A("Document.prototype.populate() no longer accepts a callback");case 1:if(ge.length!==0){xe=ye.populate.apply(null,ge),_e=l(xe);try{for(_e.s();!(Le=_e.n()).done;)Fe=Le.value,fe[Fe.path]=Fe}catch(pt){_e.e(pt)}finally{_e.f()}}return Qe=ye.object.vals(fe),Ve=this.constructor,this.$__isNested&&(Ve=this.$__[Bt].constructor,Ge=this.$__.nestedPath,Qe.forEach(function(pt){pt.path=Ge+"."+pt.path})),this.$session()!=null&&(Ne=this.$session(),Qe.forEach(function(pt){pt.options!=null?"session"in pt.options||(pt.options.session=Ne):pt.options={session:Ne}})),Qe.forEach(function(pt){pt._localModel=Ve}),lt.a(2,Ve.populate(this,Qe))}},ee,this)}));return function(){return R.apply(this,arguments)}}(),ze.prototype.$getPopulatedDocs=function(){var R=[];this.$__.populated!=null&&(R=R.concat(Object.keys(this.$__.populated)));var ee,fe=[],ge=l(R);try{for(ge.s();!(ee=ge.n()).done;){var xe=ee.value,_e=this.$get(xe);Array.isArray(_e)?fe=fe.concat(_e):_e instanceof ze&&fe.push(_e)}}catch(Le){ge.e(Le)}finally{ge.f()}return fe},ze.prototype.populated=function(R,ee,fe){if(ee==null||ee===!0){if(!this.$__.populated||typeof R!="string")return;var ge=R.endsWith(".$*")?R.replace(/\.\$\*$/,""):R,xe=this.$__.populated[ge];return xe?ee===!0?xe:xe.value:void 0}this.$__.populated||(this.$__.populated={}),this.$__.populated[R]={value:ee,options:fe};for(var _e=R.split("."),Le=0;Le<_e.length-1;++Le){var Fe=_e.slice(0,Le+1).join("."),Qe=this.$get(Fe);if(Qe!=null&&Qe.$__!=null&&this.$populated(Fe)){var Ve=_e.slice(Le+1).join(".");Qe.$populated(Ve,ee,fe);break}}return ee},ze.prototype.$populated=ze.prototype.populated,ze.prototype.$assertPopulated=function(R,ee){var fe=this;if(Array.isArray(R))return R.forEach(function(ge){return fe.$assertPopulated(ge,ee)}),this;if(arguments.length>1&&this.$set(ee),!this.$populated(R))throw new A('Expected path "'.concat(R,'" to be populated'));return this},ze.prototype.depopulate=function(R){var ee;typeof R=="string"&&(R=R.indexOf(" ")===-1?[R]:R.split(" "));var fe=this.$$populatedVirtuals?Object.keys(this.$$populatedVirtuals):[],ge=this.$__&&this.$__.populated||{};if(arguments.length===0){var xe,_e=l(fe);try{for(_e.s();!(xe=_e.n()).done;){var Le=xe.value;delete this.$$populatedVirtuals[Le],delete this._doc[Le],delete ge[Le]}}catch(or){_e.e(or)}finally{_e.f()}for(var Fe=0,Qe=Object.keys(ge);Fe<Qe.length;Fe++){var Ve=Qe[Fe];if(ee=this.$populated(Ve))if(delete ge[Ve],Array.isArray(ee)){var Ge=ye.getValue(Ve,this._doc);if(Ge.isMongooseArray)for(var Ne=Ge.__array,st=0;st<Ne.length;++st){var lt=Ne[st];lt!=null&&(Ne[st]=lt instanceof ze?lt._doc._id:lt._id)}else ye.setValue(Ve,ee,this._doc)}else ye.setValue(Ve,ee,this._doc)}return this}var pt,xt=l(R);try{for(xt.s();!(pt=xt.n()).done;){var Dt=pt.value;if(ee=this.$populated(Dt),delete ge[Dt],fe.indexOf(Dt)!==-1)delete this.$$populatedVirtuals[Dt],delete this._doc[Dt];else if(ee)if(Array.isArray(ee)){var Ot=ye.getValue(Dt,this._doc);if(Ot.isMongooseArray)for(var Wt=Ot.__array,ur=0;ur<Wt.length;++ur){var Kt=Wt[ur];Kt!=null&&(Wt[ur]=Kt instanceof ze?Kt._doc._id:Kt._id)}else ye.setValue(Dt,ee,this._doc)}else ye.setValue(Dt,ee,this._doc)}}catch(or){xt.e(or)}finally{xt.f()}return this},ze.prototype.$__fullPath=function(R){return R||""},ze.prototype.getChanges=function(){var R=this.$__delta();return R?R[1]:{}},ze.prototype.$__delta=function(){var R=this,ee=this.$__dirty(),fe=this.$__schema.options.optimisticConcurrency;if(fe)if(Array.isArray(fe)){var ge=new Set(fe);this.modifiedPaths().find(function(Dt){return ge.has(Dt)})&&(this.$__.version=ee.length?3:1)}else this.$__.version=ee.length?3:1;if(ee.length||this.$__.version===3){var xe={},_e={},Le=ee.length,Fe=[],Qe=0;for(xe._id=this._doc._id,(xe&&xe._id&&xe._id.$__||null)!=null&&(xe._id=xe._id.toObject({transform:!1,depopulate:!0}));Qe<Le;++Qe){var Ve=ee[Qe],Ge=Ve.value,Ne=ua(this,Ve.path,Ge);if(Ne)Fe.push(Ne);else{if(!this.$populated(Ve.path,!0)&&this.$__.selected){var st=Ve.path.split("."),lt=st[0];if(this.$__.selected[lt]&&this.$__.selected[lt].$elemMatch){if(!(st.length>1&&st[1]==0&&xe[lt]===void 0)){Fe.push(Ve.path);continue}xe[lt]=this.$__.selected[lt],st[1]="$",Ve.path=st.join(".")}}if(this.$isDefault(Ve.path)&&this.$__.selected&&(Ve.path.indexOf(".")===-1&&q(this.$__.selected,Ve.path)||me(Ve.path).find(function(Dt){return q(R.$__.isSelected,Dt)})))continue;if(!Fe.length)if(Ge===void 0)Xr(this,0,_e,Ve,1,"$unset");else if(Ge===null)Xr(this,0,_e,Ve,null);else if(ye.isMongooseArray(Ge)&&Ge.$path()&&Ge[Me])ca(this,0,_e,Ve,Ge);else if(Ge[S.pathSymbol]&&n.isBuffer(Ge))Xr(this,0,_e,Ve,Ge=Ge.toObject());else if(this.$__.primitiveAtomics&&this.$__.primitiveAtomics[Ve.path]!=null){var pt=this.$__.primitiveAtomics[Ve.path],xt=ae(pt);Xr(this,0,_e,Ve,pt[xt],xt)}else Xr(this,0,_e,Ve,Ge=I(Ge,{depopulate:!0,transform:!1,virtuals:!1,getters:!1,omitUndefined:!0,_isNested:!0}))}}return Fe.length?new v(Fe):(this.$__.version&&this.$__version(xe,_e),Object.keys(_e).length===0?[xe,null]:[xe,_e])}},ze.prototype.$clone=function(){var R=new this.constructor;if(R.$isNew=this.$isNew,this._doc&&(R._doc=I(this._doc,{retainDocuments:!0})),this.$__){var ee,fe=new this.$__.constructor,ge=l(Object.getOwnPropertyNames(this.$__));try{for(ge.s();!(ee=ge.n()).done;){var xe=ee.value;xe!=="activePaths"&&(fe[xe]=I(this.$__[xe]))}}catch(_e){ge.e(_e)}finally{ge.f()}Object.assign(fe.activePaths,I(u({},this.$__.activePaths))),R.$__=fe}return R},ze.prototype.$createModifiedPathsSnapshot=function(){var R=new WeakMap;if(!this.$isSubdocument){var ee,fe=l(this.$getAllSubdocs());try{for(fe.s();!(ee=fe.n()).done;){var ge=ee.value;R.set(ge,ge.$__.activePaths.clone())}}catch(xe){fe.e(xe)}finally{fe.f()}}return new V(R,this.$__.activePaths.clone(),this.$__.version)},ze.prototype.$restoreModifiedPathsSnapshot=function(R){if(this.$__.activePaths=R.activePaths.clone(),this.$__.version=R.version,!this.$isSubdocument){var ee,fe=l(this.$getAllSubdocs());try{for(fe.s();!(ee=fe.n()).done;){var ge=ee.value;R.subdocSnapshot.has(ge)&&(ge.$__.activePaths=R.subdocSnapshot.get(ge))}}catch(xe){fe.e(xe)}finally{fe.f()}}return this},ze.prototype.$clearModifiedPaths=function(){if(this.$__.activePaths.clear("modify"),this.$__.activePaths.clear("init"),this.$__.version=0,!this.$isSubdocument){var R,ee=l(this.$getAllSubdocs());try{for(ee.s();!(R=ee.n()).done;)R.value.$clearModifiedPaths()}catch(fe){ee.e(fe)}finally{ee.f()}}return this},ze.prototype.$__hasOnlyPrimitiveValues=function(){return!this.$__.populated&&!this.$__.wasPopulated&&(this._doc==null||Object.values(this._doc).every(function(R){return R==null||p(R)!=="object"||ye.isNativeObject(R)&&!Array.isArray(R)||z(R,"ObjectId")||z(R,"Decimal128")}))},ze.VERSION_WHERE=1,ze.VERSION_INC=2,ze.VERSION_ALL=3,ze.ValidationError=W,a.exports=ze},2401:a=>{"use strict";a.exports=Math.floor},2402:(a,i,t)=>{"use strict";function n(F){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},n(F)}function c(F){return c=typeof Symbol=="function"&&n(Symbol.iterator)==="symbol"?function(I){return n(I)}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":n(I)},c(F)}var b,x,w=t(3743).codes,g=w.ERR_AMBIGUOUS_ARGUMENT,o=w.ERR_INVALID_ARG_TYPE,u=w.ERR_INVALID_ARG_VALUE,h=w.ERR_INVALID_RETURN_VALUE,l=w.ERR_MISSING_ARGS,d=t(9068),_=t(7352).inspect,p=t(7352).types,m=p.isPromise,y=p.isRegExp,k=Object.assign?Object.assign:t(6182).assign,v=Object.is?Object.is:t(2064);function D(){var F=t(6193);b=F.isDeepEqual,x=F.isDeepStrictEqual}var j=!1,S=a.exports=K,A={};function M(F){throw F.message instanceof Error?F.message:new d(F)}function V(F,I,N,G){if(!N){var ae=!1;if(I===0)ae=!0,G="No value argument passed to `assert.ok()`";else if(G instanceof Error)throw G;var ce=new d({actual:N,expected:!0,message:G,operator:"==",stackStartFn:F});throw ce.generatedMessage=ae,ce}}function K(){for(var F=arguments.length,I=new Array(F),N=0;N<F;N++)I[N]=arguments[N];V.apply(void 0,[K,I.length].concat(I))}S.fail=function F(I,N,G,ae,ce){var Se,oe=arguments.length;if(oe===0?Se="Failed":oe===1?(G=I,I=void 0):(j===!1&&(j=!0,({env:{}}.emitWarning?{env:{}}.emitWarning:console.warn.bind(console))("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094")),oe===2&&(ae="!=")),G instanceof Error)throw G;var Z={actual:I,expected:N,operator:ae===void 0?"fail":ae,stackStartFn:ce||F};G!==void 0&&(Z.message=G);var he=new d(Z);throw Se&&(he.message=Se,he.generatedMessage=!0),he},S.AssertionError=d,S.ok=K,S.equal=function F(I,N,G){if(arguments.length<2)throw new l("actual","expected");I!=N&&M({actual:I,expected:N,message:G,operator:"==",stackStartFn:F})},S.notEqual=function F(I,N,G){if(arguments.length<2)throw new l("actual","expected");I==N&&M({actual:I,expected:N,message:G,operator:"!=",stackStartFn:F})},S.deepEqual=function F(I,N,G){if(arguments.length<2)throw new l("actual","expected");b===void 0&&D(),b(I,N)||M({actual:I,expected:N,message:G,operator:"deepEqual",stackStartFn:F})},S.notDeepEqual=function F(I,N,G){if(arguments.length<2)throw new l("actual","expected");b===void 0&&D(),b(I,N)&&M({actual:I,expected:N,message:G,operator:"notDeepEqual",stackStartFn:F})},S.deepStrictEqual=function F(I,N,G){if(arguments.length<2)throw new l("actual","expected");b===void 0&&D(),x(I,N)||M({actual:I,expected:N,message:G,operator:"deepStrictEqual",stackStartFn:F})},S.notDeepStrictEqual=function F(I,N,G){if(arguments.length<2)throw new l("actual","expected");b===void 0&&D(),x(I,N)&&M({actual:I,expected:N,message:G,operator:"notDeepStrictEqual",stackStartFn:F})},S.strictEqual=function F(I,N,G){if(arguments.length<2)throw new l("actual","expected");v(I,N)||M({actual:I,expected:N,message:G,operator:"strictEqual",stackStartFn:F})},S.notStrictEqual=function F(I,N,G){if(arguments.length<2)throw new l("actual","expected");v(I,N)&&M({actual:I,expected:N,message:G,operator:"notStrictEqual",stackStartFn:F})};var H=function F(I,N,G){var ae=this;(function(ce,Se){if(!(ce instanceof Se))throw new TypeError("Cannot call a class as a function")})(this,F),N.forEach(function(ce){ce in I&&(G!==void 0&&typeof G[ce]=="string"&&y(I[ce])&&I[ce].test(G[ce])?ae[ce]=G[ce]:ae[ce]=I[ce])})};function Q(F,I,N,G){if(typeof I!="function"){if(y(I))return I.test(F);if(arguments.length===2)throw new o("expected",["Function","RegExp"],I);if(c(F)!=="object"||F===null){var ae=new d({actual:F,expected:I,message:N,operator:"deepStrictEqual",stackStartFn:G});throw ae.operator=G.name,ae}var ce=Object.keys(I);if(I instanceof Error)ce.push("name","message");else if(ce.length===0)throw new u("error",I,"may not be an empty object");return b===void 0&&D(),ce.forEach(function(Se){typeof F[Se]=="string"&&y(I[Se])&&I[Se].test(F[Se])||function(oe,Z,he,E,z,X){if(!(he in oe)||!x(oe[he],Z[he])){if(!E){var de=new H(oe,z),q=new H(Z,z,oe),B=new d({actual:de,expected:q,operator:"deepStrictEqual",stackStartFn:X});throw B.actual=oe,B.expected=Z,B.operator=X.name,B}M({actual:oe,expected:Z,message:E,operator:X.name,stackStartFn:X})}}(F,I,Se,N,ce,G)}),!0}return I.prototype!==void 0&&F instanceof I||!Error.isPrototypeOf(I)&&I.call({},F)===!0}function re(F){if(typeof F!="function")throw new o("fn","Function",F);try{F()}catch(I){return I}return A}function ue(F){return m(F)||F!==null&&c(F)==="object"&&typeof F.then=="function"&&typeof F.catch=="function"}function W(F){return Promise.resolve().then(function(){var I;if(typeof F=="function"){if(!ue(I=F()))throw new h("instance of Promise","promiseFn",I)}else{if(!ue(F))throw new o("promiseFn",["Function","Promise"],F);I=F}return Promise.resolve().then(function(){return I}).then(function(){return A}).catch(function(N){return N})})}function $(F,I,N,G){if(typeof N=="string"){if(arguments.length===4)throw new o("error",["Object","Error","Function","RegExp"],N);if(c(I)==="object"&&I!==null){if(I.message===N)throw new g("error/message",'The error message "'.concat(I.message,'" is identical to the message.'))}else if(I===N)throw new g("error/message",'The error "'.concat(I,'" is identical to the message.'));G=N,N=void 0}else if(N!=null&&c(N)!=="object"&&typeof N!="function")throw new o("error",["Object","Error","Function","RegExp"],N);if(I===A){var ae="";N&&N.name&&(ae+=" (".concat(N.name,")")),ae+=G?": ".concat(G):".";var ce=F.name==="rejects"?"rejection":"exception";M({actual:void 0,expected:N,operator:F.name,message:"Missing expected ".concat(ce).concat(ae),stackStartFn:F})}if(N&&!Q(I,N,G,F))throw I}function C(F,I,N,G){if(I!==A){if(typeof N=="string"&&(G=N,N=void 0),!N||Q(I,N)){var ae=G?": ".concat(G):".",ce=F.name==="doesNotReject"?"rejection":"exception";M({actual:I,expected:N,operator:F.name,message:"Got unwanted ".concat(ce).concat(ae,`
`)+'Actual message: "'.concat(I&&I.message,'"'),stackStartFn:F})}throw I}}function J(){for(var F=arguments.length,I=new Array(F),N=0;N<F;N++)I[N]=arguments[N];V.apply(void 0,[J,I.length].concat(I))}S.throws=function F(I){for(var N=arguments.length,G=new Array(N>1?N-1:0),ae=1;ae<N;ae++)G[ae-1]=arguments[ae];$.apply(void 0,[F,re(I)].concat(G))},S.rejects=function F(I){for(var N=arguments.length,G=new Array(N>1?N-1:0),ae=1;ae<N;ae++)G[ae-1]=arguments[ae];return W(I).then(function(ce){return $.apply(void 0,[F,ce].concat(G))})},S.doesNotThrow=function F(I){for(var N=arguments.length,G=new Array(N>1?N-1:0),ae=1;ae<N;ae++)G[ae-1]=arguments[ae];C.apply(void 0,[F,re(I)].concat(G))},S.doesNotReject=function F(I){for(var N=arguments.length,G=new Array(N>1?N-1:0),ae=1;ae<N;ae++)G[ae-1]=arguments[ae];return W(I).then(function(ce){return C.apply(void 0,[F,ce].concat(G))})},S.ifError=function F(I){if(I!=null){var N="ifError got unwanted exception: ";c(I)==="object"&&typeof I.message=="string"?I.message.length===0&&I.constructor?N+=I.constructor.name:N+=I.message:N+=_(I);var G=new d({actual:I,expected:null,operator:"ifError",message:N,stackStartFn:F}),ae=I.stack;if(typeof ae=="string"){var ce=ae.split(`
`);ce.shift();for(var Se=G.stack.split(`
`),oe=0;oe<ce.length;oe++){var Z=Se.indexOf(ce[oe]);if(Z!==-1){Se=Se.slice(0,Z);break}}G.stack="".concat(Se.join(`
`),`
`).concat(ce.join(`
`))}throw G}},S.strict=k(J,S,{equal:S.strictEqual,deepEqual:S.deepStrictEqual,notEqual:S.notStrictEqual,notDeepEqual:S.notDeepStrictEqual}),S.strict.strict=S.strict},2403:a=>{"use strict";a.exports=typeof Reflect<"u"&&Reflect.getPrototypeOf||null},2423:a=>{"use strict";a.exports=function(i,t){var n=i.discriminatorMapping&&i.discriminatorMapping.value;if(n&&!("sparse"in t)){var c=i.options.discriminatorKey;t.partialFilterExpression=t.partialFilterExpression||{},t.partialFilterExpression[c]=n}return t}},2477:(a,i,t)=>{"use strict";var n=t(2402);a.exports=function(c){return c==null||c===""?null:c instanceof Date?(n.ok(!isNaN(c.valueOf())),c):(n.ok(typeof c!="boolean"),b=c instanceof Number||typeof c=="number"?new Date(c):typeof c=="string"&&!isNaN(Number(c))&&(Number(c)>=275761||Number(c)<-271820)?new Date(Number(c)):typeof c.valueOf=="function"?new Date(c.valueOf()):new Date(c),isNaN(b.valueOf())?void n.ok(!1):b);var b}},2481:(a,i,t)=>{"use strict";var n=t(4756);a.exports=function(){return typeof Object.is=="function"?Object.is:n}},2486:(a,i)=>{i.read=function(t,n,c,b,x){var w,g,o=8*x-b-1,u=(1<<o)-1,h=u>>1,l=-7,d=c?x-1:0,_=c?-1:1,p=t[n+d];for(d+=_,w=p&(1<<-l)-1,p>>=-l,l+=o;l>0;w=256*w+t[n+d],d+=_,l-=8);for(g=w&(1<<-l)-1,w>>=-l,l+=b;l>0;g=256*g+t[n+d],d+=_,l-=8);if(w===0)w=1-h;else{if(w===u)return g?NaN:1/0*(p?-1:1);g+=Math.pow(2,b),w-=h}return(p?-1:1)*g*Math.pow(2,w-b)},i.write=function(t,n,c,b,x,w){var g,o,u,h=8*w-x-1,l=(1<<h)-1,d=l>>1,_=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=b?0:w-1,m=b?1:-1,y=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(o=isNaN(n)?1:0,g=l):(g=Math.floor(Math.log(n)/Math.LN2),n*(u=Math.pow(2,-g))<1&&(g--,u*=2),(n+=g+d>=1?_/u:_*Math.pow(2,1-d))*u>=2&&(g++,u/=2),g+d>=l?(o=0,g=l):g+d>=1?(o=(n*u-1)*Math.pow(2,x),g+=d):(o=n*Math.pow(2,d-1)*Math.pow(2,x),g=0));x>=8;t[c+p]=255&o,p+=m,o/=256,x-=8);for(g=g<<x|o,h+=x;h>0;t[c+p]=255&g,p+=m,g/=256,h-=8);t[c+p-m]|=128*y}},2497:(a,i,t)=>{"use strict";var n=t(1243).isMongooseArray;a.exports=function(c){return c!=null&&(n(c)||c.$__!=null||c.isMongooseBuffer||c.$isMongooseMap)}},2555:a=>{"use strict";a.exports=function(i){if(Array.isArray(i)){if(!i.every(function(t){return typeof t=="number"||typeof t=="string"}))throw new Error("$type array values must be strings or numbers");return i}if(typeof i!="number"&&typeof i!="string")throw new Error("$type parameter must be number, string, or array of numbers and strings");return i}},2580:(a,i,t)=>{"use strict";var n=t(2400),c=t(3550).EventEmitter,b=t(3672),x=t(7058),w=t(5549),g=b.ValidationError,o=t(4957),u=t(608);function h(l,d,_,p,m){if(!(this instanceof h))return new h(l,d,_,p,m);if(u(d)&&!d.instanceOfSchema&&(d=new x(d)),d=this.schema||d,!this.schema&&d.options._id&&(l=l||{})._id===void 0&&(l._id=new w),!d)throw new b.MissingSchemaError;for(var y in this.$__setSchema(d),n.call(this,l,_,p,m),o(this,d,{decorateDoc:!0}),d.methods)this[y]=d.methods[y];for(var k in d.statics)this[k]=d.statics[k]}h.prototype=Object.create(n.prototype),h.prototype.constructor=h,h.events=new c,h.$emitter=new c,["on","once","emit","listeners","removeListener","setMaxListeners","removeAllListeners","addListener"].forEach(function(l){h[l]=function(){return h.$emitter[l].apply(h.$emitter,arguments)}}),h.ValidationError=g,a.exports=h},2653:a=>{"use strict";a.exports=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]},2692:a=>{"use strict";a.exports=function(i,t){if(t.length!==1){for(var n=t[0],c=void 0,b=0;b<t.length-1;++b){var x=i.path(n);x&&x.schema?(c=x.schema.options.strict,i=x.schema,n=x.$isMongooseDocumentArray&&!isNaN(t[b+1])?"":t[b+1]):n+=n.length?"."+t[b+1]:t[b+1]}return c}}},2696:(a,i,t)=>{"use strict";var n=t(3305);a.exports=function(c,b){return typeof c=="string"&&typeof b=="string"||typeof c=="number"&&typeof b=="number"?c===b:!(!n(c,"ObjectId")||!n(b,"ObjectId"))&&c.toString()===b.toString()}},2724:(a,i,t)=>{"use strict";var n=t(3071),c=t(9344),b=n("RegExp.prototype.exec"),x=t(2268);a.exports=function(w){if(!c(w))throw new x("`regex` must be a RegExp");return function(g){return b(w,g)!==null}}},2746:a=>{"use strict";var i=typeof{env:{}}.nextTick=="function"?{env:{}}.nextTick.bind({env:{}}):function(t){return setTimeout(t,0)};a.exports=function(t){return i(t)}},2789:a=>{"use strict";function i(t){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i(t)}a.exports=function(t){if(t==null||i(t)!=="object")return!1;var n=Object.getPrototypeOf(t);return!n||n.constructor.name==="Object"}},2793:a=>{"use strict";a.exports=new Set(["__proto__","constructor","prototype"])},2822:(a,i,t)=>{"use strict";a.exports=t(6353).Double},2824:(a,i,t)=>{"use strict";var n=t(7930).objectIdSymbol,c=t(8768);function b(){var w,g;if(this.$__.shardval){g=(w=Object.keys(this.$__.shardval)).length,this.$where=this.$where||{};for(var o=0;o<g;++o)this.$where[w[o]]=this.$__.shardval[w[o]]}}function x(){var w=this.$__schema.options.shardKey||this.$__schema.options.shardkey;if(c.isPOJO(w))for(var g,o=this.$__.shardval={},u=Object.keys(w),h=u.length,l=0;l<h;++l)(g=this.$__getValue(u[l]))==null?o[u[l]]=g:c.isMongooseObject(g)?o[u[l]]=g.toObject({depopulate:!0,_isNested:!0}):g instanceof Date||g[n]?o[u[l]]=g:typeof g.valueOf=="function"?o[u[l]]=g.valueOf():o[u[l]]=g}a.exports=function(w){w.post("init",function(){return x.call(this),this}),w.pre("save",function(g){b.call(this),g()}),w.pre("remove",function(g){b.call(this),g()}),w.post("save",function(){x.call(this)})},a.exports.storeShard=x},2900:(a,i,t)=>{"use strict";var n=t(8260);a.exports=function(c){if(n(c)!=="TopologyDescription")return!1;var b=Array.from(c.servers.values());return b.length>0&&b.every(function(x){return x.type==="Unknown"})}},2914:(a,i,t)=>{function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}var c=t(7860),b=["__proto__","constructor","prototype"];function x(g,o,u,h,l,d){for(var _,p=0;p<g.length&&p<o.length;++p)_=g[p],Array.isArray(_)&&Array.isArray(o[p])?x(_,o[p],u,h,l,d):_&&(h?h(_,u,d(o[p])):(_[l]&&(_=_[l]),_[u]=d(o[p])))}function w(g){return g}i.get=function(g,o,u,h){var l;typeof u=="function"&&(u.length<2?(h=u,u=void 0):(l=u,u=void 0)),h||(h=w);var d=typeof g=="string"?c(g):g;if(!Array.isArray(d))throw new TypeError("Invalid `path`. Must be either string or array");for(var _,p=o,m=0;m<d.length;++m){if(_=d[m],typeof d[m]!="string"&&typeof d[m]!="number")throw new TypeError("Each segment of path to `get()` must be a string or number, got "+n(d[m]));if(Array.isArray(p)&&!/^\d+$/.test(_)){var y=d.slice(m);return[].concat(p).map(function(v){return v?i.get(y,v,u||l,h):h(void 0)})}if(l)p=l(p,_);else{var k=u&&p[u]?p[u]:p;p=k instanceof Map?k.get(_):k[_]}if(!p)return h(p)}return h(p)},i.has=function(g,o){var u=typeof g=="string"?c(g):g;if(!Array.isArray(u))throw new TypeError("Invalid `path`. Must be either string or array");for(var h=u.length,l=o,d=0;d<h;++d){if(typeof u[d]!="string"&&typeof u[d]!="number")throw new TypeError("Each segment of path to `has()` must be a string or number, got "+n(u[d]));if(l==null||n(l)!=="object"||!(u[d]in l))return!1;l=l[u[d]]}return!0},i.unset=function(g,o){var u=typeof g=="string"?c(g):g;if(!Array.isArray(u))throw new TypeError("Invalid `path`. Must be either string or array");for(var h=u.length,l=o,d=0;d<h;++d){if(l==null||n(l)!=="object"||!(u[d]in l))return!1;if(typeof u[d]!="string"&&typeof u[d]!="number")throw new TypeError("Each segment of path to `unset()` must be a string or number, got "+n(u[d]));if(b.indexOf(u[d])!==-1)return!1;if(d===h-1)return delete l[u[d]],!0;l=l instanceof Map?l.get(u[d]):l[u[d]]}return!0},i.set=function(g,o,u,h,l,d){var _;typeof h=="function"&&(h.length<2?(l=h,h=void 0):(_=h,h=void 0)),l||(l=w);var p=typeof g=="string"?c(g):g;if(!Array.isArray(p))throw new TypeError("Invalid `path`. Must be either string or array");if(u!=null){for(var m=0;m<p.length;++m){if(typeof p[m]!="string"&&typeof p[m]!="number")throw new TypeError("Each segment of path to `set()` must be a string or number, got "+n(p[m]));if(b.indexOf(p[m])!==-1)return}for(var y,k=d||/\$/.test(g)&&d!==!1,v=u,D=(m=0,p.length-1);m<D;++m)if((y=p[m])!="$"){if(Array.isArray(v)&&!/^\d+$/.test(y)){var j=p.slice(m);if(!k&&Array.isArray(o))for(var S=0;S<v.length&&S<o.length;++S)i.set(j,o[S],v[S],h||_,l,k);else for(S=0;S<v.length;++S)i.set(j,o,v[S],h||_,l,k);return}if(_)v=_(v,y);else{var A=h&&v[h]?v[h]:v;v=A instanceof Map?A.get(y):A[y]}if(!v)return}else if(m==D-1)break;if(y=p[D],h&&v[h]&&(v=v[h]),Array.isArray(v)&&!/^\d+$/.test(y))if(!k&&Array.isArray(o))x(v,o,y,_,h,l);else for(S=0;S<v.length;++S){var M=v[S];M&&(_?_(M,y,l(o)):(M[h]&&(M=M[h]),M[y]=l(o)))}else _?_(v,y,l(o)):v instanceof Map?v.set(y,l(o)):v[y]=l(o)}},i.stringToParts=c},2945:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}function c(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!o})()}function b(o){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},b(o)}function x(o,u){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,l){return h.__proto__=l,h},x(o,u)}var w=function(o){function u(){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,u),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,u,arguments)}return function(l,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(d&&d.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),d&&x(l,d)}(u,o),h=u,Object.defineProperty(h,"prototype",{writable:!1}),h;var h}(t(8879)),g=t(5761);Object.defineProperty(w.prototype,"subtype",g),a.exports=w},3071:(a,i,t)=>{"use strict";var n=t(6400),c=t(8863),b=c([n("%String.prototype.indexOf%")]);a.exports=function(x,w){var g=n(x,!!w);return typeof g=="function"&&b(x,".prototype.")>-1?c([g]):g}},3091:(a,i,t)=>{"use strict";function n(S){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},n(S)}function c(S,A){var M=Object.keys(S);if(Object.getOwnPropertySymbols){var V=Object.getOwnPropertySymbols(S);A&&(V=V.filter(function(K){return Object.getOwnPropertyDescriptor(S,K).enumerable})),M.push.apply(M,V)}return M}function b(S){for(var A=1;A<arguments.length;A++){var M=arguments[A]!=null?arguments[A]:{};A%2?c(Object(M),!0).forEach(function(V){x(S,V,M[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(M)):c(Object(M)).forEach(function(V){Object.defineProperty(S,V,Object.getOwnPropertyDescriptor(M,V))})}return S}function x(S,A,M){return(A=function(V){var K=function(H){if(n(H)!="object"||!H)return H;var Q=H[Symbol.toPrimitive];if(Q!==void 0){var re=Q.call(H,"string");if(n(re)!="object")return re;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(H)}(V);return n(K)=="symbol"?K:K+""}(A))in S?Object.defineProperty(S,A,{value:M,enumerable:!0,configurable:!0,writable:!0}):S[A]=M,S}var w,g=t(4625),o=t(6426),u=t(863),h=t(4327),l=t(8260),d=t(5549),_=t(3305),p=t(8768),m=o.CastError;function y(S,A){var M=typeof S=="string"&&S.length===24&&/^[a-f0-9]+$/i.test(S),V=A&&A.suppressWarning;!M&&S!==void 0||V||p.warn("mongoose: To create a new ObjectId please try `Mongoose.Types.ObjectId` instead of using `Mongoose.Schema.ObjectId`. Set the `suppressWarning` option if you're trying to create a hex char path in your schema."),o.call(this,S,A,"ObjectId")}function k(S){return this.cast(S)}y.schemaName="ObjectId",y.defaultOptions={},y.prototype=Object.create(o.prototype),y.prototype.constructor=y,y.prototype.OptionsConstructor=g,y.get=o.get,y.set=o.set,y.setters=[],y.prototype.auto=function(S){return S&&(this.default(D),this.set(j)),this},y._checkRequired=function(S){return _(S,"ObjectId")},y._cast=u,y.cast=function(S){return arguments.length===0||(S===!1&&(S=this._defaultCaster),this._cast=S),this._cast},y._defaultCaster=function(S){if(!_(S,"ObjectId"))throw new Error(S+" is not an instance of ObjectId");return S},y.checkRequired=o.checkRequired,y.prototype.checkRequired=function(S,A){return o._isRef(this,S,A,!0)?!!S:(typeof this.constructor.checkRequired=="function"?this.constructor.checkRequired():y.checkRequired())(S)},y.prototype.cast=function(S,A,M,V,K){if(!_(S,"ObjectId")&&o._isRef(this,S,A,M)){if((l(S)||"").toLowerCase()==="objectid")return new d(S.toHexString());if(S==null||p.isNonBuiltinObject(S))return this._castRef(S,A,M,K)}var H;H=typeof this._castFunction=="function"?this._castFunction:typeof this.constructor.cast=="function"?this.constructor.cast():y.cast();try{return H(S)}catch(Q){throw new m("ObjectId",S,this.path,Q,this)}};var v=b(b({},o.prototype.$conditionalHandlers),{},{$gt:k,$gte:k,$lt:k,$lte:k});function D(){return new d}function j(S){return w||(w=t(2400)),this instanceof w&&S===void 0?new d:S}Object.defineProperty(y.prototype,"$conditionalHandlers",{enumerable:!1,value:v}),D.$runBeforeSetters=!0,y.prototype.toJSONSchema=function(S){var A=this.options.required&&typeof this.options.required!="function"||this.path==="_id";return h("string","objectId",S?.useBsonType,A)},y.prototype.autoEncryptionType=function(){return"objectId"},a.exports=y},3123:a=>{"use strict";a.exports=Function.prototype.call},3191:(a,i,t)=>{"use strict";var n=t(988),c=function(){return!!n};c.hasArrayLengthDefineBug=function(){if(!n)return null;try{return n([],"length",{value:1}).length!==1}catch{return!0}},a.exports=c},3216:(a,i,t)=>{"use strict";function n(o,u){var h=Object.keys(o);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(o);u&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(o,d).enumerable})),h.push.apply(h,l)}return h}function c(o){for(var u=1;u<arguments.length;u++){var h=arguments[u]!=null?arguments[u]:{};u%2?n(Object(h),!0).forEach(function(l){b(o,l,h[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(h)):n(Object(h)).forEach(function(l){Object.defineProperty(o,l,Object.getOwnPropertyDescriptor(h,l))})}return o}function b(o,u,h){return(u=function(l){var d=function(_){if(x(_)!="object"||!_)return _;var p=_[Symbol.toPrimitive];if(p!==void 0){var m=p.call(_,"string");if(x(m)!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(_)}(l);return x(d)=="symbol"?d:d+""}(u))in o?Object.defineProperty(o,u,{value:h,enumerable:!0,configurable:!0,writable:!0}):o[u]=h,o}function x(o){return x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},x(o)}var w=t(8768),g=new Set(["__index","__parentArray","_doc"]);a.exports=function(o,u){if(w.isPOJO(o)&&o.$__!=null&&o._doc!=null){if(u){for(var h={},l=0,d=Object.keys(o);l<d.length;l++){var _=d[l];x(_)!=="symbol"&&_[0]!=="$"&&(g.has(_)||(h[_]=o[_]))}return c(c({},o._doc),h)}return o._doc}return o}},3279:a=>{"use strict";a.exports=Function.prototype.apply},3303:(a,i)=>{"use strict";i._={transform:!1,virtuals:!1,getters:!1,_skipDepopulateTopLevel:!0,depopulate:!0,flattenDecimals:!1,useProjection:!1,versionKey:!0,flattenObjectIds:!1}},3305:a=>{"use strict";a.exports=function(i,t){return i!=null&&i._bsontype===t}},3318:(a,i,t)=>{"use strict";function n(_){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},n(_)}function c(_,p){var m=Object.keys(_);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(_);p&&(y=y.filter(function(k){return Object.getOwnPropertyDescriptor(_,k).enumerable})),m.push.apply(m,y)}return m}function b(_){for(var p=1;p<arguments.length;p++){var m=arguments[p]!=null?arguments[p]:{};p%2?c(Object(m),!0).forEach(function(y){x(_,y,m[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(m)):c(Object(m)).forEach(function(y){Object.defineProperty(_,y,Object.getOwnPropertyDescriptor(m,y))})}return _}function x(_,p,m){return(p=function(y){var k=function(v){if(n(v)!="object"||!v)return v;var D=v[Symbol.toPrimitive];if(D!==void 0){var j=D.call(v,"string");if(n(j)!="object")return j;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(v)}(y);return n(k)=="symbol"?k:k+""}(p))in _?Object.defineProperty(_,p,{value:m,enumerable:!0,configurable:!0,writable:!0}):_[p]=m,_}var w=t(3609),g=t(6426),o=t(4058),u=t(4327);function h(_,p){g.call(this,_,p,"BigInt")}h.schemaName="BigInt",h.defaultOptions={},h.prototype=Object.create(g.prototype),h.prototype.constructor=h,h._cast=o,h.set=g.set,h.setters=[],h.get=g.get,h.cast=function(_){return arguments.length===0||(_===!1&&(_=this._defaultCaster),this._cast=_),this._cast},h._checkRequired=function(_){return _!=null},h.checkRequired=g.checkRequired,h.prototype.checkRequired=function(_){return this.constructor._checkRequired(_)},h.prototype.cast=function(_){var p;p=typeof this._castFunction=="function"?this._castFunction:typeof this.constructor.cast=="function"?this.constructor.cast():h.cast();try{return p(_)}catch(m){throw new w("BigInt",_,this.path,m,this)}};var l=b(b({},g.prototype.$conditionalHandlers),{},{$gt:d,$gte:d,$lt:d,$lte:d});function d(_,p){return this.castForQuery(null,_,p)}Object.defineProperty(h.prototype,"$conditionalHandlers",{enumerable:!1,value:l}),h.prototype.castForQuery=function(_,p,m){var y;if(_!=null)return(y=this.$conditionalHandlers[_])?y.call(this,p):this.applySetters(p,m);try{return this.applySetters(p,m)}catch(k){throw k instanceof w&&k.path===this.path&&this.$fullPath!=null&&(k.path=this.$fullPath),k}},h.prototype._castNullish=function(_){return _===void 0||(typeof this.constructor.cast=="function"?this.constructor.cast():h.cast()),_},h.prototype.toJSONSchema=function(_){var p=this.options.required&&typeof this.options.required!="function";return u("string","long",_?.useBsonType,p)},h.prototype.autoEncryptionType=function(){return"long"},a.exports=h},3381:a=>{"use strict";function i(){return this._id!=null?this._id.toString():null}a.exports=function(t){return!t.paths.id&&t.paths._id&&t.options.id&&(t.aliases&&t.aliases.id||t.virtual("id").get(i)),t}},3388:a=>{"use strict";a.exports=typeof Reflect<"u"&&Reflect&&Reflect.apply},3414:a=>{"use strict";a.exports=Number.isNaN||function(i){return i!=i}},3426:(a,i,t)=>{"use strict";var n=t(2653),c=typeof globalThis>"u"?t.g:globalThis;a.exports=function(){for(var b=[],x=0;x<n.length;x++)typeof c[n[x]]=="function"&&(b[b.length]=n[x]);return b}},3441:(a,i,t)=>{"use strict";function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}function c(){try{var g=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!g})()}function b(g){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},b(g)}function x(g,o){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},x(g,o)}var w=function(g){function o(h,l){var d;(function(p,m){if(!(p instanceof m))throw new TypeError("Cannot call a class as a function")})(this,o);var _=Array.isArray(l)?"array":"primitive value";return(d=function(p,m,y){return m=b(m),function(k,v){if(v&&(n(v)=="object"||typeof v=="function"))return v;if(v!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(D){if(D===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}(k)}(p,c()?Reflect.construct(m,y||[],b(p).constructor):m.apply(p,y))}(this,o,["Tried to set nested object field `"+h+"` to ".concat(_," `")+l+"`"])).path=h,d}return function(h,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(l&&l.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),l&&x(h,l)}(o,g),u=o,Object.defineProperty(u,"prototype",{writable:!1}),u;var u}(t(8213));Object.defineProperty(w.prototype,"name",{value:"ObjectExpectedError"}),a.exports=w},3550:a=>{"use strict";function i(y){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},i(y)}var t,n=(typeof Reflect>"u"?"undefined":i(Reflect))==="object"?Reflect:null,c=n&&typeof n.apply=="function"?n.apply:function(y,k,v){return Function.prototype.apply.call(y,k,v)};t=n&&typeof n.ownKeys=="function"?n.ownKeys:Object.getOwnPropertySymbols?function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:function(y){return Object.getOwnPropertyNames(y)};var b=Number.isNaN||function(y){return y!=y};function x(){x.init.call(this)}a.exports=x,a.exports.once=function(y,k){return new Promise(function(v,D){function j(A){y.removeListener(k,S),D(A)}function S(){typeof y.removeListener=="function"&&y.removeListener("error",j),v([].slice.call(arguments))}m(y,k,S,{once:!0}),k!=="error"&&function(A,M){typeof A.on=="function"&&m(A,"error",M,{once:!0})}(y,j)})},x.EventEmitter=x,x.prototype._events=void 0,x.prototype._eventsCount=0,x.prototype._maxListeners=void 0;var w=10;function g(y){if(typeof y!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+i(y))}function o(y){return y._maxListeners===void 0?x.defaultMaxListeners:y._maxListeners}function u(y,k,v,D){var j,S,A,M;if(g(v),(S=y._events)===void 0?(S=y._events=Object.create(null),y._eventsCount=0):(S.newListener!==void 0&&(y.emit("newListener",k,v.listener?v.listener:v),S=y._events),A=S[k]),A===void 0)A=S[k]=v,++y._eventsCount;else if(typeof A=="function"?A=S[k]=D?[v,A]:[A,v]:D?A.unshift(v):A.push(v),(j=o(y))>0&&A.length>j&&!A.warned){A.warned=!0;var V=new Error("Possible EventEmitter memory leak detected. "+A.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");V.name="MaxListenersExceededWarning",V.emitter=y,V.type=k,V.count=A.length,M=V,console&&console.warn&&console.warn(M)}return y}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(y,k,v){var D={fired:!1,wrapFn:void 0,target:y,type:k,listener:v},j=h.bind(D);return j.listener=v,D.wrapFn=j,j}function d(y,k,v){var D=y._events;if(D===void 0)return[];var j=D[k];return j===void 0?[]:typeof j=="function"?v?[j.listener||j]:[j]:v?function(S){for(var A=new Array(S.length),M=0;M<A.length;++M)A[M]=S[M].listener||S[M];return A}(j):p(j,j.length)}function _(y){var k=this._events;if(k!==void 0){var v=k[y];if(typeof v=="function")return 1;if(v!==void 0)return v.length}return 0}function p(y,k){for(var v=new Array(k),D=0;D<k;++D)v[D]=y[D];return v}function m(y,k,v,D){if(typeof y.on=="function")D.once?y.once(k,v):y.on(k,v);else{if(typeof y.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+i(y));y.addEventListener(k,function j(S){D.once&&y.removeEventListener(k,j),v(S)})}}Object.defineProperty(x,"defaultMaxListeners",{enumerable:!0,get:function(){return w},set:function(y){if(typeof y!="number"||y<0||b(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");w=y}}),x.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},x.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||b(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this},x.prototype.getMaxListeners=function(){return o(this)},x.prototype.emit=function(y){for(var k=[],v=1;v<arguments.length;v++)k.push(arguments[v]);var D=y==="error",j=this._events;if(j!==void 0)D=D&&j.error===void 0;else if(!D)return!1;if(D){var S;if(k.length>0&&(S=k[0]),S instanceof Error)throw S;var A=new Error("Unhandled error."+(S?" ("+S.message+")":""));throw A.context=S,A}var M=j[y];if(M===void 0)return!1;if(typeof M=="function")c(M,this,k);else{var V=M.length,K=p(M,V);for(v=0;v<V;++v)c(K[v],this,k)}return!0},x.prototype.addListener=function(y,k){return u(this,y,k,!1)},x.prototype.on=x.prototype.addListener,x.prototype.prependListener=function(y,k){return u(this,y,k,!0)},x.prototype.once=function(y,k){return g(k),this.on(y,l(this,y,k)),this},x.prototype.prependOnceListener=function(y,k){return g(k),this.prependListener(y,l(this,y,k)),this},x.prototype.removeListener=function(y,k){var v,D,j,S,A;if(g(k),(D=this._events)===void 0)return this;if((v=D[y])===void 0)return this;if(v===k||v.listener===k)--this._eventsCount===0?this._events=Object.create(null):(delete D[y],D.removeListener&&this.emit("removeListener",y,v.listener||k));else if(typeof v!="function"){for(j=-1,S=v.length-1;S>=0;S--)if(v[S]===k||v[S].listener===k){A=v[S].listener,j=S;break}if(j<0)return this;j===0?v.shift():function(M,V){for(;V+1<M.length;V++)M[V]=M[V+1];M.pop()}(v,j),v.length===1&&(D[y]=v[0]),D.removeListener!==void 0&&this.emit("removeListener",y,A||k)}return this},x.prototype.off=x.prototype.removeListener,x.prototype.removeAllListeners=function(y){var k,v,D;if((v=this._events)===void 0)return this;if(v.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):v[y]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete v[y]),this;if(arguments.length===0){var j,S=Object.keys(v);for(D=0;D<S.length;++D)(j=S[D])!=="removeListener"&&this.removeAllListeners(j);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(k=v[y])=="function")this.removeListener(y,k);else if(k!==void 0)for(D=k.length-1;D>=0;D--)this.removeListener(y,k[D]);return this},x.prototype.listeners=function(y){return d(this,y,!0)},x.prototype.rawListeners=function(y){return d(this,y,!1)},x.listenerCount=function(y,k){return typeof y.listenerCount=="function"?y.listenerCount(k):_.call(y,k)},x.prototype.listenerCount=_,x.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},3609:(a,i,t)=>{"use strict";function n(k){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},n(k)}function c(k,v){for(var D=0;D<v.length;D++){var j=v[D];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(k,b(j.key),j)}}function b(k){var v=function(D){if(n(D)!="object"||!D)return D;var j=D[Symbol.toPrimitive];if(j!==void 0){var S=j.call(D,"string");if(n(S)!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(D)}(k);return n(v)=="symbol"?v:v+""}function x(k,v,D){return v=o(v),function(j,S){if(S&&(n(S)=="object"||typeof S=="function"))return S;if(S!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return w(j)}(k,g()?Reflect.construct(v,D||[],o(k).constructor):v.apply(k,D))}function w(k){if(k===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return k}function g(){try{var k=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(g=function(){return!!k})()}function o(k){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(v){return v.__proto__||Object.getPrototypeOf(v)},o(k)}function u(k,v){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(D,j){return D.__proto__=j,D},u(k,v)}var h=t(8213),l=t(7352),d=function(k){function v(S,A,M,V,K){var H;if(function(re,ue){if(!(re instanceof ue))throw new TypeError("Cannot call a class as a function")}(this,v),arguments.length>0){var Q=p(A);(H=x(this,v,[y(null,S,A,M,m(K),Q,V)])).init(S,A,M,V,K)}else H=x(this,v,[y()]);return w(H)}return function(S,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function");S.prototype=Object.create(A&&A.prototype,{constructor:{value:S,writable:!0,configurable:!0}}),Object.defineProperty(S,"prototype",{writable:!1}),A&&u(S,A)}(v,k),D=v,(j=[{key:"toJSON",value:function(){return{stringValue:this.stringValue,valueType:this.valueType,kind:this.kind,value:this.value,path:this.path,reason:this.reason,name:this.name,message:this.message}}},{key:"init",value:function(S,A,M,V,K){this.stringValue=_(A),this.messageFormat=m(K),this.kind=S,this.value=A,this.path=M,this.reason=V,this.valueType=p(A)}},{key:"copy",value:function(S){this.messageFormat=S.messageFormat,this.stringValue=S.stringValue,this.kind=S.kind,this.value=S.value,this.path=S.path,this.reason=S.reason,this.message=S.message,this.valueType=S.valueType}},{key:"setModel",value:function(S){this.message=y(S,this.kind,this.value,this.path,this.messageFormat,this.valueType)}}])&&c(D.prototype,j),Object.defineProperty(D,"prototype",{writable:!1}),D;var D,j}(h);function _(k){var v=l.inspect(k);return(v=v.replace(/^'|'$/g,'"')).startsWith('"')||(v='"'+v+'"'),v}function p(k){if(k==null)return""+k;var v=n(k);return v!=="object"||typeof k.constructor!="function"?v:k.constructor.name}function m(k){var v=k&&k._castErrorMessage||null;if(typeof v=="string"||typeof v=="function")return v}function y(k,v,D,j,S,A,M){if(typeof S=="string"){var V=_(D),K=S.replace("{KIND}",v).replace("{VALUE}",V).replace("{PATH}",j);return k!=null&&(K=K.replace("{MODEL}",k.modelName)),K}if(typeof S=="function")return S(D,j,k,v);var H="Cast to "+v+" failed for value "+_(D)+(A?" (type "+A+")":"")+' at path "'+j+'"';return k!=null&&(H+=' for model "'+k.modelName+'"'),M!=null&&typeof M.constructor=="function"&&M.constructor.name!=="AssertionError"&&M.constructor.name!=="Error"&&(H+=' because of "'+M.constructor.name+'"'),H}Object.defineProperty(d.prototype,"name",{value:"CastError"}),a.exports=d},3622:a=>{"use strict";function i(t){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i(t)}a.exports=function(t,n,c){return t==null?t:(t._doc!=null&&(t=t._doc),arguments.length>=3?i(t)!=="object"||c===void 0?void 0:(t instanceof Map?t.set(n,c):t[n]=c,c):n==="$*"?t instanceof Map?Array.from(t.values()):Object.keys(t).map(function(b){return t[b]}):t instanceof Map?t.get(n):t[n])}},3644:(a,i,t)=>{"use strict";function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}function c(){try{var g=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!g})()}function b(g){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},b(g)}function x(g,o){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},x(g,o)}var w=function(g){function o(h){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,o),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,o,["Cannot overwrite `"+h+"` model once compiled."])}return function(h,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(l&&l.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),l&&x(h,l)}(o,g),u=o,Object.defineProperty(u,"prototype",{writable:!1}),u;var u}(t(8213));Object.defineProperty(w.prototype,"name",{value:"OverwriteModelError"}),a.exports=w},3660:(a,i,t)=>{"use strict";function n(k,v){var D=Object.keys(k);if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(k);v&&(j=j.filter(function(S){return Object.getOwnPropertyDescriptor(k,S).enumerable})),D.push.apply(D,j)}return D}function c(k){for(var v=1;v<arguments.length;v++){var D=arguments[v]!=null?arguments[v]:{};v%2?n(Object(D),!0).forEach(function(j){b(k,j,D[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(D)):n(Object(D)).forEach(function(j){Object.defineProperty(k,j,Object.getOwnPropertyDescriptor(D,j))})}return k}function b(k,v,D){return(v=function(j){var S=function(A){if(x(A)!="object"||!A)return A;var M=A[Symbol.toPrimitive];if(M!==void 0){var V=M.call(A,"string");if(x(V)!="object")return V;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(A)}(j);return x(S)=="symbol"?S:S+""}(v))in k?Object.defineProperty(k,v,{value:D,enumerable:!0,configurable:!0,writable:!0}):k[v]=D,k}function x(k){return x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},x(k)}var w=t(3672),g=t(1007),o=t(6426),u=t(7768),h=t(4327),l=t(9460),d=t(8768),_=o.CastError;function p(k,v){o.call(this,k,v,"Number")}function m(k){return this.cast(k)}p.get=o.get,p.set=o.set,p.setters=[],p._cast=u,p.cast=function(k){return arguments.length===0||(k===!1&&(k=this._defaultCaster),this._cast=k),this._cast},p._defaultCaster=function(k){if(typeof k!="number")throw new Error;return k},p.schemaName="Number",p.defaultOptions={},p.prototype=Object.create(o.prototype),p.prototype.constructor=p,p.prototype.OptionsConstructor=g,p._checkRequired=function(k){return typeof k=="number"||k instanceof Number},p.checkRequired=o.checkRequired,p.prototype.checkRequired=function(k,v){return x(k)==="object"&&o._isRef(this,k,v,!0)?k!=null:(typeof this.constructor.checkRequired=="function"?this.constructor.checkRequired():p.checkRequired())(k)},p.prototype.min=function(k,v){if(this.minValidator&&(this.validators=this.validators.filter(function(j){return j.validator!==this.minValidator},this)),k!=null){var D=v||w.messages.Number.min;D=D.replace(/{MIN}/,k),this.validators.push({validator:this.minValidator=function(j){return j==null||j>=k},message:D,type:"min",min:k})}return this},p.prototype.max=function(k,v){if(this.maxValidator&&(this.validators=this.validators.filter(function(j){return j.validator!==this.maxValidator},this)),k!=null){var D=v||w.messages.Number.max;D=D.replace(/{MAX}/,k),this.validators.push({validator:this.maxValidator=function(j){return j==null||j<=k},message:D,type:"max",max:k})}return this},p.prototype.enum=function(k,v){return this.enumValidator&&(this.validators=this.validators.filter(function(D){return D.validator!==this.enumValidator},this)),Array.isArray(k)||(d.isPOJO(k)&&k.values!=null?(v=k.message,k=k.values):typeof k=="number"&&(k=Array.prototype.slice.call(arguments),v=null),d.isPOJO(k)&&(k=Object.values(k)),v=v||w.messages.Number.enum),v=v??w.messages.Number.enum,this.enumValidator=function(D){return D==null||k.indexOf(D)!==-1},this.validators.push({validator:this.enumValidator,message:v,type:"enum",enumValues:k}),this},p.prototype.cast=function(k,v,D,j,S){if(typeof k!="number"&&o._isRef(this,k,v,D)&&(k==null||d.isNonBuiltinObject(k)))return this._castRef(k,v,D,S);var A,M=k&&k._id!==void 0?k._id:k;A=typeof this._castFunction=="function"?this._castFunction:typeof this.constructor.cast=="function"?this.constructor.cast():p.cast();try{return A(M)}catch(V){throw new _("Number",M,this.path,V,this)}};var y=c(c({},o.prototype.$conditionalHandlers),{},{$bitsAllClear:l,$bitsAnyClear:l,$bitsAllSet:l,$bitsAnySet:l,$gt:m,$gte:m,$lt:m,$lte:m,$mod:function(k){var v=this;return Array.isArray(k)?k.map(function(D){return v.cast(D)}):[this.cast(k)]}});Object.defineProperty(p.prototype,"$conditionalHandlers",{enumerable:!1,value:y}),p.prototype.castForQuery=function(k,v,D){var j;if(k!=null){if(!(j=this.$conditionalHandlers[k]))throw new _("number",v,this.path,null,this);return j.call(this,v,D)}try{v=this.applySetters(v,D)}catch(S){throw S instanceof _&&S.path===this.path&&this.$fullPath!=null&&(S.path=this.$fullPath),S}return v},p.prototype.toJSONSchema=function(k){var v=this.options.required&&typeof this.options.required!="function"||this.path==="_id";return h("number","number",k?.useBsonType,v)},a.exports=p},3672:(a,i,t)=>{"use strict";var n=t(8213);a.exports=n,n.messages=t(766),n.Messages=n.messages,n.CastError=t(3609),n.DocumentNotFoundError=t(1129),n.ValidationError=t(6949),n.ValidatorError=t(9538),n.VersionError=t(6996),n.ParallelSaveError=t(3940),n.OverwriteModelError=t(3644),n.MissingSchemaError=t(8063),n.MongooseBulkSaveIncompleteError=t(8517),n.MongooseServerSelectionError=t(7219),n.DivergentArrayError=t(1417),n.StrictModeError=t(8995),n.StrictPopulateError=t(6801)},3696:a=>{"use strict";a.exports=function(i,t){return i==null?null:typeof i=="boolean"?t:typeof i[t]=="boolean"?i[t]?t:null:t in i?i[t]:t}},3703:a=>{"use strict";function i(n,c){(c==null||c>n.length)&&(c=n.length);for(var b=0,x=Array(c);b<c;b++)x[b]=n[b];return x}function t(n,c){return n==null?n:n instanceof Map?n.get(c):n[c]}a.exports=function(n,c,b){var x,w=!1;if(typeof c=="string"){if(c.indexOf(".")===-1){var g=t(n,c);return g??b}x=c.split(".")}else if(w=!0,(x=c).length===1){var o=t(n,x[0]);return o??b}var u,h=c,l=n,d=function(p,m){var y=typeof Symbol<"u"&&p[Symbol.iterator]||p["@@iterator"];if(!y){if(Array.isArray(p)||(y=function(A,M){if(A){if(typeof A=="string")return i(A,M);var V={}.toString.call(A).slice(8,-1);return V==="Object"&&A.constructor&&(V=A.constructor.name),V==="Map"||V==="Set"?Array.from(A):V==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(V)?i(A,M):void 0}}(p))||m&&p&&typeof p.length=="number"){y&&(p=y);var k=0,v=function(){};return{s:v,n:function(){return k>=p.length?{done:!0}:{done:!1,value:p[k++]}},e:function(A){throw A},f:v}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var D,j=!0,S=!1;return{s:function(){y=y.call(p)},n:function(){var A=y.next();return j=A.done,A},e:function(A){S=!0,D=A},f:function(){try{j||y.return==null||y.return()}finally{if(S)throw D}}}}(x);try{for(d.s();!(u=d.n()).done;){var _=u.value;if(l==null)return b;if(!w&&l[h]!=null)return l[h];l=t(l,_),w||(h=h.substr(_.length+1))}}catch(p){d.e(p)}finally{d.f()}return l??b}},3704:(a,i,t)=>{"use strict";function n(w){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},n(w)}var c=t(2402),b=t(6353),x=t(3305);a.exports=function(w){if(w==null||w==="")return null;var g;if(x(w,"Long"))g=w.toNumber();else if(typeof w=="string")try{return b.Double.fromString(w)}catch{c.ok(!1)}else if(n(w)==="object"){var o,u=(o=w.valueOf())!==null&&o!==void 0?o:w.toString();if(typeof u=="string")try{return b.Double.fromString(w)}catch{c.ok(!1)}else g=Number(u)}else g=Number(w);return new b.Double(g)}},3731:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}function c(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!o})()}function b(o){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},b(o)}function x(o,u){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,l){return h.__proto__=l,h},x(o,u)}var w=function(o){function u(){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,u),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,u,arguments)}return function(l,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(d&&d.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),d&&x(l,d)}(u,o),h=u,Object.defineProperty(h,"prototype",{writable:!1}),h;var h}(t(8879)),g=t(5761);Object.defineProperty(w.prototype,"min",g),Object.defineProperty(w.prototype,"max",g),Object.defineProperty(w.prototype,"expires",g),a.exports=w},3743:(a,i,t)=>{"use strict";function n(l){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},n(l)}function c(l){return c=typeof Symbol=="function"&&n(Symbol.iterator)==="symbol"?function(d){return n(d)}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":n(d)},c(l)}function b(l){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(d){return d.__proto__||Object.getPrototypeOf(d)},b(l)}function x(l,d){return x=Object.setPrototypeOf||function(_,p){return _.__proto__=p,_},x(l,d)}var w,g,o={};function u(l,d,_){_||(_=Error);var p=function(m){function y(k,v,D){var j;return function(S,A){if(!(S instanceof A))throw new TypeError("Cannot call a class as a function")}(this,y),j=function(S,A){return!A||c(A)!=="object"&&typeof A!="function"?function(M){if(M===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M}(S):A}(this,b(y).call(this,function(S,A,M){return typeof d=="string"?d:d(S,A,M)}(k,v,D))),j.code=l,j}return function(k,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function");k.prototype=Object.create(v&&v.prototype,{constructor:{value:k,writable:!0,configurable:!0}}),v&&x(k,v)}(y,m),y}(_);o[l]=p}function h(l,d){if(Array.isArray(l)){var _=l.length;return l=l.map(function(p){return String(p)}),_>2?"one of ".concat(d," ").concat(l.slice(0,_-1).join(", "),", or ")+l[_-1]:_===2?"one of ".concat(d," ").concat(l[0]," or ").concat(l[1]):"of ".concat(d," ").concat(l[0])}return"of ".concat(d," ").concat(String(l))}u("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError),u("ERR_INVALID_ARG_TYPE",function(l,d,_){var p,m,y,k,v;if(w===void 0&&(w=t(2402)),w(typeof l=="string","'name' must be a string"),typeof d=="string"&&(m="not ",d.substr(0,4)===m)?(p="must not be",d=d.replace(/^not /,"")):p="must be",function(j,S,A){return(A===void 0||A>j.length)&&(A=j.length),j.substring(A-9,A)===S}(l," argument"))y="The ".concat(l," ").concat(p," ").concat(h(d,"type"));else{var D=(typeof v!="number"&&(v=0),v+1>(k=l).length||k.indexOf(".",v)===-1?"argument":"property");y='The "'.concat(l,'" ').concat(D," ").concat(p," ").concat(h(d,"type"))}return y+". Received type ".concat(c(_))},TypeError),u("ERR_INVALID_ARG_VALUE",function(l,d){var _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"is invalid";g===void 0&&(g=t(7352));var p=g.inspect(d);return p.length>128&&(p="".concat(p.slice(0,128),"...")),"The argument '".concat(l,"' ").concat(_,". Received ").concat(p)},TypeError,RangeError),u("ERR_INVALID_RETURN_VALUE",function(l,d,_){var p;return p=_&&_.constructor&&_.constructor.name?"instance of ".concat(_.constructor.name):"type ".concat(c(_)),"Expected ".concat(l,' to be returned from the "').concat(d,'"')+" function but got ".concat(p,".")},TypeError),u("ERR_MISSING_ARGS",function(){for(var l=arguments.length,d=new Array(l),_=0;_<l;_++)d[_]=arguments[_];w===void 0&&(w=t(2402)),w(d.length>0,"At least one arg needs to be specified");var p="The ",m=d.length;switch(d=d.map(function(y){return'"'.concat(y,'"')}),m){case 1:p+="".concat(d[0]," argument");break;case 2:p+="".concat(d[0]," and ").concat(d[1]," arguments");break;default:p+=d.slice(0,m-1).join(", "),p+=", and ".concat(d[m-1]," arguments")}return"".concat(p," must be specified")},TypeError),a.exports.codes=o},3777:(a,i,t)=>{"use strict";var n=t(9809),c=Object.prototype.toString,b=Object.prototype.hasOwnProperty;a.exports=function(x,w,g){if(!n(w))throw new TypeError("iterator must be a function");var o,u;arguments.length>=3&&(o=g),u=x,c.call(u)==="[object Array]"?function(h,l,d){for(var _=0,p=h.length;_<p;_++)b.call(h,_)&&(d==null?l(h[_],_,h):l.call(d,h[_],_,h))}(x,w,o):typeof x=="string"?function(h,l,d){for(var _=0,p=h.length;_<p;_++)d==null?l(h.charAt(_),_,h):l.call(d,h.charAt(_),_,h)}(x,w,o):function(h,l,d){for(var _ in h)b.call(h,_)&&(d==null?l(h[_],_,h):l.call(d,h[_],_,h))}(x,w,o)}},3892:(a,i,t)=>{"use strict";function n(m){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},n(m)}function c(m,y){var k=typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(!k){if(Array.isArray(m)||(k=function(M,V){if(M){if(typeof M=="string")return b(M,V);var K={}.toString.call(M).slice(8,-1);return K==="Object"&&M.constructor&&(K=M.constructor.name),K==="Map"||K==="Set"?Array.from(M):K==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(K)?b(M,V):void 0}}(m))||y&&m&&typeof m.length=="number"){k&&(m=k);var v=0,D=function(){};return{s:D,n:function(){return v>=m.length?{done:!0}:{done:!1,value:m[v++]}},e:function(M){throw M},f:D}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var j,S=!0,A=!1;return{s:function(){k=k.call(m)},n:function(){var M=k.next();return S=M.done,M},e:function(M){A=!0,j=M},f:function(){try{S||k.return==null||k.return()}finally{if(A)throw j}}}}function b(m,y){(y==null||y>m.length)&&(y=m.length);for(var k=0,v=Array(y);k<y;k++)v[k]=m[k];return v}function x(m,y){var k=Object.keys(m);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(m);y&&(v=v.filter(function(D){return Object.getOwnPropertyDescriptor(m,D).enumerable})),k.push.apply(k,v)}return k}function w(m){for(var y=1;y<arguments.length;y++){var k=arguments[y]!=null?arguments[y]:{};y%2?x(Object(k),!0).forEach(function(v){g(m,v,k[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(k)):x(Object(k)).forEach(function(v){Object.defineProperty(m,v,Object.getOwnPropertyDescriptor(k,v))})}return m}function g(m,y,k){return(y=function(v){var D=function(j){if(n(j)!="object"||!j)return j;var S=j[Symbol.toPrimitive];if(S!==void 0){var A=S.call(j,"string");if(n(A)!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(j)}(v);return n(D)=="symbol"?D:D+""}(y))in m?Object.defineProperty(m,y,{value:k,enumerable:!0,configurable:!0,writable:!0}):m[y]=k,m}var o=t(6948),u=t(3916),h=t(3703),l=t(1058),d=t(7300),_=t(4450),p=t(6665);i.preparePopulationOptionsMQ=function(m,y){var k,v=m._mongooseOptions.populate,D=Object.keys(v).reduce(function(M,V){return M.concat([v[V]])},[]);y.lean!=null&&D.filter(function(M){return(M&&M.options&&M.options.lean)==null}).forEach((k=y.lean,function(M){M.options||(M.options={}),k!=null&&Array.isArray(k.virtuals)&&((k=Object.assign({},k)).virtuals=k.virtuals.filter(function(V){return typeof V=="string"&&V.startsWith(M.path+".")}).map(function(V){return V.slice(M.path.length+1)})),M.options.lean=k}));var j=m&&m.options&&m.options.session||null;j!=null&&D.forEach(function(M){M.options!=null?"session"in M.options||(M.options.session=j):M.options={session:j}});for(var S=m._fieldsForExec(),A=0;A<D.length;++A)D[A]instanceof o?D[A]=new o(w(w({},D[A]),{},{_queryProjection:S,_localModel:m.model})):(D[A]._queryProjection=S,D[A]._localModel=m.model);return D},i.createModel=function(m,y,k,v,D){m.hooks.execPreSync("createModel",y);var j=m.schema?m.schema.discriminatorMapping:null,S=j&&j.isRoot?j.key:null,A=y[S];if(S&&A&&m.discriminators){var M=m.discriminators[A]||l(m.discriminators,A);if(M){var V=_(v);return i.applyPaths(V,M.schema),new M(void 0,V,!0)}}var K={skipId:!0,isNew:!1,willInit:!0};return D!=null&&"defaults"in D&&(K.defaults=D.defaults),new m(void 0,k,K)},i.createModelAndInit=function(m,y,k,v,D,j,S){var A=j?{populated:j}:void 0,M=i.createModel(m,y,k,v,D);try{M.$init(y,A,S)}catch(V){S(V,M)}},i.applyPaths=function(m,y,k){var v,D,j=new Set;if(m){D=Object.keys(m);for(var S=[],A=0;A<D.length;++A){var M=D[A];D[A][0]==="-"&&(delete m[M],M==="-_id"?m._id=0:S.push(M.slice(1)))}D=Object.keys(m);for(var V=0;V<D.length;++V)if(D[V][0]!=="+"){var K=m[D[V]];if(d(K)&&!(D[V]==="_id"&&D.length>1)&&(!(D[V]===y.options.discriminatorKey&&D.length>1&&K!=null)||K)){v=!K;break}}for(var H=0,Q=S;H<Q.length;H++){var re=Q[H],ue=y.path(re);ue&&ue.selected&&v===!1?ue&&ue.selected&&v===!1&&j.add(re):(m[re]=0,v=!0)}}var W=[],$=[],C=[];switch(function X(de,q){if(q||(q=""),C.indexOf(de)!==-1)return[];C.push(de);var B=[];return de.eachPath(function(te,T){if(q&&(te=q+"."+te),T.$isSchemaMap||te.endsWith(".$*")){var Y=m&&"+"+te in m;T.options&&T.options.select===!1&&!Y&&$.push(te)}else{var ie=z(te,T);if(ie!=null||Array.isArray(T)||!T.$isMongooseArray||T.$isMongooseDocumentArray||(ie=z(te,T.caster)),ie!=null&&B.push(ie),T.schema){var me=X(T.schema,te);v===!1&&u(m,te,T.schema,W,me)}}}),C.pop(),B}(y),v){case!0:var J,F=c($);try{for(F.s();!(J=F.n()).done;){var I=J.value;m[I]=0}}catch(X){F.e(X)}finally{F.f()}break;case!1:y&&y.paths._id&&y.paths._id.options&&y.paths._id.options.select===!1&&(m._id=0);var N,G=c(W);try{for(G.s();!(N=G.n()).done;){var ae=N.value;j.has(ae)||p(m,ae)||(m[ae]=m[ae]||1)}}catch(X){G.e(X)}finally{G.f()}break;case void 0:if(m==null)break;for(var ce=0,Se=Object.keys(m||{});ce<Se.length;ce++){var oe=Se[ce];oe.startsWith("+")&&delete m[oe]}var Z,he=c($);try{for(he.s();!(Z=he.n()).done;){var E=Z.value;m[E]==null&&(m[E]=0)}}catch(X){he.e(X)}finally{he.f()}}function z(X,de){if(m!=null&&typeof de.selected=="boolean")if(de.selected===!1&&m[X])k&&(m[X]=0);else if(v||!de.selected||X!==y.options.discriminatorKey||m[X]==null||m[X]){if(v!==!1||!de.selected||m[X]==null||m[X]){var q="+"+X;if(m&&q in m)return delete m[q],void(v===!1&&D.length>1&&!~D.indexOf(X)&&!k?m[X]=1:v==null&&k&&de.selected===!1&&(m[X]=0));for(var B=X.split("."),te="",T=0;T<B.length;++T)if(te+=te.length?"."+B[T]:B[T],$.indexOf(te)!==-1)return;if(!v&&de&&de.options&&de.options.$skipDiscriminatorCheck)for(var Y="",ie=0;ie<B.length;++ie){Y+=(Y.length===0?"":".")+B[ie];var me=h(m,Y,!1)||h(m,Y+".$",!1);if(me&&n(me)!=="object")return}return(de.selected?W:$).push(X),X}delete m[X]}else delete m[X]}}},3900:(a,i,t)=>{"use strict";var n=t(6400),c=t(6750),b=t(3191)(),x=t(1464),w=t(2268),g=n("%Math.floor%");a.exports=function(o,u){if(typeof o!="function")throw new w("`fn` is not a function");if(typeof u!="number"||u<0||u>4294967295||g(u)!==u)throw new w("`length` must be a positive 32-bit integer");var h=arguments.length>2&&!!arguments[2],l=!0,d=!0;if("length"in o&&x){var _=x(o,"length");_&&!_.configurable&&(l=!1),_&&!_.writable&&(d=!1)}return(l||d||!h)&&(b?c(o,"length",u,!0,!0):c(o,"length",u)),o}},3916:a=>{"use strict";a.exports=function(i,t,n,c,b){var x=Object.keys(i).reduce(function(g,o){return g||o.startsWith(t+".")},!1),w=t+"."+n.options.discriminatorKey;x||b.length!==1||b[0]!==w||c.splice(c.indexOf(w),1)}},3940:(a,i,t)=>{"use strict";function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}function c(){try{var g=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!g})()}function b(g){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},b(g)}function x(g,o){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},x(g,o)}var w=function(g){function o(h){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,o),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,o,["Can't save() the same doc multiple times in parallel. Document: "+h._doc._id])}return function(h,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(l&&l.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),l&&x(h,l)}(o,g),u=o,Object.defineProperty(u,"prototype",{writable:!1}),u;var u}(t(8213));Object.defineProperty(w.prototype,"name",{value:"ParallelSaveError"}),a.exports=w},4009:(a,i,t)=>{"use strict";var n=t(8213),c=t(5188),b=t(3622),x=t(5678),w=t(7352),g=t(8768),o=/(\.\d+$|\.\d+\.)/g;a.exports=function(u,h,l,d,_){if(u==null)return[];if(typeof u=="string"&&_!=null&&c(_,u))throw new n("refPath `"+u+"` must not be excluded in projection, got "+w.inspect(_));if(o.test(l)){var p=l.split(o);if(p[p.length-1]==="")throw new Error("Can't populate individual element in an array");for(var m="",y=u,k=0;k<p.length;k+=2){var v=p[k];if(!y.startsWith(v+".")){if(k===p.length-1){m+=y,y="";break}throw new Error("Could not normalize ref path, chunk "+v+" not in populated path")}m+=y.substring(0,v.length)+p[k+1],y=y.substring(v.length+1)}var D=x.get(m,h,b),j=Array.isArray(D)?D:[D];return g.array.flatten(j)}var S=x.get(u,h,b);return d!=null&&d.virtuals.hasOwnProperty(u)?[d.virtuals[u].applyGetters(void 0,h)]:Array.isArray(S)?S:[S]}},4026:(a,i)=>{"use strict";i.Collection=function(){throw new Error("Cannot create a collection from browser library")},i.Connection=function(){throw new Error("Cannot create a connection from browser library")},i.BulkWriteResult=function(){}},4058:(a,i,t)=>{"use strict";var n=t(6353).Long,c=9223372036854775807n,b=-9223372036854775808n,x="Mongoose only supports BigInts between ".concat(b," and ").concat(c," because MongoDB does not support arbitrary precision integers");a.exports=function(w){if(w==null)return w;if(w==="")return null;if(typeof w=="bigint"){if(w>c||w<b)throw new Error(x);return w}if(w instanceof n)return w.toBigInt();if(typeof w=="string"||typeof w=="number"){if((w=BigInt(w))>c||w<b)throw new Error(x);return w}throw new Error('Cannot convert value to BigInt: "'.concat(w,'"'))}},4070:(a,i,t)=>{"use strict";function n(b,x){(x==null||x>b.length)&&(x=b.length);for(var w=0,g=Array(x);w<x;w++)g[w]=b[w];return g}var c=t(8260);a.exports=function(b){if(c(b)!=="TopologyDescription"||b.servers.size===0)return!1;var x,w=function(o,u){var h=typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(!h){if(Array.isArray(o)||(h=function(y,k){if(y){if(typeof y=="string")return n(y,k);var v={}.toString.call(y).slice(8,-1);return v==="Object"&&y.constructor&&(v=y.constructor.name),v==="Map"||v==="Set"?Array.from(y):v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v)?n(y,k):void 0}}(o))||u&&o&&typeof o.length=="number"){h&&(o=h);var l=0,d=function(){};return{s:d,n:function(){return l>=o.length?{done:!0}:{done:!1,value:o[l++]}},e:function(y){throw y},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _,p=!0,m=!1;return{s:function(){h=h.call(o)},n:function(){var y=h.next();return p=y.done,y},e:function(y){m=!0,_=y},f:function(){try{p||h.return==null||h.return()}finally{if(m)throw _}}}}(b.servers.values());try{for(w.s();!(x=w.n()).done;){var g=x.value;if(g.host.endsWith(".mongodb.net")===!1||g.port!==27017)return!1}}catch(o){w.e(o)}finally{w.f()}return!0}},4183:(a,i,t)=>{"use strict";var n=t(118);a.exports=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:n}},4224:(a,i,t)=>{"use strict";var n=t(6511).ctor("require","modify","init","default","ignore");function c(){this.activePaths=new n}a.exports=c,c.prototype.strictMode=!0,c.prototype.fullPath=void 0,c.prototype.selected=void 0,c.prototype.shardval=void 0,c.prototype.saveError=void 0,c.prototype.validationError=void 0,c.prototype.adhocPaths=void 0,c.prototype.removing=void 0,c.prototype.inserting=void 0,c.prototype.saving=void 0,c.prototype.version=void 0,c.prototype._id=void 0,c.prototype.ownerDocument=void 0,c.prototype.populate=void 0,c.prototype.populated=void 0,c.prototype.primitiveAtomics=void 0,c.prototype.wasPopulated=!1,c.prototype.scope=void 0,c.prototype.session=null,c.prototype.pathsToScopes=null,c.prototype.cachedRequired=null},4301:(a,i,t)=>{"use strict";var n=t(9539),c=t(2793),b=t(3305),x=t(5549),w=t(608);a.exports=function g(o,u,h,l){var d,_=Object.keys(u),p=0,m=_.length;if(h=h||"",!(l=l||new WeakSet).has(u)){for(l.add(u);p<m;)if(d=_[p++],(h||d!=="discriminators"&&d!=="base"&&d!=="_applyDiscriminators"&&d!=="_userProvidedOptions"&&d!=="options"&&d!=="tree")&&!(h==="tree"&&u!=null&&u.instanceOfSchema||c.has(d))){if(o[d]==null)o[d]=u[d];else if(w(u[d])){if(w(o[d])||(o[d]={}),u[d]!=null){if(u[d].$isSingleNested&&o[d].$isMongooseDocumentArray||u[d].$isMongooseDocumentArray&&o[d].$isSingleNested||u[d].$isMongooseDocumentArrayElement&&o[d].$isMongooseDocumentArrayElement)continue;if(u[d].instanceOfSchema){o[d].instanceOfSchema?n(o[d],u[d].clone(),!0):o[d]=u[d].clone();continue}if(b(u[d],"ObjectId")){o[d]=new x(u[d]);continue}}g(o[d],u[d],h?h+"."+d:d,l)}}u!=null&&u.instanceOfSchema&&(o.tree=Object.assign({},u.tree,o.tree))}}},4327:a=>{"use strict";a.exports=function(i,t,n,c){return n?c?{bsonType:t}:{bsonType:[t,"null"]}:c?{type:i}:{type:[i,"null"]}}},4432:(a,i,t)=>{"use strict";function n(l){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},n(l)}function c(l){if(l!=null){var d=l[typeof Symbol=="function"&&Symbol.iterator||"@@iterator"],_=0;if(d)return d.call(l);if(typeof l.next=="function")return l;if(!isNaN(l.length))return{next:function(){return l&&_>=l.length&&(l=void 0),{value:l&&l[_++],done:!l}}}}throw new TypeError(n(l)+" is not iterable")}function b(){var l,d,_=typeof Symbol=="function"?Symbol:{},p=_.iterator||"@@iterator",m=_.toStringTag||"@@toStringTag";function y(V,K,H,Q){var re=K&&K.prototype instanceof v?K:v,ue=Object.create(re.prototype);return x(ue,"_invoke",function(W,$,C){var J,F,I,N=0,G=C||[],ae=!1,ce={p:0,n:0,v:l,a:Se,f:Se.bind(l,4),d:function(oe,Z){return J=oe,F=0,I=l,ce.n=Z,k}};function Se(oe,Z){for(F=oe,I=Z,d=0;!ae&&N&&!he&&d<G.length;d++){var he,E=G[d],z=ce.p,X=E[2];oe>3?(he=X===Z)&&(I=E[(F=E[4])?5:(F=3,3)],E[4]=E[5]=l):E[0]<=z&&((he=oe<2&&z<E[1])?(F=0,ce.v=Z,ce.n=E[1]):z<X&&(he=oe<3||E[0]>Z||Z>X)&&(E[4]=oe,E[5]=Z,ce.n=X,F=0))}if(he||oe>1)return k;throw ae=!0,Z}return function(oe,Z,he){if(N>1)throw TypeError("Generator is already running");for(ae&&Z===1&&Se(Z,he),F=Z,I=he;(d=F<2?l:I)||!ae;){J||(F?F<3?(F>1&&(ce.n=-1),Se(F,I)):ce.n=I:ce.v=I);try{if(N=2,J){if(F||(oe="next"),d=J[oe]){if(!(d=d.call(J,I)))throw TypeError("iterator result is not an object");if(!d.done)return d;I=d.value,F<2&&(F=0)}else F===1&&(d=J.return)&&d.call(J),F<2&&(I=TypeError("The iterator does not provide a '"+oe+"' method"),F=1);J=l}else if((d=(ae=ce.n<0)?I:W.call($,ce))!==k)break}catch(E){J=l,F=1,I=E}finally{N=1}}return{value:d,done:ae}}}(V,H,Q),!0),ue}var k={};function v(){}function D(){}function j(){}d=Object.getPrototypeOf;var S=[][p]?d(d([][p]())):(x(d={},p,function(){return this}),d),A=j.prototype=v.prototype=Object.create(S);function M(V){return Object.setPrototypeOf?Object.setPrototypeOf(V,j):(V.__proto__=j,x(V,m,"GeneratorFunction")),V.prototype=Object.create(A),V}return D.prototype=j,x(A,"constructor",j),x(j,"constructor",D),D.displayName="GeneratorFunction",x(j,m,"GeneratorFunction"),x(A),x(A,m,"Generator"),x(A,p,function(){return this}),x(A,"toString",function(){return"[object Generator]"}),(b=function(){return{w:y,m:M}})()}function x(l,d,_,p){var m=Object.defineProperty;try{m({},"",{})}catch{m=0}x=function(y,k,v,D){function j(S,A){x(y,S,function(M){return this._invoke(S,A,M)})}k?m?m(y,k,{value:v,enumerable:!D,configurable:!D,writable:!D}):y[k]=v:(j("next",0),j("throw",1),j("return",2))},x(l,d,_,p)}function w(l,d){var _=typeof Symbol<"u"&&l[Symbol.iterator]||l["@@iterator"];if(!_){if(Array.isArray(l)||(_=function(D,j){if(D){if(typeof D=="string")return g(D,j);var S={}.toString.call(D).slice(8,-1);return S==="Object"&&D.constructor&&(S=D.constructor.name),S==="Map"||S==="Set"?Array.from(D):S==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(S)?g(D,j):void 0}}(l))||d&&l&&typeof l.length=="number"){_&&(l=_);var p=0,m=function(){};return{s:m,n:function(){return p>=l.length?{done:!0}:{done:!1,value:l[p++]}},e:function(D){throw D},f:m}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var y,k=!0,v=!1;return{s:function(){_=_.call(l)},n:function(){var D=_.next();return k=D.done,D},e:function(D){v=!0,y=D},f:function(){try{k||_.return==null||_.return()}finally{if(v)throw y}}}}function g(l,d){(d==null||d>l.length)&&(d=l.length);for(var _=0,p=Array(d);_<d;_++)p[_]=l[_];return p}function o(l,d,_,p,m,y,k){try{var v=l[y](k),D=v.value}catch(j){return void _(j)}v.done?d(D):Promise.resolve(D).then(p,m)}function u(l){return function(){var d=this,_=arguments;return new Promise(function(p,m){var y=l.apply(d,_);function k(D){o(y,p,m,k,v,"next",D)}function v(D){o(y,p,m,k,v,"throw",D)}k(void 0)})}}var h=t(5782);a.exports=function(l){var d=!0;l.s.hooks.pre("save",!1,function(_){if(this.$isSubdocument)_();else{var p=this,m=this.$getAllSubdocs({useCache:!0});m.length?h(m,function(y,k){y.$__schema.s.hooks.execPre("save",y,function(v){k(v)})},function(y){if(p.$__.saveOptions&&(p.$__.saveOptions.__subdocs=null),y)return p.$__schema.s.hooks.execPost("save:error",p,[p],{error:y},function(k){_(k)});_()}):_()}},null,d),l.s.hooks.post("save",function(){var _=u(b().m(function p(){var m,y,k,v,D,j;return b().w(function(S){for(;;)switch(S.p=S.n){case 0:if((m=this.$__.removedSubdocs)&&m.length){S.n=1;break}return S.a(2);case 1:y=[],k=w(m),S.p=2,D=b().m(function A(){var M;return b().w(function(V){for(;;)switch(V.n){case 0:M=v.value,y.push(new Promise(function(K,H){M.$__schema.s.hooks.execPost("deleteOne",M,[M],function(Q){if(Q)return H(Q);K()})}));case 1:return V.a(2)}},A)}),k.s();case 3:if((v=k.n()).done){S.n=5;break}return S.d(c(D()),4);case 4:S.n=3;break;case 5:S.n=7;break;case 6:S.p=6,j=S.v,k.e(j);case 7:return S.p=7,k.f(),S.f(7);case 8:return this.$__.removedSubdocs=null,S.n=9,Promise.all(y);case 9:return S.a(2)}},p,this,[[2,6,7,8]])}));return function(){return _.apply(this,arguments)}}()),l.s.hooks.post("save",function(){var _=u(b().m(function p(){var m,y,k,v,D,j,S,A,M=this;return b().w(function(V){for(;;)switch(V.p=V.n){case 0:if(!this.$isSubdocument){V.n=1;break}return V.a(2);case 1:if(m=this,(y=this.$getAllSubdocs({useCache:!0})).length){V.n=2;break}return V.a(2);case 2:k=[],v=w(y),V.p=3,j=b().m(function K(){var H;return b().w(function(Q){for(;;)switch(Q.n){case 0:H=D.value,k.push(new Promise(function(re,ue){H.$__schema.s.hooks.execPost("save",H,[H],function(W){if(W)return ue(W);re()})}));case 1:return Q.a(2)}},K)}),v.s();case 4:if((D=v.n()).done){V.n=6;break}return V.d(c(j()),5);case 5:V.n=4;break;case 6:V.n=8;break;case 7:V.p=7,S=V.v,v.e(S);case 8:return V.p=8,v.f(),V.f(8);case 9:return V.p=9,V.n=10,Promise.all(k);case 10:V.n=12;break;case 11:return V.p=11,A=V.v,V.n=12,new Promise(function(K,H){M.$__schema.s.hooks.execPost("save:error",m,[m],{error:A},function(Q){if(Q)return H(Q);K()})});case 12:return V.a(2)}},p,this,[[9,11],[3,7,8,9]])}));return function(){return _.apply(this,arguments)}}(),null,d)}},4450:(a,i,t)=>{"use strict";function n(k){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},n(k)}var c=t(9639),b=t(5549),x=t(2793),w=t(2497),g=t(9696),o=t(3305),u=t(1243).isMongooseArray,h=t(608),l=t(2789),d=t(7930),_=t(7291).trustedSymbol,p=t(6353);function m(k,v,D){if(k==null)return k;if(o(k,"Double"))return new p.Double(k.value);if(typeof k=="number"||typeof k=="string"||typeof k=="boolean"||typeof k=="bigint")return k;if(Array.isArray(k))return function(V,K){var H=0,Q=V.length,re=null;for(re=K!=null&&K.retainDocuments?V.isMongooseDocumentArray?new(V.$schemaType()).schema.base.Types.DocumentArray([],V.$path(),V.$parent(),V.$schemaType()):V.isMongooseArray?new(V.$parent()).schema.base.Types.Array([],V.$path(),V.$parent(),V.$schemaType()):new Array(Q):new Array(Q),V=u(V)?V.__array:V,H=0;H<Q;++H)re[H]=m(V[H],K,!0);return re}(k,v);if(w(k)){if(v&&v.retainDocuments&&k.$__!=null){var j=k.$clone();return k.__index!=null&&(j.__index=k.__index),k.__parentArray!=null&&(j.__parentArray=k.__parentArray),j.$__parent=k.$__parent,j}return l(k)&&k.$__!=null&&k._doc!=null?k._doc:v&&v.json&&typeof k.toJSON=="function"?k.toJSON(v):k.toObject(v)}var S,A,M=k.constructor;if(M)switch(g(M)){case"Object":return y(k,v,D);case"Date":return new M(+k);case"RegExp":return S=k,(A=new RegExp(S.source,S.flags)).lastIndex!==S.lastIndex&&(A.lastIndex=S.lastIndex),A}return o(k,"ObjectId")?v&&v.flattenObjectIds?k.toJSON():new b(k.id):o(k,"Decimal128")?v&&v.flattenDecimals?k.toJSON():c.fromString(k.toString()):!M&&h(k)?y(k,v,D):n(k)==="object"&&k[d.schemaTypeSymbol]?k.clone():v&&v.bson&&typeof k.toBSON=="function"?k:typeof k.valueOf=="function"?k.valueOf():y(k,v,D)}function y(k,v,D){var j,S=v&&v.minimize,A=v&&v.omitUndefined,M=v&&v._seen,V={};if(M&&M.has(k))return M.get(k);M&&M.set(k,V),_ in k&&v?.copyTrustedSymbol!==!1&&(V[_]=k[_]);for(var K=Object.keys(k),H=K.length,Q=0;Q<H;++Q){var re=K[Q];if(!x.has(re)){var ue=m(k[re],v,!1);S!==!1&&!A||ue!==void 0?S===!0&&ue===void 0||(j||(j=!0),V[re]=ue):delete V[re]}}return S&&!D?j&&V:V}a.exports=m},4473:a=>{"use strict";function i(t,n){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Set;if(c.has(t))throw new Error("Infinite subdocument loop: subdoc with _id "+t._id+" is a parent of itself");var b=t.$parent(),x=t.$__pathRelativeToParent(void 0,!1)+"."+n;b.$__.activePaths.clearPath(x),b.$isSubdocument&&i(b,x,c)}a.exports=function(t,n,c){var b=(c=c||{}).skipDocArrays,x=0;if(!t)return x;for(var w=0,g=Object.keys(t.$__.activePaths.getStatePaths("modify"));w<g.length;w++){var o=g[w];if(b){var u=t.$__schema.path(o);if(u&&u.$isMongooseDocumentArray)continue}o.startsWith(n+".")&&(t.$__.activePaths.clearPath(o),++x,t.$isSubdocument&&i(t,o))}return x}},4561:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}function c(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!o})()}function b(o){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},b(o)}function x(o,u){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,l){return h.__proto__=l,h},x(o,u)}var w=function(o){function u(){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,u),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,u,arguments)}return function(l,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(d&&d.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),d&&x(l,d)}(u,o),h=u,Object.defineProperty(h,"prototype",{writable:!1}),h;var h}(t(8879)),g=t(5761);Object.defineProperty(w.prototype,"excludeIndexes",g),Object.defineProperty(w.prototype,"_id",g),a.exports=w},4592:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}function c(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!o})()}function b(o){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},b(o)}function x(o,u){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,l){return h.__proto__=l,h},x(o,u)}var w=function(o){function u(){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,u),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,u,arguments)}return function(l,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(d&&d.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),d&&x(l,d)}(u,o),h=u,Object.defineProperty(h,"prototype",{writable:!1}),h;var h}(t(8879)),g=t(5761);Object.defineProperty(w.prototype,"enum",g),Object.defineProperty(w.prototype,"of",g),Object.defineProperty(w.prototype,"castNonArrays",g),a.exports=w},4625:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}function c(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!o})()}function b(o){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},b(o)}function x(o,u){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,l){return h.__proto__=l,h},x(o,u)}var w=function(o){function u(){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,u),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,u,arguments)}return function(l,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(d&&d.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),d&&x(l,d)}(u,o),h=u,Object.defineProperty(h,"prototype",{writable:!1}),h;var h}(t(8879)),g=t(5761);Object.defineProperty(w.prototype,"auto",g),Object.defineProperty(w.prototype,"populate",g),a.exports=w},4756:a=>{"use strict";var i=function(t){return t!=t};a.exports=function(t,n){return t===0&&n===0?1/t==1/n:t===n||!(!i(t)||!i(n))}},4829:(a,i,t)=>{"use strict";a.exports=t(8533)},4859:(a,i,t)=>{"use strict";var n=t(5832).hp;function c(D,j){var S=typeof Symbol<"u"&&D[Symbol.iterator]||D["@@iterator"];if(!S){if(Array.isArray(D)||(S=function(Q,re){if(Q){if(typeof Q=="string")return b(Q,re);var ue={}.toString.call(Q).slice(8,-1);return ue==="Object"&&Q.constructor&&(ue=Q.constructor.name),ue==="Map"||ue==="Set"?Array.from(Q):ue==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ue)?b(Q,re):void 0}}(D))||j&&D&&typeof D.length=="number"){S&&(D=S);var A=0,M=function(){};return{s:M,n:function(){return A>=D.length?{done:!0}:{done:!1,value:D[A++]}},e:function(Q){throw Q},f:M}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var V,K=!0,H=!1;return{s:function(){S=S.call(D)},n:function(){var Q=S.next();return K=Q.done,Q},e:function(Q){H=!0,V=Q},f:function(){try{K||S.return==null||S.return()}finally{if(H)throw V}}}}function b(D,j){(j==null||j>D.length)&&(j=D.length);for(var S=0,A=Array(j);S<j;S++)A[S]=D[S];return A}var x=t(8920),w=t(2400),g=t(863),o=t(1058),u=t(3303)._,h=t(8768),l=t(3305),d=t(7930).arrayParentSymbol,_=t(7930).arrayPathSymbol,p=t(7930).arraySchemaSymbol,m=t(7930).documentArrayParent,y=Array.prototype.toString,k={toBSON:function(){return this.toObject(u)},toString:function(){return y.call(this.__array.map(function(D){return D!=null&&D.$__!=null?D.toString():D}))},getArrayParent:function(){return this[d]},$schemaType:function(){return this[p]},_cast:function(D,j,S){if(this[p]==null)return D;var A=this[p].casterConstructor;if((A.$isMongooseDocumentArray?h.isMongooseDocumentArray(D):D instanceof A)||D&&D.constructor&&D.constructor.baseCasterConstructor===A)return D[m]&&D.__parentArray||(D[m]=this[d],D.__parentArray=this),D.$setIndex(j),D;if(D==null)return null;if((n.isBuffer(D)||l(D,"ObjectId")||!h.isObject(D))&&(D={_id:D}),D&&A.discriminators&&A.schema&&A.schema.options&&A.schema.options.discriminatorKey)if(typeof D[A.schema.options.discriminatorKey]=="string"&&A.discriminators[D[A.schema.options.discriminatorKey]])A=A.discriminators[D[A.schema.options.discriminatorKey]];else{var M=o(A.discriminators,D[A.schema.options.discriminatorKey]);M&&(A=M)}if(A.$isMongooseDocumentArray)return A.cast(D,this,void 0,void 0,j);var V=new A(D,this,S,void 0,j);return V.isNew=!0,V},id:function(D){var j,S,A;try{j=g(D).toString()}catch{j=null}var M,V=c(this);try{for(V.s();!(M=V.n()).done;){var K=M.value;if(K&&(A=K.get("_id"))!=null){if(A instanceof w){if(S||(S=String(D)),S==A._id)return K}else if(l(D,"ObjectId")||l(A,"ObjectId")){if(j==A)return K}else if(D==A||h.deepEqual(D,A))return K}}}catch(H){V.e(H)}finally{V.f()}return null},toObject:function(D){return[].concat(this.map(function(j){return j==null?null:typeof j.toObject!="function"?j:j.toObject(D)}))},$toObject:function(){return this.constructor.prototype.toObject.apply(this,arguments)},push:function(){var D=x.push.apply(this,arguments);return v(this),D},pull:function(){var D=x.pull.apply(this,arguments);return v(this),D},shift:function(){var D=x.shift.apply(this,arguments);return v(this),D},splice:function(){var D=x.splice.apply(this,arguments);return v(this),D},inspect:function(){return this.toObject()},create:function(D){var j=this[p].casterConstructor;if(D&&j.discriminators&&j.schema&&j.schema.options&&j.schema.options.discriminatorKey)if(typeof D[j.schema.options.discriminatorKey]=="string"&&j.discriminators[D[j.schema.options.discriminatorKey]])j=j.discriminators[D[j.schema.options.discriminatorKey]];else{var S=o(j.discriminators,D[j.schema.options.discriminatorKey]);S&&(j=S)}return new j(D,this)},notify:function(D){var j=this;return function S(A,M){for(var V=(M=M||j).length;V--;)M[V]!=null&&(D==="save"&&(A=j[V]),h.isMongooseArray(M[V])?S(A,M[V]):M[V]&&M[V].emit(D,A))}},set:function(D,j,S){var A=this.__array;if(S)return A[D]=j,this;var M=k._cast.call(this,j,D);return k._markModified.call(this,D),A[D]=M,this},_markModified:function(D,j){var S,A=this[d];if(A){if(S=this[_],arguments.length&&(S=j!=null?S+"."+D.__index+"."+j:S+"."+D),S!=null&&S.endsWith(".$"))return this;A.markModified(S,arguments.length!==0?D:A)}return this}};function v(D){var j=D[d];if(j&&j.$__.populated!=null){var S,A=c(Object.keys(j.$__.populated).filter(function(V){return V.startsWith(D[_]+".")}));try{var M=function(){var V=S.value,K=V.slice((D[_]+".").length);if(!Array.isArray(j.$__.populated[V].value))return 1;j.$__.populated[V].value=D.map(function(H){return H.$populated(K)})};for(A.s();!(S=A.n()).done;)M()}catch(V){A.e(V)}finally{A.f()}}}a.exports=k},4878:(a,i,t)=>{"use strict";function n(_){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},n(_)}function c(_,p,m){return(p=function(y){var k=function(v){if(n(v)!="object"||!v)return v;var D=v[Symbol.toPrimitive];if(D!==void 0){var j=D.call(v,"string");if(n(j)!="object")return j;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(v)}(y);return n(k)=="symbol"?k:k+""}(p))in _?Object.defineProperty(_,p,{value:m,enumerable:!0,configurable:!0,writable:!0}):_[p]=m,_}var b=t(8920),x=t(4859),w=t(7930).arrayAtomicsSymbol,g=t(7930).arrayAtomicsBackupSymbol,o=t(7930).arrayParentSymbol,u=t(7930).arrayPathSymbol,h=t(7930).arraySchemaSymbol,l=Array.prototype.push,d=/^\d+$/;a.exports=function(_,p,m,y){var k=[],v=c(c(c(c(c({},w,{}),g,void 0),u,p),h,void 0),o,void 0);if(Array.isArray(_)&&(_[u]===p&&_[o]===m&&(v[w]=Object.assign({},_[w])),_.forEach(function(j){l.call(k,j)})),v[u]=p,v.__array=k,m&&m.$__)for(v[o]=m,v[h]=m.$__schema.path(p);v[h]!=null&&v[h].$isMongooseArray&&!v[h].$isMongooseDocumentArray;)v[h]=v[h].casterConstructor;var D=new Proxy(k,{get:function(j,S){return S==="isMongooseArray"||S==="isMongooseArrayProxy"||S==="isMongooseDocumentArray"||S==="isMongooseDocumentArrayProxy"||(v.hasOwnProperty(S)?v[S]:x.hasOwnProperty(S)?x[S]:y&&y.virtuals&&y.virtuals.hasOwnProperty(S)?y.virtuals[S].applyGetters(void 0,j):b.hasOwnProperty(S)?b[S]:k[S])},set:function(j,S,A){return typeof S=="string"&&d.test(S)?x.set.call(D,S,A,!1):v.hasOwnProperty(S)?v[S]=A:y&&y.virtuals&&y.virtuals.hasOwnProperty(S)?y.virtuals[S].applySetters(A,j):k[S]=A,!0}});return D}},4957:(a,i,t)=>{"use strict";function n(h){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},n(h)}function c(h,l){var d=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);l&&(_=_.filter(function(p){return Object.getOwnPropertyDescriptor(h,p).enumerable})),d.push.apply(d,_)}return d}function b(h){for(var l=1;l<arguments.length;l++){var d=arguments[l]!=null?arguments[l]:{};l%2?c(Object(d),!0).forEach(function(_){x(h,_,d[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(d)):c(Object(d)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(d,_))})}return h}function x(h,l,d){return(l=function(_){var p=function(m){if(n(m)!="object"||!m)return m;var y=m[Symbol.toPrimitive];if(y!==void 0){var k=y.call(m,"string");if(n(k)!="object")return k;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(m)}(_);return n(p)=="symbol"?p:p+""}(l))in h?Object.defineProperty(h,l,{value:d,enumerable:!0,configurable:!0,writable:!0}):h[l]=d,h}var w=t(7160),g=t(5268);a.exports=u,u.middlewareFunctions=["deleteOne","save","validate","remove","updateOne","init"];var o=new Set(u.middlewareFunctions.flatMap(function(h){return[h,"$__".concat(h)]}));function u(h,l,d){var _={useErrorHandlers:!0,numCallbackParams:1,nullResultByDefault:!0,contextParameter:!0},p=(d=d||{}).decorateDoc?h:h.prototype;h.$appliedHooks=!0;for(var m=0,y=Object.keys(l.paths);m<y.length;m++){var k=y[m],v=l.paths[k],D=null;if(v.$isSingleNested)D=v.caster;else{if(!v.$isMongooseDocumentArray)continue;D=v.Constructor}if(!D.$appliedHooks&&(u(D,v.schema,b(b({},d),{},{isChildSchema:!0})),D.discriminators!=null))for(var j=0,S=Object.keys(D.discriminators);j<S.length;j++){var A=S[j];u(D.discriminators[A],D.discriminators[A].schema,d)}}var M=l.s.hooks.filter(function(F){return F.name==="updateOne"||F.name==="deleteOne"?!!F.document:F.name==="remove"||F.name==="init"?F.document==null||!!F.document:F.query==null&&F.document==null||F.document!==!1}).filter(function(F){return!l.methods[F.name]||!F.fn[w.builtInMiddleware]});h._middleware=M,p.$__originalValidate=p.$__originalValidate||p.$__validate;for(var V=0,K=d&&d.isChildSchema?["save","validate","deleteOne"]:["save","validate"];V<K.length;V++){var H=K[V],Q=H==="validate"?"$__originalValidate":"$__".concat(H),re=M.createWrapper(H,p[Q],null,_);p["$__".concat(H)]=re}p.$__init=M.createWrapperSync("init",p.$__init,null,_);for(var ue=Object.keys(l.methods),W=Object.assign({},_,{checkForPromise:!0}),$=function(){var F=J[C];if(o.has(F)||!M.hasHooks(F))return 0;var I=p[F];p[F]=function(){var N=this,G=Array.prototype.slice.call(arguments),ae=G.slice(-1).pop(),ce=typeof ae=="function"?G.slice(0,G.length-1):G;return g(ae,function(Se){return N["$__".concat(F)].apply(N,ce.concat([Se]))},h.events)},p["$__".concat(F)]=M.createWrapper(F,I,null,W)},C=0,J=ue;C<J.length;C++)$()}},5022:(a,i,t)=>{"use strict";var n=t(6426),c=t(7160),b=t(608),x=t(8768);function w(g,o){if(o&&o.default){var u=o.default;Array.isArray(u)&&u.length===0?o.default=Array:!o.shared&&b(u)&&Object.keys(u).length===0&&(o.default=function(){return{}})}n.call(this,g,o,"Mixed"),this[c.schemaMixedSymbol]=!0}w.schemaName="Mixed",w.defaultOptions={},w.prototype=Object.create(n.prototype),w.prototype.constructor=w,w.get=n.get,w.set=n.set,w.setters=[],w.prototype.cast=function(g){return g instanceof Error?x.errorToPOJO(g):g},w.prototype.castForQuery=function(g,o){return o},w.prototype.toJSONSchema=function(g){return{}},a.exports=w},5098:(a,i,t)=>{"use strict";function n(Q){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(re){return typeof re}:function(re){return re&&typeof Symbol=="function"&&re.constructor===Symbol&&re!==Symbol.prototype?"symbol":typeof re},n(Q)}function c(Q,re){var ue=Object.keys(Q);if(Object.getOwnPropertySymbols){var W=Object.getOwnPropertySymbols(Q);re&&(W=W.filter(function($){return Object.getOwnPropertyDescriptor(Q,$).enumerable})),ue.push.apply(ue,W)}return ue}function b(Q){for(var re=1;re<arguments.length;re++){var ue=arguments[re]!=null?arguments[re]:{};re%2?c(Object(ue),!0).forEach(function(W){x(Q,W,ue[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(ue)):c(Object(ue)).forEach(function(W){Object.defineProperty(Q,W,Object.getOwnPropertyDescriptor(ue,W))})}return Q}function x(Q,re,ue){return(re=function(W){var $=function(C){if(n(C)!="object"||!C)return C;var J=C[Symbol.toPrimitive];if(J!==void 0){var F=J.call(C,"string");if(n(F)!="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(C)}(W);return n($)=="symbol"?$:$+""}(re))in Q?Object.defineProperty(Q,re,{value:ue,enumerable:!0,configurable:!0,writable:!0}):Q[re]=ue,Q}var w,g=t(3609),o=t(3550).EventEmitter,u=t(3441),h=t(7494),l=t(6426),d=t(5335),_=t(8499),p=t(5558).G,m=t(4327),y=t(1469),k=t(9604),v=t(7910),D=t(1313),j=t(3303)._,S=t(1793),A=t(8768),M=t(5537);function V(Q,re,ue){if(Q.options.timeseries)throw new M(re,"timeseries");var W=V.defaultOptions&&V.defaultOptions._id;W!=null&&((ue=ue||{})._id=W),Q=D(Q,ue),this.caster=K(Q,null,ue),this.caster.path=re,this.caster.prototype.$basePath=re,this.schema=Q,this.$isSingleNested=!0,this.base=Q.base,l.call(this,re,ue,"Embedded")}function K(Q,re,ue){w||(w=t(9380));var W=function(I,N,G){this.$__parent=G,w.apply(this,arguments),G!=null&&this.$session(G.$session())};Q._preCompile();var $=re!=null?re.prototype:w.prototype;for(var C in(W.prototype=Object.create($)).$__setSchema(Q),W.prototype.constructor=W,W.prototype.$__schemaTypeOptions=ue,W.$__required=ue?.required,W.base=Q.base,W.schema=Q,W.$isSingleNested=!0,W.events=new o,W.prototype.toBSON=function(){return this.toObject(j)},Q.methods)W.prototype[C]=Q.methods[C];for(var J in Q.statics)W[J]=Q.statics[J];for(var F in o.prototype)W[F]=o.prototype[F];return W}a.exports=V,V.prototype=Object.create(l.prototype),V.prototype.constructor=V,V.prototype.OptionsConstructor=h;var H=b({},l.prototype.$conditionalHandlers);H.$geoWithin=function(Q,re){return{$geometry:this.castForQuery(null,Q.$geometry,re)}},H.$near=H.$nearSphere=k.cast$near,H.$within=H.$geoWithin=k.cast$within,H.$geoIntersects=k.cast$geoIntersects,H.$minDistance=p,H.$maxDistance=p,H.$exists=_,Object.defineProperty(V.prototype,"$conditionalHandlers",{enumerable:!1,value:H}),V.prototype.cast=function(Q,re,ue,W,$){if(Q&&Q.$isSingleNested&&Q.parent===re)return Q;if(Q!=null&&(n(Q)!=="object"||Array.isArray(Q)))throw new u(this.path,Q);var C,J=this.schema.path(this.schema.options.discriminatorKey),F=J==null?null:J.getDefault(re),I=v(this.caster,Q,F),N=re&&re.$__&&re.$__.selected,G=this.path,ae=N==null?null:Object.keys(N).reduce(function(Se,oe){return oe.startsWith(G+".")&&((Se=Se||{})[oe.substring(G.length+1)]=N[oe]),Se},null);if(!ue)return $=Object.assign({},$,{priorDoc:W}),Object.keys(Q).length===0?new I({},ae,re,void 0,$):new I(Q,ae,re,void 0,$);delete(C=new I(void 0,ae,re,!1,{defaults:!1})).$__.defaults,$.path!=null&&delete($=b({},$)).path,C.$init(Q,$);var ce=S(ae);return d(C,ae,ce),C},V.prototype.castForQuery=function(Q,re,ue,W){var $;if(Q!=null){if(!($=this.$conditionalHandlers[Q]))throw new Error("Can't use "+Q);return $.call(this,re)}if(re==null)return re;var C=v(this.caster,re);if(re instanceof C)return re;this.options.runSetters&&(re=this._applySetters(re,ue));var J=W!=null&&W.strict!=null?W.strict:void 0;try{re=new C(re,J)}catch(F){throw F instanceof g?F:new g("Embedded",re,this.path,F,this)}return re},V.prototype.doValidate=function(Q,re,ue,W){var $=v(this.caster,Q);if(!Q||Q instanceof $||(Q=new $(Q,null,ue!=null&&ue.$__!=null?ue:null)),W&&W.skipSchemaValidators)return Q?Q.validate().then(function(){return re(null)},function(C){return re(C)}):re(null);l.prototype.doValidate.call(this,Q,function(C){return C?re(C):Q?void Q.validate().then(function(){return re(null)},function(J){return re(J)}):re(null)},ue,W)},V.prototype.doValidateSync=function(Q,re,ue){if(!ue||!ue.skipSchemaValidators){var W=l.prototype.doValidateSync.call(this,Q,re);if(W)return W}if(Q)return Q.validateSync()},V.prototype.discriminator=function(Q,re,ue){ue=ue||{};var W=A.isPOJO(ue)?ue.value:ue,$=typeof ue.clone!="boolean"||ue.clone;return re.instanceOfSchema&&$&&(re=re.clone()),re=y(this.caster,Q,re,W,null,null,ue.overwriteExisting),this.caster.discriminators[Q]=K(re,this.caster),this.caster.discriminators[Q]},V.defaultOptions={},V.set=l.set,V.setters=[],V.get=l.get,V.prototype.toJSON=function(){return{path:this.path,options:this.options}},V.prototype.clone=function(){var Q=new this.constructor(this.schema,this.path,b(b({},this.options),{},{_skipApplyDiscriminators:!0}));return Q.validators=this.validators.slice(),this.requiredValidator!==void 0&&(Q.requiredValidator=this.requiredValidator),Q.caster.discriminators=Object.assign({},this.caster.discriminators),Q._appliedDiscriminators=this._appliedDiscriminators,Q},V.prototype.toJSONSchema=function(Q){var re=this.options.required&&typeof this.options.required!="function";return b(b({},this.schema.toJSONSchema(Q)),m("object","object",Q?.useBsonType,re))}},5110:a=>{"use strict";var i=new Set(["$ref","$id","$db"]);a.exports=function(t){return t[0]==="$"&&!i.has(t)}},5152:(a,i,t)=>{"use strict";var n=t(3703),c=t(7425);a.exports=function b(x,w,g){for(var o=(g=g||{}).typeOnly,u=Array.isArray(w)?w:w.indexOf(".")===-1?[w]:w.split("."),h=null,l="adhocOrUndefined",d=c(x.schema,x.get(x.schema.options.discriminatorKey))||x.schema,_=0;_<u.length;++_){var p=u.slice(0,_+1).join(".");if((h=d.path(p))!=null){if(h.instance==="Mixed")return o?"real":h;if(l=d.pathType(p),(h.$isSingleNested||h.$isMongooseDocumentArrayElement)&&h.schema.discriminators!=null){var m=h.schema.discriminators,y=x.get(p+"."+n(h,"schema.options.discriminatorKey"));if(y==null||m[y]==null)continue;var k=u.slice(_+1).join(".");return b(x.get(p),k,g)}}else l="adhocOrUndefined"}return o?l:h}},5188:(a,i,t)=>{"use strict";var n=t(7300);a.exports=function(c,b){if(c==null)return!1;if(b==="_id")return c._id===0;for(var x=null,w=0,g=Object.keys(c);w<g.length;w++){var o=g[w];if(n(c[o])){x=c[b]===1?"inclusive":"exclusive";break}}return x==="inclusive"?c[b]!==1:x==="exclusive"&&c[b]===0}},5268:(a,i,t)=>{"use strict";var n=t(2746),c=Symbol("mongoose#emitted");a.exports=function(b,x,w,g){if(typeof b=="function")try{return x(function(o){if(o==null)b.apply(this,arguments);else{w!=null&&w.listeners!=null&&w.listeners("error").length>0&&!o[c]&&(o[c]=!0,w.emit("error",o));try{b(o)}catch(u){return n(function(){throw u})}}})}catch(o){return w!=null&&w.listeners!=null&&w.listeners("error").length>0&&!o[c]&&(o[c]=!0,w.emit("error",o)),b(o)}return new(g=g||t.g.Promise)(function(o,u){x(function(h,l){return h!=null?(w!=null&&w.listeners!=null&&w.listeners("error").length>0&&!h[c]&&(h[c]=!0,w.emit("error",h)),u(h)):arguments.length>2?o(Array.prototype.slice.call(arguments,1)):void o(l)})})}},5289:a=>{"use strict";a.exports=function(i){switch(i){case"p":i="primary";break;case"pp":i="primaryPreferred";break;case"s":i="secondary";break;case"sp":i="secondaryPreferred";break;case"n":i="nearest"}return i}},5335:(a,i,t)=>{"use strict";var n=t(1091);function c(b,x,w){b.$__.activePaths.default(x),!w&&b.$isSubdocument&&b.$isSingleNested&&b.$parent()!=null&&b.$parent().$__.activePaths.default(b.$__pathRelativeToParent(x))}a.exports=function(b,x,w,g,o,u,h){for(var l=Object.keys(b.$__schema.paths),d=l.length,_=h&&h.skipParentChangeTracking,p=0;p<d;++p){var m=void 0,y="",k=l[p];if(k!=="_id"||!b.$__.skipId){var v=b.$__schema.paths[k],D=v.splitPath(),j=D.length;if(D[j-1]!=="$*")for(var S=!1,A=b._doc,M=0;M<j&&A!=null;++M){var V=D[M];if(y+=(y.length?".":"")+V,w===!0){if(y in x)break}else if(w===!1&&x&&!S){var K=v.$isSingleNested||v.$isMongooseDocumentArray;if(y in x&&!n(x[y])||M===j-1&&K&&g!=null&&g[y])S=!0;else if(g!=null&&!g[y])break}if(M===j-1){if(A[V]!==void 0)break;if(o!=null){if(typeof v.defaultValue=="function"){if(!v.defaultValue.$runBeforeSetters&&o||v.defaultValue.$runBeforeSetters&&!o)break}else if(!o)continue}if(u&&u[y])break;if(x&&w!==null){if(w===!0){if(k in x)continue;try{m=v.getDefault(b,!1)}catch(H){b.invalidate(k,H);break}m!==void 0&&(A[V]=m,c(b,k,_))}else if(S){try{m=v.getDefault(b,!1)}catch(H){b.invalidate(k,H);break}m!==void 0&&(A[V]=m,c(b,k,_))}}else{try{m=v.getDefault(b,!1)}catch(H){b.invalidate(k,H);break}m!==void 0&&(A[V]=m,c(b,k,_))}}else A=A[V]}}}}},5346:a=>{"use strict";a.exports=function(i,t,n){for(var c=t[0],b=n,x=i,w=0;w<t.length-1;++w){var g=b.path(c);if(g&&g.schema){var o=x.get(c);if(b=g.schema,c=t[w+1],Array.isArray(o)&&!isNaN(c)&&(o=o[c],c=""),o==null)break;x=o}else c+=c.length?"."+t[w+1]:t[w+1]}return x}},5413:(a,i,t)=>{"use strict";var n=t(3305),c=t(2402);a.exports=function(b){if(b==null)return b;if(b==="")return null;var x=n(b,"Long")?b.toNumber():Number(b);if(x===(0|x)&&x>=-2147483648&&x<=2147483647)return x;c.ok(!1)}},5477:(a,i,t)=>{"use strict";var n=t(2354),c=t(3279),b=t(3123),x=t(3388);a.exports=x||n.call(b,c)},5484:a=>{"use strict";function i(t){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i(t)}a.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(i(Symbol.iterator)==="symbol")return!0;var t={},n=Symbol("test"),c=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(c)!=="[object Symbol]")return!1;for(var b in t[n]=42,t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var x=Object.getOwnPropertySymbols(t);if(x.length!==1||x[0]!==n||!Object.prototype.propertyIsEnumerable.call(t,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var w=Object.getOwnPropertyDescriptor(t,n);if(w.value!==42||w.enumerable!==!0)return!1}return!0}},5497:(a,i,t)=>{"use strict";var n=t(8260);a.exports=function(c){if(n(c)!=="TopologyDescription")return!1;var b=Array.from(c.servers.values());return b.length>0&&b.every(function(x){return x.error&&x.error.message.indexOf("Client network socket disconnected before secure TLS connection was established")!==-1})}},5510:(a,i,t)=>{"use strict";function n(x){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},n(x)}var c=typeof Symbol<"u"&&Symbol,b=t(5484);a.exports=function(){return typeof c=="function"&&typeof Symbol=="function"&&n(c("foo"))==="symbol"&&n(Symbol("bar"))==="symbol"&&b()}},5537:(a,i,t)=>{"use strict";function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}function c(){try{var g=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!g})()}function b(g){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},b(g)}function x(g,o){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},x(g,o)}var w=function(g){function o(h,l){return function(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}(this,o),function(d,_,p){return _=b(_),function(m,y){if(y&&(n(y)=="object"||typeof y=="function"))return y;if(y!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(k){if(k===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return k}(m)}(d,c()?Reflect.construct(_,p||[],b(d).constructor):_.apply(d,p))}(this,o,['Cannot create use schema for property "'.concat(h,'" because the schema has the ').concat(l," option enabled.")])}return function(h,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(l&&l.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),l&&x(h,l)}(o,g),u=o,Object.defineProperty(u,"prototype",{writable:!1}),u;var u}(t(8213));Object.defineProperty(w.prototype,"name",{value:"InvalidSchemaOptionError"}),a.exports=w},5549:(a,i,t)=>{"use strict";var n=t(6353).ObjectId,c=t(7930).objectIdSymbol;Object.defineProperty(n.prototype,"_id",{enumerable:!1,configurable:!0,get:function(){return this}}),n.prototype.hasOwnProperty("valueOf")||(n.prototype.valueOf=function(){return this.toString()}),n.prototype[c]=!0,a.exports=n},5558:(a,i,t)=>{"use strict";var n=t(3660);function c(b){return n.cast()(b)}i.G=c,i.p=function b(x,w){x.forEach(function(g,o){Array.isArray(g)?b(g,w):x[o]=c.call(w,g)})}},5678:(a,i,t)=>{"use strict";a.exports=t(2914)},5761:a=>{"use strict";a.exports=Object.freeze({enumerable:!0,configurable:!0,writable:!0,value:void 0})},5782:a=>{"use strict";function i(t,n){(n==null||n>t.length)&&(n=t.length);for(var c=0,b=Array(n);c<n;c++)b[c]=t[c];return b}a.exports=function(t,n,c){if(t.length===0)return c();var b,x=t.length,w=null,g=function(o,u){var h=typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(!h){if(Array.isArray(o)||(h=function(y,k){if(y){if(typeof y=="string")return i(y,k);var v={}.toString.call(y).slice(8,-1);return v==="Object"&&y.constructor&&(v=y.constructor.name),v==="Map"||v==="Set"?Array.from(y):v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v)?i(y,k):void 0}}(o))||u&&o&&typeof o.length=="number"){h&&(o=h);var l=0,d=function(){};return{s:d,n:function(){return l>=o.length?{done:!0}:{done:!1,value:o[l++]}},e:function(y){throw y},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _,p=!0,m=!1;return{s:function(){h=h.call(o)},n:function(){var y=h.next();return p=y.done,y},e:function(y){m=!0,_=y},f:function(){try{p||h.return==null||h.return()}finally{if(m)throw _}}}}(t);try{for(g.s();!(b=g.n()).done;)n(b.value,function(o){if(w==null)return o!=null?c(w=o):--x<=0?c():void 0})}catch(o){g.e(o)}finally{g.f()}}},5804:(a,i,t)=>{"use strict";var n=t(2354),c=t(3279),b=t(5477);a.exports=function(){return b(n,c,arguments)}},5807:a=>{"use strict";a.exports=Object.getOwnPropertyDescriptor},5825:(a,i,t)=>{"use strict";var n=t(8093);a.exports=n.getPrototypeOf||null},5832:(a,i,t)=>{"use strict";function n(E){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(z){return typeof z}:function(z){return z&&typeof Symbol=="function"&&z.constructor===Symbol&&z!==Symbol.prototype?"symbol":typeof z},n(E)}var c=t(6775),b=t(2486),x=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;i.hp=o,i.IS=50;var w=2147483647;function g(E){if(E>w)throw new RangeError('The value "'+E+'" is invalid for option "size"');var z=new Uint8Array(E);return Object.setPrototypeOf(z,o.prototype),z}function o(E,z,X){if(typeof E=="number"){if(typeof z=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return l(E)}return u(E,z,X)}function u(E,z,X){if(typeof E=="string")return function(B,te){if(typeof te=="string"&&te!==""||(te="utf8"),!o.isEncoding(te))throw new TypeError("Unknown encoding: "+te);var T=0|m(B,te),Y=g(T),ie=Y.write(B,te);return ie!==T&&(Y=Y.slice(0,ie)),Y}(E,z);if(ArrayBuffer.isView(E))return function(B){if(oe(B,Uint8Array)){var te=new Uint8Array(B);return _(te.buffer,te.byteOffset,te.byteLength)}return d(B)}(E);if(E==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+n(E));if(oe(E,ArrayBuffer)||E&&oe(E.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(oe(E,SharedArrayBuffer)||E&&oe(E.buffer,SharedArrayBuffer)))return _(E,z,X);if(typeof E=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var de=E.valueOf&&E.valueOf();if(de!=null&&de!==E)return o.from(de,z,X);var q=function(B){if(o.isBuffer(B)){var te=0|p(B.length),T=g(te);return T.length===0||B.copy(T,0,0,te),T}return B.length!==void 0?typeof B.length!="number"||Z(B.length)?g(0):d(B):B.type==="Buffer"&&Array.isArray(B.data)?d(B.data):void 0}(E);if(q)return q;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof E[Symbol.toPrimitive]=="function")return o.from(E[Symbol.toPrimitive]("string"),z,X);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+n(E))}function h(E){if(typeof E!="number")throw new TypeError('"size" argument must be of type number');if(E<0)throw new RangeError('The value "'+E+'" is invalid for option "size"')}function l(E){return h(E),g(E<0?0:0|p(E))}function d(E){for(var z=E.length<0?0:0|p(E.length),X=g(z),de=0;de<z;de+=1)X[de]=255&E[de];return X}function _(E,z,X){if(z<0||E.byteLength<z)throw new RangeError('"offset" is outside of buffer bounds');if(E.byteLength<z+(X||0))throw new RangeError('"length" is outside of buffer bounds');var de;return de=z===void 0&&X===void 0?new Uint8Array(E):X===void 0?new Uint8Array(E,z):new Uint8Array(E,z,X),Object.setPrototypeOf(de,o.prototype),de}function p(E){if(E>=w)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+w.toString(16)+" bytes");return 0|E}function m(E,z){if(o.isBuffer(E))return E.length;if(ArrayBuffer.isView(E)||oe(E,ArrayBuffer))return E.byteLength;if(typeof E!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+n(E));var X=E.length,de=arguments.length>2&&arguments[2]===!0;if(!de&&X===0)return 0;for(var q=!1;;)switch(z){case"ascii":case"latin1":case"binary":return X;case"utf8":case"utf-8":return ae(E).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*X;case"hex":return X>>>1;case"base64":return ce(E).length;default:if(q)return de?-1:ae(E).length;z=(""+z).toLowerCase(),q=!0}}function y(E,z,X){var de=!1;if((z===void 0||z<0)&&(z=0),z>this.length||((X===void 0||X>this.length)&&(X=this.length),X<=0)||(X>>>=0)<=(z>>>=0))return"";for(E||(E="utf8");;)switch(E){case"hex":return W(this,z,X);case"utf8":case"utf-8":return H(this,z,X);case"ascii":return re(this,z,X);case"latin1":case"binary":return ue(this,z,X);case"base64":return K(this,z,X);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,z,X);default:if(de)throw new TypeError("Unknown encoding: "+E);E=(E+"").toLowerCase(),de=!0}}function k(E,z,X){var de=E[z];E[z]=E[X],E[X]=de}function v(E,z,X,de,q){if(E.length===0)return-1;if(typeof X=="string"?(de=X,X=0):X>2147483647?X=2147483647:X<-2147483648&&(X=-2147483648),Z(X=+X)&&(X=q?0:E.length-1),X<0&&(X=E.length+X),X>=E.length){if(q)return-1;X=E.length-1}else if(X<0){if(!q)return-1;X=0}if(typeof z=="string"&&(z=o.from(z,de)),o.isBuffer(z))return z.length===0?-1:D(E,z,X,de,q);if(typeof z=="number")return z&=255,typeof Uint8Array.prototype.indexOf=="function"?q?Uint8Array.prototype.indexOf.call(E,z,X):Uint8Array.prototype.lastIndexOf.call(E,z,X):D(E,[z],X,de,q);throw new TypeError("val must be string, number or Buffer")}function D(E,z,X,de,q){var B,te=1,T=E.length,Y=z.length;if(de!==void 0&&((de=String(de).toLowerCase())==="ucs2"||de==="ucs-2"||de==="utf16le"||de==="utf-16le")){if(E.length<2||z.length<2)return-1;te=2,T/=2,Y/=2,X/=2}function ie(Re,Ie){return te===1?Re[Ie]:Re.readUInt16BE(Ie*te)}if(q){var me=-1;for(B=X;B<T;B++)if(ie(E,B)===ie(z,me===-1?0:B-me)){if(me===-1&&(me=B),B-me+1===Y)return me*te}else me!==-1&&(B-=B-me),me=-1}else for(X+Y>T&&(X=T-Y),B=X;B>=0;B--){for(var ne=!0,ye=0;ye<Y;ye++)if(ie(E,B+ye)!==ie(z,ye)){ne=!1;break}if(ne)return B}return-1}function j(E,z,X,de){X=Number(X)||0;var q=E.length-X;de?(de=Number(de))>q&&(de=q):de=q;var B=z.length;de>B/2&&(de=B/2);for(var te=0;te<de;++te){var T=parseInt(z.substr(2*te,2),16);if(Z(T))return te;E[X+te]=T}return te}function S(E,z,X,de){return Se(ae(z,E.length-X),E,X,de)}function A(E,z,X,de){return Se(function(q){for(var B=[],te=0;te<q.length;++te)B.push(255&q.charCodeAt(te));return B}(z),E,X,de)}function M(E,z,X,de){return Se(ce(z),E,X,de)}function V(E,z,X,de){return Se(function(q,B){for(var te,T,Y,ie=[],me=0;me<q.length&&!((B-=2)<0);++me)T=(te=q.charCodeAt(me))>>8,Y=te%256,ie.push(Y),ie.push(T);return ie}(z,E.length-X),E,X,de)}function K(E,z,X){return z===0&&X===E.length?c.fromByteArray(E):c.fromByteArray(E.slice(z,X))}function H(E,z,X){X=Math.min(E.length,X);for(var de=[],q=z;q<X;){var B,te,T,Y,ie=E[q],me=null,ne=ie>239?4:ie>223?3:ie>191?2:1;if(q+ne<=X)switch(ne){case 1:ie<128&&(me=ie);break;case 2:(192&(B=E[q+1]))==128&&(Y=(31&ie)<<6|63&B)>127&&(me=Y);break;case 3:B=E[q+1],te=E[q+2],(192&B)==128&&(192&te)==128&&(Y=(15&ie)<<12|(63&B)<<6|63&te)>2047&&(Y<55296||Y>57343)&&(me=Y);break;case 4:B=E[q+1],te=E[q+2],T=E[q+3],(192&B)==128&&(192&te)==128&&(192&T)==128&&(Y=(15&ie)<<18|(63&B)<<12|(63&te)<<6|63&T)>65535&&Y<1114112&&(me=Y)}me===null?(me=65533,ne=1):me>65535&&(me-=65536,de.push(me>>>10&1023|55296),me=56320|1023&me),de.push(me),q+=ne}return function(ye){var Re=ye.length;if(Re<=Q)return String.fromCharCode.apply(String,ye);for(var Ie="",je=0;je<Re;)Ie+=String.fromCharCode.apply(String,ye.slice(je,je+=Q));return Ie}(de)}o.TYPED_ARRAY_SUPPORT=function(){try{var E=new Uint8Array(1),z={foo:function(){return 42}};return Object.setPrototypeOf(z,Uint8Array.prototype),Object.setPrototypeOf(E,z),E.foo()===42}catch{return!1}}(),o.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(E,z,X){return u(E,z,X)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(E,z,X){return function(de,q,B){return h(de),de<=0?g(de):q!==void 0?typeof B=="string"?g(de).fill(q,B):g(de).fill(q):g(de)}(E,z,X)},o.allocUnsafe=function(E){return l(E)},o.allocUnsafeSlow=function(E){return l(E)},o.isBuffer=function(E){return E!=null&&E._isBuffer===!0&&E!==o.prototype},o.compare=function(E,z){if(oe(E,Uint8Array)&&(E=o.from(E,E.offset,E.byteLength)),oe(z,Uint8Array)&&(z=o.from(z,z.offset,z.byteLength)),!o.isBuffer(E)||!o.isBuffer(z))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(E===z)return 0;for(var X=E.length,de=z.length,q=0,B=Math.min(X,de);q<B;++q)if(E[q]!==z[q]){X=E[q],de=z[q];break}return X<de?-1:de<X?1:0},o.isEncoding=function(E){switch(String(E).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(E,z){if(!Array.isArray(E))throw new TypeError('"list" argument must be an Array of Buffers');if(E.length===0)return o.alloc(0);var X;if(z===void 0)for(z=0,X=0;X<E.length;++X)z+=E[X].length;var de=o.allocUnsafe(z),q=0;for(X=0;X<E.length;++X){var B=E[X];if(oe(B,Uint8Array))q+B.length>de.length?o.from(B).copy(de,q):Uint8Array.prototype.set.call(de,B,q);else{if(!o.isBuffer(B))throw new TypeError('"list" argument must be an Array of Buffers');B.copy(de,q)}q+=B.length}return de},o.byteLength=m,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var E=this.length;if(E%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var z=0;z<E;z+=2)k(this,z,z+1);return this},o.prototype.swap32=function(){var E=this.length;if(E%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var z=0;z<E;z+=4)k(this,z,z+3),k(this,z+1,z+2);return this},o.prototype.swap64=function(){var E=this.length;if(E%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var z=0;z<E;z+=8)k(this,z,z+7),k(this,z+1,z+6),k(this,z+2,z+5),k(this,z+3,z+4);return this},o.prototype.toString=function(){var E=this.length;return E===0?"":arguments.length===0?H(this,0,E):y.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(E){if(!o.isBuffer(E))throw new TypeError("Argument must be a Buffer");return this===E||o.compare(this,E)===0},o.prototype.inspect=function(){var E="",z=i.IS;return E=this.toString("hex",0,z).replace(/(.{2})/g,"$1 ").trim(),this.length>z&&(E+=" ... "),"<Buffer "+E+">"},x&&(o.prototype[x]=o.prototype.inspect),o.prototype.compare=function(E,z,X,de,q){if(oe(E,Uint8Array)&&(E=o.from(E,E.offset,E.byteLength)),!o.isBuffer(E))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+n(E));if(z===void 0&&(z=0),X===void 0&&(X=E?E.length:0),de===void 0&&(de=0),q===void 0&&(q=this.length),z<0||X>E.length||de<0||q>this.length)throw new RangeError("out of range index");if(de>=q&&z>=X)return 0;if(de>=q)return-1;if(z>=X)return 1;if(this===E)return 0;for(var B=(q>>>=0)-(de>>>=0),te=(X>>>=0)-(z>>>=0),T=Math.min(B,te),Y=this.slice(de,q),ie=E.slice(z,X),me=0;me<T;++me)if(Y[me]!==ie[me]){B=Y[me],te=ie[me];break}return B<te?-1:te<B?1:0},o.prototype.includes=function(E,z,X){return this.indexOf(E,z,X)!==-1},o.prototype.indexOf=function(E,z,X){return v(this,E,z,X,!0)},o.prototype.lastIndexOf=function(E,z,X){return v(this,E,z,X,!1)},o.prototype.write=function(E,z,X,de){if(z===void 0)de="utf8",X=this.length,z=0;else if(X===void 0&&typeof z=="string")de=z,X=this.length,z=0;else{if(!isFinite(z))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");z>>>=0,isFinite(X)?(X>>>=0,de===void 0&&(de="utf8")):(de=X,X=void 0)}var q=this.length-z;if((X===void 0||X>q)&&(X=q),E.length>0&&(X<0||z<0)||z>this.length)throw new RangeError("Attempt to write outside buffer bounds");de||(de="utf8");for(var B=!1;;)switch(de){case"hex":return j(this,E,z,X);case"utf8":case"utf-8":return S(this,E,z,X);case"ascii":case"latin1":case"binary":return A(this,E,z,X);case"base64":return M(this,E,z,X);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,E,z,X);default:if(B)throw new TypeError("Unknown encoding: "+de);de=(""+de).toLowerCase(),B=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Q=4096;function re(E,z,X){var de="";X=Math.min(E.length,X);for(var q=z;q<X;++q)de+=String.fromCharCode(127&E[q]);return de}function ue(E,z,X){var de="";X=Math.min(E.length,X);for(var q=z;q<X;++q)de+=String.fromCharCode(E[q]);return de}function W(E,z,X){var de=E.length;(!z||z<0)&&(z=0),(!X||X<0||X>de)&&(X=de);for(var q="",B=z;B<X;++B)q+=he[E[B]];return q}function $(E,z,X){for(var de=E.slice(z,X),q="",B=0;B<de.length-1;B+=2)q+=String.fromCharCode(de[B]+256*de[B+1]);return q}function C(E,z,X){if(E%1!=0||E<0)throw new RangeError("offset is not uint");if(E+z>X)throw new RangeError("Trying to access beyond buffer length")}function J(E,z,X,de,q,B){if(!o.isBuffer(E))throw new TypeError('"buffer" argument must be a Buffer instance');if(z>q||z<B)throw new RangeError('"value" argument is out of bounds');if(X+de>E.length)throw new RangeError("Index out of range")}function F(E,z,X,de,q,B){if(X+de>E.length)throw new RangeError("Index out of range");if(X<0)throw new RangeError("Index out of range")}function I(E,z,X,de,q){return z=+z,X>>>=0,q||F(E,0,X,4),b.write(E,z,X,de,23,4),X+4}function N(E,z,X,de,q){return z=+z,X>>>=0,q||F(E,0,X,8),b.write(E,z,X,de,52,8),X+8}o.prototype.slice=function(E,z){var X=this.length;(E=~~E)<0?(E+=X)<0&&(E=0):E>X&&(E=X),(z=z===void 0?X:~~z)<0?(z+=X)<0&&(z=0):z>X&&(z=X),z<E&&(z=E);var de=this.subarray(E,z);return Object.setPrototypeOf(de,o.prototype),de},o.prototype.readUintLE=o.prototype.readUIntLE=function(E,z,X){E>>>=0,z>>>=0,X||C(E,z,this.length);for(var de=this[E],q=1,B=0;++B<z&&(q*=256);)de+=this[E+B]*q;return de},o.prototype.readUintBE=o.prototype.readUIntBE=function(E,z,X){E>>>=0,z>>>=0,X||C(E,z,this.length);for(var de=this[E+--z],q=1;z>0&&(q*=256);)de+=this[E+--z]*q;return de},o.prototype.readUint8=o.prototype.readUInt8=function(E,z){return E>>>=0,z||C(E,1,this.length),this[E]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(E,z){return E>>>=0,z||C(E,2,this.length),this[E]|this[E+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(E,z){return E>>>=0,z||C(E,2,this.length),this[E]<<8|this[E+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(E,z){return E>>>=0,z||C(E,4,this.length),(this[E]|this[E+1]<<8|this[E+2]<<16)+16777216*this[E+3]},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(E,z){return E>>>=0,z||C(E,4,this.length),16777216*this[E]+(this[E+1]<<16|this[E+2]<<8|this[E+3])},o.prototype.readIntLE=function(E,z,X){E>>>=0,z>>>=0,X||C(E,z,this.length);for(var de=this[E],q=1,B=0;++B<z&&(q*=256);)de+=this[E+B]*q;return de>=(q*=128)&&(de-=Math.pow(2,8*z)),de},o.prototype.readIntBE=function(E,z,X){E>>>=0,z>>>=0,X||C(E,z,this.length);for(var de=z,q=1,B=this[E+--de];de>0&&(q*=256);)B+=this[E+--de]*q;return B>=(q*=128)&&(B-=Math.pow(2,8*z)),B},o.prototype.readInt8=function(E,z){return E>>>=0,z||C(E,1,this.length),128&this[E]?-1*(255-this[E]+1):this[E]},o.prototype.readInt16LE=function(E,z){E>>>=0,z||C(E,2,this.length);var X=this[E]|this[E+1]<<8;return 32768&X?4294901760|X:X},o.prototype.readInt16BE=function(E,z){E>>>=0,z||C(E,2,this.length);var X=this[E+1]|this[E]<<8;return 32768&X?4294901760|X:X},o.prototype.readInt32LE=function(E,z){return E>>>=0,z||C(E,4,this.length),this[E]|this[E+1]<<8|this[E+2]<<16|this[E+3]<<24},o.prototype.readInt32BE=function(E,z){return E>>>=0,z||C(E,4,this.length),this[E]<<24|this[E+1]<<16|this[E+2]<<8|this[E+3]},o.prototype.readFloatLE=function(E,z){return E>>>=0,z||C(E,4,this.length),b.read(this,E,!0,23,4)},o.prototype.readFloatBE=function(E,z){return E>>>=0,z||C(E,4,this.length),b.read(this,E,!1,23,4)},o.prototype.readDoubleLE=function(E,z){return E>>>=0,z||C(E,8,this.length),b.read(this,E,!0,52,8)},o.prototype.readDoubleBE=function(E,z){return E>>>=0,z||C(E,8,this.length),b.read(this,E,!1,52,8)},o.prototype.writeUintLE=o.prototype.writeUIntLE=function(E,z,X,de){E=+E,z>>>=0,X>>>=0,de||J(this,E,z,X,Math.pow(2,8*X)-1,0);var q=1,B=0;for(this[z]=255&E;++B<X&&(q*=256);)this[z+B]=E/q&255;return z+X},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(E,z,X,de){E=+E,z>>>=0,X>>>=0,de||J(this,E,z,X,Math.pow(2,8*X)-1,0);var q=X-1,B=1;for(this[z+q]=255&E;--q>=0&&(B*=256);)this[z+q]=E/B&255;return z+X},o.prototype.writeUint8=o.prototype.writeUInt8=function(E,z,X){return E=+E,z>>>=0,X||J(this,E,z,1,255,0),this[z]=255&E,z+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(E,z,X){return E=+E,z>>>=0,X||J(this,E,z,2,65535,0),this[z]=255&E,this[z+1]=E>>>8,z+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(E,z,X){return E=+E,z>>>=0,X||J(this,E,z,2,65535,0),this[z]=E>>>8,this[z+1]=255&E,z+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(E,z,X){return E=+E,z>>>=0,X||J(this,E,z,4,4294967295,0),this[z+3]=E>>>24,this[z+2]=E>>>16,this[z+1]=E>>>8,this[z]=255&E,z+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(E,z,X){return E=+E,z>>>=0,X||J(this,E,z,4,4294967295,0),this[z]=E>>>24,this[z+1]=E>>>16,this[z+2]=E>>>8,this[z+3]=255&E,z+4},o.prototype.writeIntLE=function(E,z,X,de){if(E=+E,z>>>=0,!de){var q=Math.pow(2,8*X-1);J(this,E,z,X,q-1,-q)}var B=0,te=1,T=0;for(this[z]=255&E;++B<X&&(te*=256);)E<0&&T===0&&this[z+B-1]!==0&&(T=1),this[z+B]=(E/te|0)-T&255;return z+X},o.prototype.writeIntBE=function(E,z,X,de){if(E=+E,z>>>=0,!de){var q=Math.pow(2,8*X-1);J(this,E,z,X,q-1,-q)}var B=X-1,te=1,T=0;for(this[z+B]=255&E;--B>=0&&(te*=256);)E<0&&T===0&&this[z+B+1]!==0&&(T=1),this[z+B]=(E/te|0)-T&255;return z+X},o.prototype.writeInt8=function(E,z,X){return E=+E,z>>>=0,X||J(this,E,z,1,127,-128),E<0&&(E=255+E+1),this[z]=255&E,z+1},o.prototype.writeInt16LE=function(E,z,X){return E=+E,z>>>=0,X||J(this,E,z,2,32767,-32768),this[z]=255&E,this[z+1]=E>>>8,z+2},o.prototype.writeInt16BE=function(E,z,X){return E=+E,z>>>=0,X||J(this,E,z,2,32767,-32768),this[z]=E>>>8,this[z+1]=255&E,z+2},o.prototype.writeInt32LE=function(E,z,X){return E=+E,z>>>=0,X||J(this,E,z,4,2147483647,-2147483648),this[z]=255&E,this[z+1]=E>>>8,this[z+2]=E>>>16,this[z+3]=E>>>24,z+4},o.prototype.writeInt32BE=function(E,z,X){return E=+E,z>>>=0,X||J(this,E,z,4,2147483647,-2147483648),E<0&&(E=4294967295+E+1),this[z]=E>>>24,this[z+1]=E>>>16,this[z+2]=E>>>8,this[z+3]=255&E,z+4},o.prototype.writeFloatLE=function(E,z,X){return I(this,E,z,!0,X)},o.prototype.writeFloatBE=function(E,z,X){return I(this,E,z,!1,X)},o.prototype.writeDoubleLE=function(E,z,X){return N(this,E,z,!0,X)},o.prototype.writeDoubleBE=function(E,z,X){return N(this,E,z,!1,X)},o.prototype.copy=function(E,z,X,de){if(!o.isBuffer(E))throw new TypeError("argument should be a Buffer");if(X||(X=0),de||de===0||(de=this.length),z>=E.length&&(z=E.length),z||(z=0),de>0&&de<X&&(de=X),de===X||E.length===0||this.length===0)return 0;if(z<0)throw new RangeError("targetStart out of bounds");if(X<0||X>=this.length)throw new RangeError("Index out of range");if(de<0)throw new RangeError("sourceEnd out of bounds");de>this.length&&(de=this.length),E.length-z<de-X&&(de=E.length-z+X);var q=de-X;return this===E&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(z,X,de):Uint8Array.prototype.set.call(E,this.subarray(X,de),z),q},o.prototype.fill=function(E,z,X,de){if(typeof E=="string"){if(typeof z=="string"?(de=z,z=0,X=this.length):typeof X=="string"&&(de=X,X=this.length),de!==void 0&&typeof de!="string")throw new TypeError("encoding must be a string");if(typeof de=="string"&&!o.isEncoding(de))throw new TypeError("Unknown encoding: "+de);if(E.length===1){var q=E.charCodeAt(0);(de==="utf8"&&q<128||de==="latin1")&&(E=q)}}else typeof E=="number"?E&=255:typeof E=="boolean"&&(E=Number(E));if(z<0||this.length<z||this.length<X)throw new RangeError("Out of range index");if(X<=z)return this;var B;if(z>>>=0,X=X===void 0?this.length:X>>>0,E||(E=0),typeof E=="number")for(B=z;B<X;++B)this[B]=E;else{var te=o.isBuffer(E)?E:o.from(E,de),T=te.length;if(T===0)throw new TypeError('The value "'+E+'" is invalid for argument "value"');for(B=0;B<X-z;++B)this[B+z]=te[B%T]}return this};var G=/[^+/0-9A-Za-z-_]/g;function ae(E,z){var X;z=z||1/0;for(var de=E.length,q=null,B=[],te=0;te<de;++te){if((X=E.charCodeAt(te))>55295&&X<57344){if(!q){if(X>56319){(z-=3)>-1&&B.push(239,191,189);continue}if(te+1===de){(z-=3)>-1&&B.push(239,191,189);continue}q=X;continue}if(X<56320){(z-=3)>-1&&B.push(239,191,189),q=X;continue}X=65536+(q-55296<<10|X-56320)}else q&&(z-=3)>-1&&B.push(239,191,189);if(q=null,X<128){if((z-=1)<0)break;B.push(X)}else if(X<2048){if((z-=2)<0)break;B.push(X>>6|192,63&X|128)}else if(X<65536){if((z-=3)<0)break;B.push(X>>12|224,X>>6&63|128,63&X|128)}else{if(!(X<1114112))throw new Error("Invalid code point");if((z-=4)<0)break;B.push(X>>18|240,X>>12&63|128,X>>6&63|128,63&X|128)}}return B}function ce(E){return c.toByteArray(function(z){if((z=(z=z.split("=")[0]).trim().replace(G,"")).length<2)return"";for(;z.length%4!=0;)z+="=";return z}(E))}function Se(E,z,X,de){for(var q=0;q<de&&!(q+X>=z.length||q>=E.length);++q)z[q+X]=E[q];return q}function oe(E,z){return E instanceof z||E!=null&&E.constructor!=null&&E.constructor.name!=null&&E.constructor.name===z.name}function Z(E){return E!=E}var he=function(){for(var E="0123456789abcdef",z=new Array(256),X=0;X<16;++X)for(var de=16*X,q=0;q<16;++q)z[de+q]=E[X]+E[q];return z}()},5889:(a,i,t)=>{"use strict";function n(u,h){var l=typeof Symbol<"u"&&u[Symbol.iterator]||u["@@iterator"];if(!l){if(Array.isArray(u)||(l=c(u))||h&&u&&typeof u.length=="number"){l&&(u=l);var d=0,_=function(){};return{s:_,n:function(){return d>=u.length?{done:!0}:{done:!1,value:u[d++]}},e:function(k){throw k},f:_}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p,m=!0,y=!1;return{s:function(){l=l.call(u)},n:function(){var k=l.next();return m=k.done,k},e:function(k){y=!0,p=k},f:function(){try{m||l.return==null||l.return()}finally{if(y)throw p}}}}function c(u,h){if(u){if(typeof u=="string")return b(u,h);var l={}.toString.call(u).slice(8,-1);return l==="Object"&&u.constructor&&(l=u.constructor.name),l==="Map"||l==="Set"?Array.from(u):l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?b(u,h):void 0}}function b(u,h){(h==null||h>u.length)&&(h=u.length);for(var l=0,d=Array(h);l<h;l++)d[l]=u[l];return d}var x=t(7930).arrayAtomicsSymbol,w=t(7930).sessionNewDocuments,g=t(8768);function o(u,h){return u=u||{},h.$pullAll!=null&&(u.$pullAll=(u.$pullAll||[]).concat(h.$pullAll)),h.$push!=null&&(u.$push=u.$push||{},u.$push.$each=(u.$push.$each||[]).concat(h.$push.$each)),h.$addToSet!=null&&(u.$addToSet=(u.$addToSet||[]).concat(h.$addToSet)),h.$set!=null&&(u.$set=Array.isArray(h.$set)?function(d){if(Array.isArray(d))return b(d)}(l=h.$set)||function(d){if(typeof Symbol<"u"&&d[Symbol.iterator]!=null||d["@@iterator"]!=null)return Array.from(d)}(l)||c(l)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}():Object.assign({},h.$set)),u;var l}a.exports=function(u){u.pre("save",function(){var h=this.$session();if(h!=null&&h.transaction!=null&&h[w]!=null&&!h[w].has(this)){var l={};this.isNew&&(l.isNew=!0),this.$__schema.options.versionKey&&(l.versionKey=this.get(this.$__schema.options.versionKey)),l.modifiedPaths=new Set(Object.keys(this.$__.activePaths.getStatePaths("modify"))),l.atomics=function(d,_){var p=new Map;_=_||new Map;var m,y=n(Object.keys(d.$__.activePaths.init).concat(Object.keys(d.$__.activePaths.modify)));try{for(y.s();!(m=y.n()).done;){var k=m.value,v=d.$__getValue(k);if(v!=null&&Array.isArray(v)&&g.isMongooseDocumentArray(v)&&v.length&&v[x]!=null&&Object.keys(v[x]).length!==0){var D=_.get(k)||{};p.set(k,o(D,v[x]))}}}catch(H){y.e(H)}finally{y.f()}var j,S=n(d.$__dirty());try{for(S.s();!(j=S.n()).done;){var A=j.value,M=A.path,V=A.value;if(V!=null&&V[x]!=null&&Object.keys(V[x]).length!==0){var K=_.get(M)||{};p.set(M,o(K,V[x]))}}}catch(H){S.e(H)}finally{S.f()}return p}(this),h[w].set(this,l)}})}},5899:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}var c=t(953)(),b=t(3071)("Object.prototype.toString"),x=function(o){return!(c&&o&&n(o)==="object"&&Symbol.toStringTag in o)&&b(o)==="[object Arguments]"},w=function(o){return!!x(o)||o!==null&&n(o)==="object"&&"length"in o&&typeof o.length=="number"&&o.length>=0&&b(o)!=="[object Array]"&&"callee"in o&&b(o.callee)==="[object Function]"},g=function(){return x(arguments)}();x.isLegacyArguments=w,a.exports=g?x:w},5994:(a,i,t)=>{"use strict";var n=Function.prototype.call,c=Object.prototype.hasOwnProperty,b=t(2354);a.exports=b.call(n,c)},6062:(a,i,t)=>{"use strict";var n=t(9122),c=t(2273),b=t(118),x=t(4183),w=t(7878),g=n(x(),Number);c(g,{getPolyfill:x,implementation:b,shim:w}),a.exports=g},6140:a=>{"use strict";function i(b){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},i(b)}function t(b,x){for(var w=0;w<x.length;w++){var g=x[w];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(b,c(g.key),g)}}function n(b,x,w){return x&&t(b.prototype,x),w&&t(b,w),Object.defineProperty(b,"prototype",{writable:!1}),b}function c(b){var x=function(w){if(i(w)!="object"||!w)return w;var g=w[Symbol.toPrimitive];if(g!==void 0){var o=g.call(w,"string");if(i(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(w)}(b);return i(x)=="symbol"?x:x+""}a.exports=n(function b(x,w,g){(function(o,u){if(!(o instanceof u))throw new TypeError("Cannot call a class as a function")})(this,b),this.subdocSnapshot=x,this.activePaths=w,this.version=g})},6155:a=>{"use strict";function i(t){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i(t)}a.exports=function(t){for(var n=Object.keys(t),c=!0,b=0,x=n.length;b<x;++b)if(i(t[n[b]])==="object"&&t[n[b]]!==null){c=!1;break}return c}},6182:a=>{"use strict";function i(t,n){if(t==null)throw new TypeError("Cannot convert first argument to object");for(var c=Object(t),b=1;b<arguments.length;b++){var x=arguments[b];if(x!=null)for(var w=Object.keys(Object(x)),g=0,o=w.length;g<o;g++){var u=w[g],h=Object.getOwnPropertyDescriptor(x,u);h!==void 0&&h.enumerable&&(c[u]=x[u])}}return c}a.exports={assign:i,polyfill:function(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:i})}}},6193:(a,i,t)=>{"use strict";function n(Z){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(he){return typeof he}:function(he){return he&&typeof Symbol=="function"&&he.constructor===Symbol&&he!==Symbol.prototype?"symbol":typeof he},n(Z)}function c(Z,he){return function(E){if(Array.isArray(E))return E}(Z)||function(E,z){var X=[],de=!0,q=!1,B=void 0;try{for(var te,T=E[Symbol.iterator]();!(de=(te=T.next()).done)&&(X.push(te.value),!z||X.length!==z);de=!0);}catch(Y){q=!0,B=Y}finally{try{de||T.return==null||T.return()}finally{if(q)throw B}}return X}(Z,he)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function b(Z){return b=typeof Symbol=="function"&&n(Symbol.iterator)==="symbol"?function(he){return n(he)}:function(he){return he&&typeof Symbol=="function"&&he.constructor===Symbol&&he!==Symbol.prototype?"symbol":n(he)},b(Z)}var x=/a/g.flags!==void 0,w=function(Z){var he=[];return Z.forEach(function(E){return he.push(E)}),he},g=function(Z){var he=[];return Z.forEach(function(E,z){return he.push([z,E])}),he},o=Object.is?Object.is:t(2064),u=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},h=Number.isNaN?Number.isNaN:t(6062);function l(Z){return Z.call.bind(Z)}var d=l(Object.prototype.hasOwnProperty),_=l(Object.prototype.propertyIsEnumerable),p=l(Object.prototype.toString),m=t(7352).types,y=m.isAnyArrayBuffer,k=m.isArrayBufferView,v=m.isDate,D=m.isMap,j=m.isRegExp,S=m.isSet,A=m.isNativeError,M=m.isBoxedPrimitive,V=m.isNumberObject,K=m.isStringObject,H=m.isBooleanObject,Q=m.isBigIntObject,re=m.isSymbolObject,ue=m.isFloat32Array,W=m.isFloat64Array;function $(Z){if(Z.length===0||Z.length>10)return!0;for(var he=0;he<Z.length;he++){var E=Z.charCodeAt(he);if(E<48||E>57)return!0}return Z.length===10&&Z>=Math.pow(2,32)}function C(Z){return Object.keys(Z).filter($).concat(u(Z).filter(Object.prototype.propertyIsEnumerable.bind(Z)))}function J(Z,he){if(Z===he)return 0;for(var E=Z.length,z=he.length,X=0,de=Math.min(E,z);X<de;++X)if(Z[X]!==he[X]){E=Z[X],z=he[X];break}return E<z?-1:z<E?1:0}function F(Z,he,E,z){if(Z===he)return Z!==0||!E||o(Z,he);if(E){if(b(Z)!=="object")return typeof Z=="number"&&h(Z)&&h(he);if(b(he)!=="object"||Z===null||he===null||Object.getPrototypeOf(Z)!==Object.getPrototypeOf(he))return!1}else{if(Z===null||b(Z)!=="object")return(he===null||b(he)!=="object")&&Z==he;if(he===null||b(he)!=="object")return!1}var X,de,q,B,te=p(Z);if(te!==p(he))return!1;if(Array.isArray(Z)){if(Z.length!==he.length)return!1;var T=C(Z),Y=C(he);return T.length===Y.length&&N(Z,he,E,z,1,T)}if(te==="[object Object]"&&(!D(Z)&&D(he)||!S(Z)&&S(he)))return!1;if(v(Z)){if(!v(he)||Date.prototype.getTime.call(Z)!==Date.prototype.getTime.call(he))return!1}else if(j(Z)){if(!j(he)||(q=Z,B=he,!(x?q.source===B.source&&q.flags===B.flags:RegExp.prototype.toString.call(q)===RegExp.prototype.toString.call(B))))return!1}else if(A(Z)||Z instanceof Error){if(Z.message!==he.message||Z.name!==he.name)return!1}else{if(k(Z)){if(E||!ue(Z)&&!W(Z)){if(!function(ne,ye){return ne.byteLength===ye.byteLength&&J(new Uint8Array(ne.buffer,ne.byteOffset,ne.byteLength),new Uint8Array(ye.buffer,ye.byteOffset,ye.byteLength))===0}(Z,he))return!1}else if(!function(ne,ye){if(ne.byteLength!==ye.byteLength)return!1;for(var Re=0;Re<ne.byteLength;Re++)if(ne[Re]!==ye[Re])return!1;return!0}(Z,he))return!1;var ie=C(Z),me=C(he);return ie.length===me.length&&N(Z,he,E,z,0,ie)}if(S(Z))return!(!S(he)||Z.size!==he.size)&&N(Z,he,E,z,2);if(D(Z))return!(!D(he)||Z.size!==he.size)&&N(Z,he,E,z,3);if(y(Z)){if(de=he,(X=Z).byteLength!==de.byteLength||J(new Uint8Array(X),new Uint8Array(de))!==0)return!1}else if(M(Z)&&!function(ne,ye){return V(ne)?V(ye)&&o(Number.prototype.valueOf.call(ne),Number.prototype.valueOf.call(ye)):K(ne)?K(ye)&&String.prototype.valueOf.call(ne)===String.prototype.valueOf.call(ye):H(ne)?H(ye)&&Boolean.prototype.valueOf.call(ne)===Boolean.prototype.valueOf.call(ye):Q(ne)?Q(ye)&&BigInt.prototype.valueOf.call(ne)===BigInt.prototype.valueOf.call(ye):re(ye)&&Symbol.prototype.valueOf.call(ne)===Symbol.prototype.valueOf.call(ye)}(Z,he))return!1}return N(Z,he,E,z,0)}function I(Z,he){return he.filter(function(E){return _(Z,E)})}function N(Z,he,E,z,X,de){if(arguments.length===5){de=Object.keys(Z);var q=Object.keys(he);if(de.length!==q.length)return!1}for(var B=0;B<de.length;B++)if(!d(he,de[B]))return!1;if(E&&arguments.length===5){var te=u(Z);if(te.length!==0){var T=0;for(B=0;B<te.length;B++){var Y=te[B];if(_(Z,Y)){if(!_(he,Y))return!1;de.push(Y),T++}else if(_(he,Y))return!1}var ie=u(he);if(te.length!==ie.length&&I(he,ie).length!==T)return!1}else{var me=u(he);if(me.length!==0&&I(he,me).length!==0)return!1}}if(de.length===0&&(X===0||X===1&&Z.length===0||Z.size===0))return!0;if(z===void 0)z={val1:new Map,val2:new Map,position:0};else{var ne=z.val1.get(Z);if(ne!==void 0){var ye=z.val2.get(he);if(ye!==void 0)return ne===ye}z.position++}z.val1.set(Z,z.position),z.val2.set(he,z.position);var Re=function(Ie,je,Be,Me,qe,vt){var jt=0;if(vt===2){if(!function(Nt,Bt,Ht,Lt){for(var qt=null,Ir=w(Nt),ze=0;ze<Ir.length;ze++){var br=Ir[ze];if(b(br)==="object"&&br!==null)qt===null&&(qt=new Set),qt.add(br);else if(!Bt.has(br)){if(Ht||!ce(Nt,Bt,br))return!1;qt===null&&(qt=new Set),qt.add(br)}}if(qt!==null){for(var yr=w(Bt),Ae=0;Ae<yr.length;Ae++){var Nr=yr[Ae];if(b(Nr)==="object"&&Nr!==null){if(!G(qt,Nr,Ht,Lt))return!1}else if(!Ht&&!Nt.has(Nr)&&!G(qt,Nr,Ht,Lt))return!1}return qt.size===0}return!0}(Ie,je,Be,qe))return!1}else if(vt===3){if(!function(Nt,Bt,Ht,Lt){for(var qt=null,Ir=g(Nt),ze=0;ze<Ir.length;ze++){var br=c(Ir[ze],2),yr=br[0],Ae=br[1];if(b(yr)==="object"&&yr!==null)qt===null&&(qt=new Set),qt.add(yr);else{var Nr=Bt.get(yr);if(Nr===void 0&&!Bt.has(yr)||!F(Ae,Nr,Ht,Lt)){if(Ht||!Se(Nt,Bt,yr,Ae,Lt))return!1;qt===null&&(qt=new Set),qt.add(yr)}}}if(qt!==null){for(var sa=g(Bt),Yr=0;Yr<sa.length;Yr++){var kr=c(sa[Yr],2),Vr=(yr=kr[0],kr[1]);if(b(yr)==="object"&&yr!==null){if(!oe(qt,Nt,yr,Vr,Ht,Lt))return!1}else if(!(Ht||Nt.has(yr)&&F(Nt.get(yr),Vr,!1,Lt)||oe(qt,Nt,yr,Vr,!1,Lt)))return!1}return qt.size===0}return!0}(Ie,je,Be,qe))return!1}else if(vt===1)for(;jt<Ie.length;jt++){if(!d(Ie,jt)){if(d(je,jt))return!1;for(var wt=Object.keys(Ie);jt<wt.length;jt++){var ft=wt[jt];if(!d(je,ft)||!F(Ie[ft],je[ft],Be,qe))return!1}return wt.length===Object.keys(je).length}if(!d(je,jt)||!F(Ie[jt],je[jt],Be,qe))return!1}for(jt=0;jt<Me.length;jt++){var fr=Me[jt];if(!F(Ie[fr],je[fr],Be,qe))return!1}return!0}(Z,he,E,de,z,X);return z.val1.delete(Z),z.val2.delete(he),Re}function G(Z,he,E,z){for(var X=w(Z),de=0;de<X.length;de++){var q=X[de];if(F(he,q,E,z))return Z.delete(q),!0}return!1}function ae(Z){switch(b(Z)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":Z=+Z;case"number":if(h(Z))return!1}return!0}function ce(Z,he,E){var z=ae(E);return z??(he.has(z)&&!Z.has(z))}function Se(Z,he,E,z,X){var de=ae(E);if(de!=null)return de;var q=he.get(de);return!(q===void 0&&!he.has(de)||!F(z,q,!1,X))&&!Z.has(de)&&F(z,q,!1,X)}function oe(Z,he,E,z,X,de){for(var q=w(Z),B=0;B<q.length;B++){var te=q[B];if(F(E,te,X,de)&&F(z,he.get(te),X,de))return Z.delete(te),!0}return!1}a.exports={isDeepEqual:function(Z,he){return F(Z,he,!1)},isDeepStrictEqual:function(Z,he){return F(Z,he,!0)}}},6223:a=>{"use strict";var i=/\./g;a.exports=function(t){if(t.indexOf(".")===-1)return[t];for(var n=t.split(i),c=n.length,b=new Array(c),x="",w=0;w<c;++w)x+=x.length!==0?"."+n[w]:n[w],b[w]=x;return b}},6312:a=>{"use strict";function i(n){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},i(n)}var t=Object.prototype.toString;a.exports=function(n){var c=t.call(n),b=c==="[object Arguments]";return b||(b=c!=="[object Array]"&&n!==null&&i(n)==="object"&&typeof n.length=="number"&&n.length>=0&&t.call(n.callee)==="[object Function]"),b}},6353:(a,i,t)=>{"use strict";t.r(i),t.d(i,{BSON:()=>va,BSONError:()=>Z,BSONOffsetError:()=>z,BSONRegExp:()=>pt,BSONRuntimeError:()=>E,BSONSymbol:()=>xt,BSONType:()=>oe,BSONValue:()=>ye,BSONVersionError:()=>he,Binary:()=>Me,Code:()=>ft,DBRef:()=>Nt,Decimal128:()=>xe,Double:()=>_e,EJSON:()=>Dr,Int32:()=>Le,Long:()=>Ae,MaxKey:()=>Fe,MinKey:()=>Qe,ObjectId:()=>Ne,Timestamp:()=>Ot,UUID:()=>wt,calculateObjectSize:()=>ya,deserialize:()=>ha,deserializeStream:()=>fa,onDemand:()=>Hr,serialize:()=>da,serializeWithBufferAndIndex:()=>_a,setInternalBufferSize:()=>ea});var n=t(5832).hp;let c=(()=>{let O=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Uint8Array.prototype),Symbol.toStringTag).get;return s=>O.call(s)})();function b(O){return c(O)==="Uint8Array"}function x(O){return typeof O=="object"&&O!=null&&Symbol.toStringTag in O&&(O[Symbol.toStringTag]==="ArrayBuffer"||O[Symbol.toStringTag]==="SharedArrayBuffer")}function w(O){return O instanceof RegExp||Object.prototype.toString.call(O)==="[object RegExp]"}function g(O){return typeof O=="object"&&O!=null&&Symbol.toStringTag in O&&O[Symbol.toStringTag]==="Map"}function o(O){return O instanceof Date||Object.prototype.toString.call(O)==="[object Date]"}function u(O,s){return JSON.stringify(O,(U,L)=>typeof L=="bigint"?{$numberLong:`${L}`}:g(L)?Object.fromEntries(L):L)}let h=6,l=Symbol.for("@@mdb.bson.version"),d=2147483647,_=-2147483648,p=Math.pow(2,63)-1,m=-Math.pow(2,63),y=Math.pow(2,53),k=-Math.pow(2,53),v=1,D=2,j=3,S=4,A=5,M=6,V=7,K=8,H=9,Q=10,re=11,ue=12,W=13,$=14,C=15,J=16,F=17,I=18,N=19,G=255,ae=127,ce=0,Se=4,oe=Object.freeze({double:1,string:2,object:3,array:4,binData:5,undefined:6,objectId:7,bool:8,date:9,null:10,regex:11,dbPointer:12,javascript:13,symbol:14,javascriptWithScope:15,int:16,timestamp:17,long:18,decimal:19,minKey:-1,maxKey:127});class Z extends Error{get bsonError(){return!0}get name(){return"BSONError"}constructor(s,U){super(s,U)}static isBSONError(s){return s!=null&&typeof s=="object"&&"bsonError"in s&&s.bsonError===!0&&"name"in s&&"message"in s&&"stack"in s}}class he extends Z{get name(){return"BSONVersionError"}constructor(){super(`Unsupported BSON version, bson types must be from bson ${h}.x.x`)}}class E extends Z{get name(){return"BSONRuntimeError"}constructor(s){super(s)}}class z extends Z{get name(){return"BSONOffsetError"}constructor(s,U,L){super(`${s}. offset: ${U}`,L),this.offset=U}}let X,de;function q(O,s,U,L){if(L){X??=new TextDecoder("utf8",{fatal:!0});try{return X.decode(O.subarray(s,U))}catch(Pe){throw new Z("Invalid UTF-8 string in BSON document",{cause:Pe})}}return de??=new TextDecoder("utf8",{fatal:!1}),de.decode(O.subarray(s,U))}function B(O,s,U){if(O.length===0)return"";let L=U-s;if(L===0)return"";if(L>20)return null;if(L===1&&O[s]<128)return String.fromCharCode(O[s]);if(L===2&&O[s]<128&&O[s+1]<128)return String.fromCharCode(O[s])+String.fromCharCode(O[s+1]);if(L===3&&O[s]<128&&O[s+1]<128&&O[s+2]<128)return String.fromCharCode(O[s])+String.fromCharCode(O[s+1])+String.fromCharCode(O[s+2]);let Pe=[];for(let ke=s;ke<U;ke++){let Ze=O[ke];if(Ze>127)return null;Pe.push(Ze)}return String.fromCharCode(...Pe)}let te={toLocalBufferType(O){if(n.isBuffer(O))return O;if(ArrayBuffer.isView(O))return n.from(O.buffer,O.byteOffset,O.byteLength);let s=O?.[Symbol.toStringTag]??Object.prototype.toString.call(O);if(s==="ArrayBuffer"||s==="SharedArrayBuffer"||s==="[object ArrayBuffer]"||s==="[object SharedArrayBuffer]")return n.from(O);throw new Z("Cannot create Buffer from the passed potentialBuffer.")},allocate:O=>n.alloc(O),allocateUnsafe:O=>n.allocUnsafe(O),equals:(O,s)=>te.toLocalBufferType(O).equals(s),fromNumberArray:O=>n.from(O),fromBase64:O=>n.from(O,"base64"),toBase64:O=>te.toLocalBufferType(O).toString("base64"),fromISO88591:O=>n.from(O,"binary"),toISO88591:O=>te.toLocalBufferType(O).toString("binary"),fromHex:O=>n.from(O,"hex"),toHex:O=>te.toLocalBufferType(O).toString("hex"),toUTF8(O,s,U,L){let Pe=U-s<=20?B(O,s,U):null;if(Pe!=null)return Pe;let ke=te.toLocalBufferType(O).toString("utf8",s,U);if(L){for(let Ze=0;Ze<ke.length;Ze++)if(ke.charCodeAt(Ze)===65533){q(O,s,U,!0);break}}return ke},utf8ByteLength:O=>n.byteLength(O,"utf8"),encodeUTF8Into(O,s,U){let L=function(Pe,ke,Ze){if(ke.length===0)return 0;if(ke.length>25||Pe.length-Ze<ke.length)return null;for(let We=0,Oe=Ze;We<ke.length;We++,Oe++){let St=ke.charCodeAt(We);if(St>127)return null;Pe[Oe]=St}return ke.length}(O,s,U);return L??te.toLocalBufferType(O).write(s,U,void 0,"utf8")},randomBytes:function(O){return te.fromNumberArray(Array.from({length:O},()=>Math.floor(256*Math.random())))},swap32:O=>te.toLocalBufferType(O).swap32()};function T(O){if(O<0)throw new RangeError(`The argument 'byteLength' is invalid. Received ${O}`);return me.fromNumberArray(Array.from({length:O},()=>Math.floor(256*Math.random())))}let Y=(()=>{let{crypto:O}=globalThis;if(O!=null&&typeof O.getRandomValues=="function")return s=>O.getRandomValues(me.allocate(s));if(function(){let{navigator:s}=globalThis;return typeof s=="object"&&s.product==="ReactNative"}()){let{console:s}=globalThis;s?.warn?.("BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.")}return T})(),ie=/(\d|[a-f])/i,me={toLocalBufferType(O){let s=O?.[Symbol.toStringTag]??Object.prototype.toString.call(O);if(s==="Uint8Array")return O;if(ArrayBuffer.isView(O))return new Uint8Array(O.buffer.slice(O.byteOffset,O.byteOffset+O.byteLength));if(s==="ArrayBuffer"||s==="SharedArrayBuffer"||s==="[object ArrayBuffer]"||s==="[object SharedArrayBuffer]")return new Uint8Array(O);throw new Z("Cannot make a Uint8Array from passed potentialBuffer.")},allocate(O){if(typeof O!="number")throw new TypeError(`The "size" argument must be of type number. Received ${String(O)}`);return new Uint8Array(O)},allocateUnsafe:O=>me.allocate(O),equals(O,s){if(O.byteLength!==s.byteLength)return!1;for(let U=0;U<O.byteLength;U++)if(O[U]!==s[U])return!1;return!0},fromNumberArray:O=>Uint8Array.from(O),fromBase64:O=>Uint8Array.from(atob(O),s=>s.charCodeAt(0)),toBase64:O=>btoa(me.toISO88591(O)),fromISO88591:O=>Uint8Array.from(O,s=>255&s.charCodeAt(0)),toISO88591:O=>Array.from(Uint16Array.from(O),s=>String.fromCharCode(s)).join(""),fromHex(O){let s=O.length%2==0?O:O.slice(0,O.length-1),U=[];for(let L=0;L<s.length;L+=2){let Pe=s[L],ke=s[L+1];if(!ie.test(Pe)||!ie.test(ke))break;let Ze=Number.parseInt(`${Pe}${ke}`,16);U.push(Ze)}return Uint8Array.from(U)},toHex:O=>Array.from(O,s=>s.toString(16).padStart(2,"0")).join(""),toUTF8(O,s,U,L){let Pe=U-s<=20?B(O,s,U):null;return Pe??q(O,s,U,L)},utf8ByteLength:O=>new TextEncoder().encode(O).byteLength,encodeUTF8Into(O,s,U){let L=new TextEncoder().encode(s);return O.set(L,U),L.byteLength},randomBytes:Y,swap32(O){if(O.length%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let s=0;s<O.length;s+=4){let U=O[s],L=O[s+1],Pe=O[s+2],ke=O[s+3];O[s]=ke,O[s+1]=Pe,O[s+2]=L,O[s+3]=U}return O}},ne=typeof n=="function"&&n.prototype?._isBuffer!==!0?te:me;class ye{get[l](){return h}[Symbol.for("nodejs.util.inspect.custom")](s,U,L){return this.inspect(s,U,L)}}let Re=new Float64Array(1),Ie=new Uint8Array(Re.buffer,0,8);Re[0]=-1;let je=Ie[7]===0,Be={isBigEndian:je,getNonnegativeInt32LE(O,s){if(O[s+3]>127)throw new RangeError(`Size cannot be negative at offset: ${s}`);return O[s]|O[s+1]<<8|O[s+2]<<16|O[s+3]<<24},getInt32LE:(O,s)=>O[s]|O[s+1]<<8|O[s+2]<<16|O[s+3]<<24,getUint32LE:(O,s)=>O[s]+256*O[s+1]+65536*O[s+2]+16777216*O[s+3],getUint32BE:(O,s)=>O[s+3]+256*O[s+2]+65536*O[s+1]+16777216*O[s],getBigInt64LE(O,s){let U=BigInt(O[s+4]+256*O[s+5]+65536*O[s+6]+(O[s+7]<<24)),L=BigInt(O[s]+256*O[s+1]+65536*O[s+2]+16777216*O[s+3]);return(U<<BigInt(32))+L},getFloat64LE:je?(O,s)=>(Ie[7]=O[s],Ie[6]=O[s+1],Ie[5]=O[s+2],Ie[4]=O[s+3],Ie[3]=O[s+4],Ie[2]=O[s+5],Ie[1]=O[s+6],Ie[0]=O[s+7],Re[0]):(O,s)=>(Ie[0]=O[s],Ie[1]=O[s+1],Ie[2]=O[s+2],Ie[3]=O[s+3],Ie[4]=O[s+4],Ie[5]=O[s+5],Ie[6]=O[s+6],Ie[7]=O[s+7],Re[0]),setInt32BE:(O,s,U)=>(O[s+3]=U,U>>>=8,O[s+2]=U,U>>>=8,O[s+1]=U,U>>>=8,O[s]=U,4),setInt32LE:(O,s,U)=>(O[s]=U,U>>>=8,O[s+1]=U,U>>>=8,O[s+2]=U,U>>>=8,O[s+3]=U,4),setBigInt64LE(O,s,U){let L=BigInt(4294967295),Pe=Number(U&L);O[s]=Pe,Pe>>=8,O[s+1]=Pe,Pe>>=8,O[s+2]=Pe,Pe>>=8,O[s+3]=Pe;let ke=Number(U>>BigInt(32)&L);return O[s+4]=ke,ke>>=8,O[s+5]=ke,ke>>=8,O[s+6]=ke,ke>>=8,O[s+7]=ke,8},setFloat64LE:je?(O,s,U)=>(Re[0]=U,O[s]=Ie[7],O[s+1]=Ie[6],O[s+2]=Ie[5],O[s+3]=Ie[4],O[s+4]=Ie[3],O[s+5]=Ie[2],O[s+6]=Ie[1],O[s+7]=Ie[0],8):(O,s,U)=>(Re[0]=U,O[s]=Ie[0],O[s+1]=Ie[1],O[s+2]=Ie[2],O[s+3]=Ie[3],O[s+4]=Ie[4],O[s+5]=Ie[5],O[s+6]=Ie[6],O[s+7]=Ie[7],8)};class Me extends ye{get _bsontype(){return"Binary"}constructor(s,U){if(super(),s!=null&&typeof s=="string"&&!ArrayBuffer.isView(s)&&!x(s)&&!Array.isArray(s))throw new Z("Binary can only be constructed from Uint8Array or number[]");this.sub_type=U??Me.BSON_BINARY_SUBTYPE_DEFAULT,s==null?(this.buffer=ne.allocate(Me.BUFFER_SIZE),this.position=0):(this.buffer=Array.isArray(s)?ne.fromNumberArray(s):ne.toLocalBufferType(s),this.position=this.buffer.byteLength)}put(s){if(typeof s=="string"&&s.length!==1)throw new Z("only accepts single character String");if(typeof s!="number"&&s.length!==1)throw new Z("only accepts single character Uint8Array or Array");let U;if(U=typeof s=="string"?s.charCodeAt(0):typeof s=="number"?s:s[0],U<0||U>255)throw new Z("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.byteLength>this.position)this.buffer[this.position++]=U;else{let L=ne.allocate(Me.BUFFER_SIZE+this.buffer.length);L.set(this.buffer,0),this.buffer=L,this.buffer[this.position++]=U}}write(s,U){if(U=typeof U=="number"?U:this.position,this.buffer.byteLength<U+s.length){let L=ne.allocate(this.buffer.byteLength+s.length);L.set(this.buffer,0),this.buffer=L}if(ArrayBuffer.isView(s))this.buffer.set(ne.toLocalBufferType(s),U),this.position=U+s.byteLength>this.position?U+s.length:this.position;else if(typeof s=="string")throw new Z("input cannot be string")}read(s,U){let L=s+(U=U&&U>0?U:this.position);return this.buffer.subarray(s,L>this.position?this.position:L)}value(){return this.buffer.length===this.position?this.buffer:this.buffer.subarray(0,this.position)}length(){return this.position}toJSON(){return ne.toBase64(this.buffer.subarray(0,this.position))}toString(s){return s==="hex"?ne.toHex(this.buffer.subarray(0,this.position)):s==="base64"?ne.toBase64(this.buffer.subarray(0,this.position)):ne.toUTF8(this.buffer,0,this.position,!1)}toExtendedJSON(s){s=s||{},this.sub_type===Me.SUBTYPE_VECTOR&&qe(this);let U=ne.toBase64(this.buffer),L=Number(this.sub_type).toString(16);return s.legacy?{$binary:U,$type:L.length===1?"0"+L:L}:{$binary:{base64:U,subType:L.length===1?"0"+L:L}}}toUUID(){if(this.sub_type===Me.SUBTYPE_UUID)return new wt(this.buffer.subarray(0,this.position));throw new Z(`Binary sub_type "${this.sub_type}" is not supported for converting to UUID. Only "${Me.SUBTYPE_UUID}" is currently supported.`)}static createFromHexString(s,U){return new Me(ne.fromHex(s),U)}static createFromBase64(s,U){return new Me(ne.fromBase64(s),U)}static fromExtendedJSON(s,U){let L,Pe;if(U=U||{},"$binary"in s?U.legacy&&typeof s.$binary=="string"&&"$type"in s?(Pe=s.$type?parseInt(s.$type,16):0,L=ne.fromBase64(s.$binary)):typeof s.$binary!="string"&&(Pe=s.$binary.subType?parseInt(s.$binary.subType,16):0,L=ne.fromBase64(s.$binary.base64)):"$uuid"in s&&(Pe=4,L=wt.bytesFromString(s.$uuid)),!L)throw new Z(`Unexpected Binary Extended JSON format ${JSON.stringify(s)}`);return Pe===Se?new wt(L):new Me(L,Pe)}inspect(s,U,L){return L??=u,`Binary.createFromBase64(${L(ne.toBase64(this.buffer.subarray(0,this.position)),U)}, ${L(this.sub_type,U)})`}toInt8Array(){if(this.sub_type!==Me.SUBTYPE_VECTOR)throw new Z("Binary sub_type is not Vector");if(this.buffer[0]!==Me.VECTOR_TYPE.Int8)throw new Z("Binary datatype field is not Int8");return qe(this),new Int8Array(this.buffer.buffer.slice(this.buffer.byteOffset+2,this.buffer.byteOffset+this.position))}toFloat32Array(){if(this.sub_type!==Me.SUBTYPE_VECTOR)throw new Z("Binary sub_type is not Vector");if(this.buffer[0]!==Me.VECTOR_TYPE.Float32)throw new Z("Binary datatype field is not Float32");qe(this);let s=new Uint8Array(this.buffer.buffer.slice(this.buffer.byteOffset+2,this.buffer.byteOffset+this.position));return Be.isBigEndian&&ne.swap32(s),new Float32Array(s.buffer)}toPackedBits(){if(this.sub_type!==Me.SUBTYPE_VECTOR)throw new Z("Binary sub_type is not Vector");if(this.buffer[0]!==Me.VECTOR_TYPE.PackedBit)throw new Z("Binary datatype field is not packed bit");return qe(this),new Uint8Array(this.buffer.buffer.slice(this.buffer.byteOffset+2,this.buffer.byteOffset+this.position))}toBits(){if(this.sub_type!==Me.SUBTYPE_VECTOR)throw new Z("Binary sub_type is not Vector");if(this.buffer[0]!==Me.VECTOR_TYPE.PackedBit)throw new Z("Binary datatype field is not packed bit");qe(this);let s=8*(this.length()-2)-this.buffer[1],U=new Int8Array(s);for(let L=0;L<U.length;L++){let Pe=L/8|0,ke=this.buffer[Pe+2]>>7-L%8&1;U[L]=ke}return U}static fromInt8Array(s){let U=ne.allocate(s.byteLength+2);U[0]=Me.VECTOR_TYPE.Int8,U[1]=0;let L=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);U.set(L,2);let Pe=new this(U,this.SUBTYPE_VECTOR);return qe(Pe),Pe}static fromFloat32Array(s){let U=ne.allocate(s.byteLength+2);U[0]=Me.VECTOR_TYPE.Float32,U[1]=0;let L=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);U.set(L,2),Be.isBigEndian&&ne.swap32(new Uint8Array(U.buffer,2));let Pe=new this(U,this.SUBTYPE_VECTOR);return qe(Pe),Pe}static fromPackedBits(s,U=0){let L=ne.allocate(s.byteLength+2);L[0]=Me.VECTOR_TYPE.PackedBit,L[1]=U,L.set(s,2);let Pe=new this(L,this.SUBTYPE_VECTOR);return qe(Pe),Pe}static fromBits(s){let U=s.length+7>>>3,L=new Uint8Array(U+2);L[0]=Me.VECTOR_TYPE.PackedBit;let Pe=s.length%8;L[1]=Pe===0?0:8-Pe;for(let ke=0;ke<s.length;ke++){let Ze=ke>>>3,We=s[ke];if(We!==0&&We!==1)throw new Z(`Invalid bit value at ${ke}: must be 0 or 1, found ${s[ke]}`);if(We===0)continue;let Oe=7-ke%8;L[Ze+2]|=We<<Oe}return new this(L,Me.SUBTYPE_VECTOR)}}function qe(O){if(O.sub_type!==Me.SUBTYPE_VECTOR)return;let s=O.position,U=O.buffer[0],L=O.buffer[1];if((U===Me.VECTOR_TYPE.Float32||U===Me.VECTOR_TYPE.Int8)&&L!==0)throw new Z("Invalid Vector: padding must be zero for int8 and float32 vectors");if(U===Me.VECTOR_TYPE.Float32&&s!==0&&s-2!=0&&(s-2)%4!=0)throw new Z("Invalid Vector: Float32 vector must contain a multiple of 4 bytes");if(U===Me.VECTOR_TYPE.PackedBit&&L!==0&&s===2)throw new Z("Invalid Vector: padding must be zero for packed bit vectors that are empty");if(U===Me.VECTOR_TYPE.PackedBit&&L>7)throw new Z(`Invalid Vector: padding must be a value between 0 and 7. found: ${L}`)}Me.BSON_BINARY_SUBTYPE_DEFAULT=0,Me.BUFFER_SIZE=256,Me.SUBTYPE_DEFAULT=0,Me.SUBTYPE_FUNCTION=1,Me.SUBTYPE_BYTE_ARRAY=2,Me.SUBTYPE_UUID_OLD=3,Me.SUBTYPE_UUID=4,Me.SUBTYPE_MD5=5,Me.SUBTYPE_ENCRYPTED=6,Me.SUBTYPE_COLUMN=7,Me.SUBTYPE_SENSITIVE=8,Me.SUBTYPE_VECTOR=9,Me.SUBTYPE_USER_DEFINED=128,Me.VECTOR_TYPE=Object.freeze({Int8:3,Float32:39,PackedBit:16});let vt=/^[0-9A-F]{32}$/i,jt=/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i;class wt extends Me{constructor(s){let U;if(s==null)U=wt.generate();else if(s instanceof wt)U=ne.toLocalBufferType(new Uint8Array(s.buffer));else if(ArrayBuffer.isView(s)&&s.byteLength===16)U=ne.toLocalBufferType(s);else{if(typeof s!="string")throw new Z("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");U=wt.bytesFromString(s)}super(U,Se)}get id(){return this.buffer}set id(s){this.buffer=s}toHexString(s=!0){return s?[ne.toHex(this.buffer.subarray(0,4)),ne.toHex(this.buffer.subarray(4,6)),ne.toHex(this.buffer.subarray(6,8)),ne.toHex(this.buffer.subarray(8,10)),ne.toHex(this.buffer.subarray(10,16))].join("-"):ne.toHex(this.buffer)}toString(s){return s==="hex"?ne.toHex(this.id):s==="base64"?ne.toBase64(this.id):this.toHexString()}toJSON(){return this.toHexString()}equals(s){if(!s)return!1;if(s instanceof wt)return ne.equals(s.id,this.id);try{return ne.equals(new wt(s).id,this.id)}catch{return!1}}toBinary(){return new Me(this.id,Me.SUBTYPE_UUID)}static generate(){let s=ne.randomBytes(16);return s[6]=15&s[6]|64,s[8]=63&s[8]|128,s}static isValid(s){return!!s&&(typeof s=="string"?wt.isValidUUIDString(s):b(s)?s.byteLength===16:s._bsontype==="Binary"&&s.sub_type===this.SUBTYPE_UUID&&s.buffer.byteLength===16)}static createFromHexString(s){let U=wt.bytesFromString(s);return new wt(U)}static createFromBase64(s){return new wt(ne.fromBase64(s))}static bytesFromString(s){if(!wt.isValidUUIDString(s))throw new Z("UUID string representation must be 32 hex digits or canonical hyphenated representation");return ne.fromHex(s.replace(/-/g,""))}static isValidUUIDString(s){return vt.test(s)||jt.test(s)}inspect(s,U,L){return L??=u,`new UUID(${L(this.toHexString(),U)})`}}class ft extends ye{get _bsontype(){return"Code"}constructor(s,U){super(),this.code=s.toString(),this.scope=U??null}toJSON(){return this.scope!=null?{code:this.code,scope:this.scope}:{code:this.code}}toExtendedJSON(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}}static fromExtendedJSON(s){return new ft(s.$code,s.$scope)}inspect(s,U,L){L??=u;let Pe=L(this.code,U),ke=Pe.includes(`
`);return this.scope!=null&&(Pe+=`,${ke?`
`:" "}${L(this.scope,U)}`),`new Code(${ke?`
`:""}${Pe}${ke&&this.scope===null?`
`:""})`}}function fr(O){return O!=null&&typeof O=="object"&&"$id"in O&&O.$id!=null&&"$ref"in O&&typeof O.$ref=="string"&&(!("$db"in O)||"$db"in O&&typeof O.$db=="string")}class Nt extends ye{get _bsontype(){return"DBRef"}constructor(s,U,L,Pe){super();let ke=s.split(".");ke.length===2&&(L=ke.shift(),s=ke.shift()),this.collection=s,this.oid=U,this.db=L,this.fields=Pe||{}}get namespace(){return this.collection}set namespace(s){this.collection=s}toJSON(){let s=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return this.db!=null&&(s.$db=this.db),s}toExtendedJSON(s){s=s||{};let U={$ref:this.collection,$id:this.oid};return s.legacy||(this.db&&(U.$db=this.db),U=Object.assign(U,this.fields)),U}static fromExtendedJSON(s){let U=Object.assign({},s);return delete U.$ref,delete U.$id,delete U.$db,new Nt(s.$ref,s.$id,s.$db,U)}inspect(s,U,L){L??=u;let Pe=[L(this.namespace,U),L(this.oid,U),...this.db?[L(this.db,U)]:[],...Object.keys(this.fields).length>0?[L(this.fields,U)]:[]];return Pe[1]=L===u?`new ObjectId(${Pe[1]})`:Pe[1],`new DBRef(${Pe.join(", ")})`}}function Bt(O){if(O==="")return O;let s=0,U=O[s]==="-",L=O[s]==="+";(L||U)&&(s+=1);let Pe=!1;for(;s<O.length&&O[s]==="0";++s)Pe=!0;return Pe?`${U?"-":""}${O.length===s?"0":O.slice(s)}`:L?O.slice(1):O}let Ht;try{Ht=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}let Lt=4294967296,qt=18446744073709552e3,Ir=qt/2,ze={},br={},yr=/^(\+?0|(\+|-)?[1-9][0-9]*)$/;class Ae extends ye{get _bsontype(){return"Long"}get __isLong__(){return!0}constructor(s=0,U,L){super();let Pe=typeof U=="boolean"?U:!!L,ke=typeof U=="number"?U:0,Ze=typeof s=="string"?Ae.fromString(s,Pe):typeof s=="bigint"?Ae.fromBigInt(s,Pe):{low:0|s,high:0|ke,unsigned:Pe};this.low=Ze.low,this.high=Ze.high,this.unsigned=Ze.unsigned}static fromBits(s,U,L){return new Ae(s,U,L)}static fromInt(s,U){let L,Pe,ke;return U?(ke=0<=(s>>>=0)&&s<256)&&(Pe=br[s],Pe)?Pe:(L=Ae.fromBits(s,(0|s)<0?-1:0,!0),ke&&(br[s]=L),L):(ke=-128<=(s|=0)&&s<128)&&(Pe=ze[s],Pe)?Pe:(L=Ae.fromBits(s,s<0?-1:0,!1),ke&&(ze[s]=L),L)}static fromNumber(s,U){if(isNaN(s))return U?Ae.UZERO:Ae.ZERO;if(U){if(s<0)return Ae.UZERO;if(s>=qt)return Ae.MAX_UNSIGNED_VALUE}else{if(s<=-9223372036854776e3)return Ae.MIN_VALUE;if(s+1>=Ir)return Ae.MAX_VALUE}return s<0?Ae.fromNumber(-s,U).neg():Ae.fromBits(s%Lt|0,s/Lt|0,U)}static fromBigInt(s,U){let L=BigInt(4294967295),Pe=BigInt(32);return new Ae(Number(s&L),Number(s>>Pe&L),U)}static _fromString(s,U,L){if(s.length===0)throw new Z("empty string");if(L<2||36<L)throw new Z("radix");let Pe;if((Pe=s.indexOf("-"))>0)throw new Z("interior hyphen");if(Pe===0)return Ae._fromString(s.substring(1),U,L).neg();let ke=Ae.fromNumber(Math.pow(L,8)),Ze=Ae.ZERO;for(let We=0;We<s.length;We+=8){let Oe=Math.min(8,s.length-We),St=parseInt(s.substring(We,We+Oe),L);if(Oe<8){let ut=Ae.fromNumber(Math.pow(L,Oe));Ze=Ze.mul(ut).add(Ae.fromNumber(St))}else Ze=Ze.mul(ke),Ze=Ze.add(Ae.fromNumber(St))}return Ze.unsigned=U,Ze}static fromStringStrict(s,U,L){let Pe=!1;if(typeof U=="number"?(L=U,U=!1):Pe=!!U,L??=10,s.trim()!==s)throw new Z(`Input: '${s}' contains leading and/or trailing whitespace`);if(!function(We,Oe){let St="0123456789abcdefghijklmnopqrstuvwxyz".slice(0,Oe=Oe??10);return!new RegExp(`[^-+${St}]`,"i").test(We)&&We}(s,L))throw new Z(`Input: '${s}' contains invalid characters for radix: ${L}`);let ke=Bt(s),Ze=Ae._fromString(ke,Pe,L);if(Ze.toString(L).toLowerCase()!==ke.toLowerCase())throw new Z(`Input: ${s} is not representable as ${Ze.unsigned?"an unsigned":"a signed"} 64-bit Long ${L!=null?`with radix: ${L}`:""}`);return Ze}static fromString(s,U,L){let Pe=!1;return typeof U=="number"?(L=U,U=!1):Pe=!!U,L??=10,s==="NaN"&&L<24||(s==="Infinity"||s==="+Infinity"||s==="-Infinity")&&L<35?Ae.ZERO:Ae._fromString(s,Pe,L)}static fromBytes(s,U,L){return L?Ae.fromBytesLE(s,U):Ae.fromBytesBE(s,U)}static fromBytesLE(s,U){return new Ae(s[0]|s[1]<<8|s[2]<<16|s[3]<<24,s[4]|s[5]<<8|s[6]<<16|s[7]<<24,U)}static fromBytesBE(s,U){return new Ae(s[4]<<24|s[5]<<16|s[6]<<8|s[7],s[0]<<24|s[1]<<16|s[2]<<8|s[3],U)}static isLong(s){return s!=null&&typeof s=="object"&&"__isLong__"in s&&s.__isLong__===!0}static fromValue(s,U){return typeof s=="number"?Ae.fromNumber(s,U):typeof s=="string"?Ae.fromString(s,U):Ae.fromBits(s.low,s.high,typeof U=="boolean"?U:s.unsigned)}add(s){Ae.isLong(s)||(s=Ae.fromValue(s));let U=this.high>>>16,L=65535&this.high,Pe=this.low>>>16,ke=65535&this.low,Ze=s.high>>>16,We=65535&s.high,Oe=s.low>>>16,St=0,ut=0,Ye=0,ot=0;return ot+=ke+(65535&s.low),Ye+=ot>>>16,ot&=65535,Ye+=Pe+Oe,ut+=Ye>>>16,Ye&=65535,ut+=L+We,St+=ut>>>16,ut&=65535,St+=U+Ze,St&=65535,Ae.fromBits(Ye<<16|ot,St<<16|ut,this.unsigned)}and(s){return Ae.isLong(s)||(s=Ae.fromValue(s)),Ae.fromBits(this.low&s.low,this.high&s.high,this.unsigned)}compare(s){if(Ae.isLong(s)||(s=Ae.fromValue(s)),this.eq(s))return 0;let U=this.isNegative(),L=s.isNegative();return U&&!L?-1:!U&&L?1:this.unsigned?s.high>>>0>this.high>>>0||s.high===this.high&&s.low>>>0>this.low>>>0?-1:1:this.sub(s).isNegative()?-1:1}comp(s){return this.compare(s)}divide(s){if(Ae.isLong(s)||(s=Ae.fromValue(s)),s.isZero())throw new Z("division by zero");if(Ht){if(!this.unsigned&&this.high===-2147483648&&s.low===-1&&s.high===-1)return this;let ke=(this.unsigned?Ht.div_u:Ht.div_s)(this.low,this.high,s.low,s.high);return Ae.fromBits(ke,Ht.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ae.UZERO:Ae.ZERO;let U,L,Pe;if(this.unsigned){if(s.unsigned||(s=s.toUnsigned()),s.gt(this))return Ae.UZERO;if(s.gt(this.shru(1)))return Ae.UONE;Pe=Ae.UZERO}else{if(this.eq(Ae.MIN_VALUE))return s.eq(Ae.ONE)||s.eq(Ae.NEG_ONE)?Ae.MIN_VALUE:s.eq(Ae.MIN_VALUE)?Ae.ONE:(U=this.shr(1).div(s).shl(1),U.eq(Ae.ZERO)?s.isNegative()?Ae.ONE:Ae.NEG_ONE:(L=this.sub(s.mul(U)),Pe=U.add(L.div(s)),Pe));if(s.eq(Ae.MIN_VALUE))return this.unsigned?Ae.UZERO:Ae.ZERO;if(this.isNegative())return s.isNegative()?this.neg().div(s.neg()):this.neg().div(s).neg();if(s.isNegative())return this.div(s.neg()).neg();Pe=Ae.ZERO}for(L=this;L.gte(s);){U=Math.max(1,Math.floor(L.toNumber()/s.toNumber()));let ke=Math.ceil(Math.log(U)/Math.LN2),Ze=ke<=48?1:Math.pow(2,ke-48),We=Ae.fromNumber(U),Oe=We.mul(s);for(;Oe.isNegative()||Oe.gt(L);)U-=Ze,We=Ae.fromNumber(U,this.unsigned),Oe=We.mul(s);We.isZero()&&(We=Ae.ONE),Pe=Pe.add(We),L=L.sub(Oe)}return Pe}div(s){return this.divide(s)}equals(s){return Ae.isLong(s)||(s=Ae.fromValue(s)),(this.unsigned===s.unsigned||this.high>>>31!=1||s.high>>>31!=1)&&this.high===s.high&&this.low===s.low}eq(s){return this.equals(s)}getHighBits(){return this.high}getHighBitsUnsigned(){return this.high>>>0}getLowBits(){return this.low}getLowBitsUnsigned(){return this.low>>>0}getNumBitsAbs(){if(this.isNegative())return this.eq(Ae.MIN_VALUE)?64:this.neg().getNumBitsAbs();let s=this.high!==0?this.high:this.low,U;for(U=31;U>0&&!(s&1<<U);U--);return this.high!==0?U+33:U+1}greaterThan(s){return this.comp(s)>0}gt(s){return this.greaterThan(s)}greaterThanOrEqual(s){return this.comp(s)>=0}gte(s){return this.greaterThanOrEqual(s)}ge(s){return this.greaterThanOrEqual(s)}isEven(){return!(1&this.low)}isNegative(){return!this.unsigned&&this.high<0}isOdd(){return!(1&~this.low)}isPositive(){return this.unsigned||this.high>=0}isZero(){return this.high===0&&this.low===0}lessThan(s){return this.comp(s)<0}lt(s){return this.lessThan(s)}lessThanOrEqual(s){return this.comp(s)<=0}lte(s){return this.lessThanOrEqual(s)}modulo(s){if(Ae.isLong(s)||(s=Ae.fromValue(s)),Ht){let U=(this.unsigned?Ht.rem_u:Ht.rem_s)(this.low,this.high,s.low,s.high);return Ae.fromBits(U,Ht.get_high(),this.unsigned)}return this.sub(this.div(s).mul(s))}mod(s){return this.modulo(s)}rem(s){return this.modulo(s)}multiply(s){if(this.isZero())return Ae.ZERO;if(Ae.isLong(s)||(s=Ae.fromValue(s)),Ht){let Tt=Ht.mul(this.low,this.high,s.low,s.high);return Ae.fromBits(Tt,Ht.get_high(),this.unsigned)}if(s.isZero())return Ae.ZERO;if(this.eq(Ae.MIN_VALUE))return s.isOdd()?Ae.MIN_VALUE:Ae.ZERO;if(s.eq(Ae.MIN_VALUE))return this.isOdd()?Ae.MIN_VALUE:Ae.ZERO;if(this.isNegative())return s.isNegative()?this.neg().mul(s.neg()):this.neg().mul(s).neg();if(s.isNegative())return this.mul(s.neg()).neg();if(this.lt(Ae.TWO_PWR_24)&&s.lt(Ae.TWO_PWR_24))return Ae.fromNumber(this.toNumber()*s.toNumber(),this.unsigned);let U=this.high>>>16,L=65535&this.high,Pe=this.low>>>16,ke=65535&this.low,Ze=s.high>>>16,We=65535&s.high,Oe=s.low>>>16,St=65535&s.low,ut=0,Ye=0,ot=0,At=0;return At+=ke*St,ot+=At>>>16,At&=65535,ot+=Pe*St,Ye+=ot>>>16,ot&=65535,ot+=ke*Oe,Ye+=ot>>>16,ot&=65535,Ye+=L*St,ut+=Ye>>>16,Ye&=65535,Ye+=Pe*Oe,ut+=Ye>>>16,Ye&=65535,Ye+=ke*We,ut+=Ye>>>16,Ye&=65535,ut+=U*St+L*Oe+Pe*We+ke*Ze,ut&=65535,Ae.fromBits(ot<<16|At,ut<<16|Ye,this.unsigned)}mul(s){return this.multiply(s)}negate(){return!this.unsigned&&this.eq(Ae.MIN_VALUE)?Ae.MIN_VALUE:this.not().add(Ae.ONE)}neg(){return this.negate()}not(){return Ae.fromBits(~this.low,~this.high,this.unsigned)}notEquals(s){return!this.equals(s)}neq(s){return this.notEquals(s)}ne(s){return this.notEquals(s)}or(s){return Ae.isLong(s)||(s=Ae.fromValue(s)),Ae.fromBits(this.low|s.low,this.high|s.high,this.unsigned)}shiftLeft(s){return Ae.isLong(s)&&(s=s.toInt()),(s&=63)==0?this:s<32?Ae.fromBits(this.low<<s,this.high<<s|this.low>>>32-s,this.unsigned):Ae.fromBits(0,this.low<<s-32,this.unsigned)}shl(s){return this.shiftLeft(s)}shiftRight(s){return Ae.isLong(s)&&(s=s.toInt()),(s&=63)==0?this:s<32?Ae.fromBits(this.low>>>s|this.high<<32-s,this.high>>s,this.unsigned):Ae.fromBits(this.high>>s-32,this.high>=0?0:-1,this.unsigned)}shr(s){return this.shiftRight(s)}shiftRightUnsigned(s){if(Ae.isLong(s)&&(s=s.toInt()),(s&=63)==0)return this;{let U=this.high;if(s<32){let L=this.low;return Ae.fromBits(L>>>s|U<<32-s,U>>>s,this.unsigned)}return s===32?Ae.fromBits(U,0,this.unsigned):Ae.fromBits(U>>>s-32,0,this.unsigned)}}shr_u(s){return this.shiftRightUnsigned(s)}shru(s){return this.shiftRightUnsigned(s)}subtract(s){return Ae.isLong(s)||(s=Ae.fromValue(s)),this.add(s.neg())}sub(s){return this.subtract(s)}toInt(){return this.unsigned?this.low>>>0:this.low}toNumber(){return this.unsigned?(this.high>>>0)*Lt+(this.low>>>0):this.high*Lt+(this.low>>>0)}toBigInt(){return BigInt(this.toString())}toBytes(s){return s?this.toBytesLE():this.toBytesBE()}toBytesLE(){let s=this.high,U=this.low;return[255&U,U>>>8&255,U>>>16&255,U>>>24,255&s,s>>>8&255,s>>>16&255,s>>>24]}toBytesBE(){let s=this.high,U=this.low;return[s>>>24,s>>>16&255,s>>>8&255,255&s,U>>>24,U>>>16&255,U>>>8&255,255&U]}toSigned(){return this.unsigned?Ae.fromBits(this.low,this.high,!1):this}toString(s){if((s=s||10)<2||36<s)throw new Z("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Ae.MIN_VALUE)){let ke=Ae.fromNumber(s),Ze=this.div(ke),We=Ze.mul(ke).sub(this);return Ze.toString(s)+We.toInt().toString(s)}return"-"+this.neg().toString(s)}let U=Ae.fromNumber(Math.pow(s,6),this.unsigned),L=this,Pe="";for(;;){let ke=L.div(U),Ze=(L.sub(ke.mul(U)).toInt()>>>0).toString(s);if(L=ke,L.isZero())return Ze+Pe;for(;Ze.length<6;)Ze="0"+Ze;Pe=""+Ze+Pe}}toUnsigned(){return this.unsigned?this:Ae.fromBits(this.low,this.high,!0)}xor(s){return Ae.isLong(s)||(s=Ae.fromValue(s)),Ae.fromBits(this.low^s.low,this.high^s.high,this.unsigned)}eqz(){return this.isZero()}le(s){return this.lessThanOrEqual(s)}toExtendedJSON(s){return s&&s.relaxed?this.toNumber():{$numberLong:this.toString()}}static fromExtendedJSON(s,U){let{useBigInt64:L=!1,relaxed:Pe=!0}={...U};if(s.$numberLong.length>20)throw new Z("$numberLong string is too long");if(!yr.test(s.$numberLong))throw new Z(`$numberLong string "${s.$numberLong}" is in an invalid format`);if(L){let Ze=BigInt(s.$numberLong);return BigInt.asIntN(64,Ze)}let ke=Ae.fromString(s.$numberLong);return Pe?ke.toNumber():ke}inspect(s,U,L){return L??=u,`new Long(${L(this.toString(),U)}${this.unsigned?`, ${L(this.unsigned,U)}`:""})`}}Ae.TWO_PWR_24=Ae.fromInt(16777216),Ae.MAX_UNSIGNED_VALUE=Ae.fromBits(-1,-1,!0),Ae.ZERO=Ae.fromInt(0),Ae.UZERO=Ae.fromInt(0,!0),Ae.ONE=Ae.fromInt(1),Ae.UONE=Ae.fromInt(1,!0),Ae.NEG_ONE=Ae.fromInt(-1),Ae.MAX_VALUE=Ae.fromBits(-1,2147483647,!1),Ae.MIN_VALUE=Ae.fromBits(0,-2147483648,!1);let Nr=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,sa=/^(\+|-)?(Infinity|inf)$/i,Yr=/^(\+|-)?NaN$/i,kr=6111,Vr=-6176,ua=ne.fromNumberArray([124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),Xr=ne.fromNumberArray([248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),ca=ne.fromNumberArray([120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),R=/^([-+])?(\d+)?$/;function ee(O){return!isNaN(parseInt(O,10))}function fe(O){let s=Ae.fromNumber(1e9),U=Ae.fromNumber(0);if(!(O.parts[0]||O.parts[1]||O.parts[2]||O.parts[3]))return{quotient:O,rem:U};for(let L=0;L<=3;L++)U=U.shiftLeft(32),U=U.add(new Ae(O.parts[L],0)),O.parts[L]=U.div(s).low,U=U.modulo(s);return{quotient:O,rem:U}}function ge(O,s){throw new Z(`"${O}" is not a valid Decimal128 string - ${s}`)}class xe extends ye{get _bsontype(){return"Decimal128"}constructor(s){if(super(),typeof s=="string")this.bytes=xe.fromString(s).bytes;else{if(!(s instanceof Uint8Array||b(s)))throw new Z("Decimal128 must take a Buffer or string");if(s.byteLength!==16)throw new Z("Decimal128 must take a Buffer of 16 bytes");this.bytes=s}}static fromString(s){return xe._fromString(s,{allowRounding:!1})}static fromStringWithRounding(s){return xe._fromString(s,{allowRounding:!0})}static _fromString(s,U){let L=!1,Pe=!1,ke=!1,Ze=!1,We=0,Oe=0,St=0,ut=0,Ye=0,ot=[0],At=0,Tt=0,er=0,gr=0,hr=new Ae(0,0),Ar=new Ae(0,0),mr=0,yt=0;if(s.length>=7e3)throw new Z(s+" not a valid Decimal128 string");let Rt=s.match(Nr),oa=s.match(sa),ar=s.match(Yr);if(!Rt&&!oa&&!ar||s.length===0)throw new Z(s+" not a valid Decimal128 string");if(Rt){let Mt=Rt[2],Kr=Rt[4],Mr=Rt[5],Fr=Rt[6];Kr&&Fr===void 0&&ge(s,"missing exponent power"),Kr&&Mt===void 0&&ge(s,"missing exponent base"),Kr===void 0&&(Mr||Fr)&&ge(s,"missing e before exponent")}if(s[yt]!=="+"&&s[yt]!=="-"||(Pe=!0,L=s[yt++]==="-"),!ee(s[yt])&&s[yt]!=="."){if(s[yt]==="i"||s[yt]==="I")return new xe(L?Xr:ca);if(s[yt]==="N")return new xe(ua)}for(;ee(s[yt])||s[yt]===".";)s[yt]!=="."?(At<34&&(s[yt]!=="0"||Ze)&&(Ze||(Ye=Oe),Ze=!0,ot[Tt++]=parseInt(s[yt],10),At+=1),Ze&&(St+=1),ke&&(ut+=1),Oe+=1,yt+=1):(ke&&ge(s,"contains multiple periods"),ke=!0,yt+=1);if(ke&&!Oe)throw new Z(s+" not a valid Decimal128 string");if(s[yt]==="e"||s[yt]==="E"){let Mt=s.substr(++yt).match(R);if(!Mt||!Mt[2])return new xe(ua);gr=parseInt(Mt[0],10),yt+=Mt[0].length}if(s[yt])return new xe(ua);if(At){if(er=At-1,We=St,We!==1)for(;s[Ye+We-1+Number(Pe)+Number(ke)]==="0";)We-=1}else ot[0]=0,St=1,At=1,We=0;for(gr<=ut&&ut>gr+16384?gr=Vr:gr-=ut;gr>kr;){if(er+=1,er>=34){if(We===0){gr=kr;break}ge(s,"overflow")}gr-=1}if(U.allowRounding){for(;gr<Vr||At<St;){if(er===0&&We<At){gr=Vr,We=0;break}if(At<St?St-=1:er-=1,gr<kr)gr+=1;else{if(ot.join("").match(/^0+$/)){gr=kr;break}ge(s,"overflow")}}if(er+1<We){let Mt=Oe;ke&&(Ye+=1,Mt+=1),Pe&&(Ye+=1,Mt+=1);let Kr=parseInt(s[Ye+er+1],10),Mr=0;if(Kr>=5&&(Mr=1,Kr===5)){Mr=ot[er]%2==1?1:0;for(let Fr=Ye+er+2;Fr<Mt;Fr++)if(parseInt(s[Fr],10)){Mr=1;break}}if(Mr){let Fr=er;for(;Fr>=0&&++ot[Fr]>9;Fr--)if(ot[Fr]=0,Fr===0){if(!(gr<kr))return new xe(L?Xr:ca);gr+=1,ot[Fr]=1}}}}else{for(;gr<Vr||At<St;){if(er===0){if(We===0){gr=Vr;break}ge(s,"exponent underflow")}At<St?(s[St-1+Number(Pe)+Number(ke)]!=="0"&&We!==0&&ge(s,"inexact rounding"),St-=1):(ot[er]!==0&&ge(s,"inexact rounding"),er-=1),gr<kr?gr+=1:ge(s,"overflow")}er+1<We&&(ke&&(Ye+=1),Pe&&(Ye+=1),parseInt(s[Ye+er+1],10)!==0&&ge(s,"inexact rounding"))}if(hr=Ae.fromNumber(0),Ar=Ae.fromNumber(0),We===0)hr=Ae.fromNumber(0),Ar=Ae.fromNumber(0);else if(er<17){let Mt=0;for(Ar=Ae.fromNumber(ot[Mt++]),hr=new Ae(0,0);Mt<=er;Mt++)Ar=Ar.multiply(Ae.fromNumber(10)),Ar=Ar.add(Ae.fromNumber(ot[Mt]))}else{let Mt=0;for(hr=Ae.fromNumber(ot[Mt++]);Mt<=er-17;Mt++)hr=hr.multiply(Ae.fromNumber(10)),hr=hr.add(Ae.fromNumber(ot[Mt]));for(Ar=Ae.fromNumber(ot[Mt++]);Mt<=er;Mt++)Ar=Ar.multiply(Ae.fromNumber(10)),Ar=Ar.add(Ae.fromNumber(ot[Mt]))}let Br=function(Mt,Kr){if(!Mt&&!Kr)return{high:Ae.fromNumber(0),low:Ae.fromNumber(0)};let Mr=Mt.shiftRightUnsigned(32),Fr=new Ae(Mt.getLowBits(),0),nn=Kr.shiftRightUnsigned(32),on=new Ae(Kr.getLowBits(),0),xa=Mr.multiply(nn),wa=Mr.multiply(on),Ai=Fr.multiply(nn),Da=Fr.multiply(on);return xa=xa.add(wa.shiftRightUnsigned(32)),wa=new Ae(wa.getLowBits(),0).add(Ai).add(Da.shiftRightUnsigned(32)),xa=xa.add(wa.shiftRightUnsigned(32)),Da=wa.shiftLeft(32).add(new Ae(Da.getLowBits(),0)),{high:xa,low:Da}}(hr,Ae.fromString("100000000000000000"));Br.low=Br.low.add(Ar),function(Mt,Kr){let Mr=Mt.high>>>0,Fr=Kr.high>>>0;return Mr<Fr||Mr===Fr&&Mt.low>>>0<Kr.low>>>0}(Br.low,Ar)&&(Br.high=Br.high.add(Ae.fromNumber(1))),mr=gr+6176;let bt={low:Ae.fromNumber(0),high:Ae.fromNumber(0)};Br.high.shiftRightUnsigned(49).and(Ae.fromNumber(1)).equals(Ae.fromNumber(1))?(bt.high=bt.high.or(Ae.fromNumber(3).shiftLeft(61)),bt.high=bt.high.or(Ae.fromNumber(mr).and(Ae.fromNumber(16383).shiftLeft(47))),bt.high=bt.high.or(Br.high.and(Ae.fromNumber(0x7fffffffffff)))):(bt.high=bt.high.or(Ae.fromNumber(16383&mr).shiftLeft(49)),bt.high=bt.high.or(Br.high.and(Ae.fromNumber(562949953421311)))),bt.low=Br.low,L&&(bt.high=bt.high.or(Ae.fromString("9223372036854775808")));let Et=ne.allocateUnsafe(16);return yt=0,Et[yt++]=255&bt.low.low,Et[yt++]=bt.low.low>>8&255,Et[yt++]=bt.low.low>>16&255,Et[yt++]=bt.low.low>>24&255,Et[yt++]=255&bt.low.high,Et[yt++]=bt.low.high>>8&255,Et[yt++]=bt.low.high>>16&255,Et[yt++]=bt.low.high>>24&255,Et[yt++]=255&bt.high.low,Et[yt++]=bt.high.low>>8&255,Et[yt++]=bt.high.low>>16&255,Et[yt++]=bt.high.low>>24&255,Et[yt++]=255&bt.high.high,Et[yt++]=bt.high.high>>8&255,Et[yt++]=bt.high.high>>16&255,Et[yt++]=bt.high.high>>24&255,new xe(Et)}toString(){let s,U=0,L=new Array(36);for(let mr=0;mr<L.length;mr++)L[mr]=0;let Pe,ke,Ze,We=0,Oe=!1,St={parts:[0,0,0,0]},ut=[];We=0;let Ye=this.bytes,ot=Ye[We++]|Ye[We++]<<8|Ye[We++]<<16|Ye[We++]<<24,At=Ye[We++]|Ye[We++]<<8|Ye[We++]<<16|Ye[We++]<<24,Tt=Ye[We++]|Ye[We++]<<8|Ye[We++]<<16|Ye[We++]<<24,er=Ye[We++]|Ye[We++]<<8|Ye[We++]<<16|Ye[We++]<<24;We=0,(new Ae(ot,At),new Ae(Tt,er)).lessThan(Ae.ZERO)&&ut.push("-");let gr=er>>26&31;if(gr>>3==3){if(gr===30)return ut.join("")+"Infinity";if(gr===31)return"NaN";s=er>>15&16383,Pe=8+(er>>14&1)}else Pe=er>>14&7,s=er>>17&16383;let hr=s-6176;if(St.parts[0]=(16383&er)+((15&Pe)<<14),St.parts[1]=Tt,St.parts[2]=At,St.parts[3]=ot,St.parts[0]===0&&St.parts[1]===0&&St.parts[2]===0&&St.parts[3]===0)Oe=!0;else for(Ze=3;Ze>=0;Ze--){let mr=0,yt=fe(St);if(St=yt.quotient,mr=yt.rem.low,mr)for(ke=8;ke>=0;ke--)L[9*Ze+ke]=mr%10,mr=Math.floor(mr/10)}if(Oe)U=1,L[We]=0;else for(U=36;!L[We];)U-=1,We+=1;let Ar=U-1+hr;if(Ar>=34||Ar<=-7||hr>0){if(U>34)return ut.push("0"),hr>0?ut.push(`E+${hr}`):hr<0&&ut.push(`E${hr}`),ut.join("");ut.push(`${L[We++]}`),U-=1,U&&ut.push(".");for(let mr=0;mr<U;mr++)ut.push(`${L[We++]}`);ut.push("E"),Ar>0?ut.push(`+${Ar}`):ut.push(`${Ar}`)}else if(hr>=0)for(let mr=0;mr<U;mr++)ut.push(`${L[We++]}`);else{let mr=U+hr;if(mr>0)for(let yt=0;yt<mr;yt++)ut.push(`${L[We++]}`);else ut.push("0");for(ut.push(".");mr++<0;)ut.push("0");for(let yt=0;yt<U-Math.max(mr-1,0);yt++)ut.push(`${L[We++]}`)}return ut.join("")}toJSON(){return{$numberDecimal:this.toString()}}toExtendedJSON(){return{$numberDecimal:this.toString()}}static fromExtendedJSON(s){return xe.fromString(s.$numberDecimal)}inspect(s,U,L){return L??=u,`new Decimal128(${L(this.toString(),U)})`}}class _e extends ye{get _bsontype(){return"Double"}constructor(s){super(),s instanceof Number&&(s=s.valueOf()),this.value=+s}static fromString(s){let U=Number(s);if(s==="NaN")return new _e(NaN);if(s==="Infinity")return new _e(1/0);if(s==="-Infinity")return new _e(-1/0);if(!Number.isFinite(U))throw new Z(`Input: ${s} is not representable as a Double`);if(s.trim()!==s)throw new Z(`Input: '${s}' contains whitespace`);if(s==="")throw new Z("Input is an empty string");if(/[^-0-9.+eE]/.test(s))throw new Z(`Input: '${s}' is not in decimal or exponential notation`);return new _e(U)}valueOf(){return this.value}toJSON(){return this.value}toString(s){return this.value.toString(s)}toExtendedJSON(s){return s&&(s.legacy||s.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-0.0"}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}}static fromExtendedJSON(s,U){let L=parseFloat(s.$numberDouble);return U&&U.relaxed?L:new _e(L)}inspect(s,U,L){return L??=u,`new Double(${L(this.value,U)})`}}class Le extends ye{get _bsontype(){return"Int32"}constructor(s){super(),s instanceof Number&&(s=s.valueOf()),this.value=0|+s}static fromString(s){let U=Bt(s),L=Number(s);if(d<L)throw new Z(`Input: '${s}' is larger than the maximum value for Int32`);if(_>L)throw new Z(`Input: '${s}' is smaller than the minimum value for Int32`);if(!Number.isSafeInteger(L))throw new Z(`Input: '${s}' is not a safe integer`);if(L.toString()!==U)throw new Z(`Input: '${s}' is not a valid Int32 string`);return new Le(L)}valueOf(){return this.value}toString(s){return this.value.toString(s)}toJSON(){return this.value}toExtendedJSON(s){return s&&(s.relaxed||s.legacy)?this.value:{$numberInt:this.value.toString()}}static fromExtendedJSON(s,U){return U&&U.relaxed?parseInt(s.$numberInt,10):new Le(s.$numberInt)}inspect(s,U,L){return L??=u,`new Int32(${L(this.value,U)})`}}class Fe extends ye{get _bsontype(){return"MaxKey"}toExtendedJSON(){return{$maxKey:1}}static fromExtendedJSON(){return new Fe}inspect(){return"new MaxKey()"}}class Qe extends ye{get _bsontype(){return"MinKey"}toExtendedJSON(){return{$minKey:1}}static fromExtendedJSON(){return new Qe}inspect(){return"new MinKey()"}}let Ve=null,Ge=new WeakMap;class Ne extends ye{get _bsontype(){return"ObjectId"}constructor(s){let U;if(super(),typeof s=="object"&&s&&"id"in s){if(typeof s.id!="string"&&!ArrayBuffer.isView(s.id))throw new Z("Argument passed in must have an id that is of type string or Buffer");U="toHexString"in s&&typeof s.toHexString=="function"?ne.fromHex(s.toHexString()):s.id}else U=s;if(U==null||typeof U=="number")this.buffer=Ne.generate(typeof U=="number"?U:void 0);else if(ArrayBuffer.isView(U)&&U.byteLength===12)this.buffer=ne.toLocalBufferType(U);else{if(typeof U!="string")throw new Z("Argument passed in does not match the accepted types");if(!Ne.validateHexString(U))throw new Z("input must be a 24 character hex string, 12 byte Uint8Array, or an integer");this.buffer=ne.fromHex(U),Ne.cacheHexString&&Ge.set(this,U)}}get id(){return this.buffer}set id(s){this.buffer=s,Ne.cacheHexString&&Ge.set(this,ne.toHex(s))}static validateHexString(s){if(s?.length!==24)return!1;for(let U=0;U<24;U++){let L=s.charCodeAt(U);if(!(L>=48&&L<=57||L>=97&&L<=102||L>=65&&L<=70))return!1}return!0}toHexString(){if(Ne.cacheHexString){let U=Ge.get(this);if(U)return U}let s=ne.toHex(this.id);return Ne.cacheHexString&&Ge.set(this,s),s}static getInc(){return Ne.index=(Ne.index+1)%16777215}static generate(s){typeof s!="number"&&(s=Math.floor(Date.now()/1e3));let U=Ne.getInc(),L=ne.allocateUnsafe(12);return Be.setInt32BE(L,0,s),Ve===null&&(Ve=ne.randomBytes(5)),L[4]=Ve[0],L[5]=Ve[1],L[6]=Ve[2],L[7]=Ve[3],L[8]=Ve[4],L[11]=255&U,L[10]=U>>8&255,L[9]=U>>16&255,L}toString(s){return s==="base64"?ne.toBase64(this.id):this.toHexString()}toJSON(){return this.toHexString()}static is(s){return s!=null&&typeof s=="object"&&"_bsontype"in s&&s._bsontype==="ObjectId"}equals(s){if(s==null)return!1;if(Ne.is(s))return this.buffer[11]===s.buffer[11]&&ne.equals(this.buffer,s.buffer);if(typeof s=="string")return s.toLowerCase()===this.toHexString();if(typeof s=="object"&&typeof s.toHexString=="function"){let U=s.toHexString(),L=this.toHexString();return typeof U=="string"&&U.toLowerCase()===L}return!1}getTimestamp(){let s=new Date,U=Be.getUint32BE(this.buffer,0);return s.setTime(1e3*Math.floor(U)),s}static createPk(){return new Ne}serializeInto(s,U){return s[U]=this.buffer[0],s[U+1]=this.buffer[1],s[U+2]=this.buffer[2],s[U+3]=this.buffer[3],s[U+4]=this.buffer[4],s[U+5]=this.buffer[5],s[U+6]=this.buffer[6],s[U+7]=this.buffer[7],s[U+8]=this.buffer[8],s[U+9]=this.buffer[9],s[U+10]=this.buffer[10],s[U+11]=this.buffer[11],12}static createFromTime(s){let U=ne.allocate(12);for(let L=11;L>=4;L--)U[L]=0;return Be.setInt32BE(U,0,s),new Ne(U)}static createFromHexString(s){if(s?.length!==24)throw new Z("hex string must be 24 characters");return new Ne(ne.fromHex(s))}static createFromBase64(s){if(s?.length!==16)throw new Z("base64 string must be 16 characters");return new Ne(ne.fromBase64(s))}static isValid(s){if(s==null)return!1;if(typeof s=="string")return Ne.validateHexString(s);try{return new Ne(s),!0}catch{return!1}}toExtendedJSON(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}}static fromExtendedJSON(s){return new Ne(s.$oid)}isCached(){return Ne.cacheHexString&&Ge.has(this)}inspect(s,U,L){return L??=u,`new ObjectId(${L(this.toHexString(),U)})`}}function st(O,s,U){let L=5;if(Array.isArray(O))for(let Pe=0;Pe<O.length;Pe++)L+=lt(Pe.toString(),O[Pe],s,!0,U);else{typeof O?.toBSON=="function"&&(O=O.toBSON());for(let Pe of Object.keys(O))L+=lt(Pe,O[Pe],s,!1,U)}return L}function lt(O,s,U=!1,L=!1,Pe=!1){switch(typeof s?.toBSON=="function"&&(s=s.toBSON()),typeof s){case"string":return 1+ne.utf8ByteLength(O)+1+4+ne.utf8ByteLength(s)+1;case"number":return Math.floor(s)===s&&s>=k&&s<=y&&s>=_&&s<=d?(O!=null?ne.utf8ByteLength(O)+1:0)+5:(O!=null?ne.utf8ByteLength(O)+1:0)+9;case"undefined":return L||!Pe?(O!=null?ne.utf8ByteLength(O)+1:0)+1:0;case"boolean":return(O!=null?ne.utf8ByteLength(O)+1:0)+2;case"object":if(s!=null&&typeof s._bsontype=="string"&&s[l]!==h)throw new he;if(s==null||s._bsontype==="MinKey"||s._bsontype==="MaxKey")return(O!=null?ne.utf8ByteLength(O)+1:0)+1;if(s._bsontype==="ObjectId")return(O!=null?ne.utf8ByteLength(O)+1:0)+13;if(s instanceof Date||o(s))return(O!=null?ne.utf8ByteLength(O)+1:0)+9;if(ArrayBuffer.isView(s)||s instanceof ArrayBuffer||x(s))return(O!=null?ne.utf8ByteLength(O)+1:0)+6+s.byteLength;if(s._bsontype==="Long"||s._bsontype==="Double"||s._bsontype==="Timestamp")return(O!=null?ne.utf8ByteLength(O)+1:0)+9;if(s._bsontype==="Decimal128")return(O!=null?ne.utf8ByteLength(O)+1:0)+17;if(s._bsontype==="Code")return s.scope!=null&&Object.keys(s.scope).length>0?(O!=null?ne.utf8ByteLength(O)+1:0)+1+4+4+ne.utf8ByteLength(s.code.toString())+1+st(s.scope,U,Pe):(O!=null?ne.utf8ByteLength(O)+1:0)+1+4+ne.utf8ByteLength(s.code.toString())+1;if(s._bsontype==="Binary"){let ke=s;return ke.sub_type===Me.SUBTYPE_BYTE_ARRAY?(O!=null?ne.utf8ByteLength(O)+1:0)+(ke.position+1+4+1+4):(O!=null?ne.utf8ByteLength(O)+1:0)+(ke.position+1+4+1)}if(s._bsontype==="Symbol")return(O!=null?ne.utf8ByteLength(O)+1:0)+ne.utf8ByteLength(s.value)+4+1+1;if(s._bsontype==="DBRef"){let ke=Object.assign({$ref:s.collection,$id:s.oid},s.fields);return s.db!=null&&(ke.$db=s.db),(O!=null?ne.utf8ByteLength(O)+1:0)+1+st(ke,U,Pe)}return s instanceof RegExp||w(s)?(O!=null?ne.utf8ByteLength(O)+1:0)+1+ne.utf8ByteLength(s.source)+1+(s.global?1:0)+(s.ignoreCase?1:0)+(s.multiline?1:0)+1:s._bsontype==="BSONRegExp"?(O!=null?ne.utf8ByteLength(O)+1:0)+1+ne.utf8ByteLength(s.pattern)+1+ne.utf8ByteLength(s.options)+1:(O!=null?ne.utf8ByteLength(O)+1:0)+st(s,U,Pe)+1;case"function":return U?(O!=null?ne.utf8ByteLength(O)+1:0)+1+4+ne.utf8ByteLength(s.toString())+1:0;case"bigint":return(O!=null?ne.utf8ByteLength(O)+1:0)+9;case"symbol":return 0;default:throw new Z("Unrecognized JS type: "+typeof s)}}Ne.index=Math.floor(16777215*Math.random());class pt extends ye{get _bsontype(){return"BSONRegExp"}constructor(s,U){if(super(),this.pattern=s,this.options=(U??"").split("").sort().join(""),this.pattern.indexOf("\0")!==-1)throw new Z(`BSON Regex patterns cannot contain null bytes, found: ${JSON.stringify(this.pattern)}`);if(this.options.indexOf("\0")!==-1)throw new Z(`BSON Regex options cannot contain null bytes, found: ${JSON.stringify(this.options)}`);for(let L=0;L<this.options.length;L++)if(this.options[L]!=="i"&&this.options[L]!=="m"&&this.options[L]!=="x"&&this.options[L]!=="l"&&this.options[L]!=="s"&&this.options[L]!=="u")throw new Z(`The regular expression option [${this.options[L]}] is not supported`)}static parseOptions(s){return s?s.split("").sort().join(""):""}toExtendedJSON(s){return(s=s||{}).legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}}static fromExtendedJSON(s){if("$regex"in s){if(typeof s.$regex=="string")return new pt(s.$regex,pt.parseOptions(s.$options));if(s.$regex._bsontype==="BSONRegExp")return s}if("$regularExpression"in s)return new pt(s.$regularExpression.pattern,pt.parseOptions(s.$regularExpression.options));throw new Z(`Unexpected BSONRegExp EJSON object form: ${JSON.stringify(s)}`)}inspect(s,U,L){let Pe=function(ke){if(ke!=null&&typeof ke=="object"&&"stylize"in ke&&typeof ke.stylize=="function")return ke.stylize}(U)??(ke=>ke);return L??=u,`new BSONRegExp(${Pe(L(this.pattern),"regexp")}, ${Pe(L(this.options),"regexp")})`}}class xt extends ye{get _bsontype(){return"BSONSymbol"}constructor(s){super(),this.value=s}valueOf(){return this.value}toString(){return this.value}toJSON(){return this.value}toExtendedJSON(){return{$symbol:this.value}}static fromExtendedJSON(s){return new xt(s.$symbol)}inspect(s,U,L){return L??=u,`new BSONSymbol(${L(this.value,U)})`}}let Dt=Ae;class Ot extends Dt{get _bsontype(){return"Timestamp"}get i(){return this.low>>>0}get t(){return this.high>>>0}constructor(s){if(s==null)super(0,0,!0);else if(typeof s=="bigint")super(s,!0);else if(Ae.isLong(s))super(s.low,s.high,!0);else{if(typeof s!="object"||!("t"in s)||!("i"in s))throw new Z("A Timestamp can only be constructed with: bigint, Long, or { t: number; i: number }");{if(typeof s.t!="number"&&(typeof s.t!="object"||s.t._bsontype!=="Int32"))throw new Z("Timestamp constructed from { t, i } must provide t as a number");if(typeof s.i!="number"&&(typeof s.i!="object"||s.i._bsontype!=="Int32"))throw new Z("Timestamp constructed from { t, i } must provide i as a number");let U=Number(s.t),L=Number(s.i);if(U<0||Number.isNaN(U))throw new Z("Timestamp constructed from { t, i } must provide a positive t");if(L<0||Number.isNaN(L))throw new Z("Timestamp constructed from { t, i } must provide a positive i");if(U>4294967295)throw new Z("Timestamp constructed from { t, i } must provide t equal or less than uint32 max");if(L>4294967295)throw new Z("Timestamp constructed from { t, i } must provide i equal or less than uint32 max");super(L,U,!0)}}}toJSON(){return{$timestamp:this.toString()}}static fromInt(s){return new Ot(Ae.fromInt(s,!0))}static fromNumber(s){return new Ot(Ae.fromNumber(s,!0))}static fromBits(s,U){return new Ot({i:s,t:U})}static fromString(s,U){return new Ot(Ae.fromString(s,!0,U))}toExtendedJSON(){return{$timestamp:{t:this.t,i:this.i}}}static fromExtendedJSON(s){let U=Ae.isLong(s.$timestamp.i)?s.$timestamp.i.getLowBitsUnsigned():s.$timestamp.i,L=Ae.isLong(s.$timestamp.t)?s.$timestamp.t.getLowBitsUnsigned():s.$timestamp.t;return new Ot({t:L,i:U})}inspect(s,U,L){return L??=u,`new Timestamp({ t: ${L(this.t,U)}, i: ${L(this.i,U)} })`}}Ot.MAX_VALUE=Ae.MAX_UNSIGNED_VALUE;let Wt=Ae.fromNumber(y),ur=Ae.fromNumber(k);function Kt(O,s,U){let L=(s=s??{})&&s.index?s.index:0,Pe=Be.getInt32LE(O,L);if(Pe<5)throw new Z(`bson size must be >= 5, is ${Pe}`);if(s.allowObjectSmallerThanBufferSize&&O.length<Pe)throw new Z(`buffer length ${O.length} must be >= bson size ${Pe}`);if(!s.allowObjectSmallerThanBufferSize&&O.length!==Pe)throw new Z(`buffer length ${O.length} must === bson size ${Pe}`);if(Pe+L>O.byteLength)throw new Z(`(bson size ${Pe} + options.index ${L} must be <= buffer length ${O.byteLength})`);if(O[L+Pe-1]!==0)throw new Z("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return Qt(O,L,s,U)}let or=/^\$ref$|^\$id$|^\$db$/;function Qt(O,s,U,L=!1){let Pe=U.fieldsAsRaw==null?null:U.fieldsAsRaw,ke=U.raw!=null&&U.raw,Ze=typeof U.bsonRegExp=="boolean"&&U.bsonRegExp,We=U.promoteBuffers??!1,Oe=U.promoteLongs??!0,St=U.promoteValues??!0,ut=U.useBigInt64??!1;if(ut&&!St)throw new Z("Must either request bigint or Long for int64 deserialization");if(ut&&!Oe)throw new Z("Must either request bigint or Long for int64 deserialization");let Ye,ot,At=!0,Tt=(U.validation==null?{utf8:!0}:U.validation).utf8;if(typeof Tt=="boolean")Ye=Tt;else{At=!1;let yt=Object.keys(Tt).map(function(Rt){return Tt[Rt]});if(yt.length===0)throw new Z("UTF-8 validation setting cannot be empty");if(typeof yt[0]!="boolean")throw new Z("Invalid UTF-8 validation option, must specify boolean values");if(Ye=yt[0],!yt.every(Rt=>Rt===Ye))throw new Z("Invalid UTF-8 validation option - keys must be all true or all false")}if(!At){ot=new Set;for(let yt of Object.keys(Tt))ot.add(yt)}let er=s;if(O.length<5)throw new Z("corrupt bson message < 5 bytes long");let gr=Be.getInt32LE(O,s);if(s+=4,gr<5||gr>O.length)throw new Z("corrupt bson message");let hr=L?[]:{},Ar=0,mr=!L&&null;for(;;){let yt=O[s++];if(yt===0)break;let Rt=s;for(;O[Rt]!==0&&Rt<O.length;)Rt++;if(Rt>=O.byteLength)throw new Z("Bad BSON Document: illegal CString");let oa=L?Ar++:ne.toUTF8(O,s,Rt,!1),ar,Br=!0;if(Br=At||ot?.has(oa)?Ye:!Ye,mr!==!1&&oa[0]==="$"&&(mr=or.test(oa)),s=Rt+1,yt===D){let bt=Be.getInt32LE(O,s);if(s+=4,bt<=0||bt>O.length-s||O[s+bt-1]!==0)throw new Z("bad string length in bson");ar=ne.toUTF8(O,s,s+bt-1,Br),s+=bt}else if(yt===V){let bt=ne.allocateUnsafe(12);for(let Et=0;Et<12;Et++)bt[Et]=O[s+Et];ar=new Ne(bt),s+=12}else if(yt===J&&St===!1)ar=new Le(Be.getInt32LE(O,s)),s+=4;else if(yt===J)ar=Be.getInt32LE(O,s),s+=4;else if(yt===v)ar=Be.getFloat64LE(O,s),s+=8,St===!1&&(ar=new _e(ar));else if(yt===H){let bt=Be.getInt32LE(O,s),Et=Be.getInt32LE(O,s+4);s+=8,ar=new Date(new Ae(bt,Et).toNumber())}else if(yt===K){if(O[s]!==0&&O[s]!==1)throw new Z("illegal boolean type value");ar=O[s++]===1}else if(yt===j){let bt=s,Et=Be.getInt32LE(O,s);if(Et<=0||Et>O.length-s)throw new Z("bad embedded document length in bson");if(ke)ar=O.subarray(s,s+Et);else{let Mt=U;At||(Mt={...U,validation:{utf8:Br}}),ar=Qt(O,bt,Mt,!1)}s+=Et}else if(yt===S){let bt=s,Et=Be.getInt32LE(O,s),Mt=U,Kr=s+Et;if(Pe&&Pe[oa]&&(Mt={...U,raw:!0}),At||(Mt={...Mt,validation:{utf8:Br}}),ar=Qt(O,bt,Mt,!0),O[(s+=Et)-1]!==0)throw new Z("invalid array terminator byte");if(s!==Kr)throw new Z("corrupted array bson")}else if(yt===M)ar=void 0;else if(yt===Q)ar=null;else if(yt===I)if(ut)ar=Be.getBigInt64LE(O,s),s+=8;else{let bt=Be.getInt32LE(O,s),Et=Be.getInt32LE(O,s+4);s+=8;let Mt=new Ae(bt,Et);ar=Oe&&St===!0&&Mt.lessThanOrEqual(Wt)&&Mt.greaterThanOrEqual(ur)?Mt.toNumber():Mt}else if(yt===N){let bt=ne.allocateUnsafe(16);for(let Et=0;Et<16;Et++)bt[Et]=O[s+Et];s+=16,ar=new xe(bt)}else if(yt===A){let bt=Be.getInt32LE(O,s);s+=4;let Et=bt,Mt=O[s++];if(bt<0)throw new Z("Negative binary type element size found");if(bt>O.byteLength)throw new Z("Binary type size larger than document size");if(Mt===Me.SUBTYPE_BYTE_ARRAY){if(bt=Be.getInt32LE(O,s),s+=4,bt<0)throw new Z("Negative binary type element size found for subtype 0x02");if(bt>Et-4)throw new Z("Binary type with subtype 0x02 contains too long binary size");if(bt<Et-4)throw new Z("Binary type with subtype 0x02 contains too short binary size")}We&&St?ar=ne.toLocalBufferType(O.subarray(s,s+bt)):(ar=new Me(O.subarray(s,s+bt),Mt),Mt===Se&&wt.isValid(ar)&&(ar=ar.toUUID())),s+=bt}else if(yt===re&&Ze===!1){for(Rt=s;O[Rt]!==0&&Rt<O.length;)Rt++;if(Rt>=O.length)throw new Z("Bad BSON Document: illegal CString");let bt=ne.toUTF8(O,s,Rt,!1);for(Rt=s=Rt+1;O[Rt]!==0&&Rt<O.length;)Rt++;if(Rt>=O.length)throw new Z("Bad BSON Document: illegal CString");let Et=ne.toUTF8(O,s,Rt,!1);s=Rt+1;let Mt=new Array(Et.length);for(Rt=0;Rt<Et.length;Rt++)switch(Et[Rt]){case"m":Mt[Rt]="m";break;case"s":Mt[Rt]="g";break;case"i":Mt[Rt]="i"}ar=new RegExp(bt,Mt.join(""))}else if(yt===re&&Ze===!0){for(Rt=s;O[Rt]!==0&&Rt<O.length;)Rt++;if(Rt>=O.length)throw new Z("Bad BSON Document: illegal CString");let bt=ne.toUTF8(O,s,Rt,!1);for(Rt=s=Rt+1;O[Rt]!==0&&Rt<O.length;)Rt++;if(Rt>=O.length)throw new Z("Bad BSON Document: illegal CString");let Et=ne.toUTF8(O,s,Rt,!1);s=Rt+1,ar=new pt(bt,Et)}else if(yt===$){let bt=Be.getInt32LE(O,s);if(s+=4,bt<=0||bt>O.length-s||O[s+bt-1]!==0)throw new Z("bad string length in bson");let Et=ne.toUTF8(O,s,s+bt-1,Br);ar=St?Et:new xt(Et),s+=bt}else if(yt===F)ar=new Ot({i:Be.getUint32LE(O,s),t:Be.getUint32LE(O,s+4)}),s+=8;else if(yt===G)ar=new Qe;else if(yt===ae)ar=new Fe;else if(yt===W){let bt=Be.getInt32LE(O,s);if(s+=4,bt<=0||bt>O.length-s||O[s+bt-1]!==0)throw new Z("bad string length in bson");let Et=ne.toUTF8(O,s,s+bt-1,Br);ar=new ft(Et),s+=bt}else if(yt===C){let bt=Be.getInt32LE(O,s);if(s+=4,bt<13)throw new Z("code_w_scope total size shorter minimum expected length");let Et=Be.getInt32LE(O,s);if(s+=4,Et<=0||Et>O.length-s||O[s+Et-1]!==0)throw new Z("bad string length in bson");let Mt=ne.toUTF8(O,s,s+Et-1,Br),Kr=s+=Et,Mr=Be.getInt32LE(O,s),Fr=Qt(O,Kr,U,!1);if(s+=Mr,bt<8+Mr+Et)throw new Z("code_w_scope total size is too short, truncating scope");if(bt>8+Mr+Et)throw new Z("code_w_scope total size is too long, clips outer document");ar=new ft(Mt,Fr)}else{if(yt!==ue)throw new Z(`Detected unknown BSON type ${yt.toString(16)} for fieldname "${oa}"`);{let bt=Be.getInt32LE(O,s);if(s+=4,bt<=0||bt>O.length-s||O[s+bt-1]!==0)throw new Z("bad string length in bson");let Et=ne.toUTF8(O,s,s+bt-1,Br);s+=bt;let Mt=ne.allocateUnsafe(12);for(let Mr=0;Mr<12;Mr++)Mt[Mr]=O[s+Mr];let Kr=new Ne(Mt);s+=12,ar=new Nt(Et,Kr)}}oa==="__proto__"?Object.defineProperty(hr,oa,{value:ar,writable:!0,enumerable:!0,configurable:!0}):hr[oa]=ar}if(gr!==s-er)throw L?new Z("corrupt array bson"):new Z("corrupt object bson");if(!mr)return hr;if(fr(hr)){let yt=Object.assign({},hr);return delete yt.$ref,delete yt.$id,delete yt.$db,new Nt(hr.$ref,hr.$id,hr.$db,yt)}return hr}let Ct=/\x00/,zt=new Set(["$db","$ref","$id","$clusterTime"]);function Pr(O,s,U,L){O[L++]=D,O[(L=L+ne.encodeUTF8Into(O,s,L)+1)-1]=0;let Pe=ne.encodeUTF8Into(O,U,L+4);return Be.setInt32LE(O,L,Pe+1),L=L+4+Pe,O[L++]=0,L}function vr(O,s,U,L){let Pe=!Object.is(U,-0)&&Number.isSafeInteger(U)&&U<=d&&U>=_?J:v;return O[L++]=Pe,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0,L+(Pe===J?Be.setInt32LE(O,L,U):Be.setFloat64LE(O,L,U))}function Ut(O,s,U,L){return O[L++]=I,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0,L+Be.setBigInt64LE(O,L,U)}function nr(O,s,U,L){return O[L++]=Q,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0,L}function it(O,s,U,L){return O[L++]=K,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0,O[L++]=U?1:0,L}function Vt(O,s,U,L){O[L++]=H,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0;let Pe=Ae.fromNumber(U.getTime()),ke=Pe.getLowBits(),Ze=Pe.getHighBits();return(L+=Be.setInt32LE(O,L,ke))+Be.setInt32LE(O,L,Ze)}function tr(O,s,U,L){if(O[L++]=re,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0,U.source&&U.source.match(Ct)!=null)throw new Z("value "+U.source+" must not contain null bytes");return L+=ne.encodeUTF8Into(O,U.source,L),O[L++]=0,U.ignoreCase&&(O[L++]=105),U.global&&(O[L++]=115),U.multiline&&(O[L++]=109),O[L++]=0,L}function Xt(O,s,U,L){if(O[L++]=re,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0,U.pattern.match(Ct)!=null)throw new Z("pattern "+U.pattern+" must not contain null bytes");L+=ne.encodeUTF8Into(O,U.pattern,L),O[L++]=0;let Pe=U.options.split("").sort().join("");return L+=ne.encodeUTF8Into(O,Pe,L),O[L++]=0,L}function rr(O,s,U,L){return U===null?O[L++]=Q:U._bsontype==="MinKey"?O[L++]=G:O[L++]=ae,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0,L}function Lr(O,s,U,L){return O[L++]=V,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0,L+U.serializeInto(O,L)}function jr(O,s,U,L){O[L++]=A,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0;let Pe=U.length;if(L+=Be.setInt32LE(O,L,Pe),O[L++]=ce,Pe<=16)for(let ke=0;ke<Pe;ke++)O[L+ke]=U[ke];else O.set(U,L);return L+Pe}function ta(O,s,U,L,Pe,ke,Ze,We,Oe){if(Oe.has(U))throw new Z("Cannot convert circular structure to BSON");Oe.add(U),O[L++]=Array.isArray(U)?S:j,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0;let St=Rr(O,U,Pe,L,ke+1,Ze,We,Oe);return Oe.delete(U),St}function Gr(O,s,U,L){O[L++]=N,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0;for(let Pe=0;Pe<16;Pe++)O[L+Pe]=U.bytes[Pe];return L+16}function ra(O,s,U,L){O[L++]=U._bsontype==="Long"?I:F,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0;let Pe=U.getLowBits(),ke=U.getHighBits();return(L+=Be.setInt32LE(O,L,Pe))+Be.setInt32LE(O,L,ke)}function Zr(O,s,U,L){return U=U.valueOf(),O[L++]=J,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0,L+Be.setInt32LE(O,L,U)}function dr(O,s,U,L){return O[L++]=v,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0,L+Be.setFloat64LE(O,L,U.value)}function Or(O,s,U,L){O[L++]=W,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0;let Pe=U.toString(),ke=ne.encodeUTF8Into(O,Pe,L+4)+1;return Be.setInt32LE(O,L,ke),L=L+4+ke-1,O[L++]=0,L}function _r(O,s,U,L,Pe=!1,ke=0,Ze=!1,We=!0,Oe){if(U.scope&&typeof U.scope=="object"){O[L++]=C,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0;let St=L,ut=U.code;L+=4;let Ye=ne.encodeUTF8Into(O,ut,L+4)+1;Be.setInt32LE(O,L,Ye),O[L+4+Ye-1]=0,L=L+Ye+4;let ot=Rr(O,U.scope,Pe,L,ke+1,Ze,We,Oe);L=ot-1;let At=ot-St;St+=Be.setInt32LE(O,St,At),O[L++]=0}else{O[L++]=W,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0;let St=U.code.toString(),ut=ne.encodeUTF8Into(O,St,L+4)+1;Be.setInt32LE(O,L,ut),L=L+4+ut-1,O[L++]=0}return L}function $r(O,s,U,L){O[L++]=A,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0;let Pe=U.buffer,ke=U.position;if(U.sub_type===Me.SUBTYPE_BYTE_ARRAY&&(ke+=4),L+=Be.setInt32LE(O,L,ke),O[L++]=U.sub_type,U.sub_type===Me.SUBTYPE_BYTE_ARRAY&&(ke-=4,L+=Be.setInt32LE(O,L,ke)),U.sub_type===Me.SUBTYPE_VECTOR&&qe(U),ke<=16)for(let Ze=0;Ze<ke;Ze++)O[L+Ze]=Pe[Ze];else O.set(Pe,L);return L+U.position}function cr(O,s,U,L){O[L++]=$,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0;let Pe=ne.encodeUTF8Into(O,U.value,L+4)+1;return Be.setInt32LE(O,L,Pe),L=L+4+Pe-1,O[L++]=0,L}function Sr(O,s,U,L,Pe,ke,Ze){O[L++]=j,L+=ne.encodeUTF8Into(O,s,L),O[L++]=0;let We=L,Oe={$ref:U.collection||U.namespace,$id:U.oid};U.db!=null&&(Oe.$db=U.db),Oe=Object.assign(Oe,U.fields);let St=Rr(O,Oe,!1,L,Pe+1,ke,!0,Ze),ut=St-We;return We+=Be.setInt32LE(O,L,ut),St}function Rr(O,s,U,L,Pe,ke,Ze,We){if(We==null){if(s==null)return O[0]=5,O[1]=0,O[2]=0,O[3]=0,O[4]=0,5;if(Array.isArray(s))throw new Z("serialize does not support an array as the root input");if(typeof s!="object")throw new Z("serialize does not support non-object as the root input");if("_bsontype"in s&&typeof s._bsontype=="string")throw new Z("BSON types cannot be serialized as a document");if(o(s)||w(s)||b(s)||x(s))throw new Z("date, regexp, typedarray, and arraybuffer cannot be BSON documents");We=new Set}We.add(s);let Oe=L+4;if(Array.isArray(s))for(let ut=0;ut<s.length;ut++){let Ye=`${ut}`,ot=s[ut];typeof ot?.toBSON=="function"&&(ot=ot.toBSON());let At=typeof ot;if(ot===void 0)Oe=nr(O,Ye,0,Oe);else if(ot===null)Oe=nr(O,Ye,0,Oe);else if(At==="string")Oe=Pr(O,Ye,ot,Oe);else if(At==="number")Oe=vr(O,Ye,ot,Oe);else if(At==="bigint")Oe=Ut(O,Ye,ot,Oe);else if(At==="boolean")Oe=it(O,Ye,ot,Oe);else if(At==="object"&&ot._bsontype==null)Oe=ot instanceof Date||o(ot)?Vt(O,Ye,ot,Oe):ot instanceof Uint8Array||b(ot)?jr(O,Ye,ot,Oe):ot instanceof RegExp||w(ot)?tr(O,Ye,ot,Oe):ta(O,Ye,ot,Oe,U,Pe,ke,Ze,We);else if(At==="object"){if(ot[l]!==h)throw new he;if(ot._bsontype==="ObjectId")Oe=Lr(O,Ye,ot,Oe);else if(ot._bsontype==="Decimal128")Oe=Gr(O,Ye,ot,Oe);else if(ot._bsontype==="Long"||ot._bsontype==="Timestamp")Oe=ra(O,Ye,ot,Oe);else if(ot._bsontype==="Double")Oe=dr(O,Ye,ot,Oe);else if(ot._bsontype==="Code")Oe=_r(O,Ye,ot,Oe,U,Pe,ke,Ze,We);else if(ot._bsontype==="Binary")Oe=$r(O,Ye,ot,Oe);else if(ot._bsontype==="BSONSymbol")Oe=cr(O,Ye,ot,Oe);else if(ot._bsontype==="DBRef")Oe=Sr(O,Ye,ot,Oe,Pe,ke,We);else if(ot._bsontype==="BSONRegExp")Oe=Xt(O,Ye,ot,Oe);else if(ot._bsontype==="Int32")Oe=Zr(O,Ye,ot,Oe);else if(ot._bsontype==="MinKey"||ot._bsontype==="MaxKey")Oe=rr(O,Ye,ot,Oe);else if(ot._bsontype!==void 0)throw new Z(`Unrecognized or invalid _bsontype: ${String(ot._bsontype)}`)}else At==="function"&&ke&&(Oe=Or(O,Ye,ot,Oe))}else if(s instanceof Map||g(s)){let ut=s.entries(),Ye=!1;for(;!Ye;){let ot=ut.next();if(Ye=!!ot.done,Ye)continue;let At=ot.value?ot.value[0]:void 0,Tt=ot.value?ot.value[1]:void 0;typeof Tt?.toBSON=="function"&&(Tt=Tt.toBSON());let er=typeof Tt;if(typeof At=="string"&&!zt.has(At)){if(At.match(Ct)!=null)throw new Z("key "+At+" must not contain null bytes");if(U){if(At[0]==="$")throw new Z("key "+At+" must not start with '$'");if(At.includes("."))throw new Z("key "+At+" must not contain '.'")}}if(Tt===void 0)Ze===!1&&(Oe=nr(O,At,0,Oe));else if(Tt===null)Oe=nr(O,At,0,Oe);else if(er==="string")Oe=Pr(O,At,Tt,Oe);else if(er==="number")Oe=vr(O,At,Tt,Oe);else if(er==="bigint")Oe=Ut(O,At,Tt,Oe);else if(er==="boolean")Oe=it(O,At,Tt,Oe);else if(er==="object"&&Tt._bsontype==null)Oe=Tt instanceof Date||o(Tt)?Vt(O,At,Tt,Oe):Tt instanceof Uint8Array||b(Tt)?jr(O,At,Tt,Oe):Tt instanceof RegExp||w(Tt)?tr(O,At,Tt,Oe):ta(O,At,Tt,Oe,U,Pe,ke,Ze,We);else if(er==="object"){if(Tt[l]!==h)throw new he;if(Tt._bsontype==="ObjectId")Oe=Lr(O,At,Tt,Oe);else if(Tt._bsontype==="Decimal128")Oe=Gr(O,At,Tt,Oe);else if(Tt._bsontype==="Long"||Tt._bsontype==="Timestamp")Oe=ra(O,At,Tt,Oe);else if(Tt._bsontype==="Double")Oe=dr(O,At,Tt,Oe);else if(Tt._bsontype==="Code")Oe=_r(O,At,Tt,Oe,U,Pe,ke,Ze,We);else if(Tt._bsontype==="Binary")Oe=$r(O,At,Tt,Oe);else if(Tt._bsontype==="BSONSymbol")Oe=cr(O,At,Tt,Oe);else if(Tt._bsontype==="DBRef")Oe=Sr(O,At,Tt,Oe,Pe,ke,We);else if(Tt._bsontype==="BSONRegExp")Oe=Xt(O,At,Tt,Oe);else if(Tt._bsontype==="Int32")Oe=Zr(O,At,Tt,Oe);else if(Tt._bsontype==="MinKey"||Tt._bsontype==="MaxKey")Oe=rr(O,At,Tt,Oe);else if(Tt._bsontype!==void 0)throw new Z(`Unrecognized or invalid _bsontype: ${String(Tt._bsontype)}`)}else er==="function"&&ke&&(Oe=Or(O,At,Tt,Oe))}}else{if(typeof s?.toBSON=="function"&&(s=s.toBSON())!=null&&typeof s!="object")throw new Z("toBSON function did not return an object");for(let ut of Object.keys(s)){let Ye=s[ut];typeof Ye?.toBSON=="function"&&(Ye=Ye.toBSON());let ot=typeof Ye;if(typeof ut=="string"&&!zt.has(ut)){if(ut.match(Ct)!=null)throw new Z("key "+ut+" must not contain null bytes");if(U){if(ut[0]==="$")throw new Z("key "+ut+" must not start with '$'");if(ut.includes("."))throw new Z("key "+ut+" must not contain '.'")}}if(Ye===void 0)Ze===!1&&(Oe=nr(O,ut,0,Oe));else if(Ye===null)Oe=nr(O,ut,0,Oe);else if(ot==="string")Oe=Pr(O,ut,Ye,Oe);else if(ot==="number")Oe=vr(O,ut,Ye,Oe);else if(ot==="bigint")Oe=Ut(O,ut,Ye,Oe);else if(ot==="boolean")Oe=it(O,ut,Ye,Oe);else if(ot==="object"&&Ye._bsontype==null)Oe=Ye instanceof Date||o(Ye)?Vt(O,ut,Ye,Oe):Ye instanceof Uint8Array||b(Ye)?jr(O,ut,Ye,Oe):Ye instanceof RegExp||w(Ye)?tr(O,ut,Ye,Oe):ta(O,ut,Ye,Oe,U,Pe,ke,Ze,We);else if(ot==="object"){if(Ye[l]!==h)throw new he;if(Ye._bsontype==="ObjectId")Oe=Lr(O,ut,Ye,Oe);else if(Ye._bsontype==="Decimal128")Oe=Gr(O,ut,Ye,Oe);else if(Ye._bsontype==="Long"||Ye._bsontype==="Timestamp")Oe=ra(O,ut,Ye,Oe);else if(Ye._bsontype==="Double")Oe=dr(O,ut,Ye,Oe);else if(Ye._bsontype==="Code")Oe=_r(O,ut,Ye,Oe,U,Pe,ke,Ze,We);else if(Ye._bsontype==="Binary")Oe=$r(O,ut,Ye,Oe);else if(Ye._bsontype==="BSONSymbol")Oe=cr(O,ut,Ye,Oe);else if(Ye._bsontype==="DBRef")Oe=Sr(O,ut,Ye,Oe,Pe,ke,We);else if(Ye._bsontype==="BSONRegExp")Oe=Xt(O,ut,Ye,Oe);else if(Ye._bsontype==="Int32")Oe=Zr(O,ut,Ye,Oe);else if(Ye._bsontype==="MinKey"||Ye._bsontype==="MaxKey")Oe=rr(O,ut,Ye,Oe);else if(Ye._bsontype!==void 0)throw new Z(`Unrecognized or invalid _bsontype: ${String(Ye._bsontype)}`)}else ot==="function"&&ke&&(Oe=Or(O,ut,Ye,Oe))}}We.delete(s),O[Oe++]=0;let St=Oe-L;return L+=Be.setInt32LE(O,L,St),Oe}let It={$oid:Ne,$binary:Me,$uuid:Me,$symbol:xt,$numberInt:Le,$numberDecimal:xe,$numberDouble:_e,$numberLong:Ae,$minKey:Qe,$maxKey:Fe,$regex:pt,$regularExpression:pt,$timestamp:Ot};function xr(O,s={}){if(typeof O=="number"){let L=O<=d&&O>=_,Pe=O<=p&&O>=m;if(s.relaxed||s.legacy)return O;if(Number.isInteger(O)&&!Object.is(O,-0)){if(L)return new Le(O);if(Pe)return s.useBigInt64?BigInt(O):Ae.fromNumber(O)}return new _e(O)}if(O==null||typeof O!="object")return O;if(O.$undefined)return null;let U=Object.keys(O).filter(L=>L.startsWith("$")&&O[L]!=null);for(let L=0;L<U.length;L++){let Pe=It[U[L]];if(Pe)return Pe.fromExtendedJSON(O,s)}if(O.$date!=null){let L=O.$date,Pe=new Date;if(s.legacy)if(typeof L=="number")Pe.setTime(L);else if(typeof L=="string")Pe.setTime(Date.parse(L));else{if(typeof L!="bigint")throw new E("Unrecognized type for EJSON date: "+typeof L);Pe.setTime(Number(L))}else if(typeof L=="string")Pe.setTime(Date.parse(L));else if(Ae.isLong(L))Pe.setTime(L.toNumber());else if(typeof L=="number"&&s.relaxed)Pe.setTime(L);else{if(typeof L!="bigint")throw new E("Unrecognized type for EJSON date: "+typeof L);Pe.setTime(Number(L))}return Pe}if(O.$code!=null){let L=Object.assign({},O);return O.$scope&&(L.$scope=xr(O.$scope)),ft.fromExtendedJSON(O)}if(fr(O)||O.$dbPointer){let L=O.$ref?O:O.$dbPointer;if(L instanceof Nt)return L;let Pe=Object.keys(L).filter(Ze=>Ze.startsWith("$")),ke=!0;if(Pe.forEach(Ze=>{["$ref","$id","$db"].indexOf(Ze)===-1&&(ke=!1)}),ke)return Nt.fromExtendedJSON(L)}return O}function pr(O){let s=O.toISOString();return O.getUTCMilliseconds()!==0?s:s.slice(0,-5)+"Z"}function ir(O,s){if(O instanceof Map||g(O)){let U=Object.create(null);for(let[L,Pe]of O){if(typeof L!="string")throw new Z("Can only serialize maps with string keys");U[L]=Pe}return ir(U,s)}if((typeof O=="object"||typeof O=="function")&&O!==null){let U=s.seenObjects.findIndex(L=>L.obj===O);if(U!==-1){let L=s.seenObjects.map(ut=>ut.propertyName),Pe=L.slice(0,U).map(ut=>`${ut} -> `).join(""),ke=L[U],Ze=" -> "+L.slice(U+1,L.length-1).map(ut=>`${ut} -> `).join(""),We=L[L.length-1],Oe=" ".repeat(Pe.length+ke.length/2),St="-".repeat(Ze.length+(ke.length+We.length)/2-1);throw new Z(`Converting circular structure to EJSON:
    ${Pe}${ke}${Ze}${We}
    ${Oe}\\${St}/`)}s.seenObjects[s.seenObjects.length-1].obj=O}if(Array.isArray(O))return function(U,L){return U.map((Pe,ke)=>{L.seenObjects.push({propertyName:`index ${ke}`,obj:null});try{return ir(Pe,L)}finally{L.seenObjects.pop()}})}(O,s);if(O===void 0)return null;if(O instanceof Date||o(O)){let U=O.getTime(),L=U>-1&&U<2534023188e5;return s.legacy?s.relaxed&&L?{$date:O.getTime()}:{$date:pr(O)}:s.relaxed&&L?{$date:pr(O)}:{$date:{$numberLong:O.getTime().toString()}}}if(!(typeof O!="number"||s.relaxed&&isFinite(O))){if(Number.isInteger(O)&&!Object.is(O,-0)){if(O>=_&&O<=d)return{$numberInt:O.toString()};if(O>=m&&O<=p)return{$numberLong:O.toString()}}return{$numberDouble:Object.is(O,-0)?"-0.0":O.toString()}}if(typeof O=="bigint")return s.relaxed?Number(BigInt.asIntN(64,O)):{$numberLong:BigInt.asIntN(64,O).toString()};if(O instanceof RegExp||w(O)){let U=O.flags;if(U===void 0){let L=O.toString().match(/[gimuy]*$/);L&&(U=L[0])}return new pt(O.source,U).toExtendedJSON(s)}return O!=null&&typeof O=="object"?function(U,L){if(U==null||typeof U!="object")throw new Z("not an object instance");let Pe=U._bsontype;if(Pe===void 0){let ke={};for(let Ze of Object.keys(U)){L.seenObjects.push({propertyName:Ze,obj:null});try{let We=ir(U[Ze],L);Ze==="__proto__"?Object.defineProperty(ke,Ze,{value:We,writable:!0,enumerable:!0,configurable:!0}):ke[Ze]=We}finally{L.seenObjects.pop()}}return ke}if(U!=null&&typeof U=="object"&&typeof U._bsontype=="string"&&U[l]!==h)throw new he;if(function(ke){return ke!=null&&typeof ke=="object"&&"_bsontype"in ke&&typeof ke._bsontype=="string"}(U)){let ke=U;if(typeof ke.toExtendedJSON!="function"){let Ze=Zt[U._bsontype];if(!Ze)throw new Z("Unrecognized or invalid _bsontype: "+U._bsontype);ke=Ze(ke)}return Pe==="Code"&&ke.scope?ke=new ft(ke.code,ir(ke.scope,L)):Pe==="DBRef"&&ke.oid&&(ke=new Nt(ir(ke.collection,L),ir(ke.oid,L),ir(ke.db,L),ir(ke.fields,L))),ke.toExtendedJSON(L)}throw new Z("_bsontype must be a string, but was: "+typeof Pe)}(O,s):O}let Zt={Binary:O=>new Me(O.value(),O.sub_type),Code:O=>new ft(O.code,O.scope),DBRef:O=>new Nt(O.collection||O.namespace,O.oid,O.db,O.fields),Decimal128:O=>new xe(O.bytes),Double:O=>new _e(O.value),Int32:O=>new Le(O.value),Long:O=>Ae.fromBits(O.low!=null?O.low:O.low_,O.low!=null?O.high:O.high_,O.low!=null?O.unsigned:O.unsigned_),MaxKey:()=>new Fe,MinKey:()=>new Qe,ObjectId:O=>new Ne(O),BSONRegExp:O=>new pt(O.pattern,O.options),BSONSymbol:O=>new xt(O.value),Timestamp:O=>Ot.fromBits(O.low,O.high)};function Yt(O,s){let U={useBigInt64:s?.useBigInt64??!1,relaxed:s?.relaxed??!0,legacy:s?.legacy??!1};return JSON.parse(O,(L,Pe)=>{if(L.indexOf("\0")!==-1)throw new Z(`BSON Document field names cannot contain null bytes, found: ${JSON.stringify(L)}`);return xr(Pe,U)})}function Er(O,s,U,L){U!=null&&typeof U=="object"&&(L=U,U=0),s==null||typeof s!="object"||Array.isArray(s)||(L=s,s=void 0,U=0);let Pe=ir(O,Object.assign({relaxed:!0,legacy:!1},L,{seenObjects:[{propertyName:"(root)",obj:null}]}));return JSON.stringify(Pe,s,U)}let Dr=Object.create(null);Dr.parse=Yt,Dr.stringify=Er,Dr.serialize=function(O,s){return s=s||{},JSON.parse(Er(O,s))},Dr.deserialize=function(O,s){return s=s||{},Yt(JSON.stringify(O),s)},Object.freeze(Dr);function aa(O,s){try{return Be.getNonnegativeInt32LE(O,s)}catch(U){throw new z("BSON size cannot be negative",s,{cause:U})}}function qr(O,s){let U=s;for(;O[U]!==0;U++);if(U===O.length-1)throw new z("Null terminator not found",s);return U}let Hr=Object.create(null);Hr.parseToElements=function(O,s=0){if(s??=0,O.length<5)throw new z(`Input must be at least 5 bytes, got ${O.length} bytes`,s);let U=aa(O,s);if(U>O.length-s)throw new z(`Parsed documentSize (${U} bytes) does not match input length (${O.length} bytes)`,s);if(O[s+U-1]!==0)throw new z("BSON documents must end in 0x00",s+U);let L=[],Pe=s+4;for(;Pe<=U+s;){let ke=O[Pe];if(Pe+=1,ke===0){if(Pe-s!==U)throw new z("Invalid 0x00 type byte",Pe);break}let Ze=Pe,We=qr(O,Pe)-Ze,Oe;if(Pe+=We+1,ke===1||ke===18||ke===9||ke===17)Oe=8;else if(ke===16)Oe=4;else if(ke===7)Oe=12;else if(ke===19)Oe=16;else if(ke===8)Oe=1;else if(ke===10||ke===6||ke===127||ke===255)Oe=0;else if(ke===11)Oe=qr(O,qr(O,Pe)+1)+1-Pe;else if(ke===3||ke===4||ke===15)Oe=aa(O,Pe);else{if(ke!==2&&ke!==5&&ke!==12&&ke!==13&&ke!==14)throw new z(`Invalid 0x${ke.toString(16).padStart(2,"0")} type byte`,Pe);Oe=aa(O,Pe)+4,ke===5&&(Oe+=1),ke===12&&(Oe+=12)}if(Oe>U)throw new z("value reports length larger than document",Pe);L.push([ke,Ze,We,Pe,Oe]),Pe+=Oe}return L},Hr.ByteUtils=ne,Hr.NumberUtils=Be,Object.freeze(Hr);let zr=17825792,Tr=ne.allocate(zr);function ea(O){Tr.length<O&&(Tr=ne.allocate(O))}function da(O,s={}){let U=typeof s.checkKeys=="boolean"&&s.checkKeys,L=typeof s.serializeFunctions=="boolean"&&s.serializeFunctions,Pe=typeof s.ignoreUndefined!="boolean"||s.ignoreUndefined,ke=typeof s.minInternalBufferSize=="number"?s.minInternalBufferSize:zr;Tr.length<ke&&(Tr=ne.allocate(ke));let Ze=Rr(Tr,O,U,0,0,L,Pe,null),We=ne.allocateUnsafe(Ze);return We.set(Tr.subarray(0,Ze),0),We}function _a(O,s,U={}){let L=typeof U.checkKeys=="boolean"&&U.checkKeys,Pe=typeof U.serializeFunctions=="boolean"&&U.serializeFunctions,ke=typeof U.ignoreUndefined!="boolean"||U.ignoreUndefined,Ze=typeof U.index=="number"?U.index:0,We=Rr(Tr,O,L,0,0,Pe,ke,null);return s.set(Tr.subarray(0,We),Ze),Ze+We-1}function ha(O,s={}){return Kt(ne.toLocalBufferType(O),s)}function ya(O,s={}){return st(O,typeof(s=s||{}).serializeFunctions=="boolean"&&s.serializeFunctions,typeof s.ignoreUndefined!="boolean"||s.ignoreUndefined)}function fa(O,s,U,L,Pe,ke){let Ze=Object.assign({allowObjectSmallerThanBufferSize:!0,index:0},ke),We=ne.toLocalBufferType(O),Oe=s;for(let St=0;St<U;St++){let ut=Be.getInt32LE(We,Oe);Ze.index=Oe,L[Pe+St]=Kt(We,Ze),Oe+=ut}return Oe}var va=Object.freeze({__proto__:null,BSONError:Z,BSONOffsetError:z,BSONRegExp:pt,BSONRuntimeError:E,BSONSymbol:xt,BSONType:oe,BSONValue:ye,BSONVersionError:he,Binary:Me,Code:ft,DBRef:Nt,Decimal128:xe,Double:_e,EJSON:Dr,Int32:Le,Long:Ae,MaxKey:Fe,MinKey:Qe,ObjectId:Ne,Timestamp:Ot,UUID:wt,calculateObjectSize:ya,deserialize:ha,deserializeStream:fa,onDemand:Hr,serialize:da,serializeWithBufferAndIndex:_a,setInternalBufferSize:ea})},6365:(a,i,t)=>{"use strict";var n=t(5832).hp,c=t(6353).Binary,b=t(6353).UUID,x=t(8768);function w(u,h,l){var d,_,p,m,y=u;return u==null&&(y=0),Array.isArray(h)?(_=h[0],p=h[1]):d=h,m=typeof y=="number"||y instanceof Number?n.alloc(y):n.from(y,d,l),x.decorate(m,w.mixin),m.isMongooseBuffer=!0,m[w.pathSymbol]=_,m[o]=p,m._subtype=0,m}var g=Symbol.for("mongoose#Buffer#_path"),o=Symbol.for("mongoose#Buffer#_parent");w.pathSymbol=g,w.mixin={_subtype:void 0,_markModified:function(){var u=this[o];return u&&u.markModified(this[w.pathSymbol]),this},write:function(){var u=n.prototype.write.apply(this,arguments);return u>0&&this._markModified(),u},copy:function(u){var h=n.prototype.copy.apply(this,arguments);return u&&u.isMongooseBuffer&&u._markModified(),h}},x.each(["writeUInt8","writeUInt16","writeUInt32","writeInt8","writeInt16","writeInt32","writeFloat","writeDouble","fill","utf8Write","binaryWrite","asciiWrite","set","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE"],function(u){n.prototype[u]&&(w.mixin[u]=function(){var h=n.prototype[u].apply(this,arguments);return this._markModified(),h})}),w.mixin.toObject=function(u){var h=typeof u=="number"?u:this._subtype||0;return new c(n.from(this),h)},w.mixin.$toObject=w.mixin.toObject,w.mixin.toBSON=function(){return new c(this,this._subtype||0)},w.mixin.toUUID=function(){if(this._subtype!==4)throw new Error("Cannot convert a Buffer with subtype "+this._subtype+" to a UUID");return new b(this)},w.mixin.equals=function(u){if(!n.isBuffer(u)||this.length!==u.length)return!1;for(var h=0;h<this.length;++h)if(this[h]!==u[h])return!1;return!0},w.mixin.subtype=function(u){if(typeof u!="number")throw new TypeError("Invalid subtype. Expected a number");this._subtype!==u&&this._markModified(),this._subtype=u},w.Binary=c,a.exports=w},6400:(a,i,t)=>{"use strict";function n(de){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(q){return typeof q}:function(q){return q&&typeof Symbol=="function"&&q.constructor===Symbol&&q!==Symbol.prototype?"symbol":typeof q},n(de)}var c,b=t(8093),x=t(9870),w=t(9206),g=t(9939),o=t(783),u=t(9907),h=t(2268),l=t(8188),d=t(9471),_=t(2401),p=t(1697),m=t(8435),y=t(8633),k=t(2151),v=t(674),D=Function,j=function(de){try{return D('"use strict"; return ('+de+").constructor;")()}catch{}},S=t(1464),A=t(988),M=function(){throw new h},V=S?function(){try{return M}catch{try{return S(arguments,"callee").get}catch{return M}}}():M,K=t(5510)(),H=t(209),Q=t(5825),re=t(2403),ue=t(3279),W=t(3123),$={},C=typeof Uint8Array<"u"&&H?H(Uint8Array):c,J={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?c:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?c:ArrayBuffer,"%ArrayIteratorPrototype%":K&&H?H([][Symbol.iterator]()):c,"%AsyncFromSyncIteratorPrototype%":c,"%AsyncFunction%":$,"%AsyncGenerator%":$,"%AsyncGeneratorFunction%":$,"%AsyncIteratorPrototype%":$,"%Atomics%":typeof Atomics>"u"?c:Atomics,"%BigInt%":typeof BigInt>"u"?c:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?c:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?c:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?c:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":x,"%eval%":eval,"%EvalError%":w,"%Float16Array%":typeof Float16Array>"u"?c:Float16Array,"%Float32Array%":typeof Float32Array>"u"?c:Float32Array,"%Float64Array%":typeof Float64Array>"u"?c:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?c:FinalizationRegistry,"%Function%":D,"%GeneratorFunction%":$,"%Int8Array%":typeof Int8Array>"u"?c:Int8Array,"%Int16Array%":typeof Int16Array>"u"?c:Int16Array,"%Int32Array%":typeof Int32Array>"u"?c:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":K&&H?H(H([][Symbol.iterator]())):c,"%JSON%":(typeof JSON>"u"?"undefined":n(JSON))==="object"?JSON:c,"%Map%":typeof Map>"u"?c:Map,"%MapIteratorPrototype%":typeof Map<"u"&&K&&H?H(new Map()[Symbol.iterator]()):c,"%Math%":Math,"%Number%":Number,"%Object%":b,"%Object.getOwnPropertyDescriptor%":S,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?c:Promise,"%Proxy%":typeof Proxy>"u"?c:Proxy,"%RangeError%":g,"%ReferenceError%":o,"%Reflect%":typeof Reflect>"u"?c:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?c:Set,"%SetIteratorPrototype%":typeof Set<"u"&&K&&H?H(new Set()[Symbol.iterator]()):c,"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?c:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":K&&H?H(""[Symbol.iterator]()):c,"%Symbol%":K?Symbol:c,"%SyntaxError%":u,"%ThrowTypeError%":V,"%TypedArray%":C,"%TypeError%":h,"%Uint8Array%":typeof Uint8Array>"u"?c:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?c:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?c:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?c:Uint32Array,"%URIError%":l,"%WeakMap%":typeof WeakMap>"u"?c:WeakMap,"%WeakRef%":typeof WeakRef>"u"?c:WeakRef,"%WeakSet%":typeof WeakSet>"u"?c:WeakSet,"%Function.prototype.call%":W,"%Function.prototype.apply%":ue,"%Object.defineProperty%":A,"%Object.getPrototypeOf%":Q,"%Math.abs%":d,"%Math.floor%":_,"%Math.max%":p,"%Math.min%":m,"%Math.pow%":y,"%Math.round%":k,"%Math.sign%":v,"%Reflect.getPrototypeOf%":re};if(H)try{null.error}catch(de){var F=H(H(de));J["%Error.prototype%"]=F}var I=function de(q){var B;if(q==="%AsyncFunction%")B=j("async function () {}");else if(q==="%GeneratorFunction%")B=j("function* () {}");else if(q==="%AsyncGeneratorFunction%")B=j("async function* () {}");else if(q==="%AsyncGenerator%"){var te=de("%AsyncGeneratorFunction%");te&&(B=te.prototype)}else if(q==="%AsyncIteratorPrototype%"){var T=de("%AsyncGenerator%");T&&H&&(B=H(T.prototype))}return J[q]=B,B},N={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},G=t(2354),ae=t(5994),ce=G.call(W,Array.prototype.concat),Se=G.call(ue,Array.prototype.splice),oe=G.call(W,String.prototype.replace),Z=G.call(W,String.prototype.slice),he=G.call(W,RegExp.prototype.exec),E=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,z=/\\(\\)?/g,X=function(de,q){var B,te=de;if(ae(N,te)&&(te="%"+(B=N[te])[0]+"%"),ae(J,te)){var T=J[te];if(T===$&&(T=I(te)),T===void 0&&!q)throw new h("intrinsic "+de+" exists, but is not available. Please file an issue!");return{alias:B,name:te,value:T}}throw new u("intrinsic "+de+" does not exist!")};a.exports=function(de,q){if(typeof de!="string"||de.length===0)throw new h("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof q!="boolean")throw new h('"allowMissing" argument must be a boolean');if(he(/^%?[^%]*%?$/,de)===null)throw new u("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var B=function(qe){var vt=Z(qe,0,1),jt=Z(qe,-1);if(vt==="%"&&jt!=="%")throw new u("invalid intrinsic syntax, expected closing `%`");if(jt==="%"&&vt!=="%")throw new u("invalid intrinsic syntax, expected opening `%`");var wt=[];return oe(qe,E,function(ft,fr,Nt,Bt){wt[wt.length]=Nt?oe(Bt,z,"$1"):fr||ft}),wt}(de),te=B.length>0?B[0]:"",T=X("%"+te+"%",q),Y=T.name,ie=T.value,me=!1,ne=T.alias;ne&&(te=ne[0],Se(B,ce([0,1],ne)));for(var ye=1,Re=!0;ye<B.length;ye+=1){var Ie=B[ye],je=Z(Ie,0,1),Be=Z(Ie,-1);if((je==='"'||je==="'"||je==="`"||Be==='"'||Be==="'"||Be==="`")&&je!==Be)throw new u("property names with quotes must have matching quotes");if(Ie!=="constructor"&&Re||(me=!0),ae(J,Y="%"+(te+="."+Ie)+"%"))ie=J[Y];else if(ie!=null){if(!(Ie in ie)){if(!q)throw new h("base intrinsic for "+de+" exists, but the property is not available.");return}if(S&&ye+1>=B.length){var Me=S(ie,Ie);ie=(Re=!!Me)&&"get"in Me&&!("originalValue"in Me.get)?Me.get:ie[Ie]}else Re=ae(ie,Ie),ie=ie[Ie];Re&&!me&&(J[Y]=ie)}}return ie}},6413:(a,i,t)=>{"use strict";function n(l){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},n(l)}function c(l,d){var _=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);d&&(p=p.filter(function(m){return Object.getOwnPropertyDescriptor(l,m).enumerable})),_.push.apply(_,p)}return _}function b(l,d,_){return(d=function(p){var m=function(y){if(n(y)!="object"||!y)return y;var k=y[Symbol.toPrimitive];if(k!==void 0){var v=k.call(y,"string");if(n(v)!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(y)}(p);return n(m)=="symbol"?m:m+""}(d))in l?Object.defineProperty(l,d,{value:_,enumerable:!0,configurable:!0,writable:!0}):l[d]=_,l}var x=t(3609),w=t(6426),g=t(8953),o=t(4327);function u(l,d){w.call(this,l,d,"Boolean")}u.schemaName="Boolean",u.defaultOptions={},u.prototype=Object.create(w.prototype),u.prototype.constructor=u,u._cast=g,u.set=w.set,u.setters=[],u.get=w.get,u.cast=function(l){return arguments.length===0||(l===!1&&(l=this._defaultCaster),this._cast=l),this._cast},u._defaultCaster=function(l){if(l!=null&&typeof l!="boolean")throw new Error;return l},u._checkRequired=function(l){return l===!0||l===!1},u.checkRequired=w.checkRequired,u.prototype.checkRequired=function(l){return this.constructor._checkRequired(l)},Object.defineProperty(u,"convertToTrue",{get:function(){return g.convertToTrue},set:function(l){g.convertToTrue=l}}),Object.defineProperty(u,"convertToFalse",{get:function(){return g.convertToFalse},set:function(l){g.convertToFalse=l}}),u.prototype.cast=function(l){var d;d=typeof this._castFunction=="function"?this._castFunction:typeof this.constructor.cast=="function"?this.constructor.cast():u.cast();try{return d(l)}catch(_){throw new x("Boolean",l,this.path,_,this)}};var h=function(l){for(var d=1;d<arguments.length;d++){var _=arguments[d]!=null?arguments[d]:{};d%2?c(Object(_),!0).forEach(function(p){b(l,p,_[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(_)):c(Object(_)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(_,p))})}return l}({},w.prototype.$conditionalHandlers);Object.defineProperty(u.prototype,"$conditionalHandlers",{enumerable:!1,value:h}),u.prototype.castForQuery=function(l,d,_){var p;if(l!=null)return(p=this.$conditionalHandlers[l])?p.call(this,d):this.applySetters(d,_);try{return this.applySetters(d,_)}catch(m){throw m instanceof x&&m.path===this.path&&this.$fullPath!=null&&(m.path=this.$fullPath),m}},u.prototype._castNullish=function(l){if(l===void 0)return l;var d=typeof this.constructor.cast=="function"?this.constructor.cast():u.cast();return d==null?l:!(d.convertToFalse instanceof Set&&d.convertToFalse.has(l))&&(!!(d.convertToTrue instanceof Set&&d.convertToTrue.has(l))||l)},u.prototype.toJSONSchema=function(l){var d=this.options.required&&typeof this.options.required!="function";return o("boolean","bool",l?.useBsonType,d)},u.prototype.autoEncryptionType=function(){return"bool"},a.exports=u},6426:(a,i,t)=>{"use strict";var n=t(5832).hp;function c(K){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(H){return typeof H}:function(H){return H&&typeof Symbol=="function"&&H.constructor===Symbol&&H!==Symbol.prototype?"symbol":typeof H},c(K)}var b=t(3672),x=t(8879),w=t(8499),g=t(2555),o=t(4450),u=t(8133),h=t(9183),l=t(6155),d=t(2746),_=t(7930).schemaTypeSymbol,p=t(8768),m=t(7930).validatorErrorSymbol,y=t(7930).documentIsModified,k=t(7930).populateModelSymbol,v=b.CastError,D=b.ValidatorError,j={_skipMarkModified:!0};function S(K,H,Q){this[_]=!0,this.path=K,this.instance=Q,this.schemaName=this.constructor.schemaName,this.validators=[],this.getters=this.constructor.hasOwnProperty("getters")?this.constructor.getters.slice():[],this.setters=this.constructor.hasOwnProperty("setters")?this.constructor.setters.slice():[],this.splitPath(),H=H||{};for(var re=this.constructor.defaultOptions||{},ue=0,W=Object.keys(re);ue<W.length;ue++){var $=W[ue];$==="validate"?this.validate(re.validate):re.hasOwnProperty($)&&!Object.prototype.hasOwnProperty.call(H,$)&&(H[$]=re[$])}H.select==null&&delete H.select;var C=this.OptionsConstructor||x;this.options=new C(H),this._index=null,p.hasUserDefinedProperty(this.options,"immutable")&&(this.$immutable=this.options.immutable,u(this));for(var J=0,F=Object.keys(this.options);J<F.length;J++){var I=F[J];if(I!=="cast"){if(p.hasUserDefinedProperty(this.options,I)&&typeof this[I]=="function"){if(I==="index"&&this._index){if(H.index===!1){var N=this._index;if(c(N)==="object"&&N!=null){if(N.unique)throw new Error('Path "'+this.path+'" may not have `index` set to false and `unique` set to true');if(N.sparse)throw new Error('Path "'+this.path+'" may not have `index` set to false and `sparse` set to true')}this._index=!1}continue}var G=H[I];if(I==="default"){this.default(G);continue}var ae=Array.isArray(G)?G:[G];this[I].apply(this,ae)}}else Array.isArray(this.options[I])?this.castFunction.apply(this,this.options[I]):this.castFunction(this.options[I])}Object.defineProperty(this,"$$context",{enumerable:!1,configurable:!1,writable:!0,value:null})}function A(K,H){if(K!==void 0&&!K){var Q=new(H.ErrorConstructor||D)(H);return Q[m]=!0,Q}}function M(K,H){return this.castForQuery(null,K,H)}function V(K,H){var Q=this;return Array.isArray(K)?K.map(function(re){return Array.isArray(re)&&re.length===0?re:Q.castForQuery(null,re,H)}):[this.castForQuery(null,K,H)]}S.prototype.OptionsConstructor=x,S.prototype.path,S.prototype.validators,S.prototype.isRequired,S.prototype.splitPath=function(){return this._presplitPath!=null?this._presplitPath:this.path!=null?(this._presplitPath=this.path.indexOf(".")===-1?[this.path]:this.path.split("."),this._presplitPath):void 0},S.cast=function(K){return arguments.length===0||(K===!1&&(K=function(H){return H}),this._cast=K),this._cast},S.prototype.castFunction=function(K,H){return arguments.length===0?this._castFunction:(K===!1&&(K=this.constructor._defaultCaster||function(Q){return Q}),typeof K=="string"?(this._castErrorMessage=K,this._castFunction):(K!=null&&(this._castFunction=K),H!=null&&(this._castErrorMessage=H),this._castFunction))},S.prototype.cast=function(){throw new Error("Base SchemaType class does not implement a `cast()` function")},S.set=function(K,H){this.hasOwnProperty("defaultOptions")||(this.defaultOptions=Object.assign({},this.defaultOptions)),this.defaultOptions[K]=H},S.get=function(K){this.getters=this.hasOwnProperty("getters")?this.getters:[],this.getters.push(K)},S.prototype.default=function(K){if(arguments.length===1){if(K===void 0)return void(this.defaultValue=void 0);if(K!=null&&K.instanceOfSchema)throw new b("Cannot set default value of path `"+this.path+"` to a mongoose Schema instance.");return this.defaultValue=K,this.defaultValue}return arguments.length>1&&(this.defaultValue=Array.prototype.slice.call(arguments)),this.defaultValue},S.prototype.index=function(K){return this._index=K,p.expires(this._index),this},S.prototype.unique=function(K,H){if(this._index===!1){if(!K)return;throw new Error('Path "'+this.path+'" may not have `index` set to false and `unique` set to true')}return this.options.hasOwnProperty("index")||K!==!1?(this._index==null||this._index===!0?this._index={}:typeof this._index=="string"&&(this._index={type:this._index}),this._index.unique=!!K,typeof H=="string"&&(this._duplicateKeyErrorMessage=H),this):this},S.prototype.text=function(K){if(this._index===!1){if(!K)return this;throw new Error('Path "'+this.path+'" may not have `index` set to false and `text` set to true')}return this.options.hasOwnProperty("index")||K!==!1?(this._index===null||this._index===void 0||typeof this._index=="boolean"?this._index={}:typeof this._index=="string"&&(this._index={type:this._index}),this._index.text=K,this):this},S.prototype.sparse=function(K){if(this._index===!1){if(!K)return this;throw new Error('Path "'+this.path+'" may not have `index` set to false and `sparse` set to true')}return this.options.hasOwnProperty("index")||K!==!1?(this._index==null||typeof this._index=="boolean"?this._index={}:typeof this._index=="string"&&(this._index={type:this._index}),this._index.sparse=K,this):this},S.prototype.immutable=function(K){return this.$immutable=K,u(this),this},S.prototype.transform=function(K){return this.options.transform=K,this},S.prototype.set=function(K){if(typeof K!="function")throw new TypeError("A setter must be a function.");return this.setters.push(K),this},S.prototype.get=function(K){if(typeof K!="function")throw new TypeError("A getter must be a function.");return this.getters.push(K),this},S.prototype.validateAll=function(K){for(var H=0;H<K.length;H++)this.validate(K[H]);return this},S.prototype.validate=function(K,H,Q){var re,ue,W,$;if(typeof K=="function"||K&&p.getFunctionName(K.constructor)==="RegExp")return typeof H=="function"?(re={validator:K,message:H}).type=Q||"user defined":H instanceof Object&&!Q?((re=l(H)?Object.assign({},H):o(H)).message||(re.message=re.msg),re.validator=K,re.type=re.type||"user defined"):(H==null&&(H=b.messages.general.default),Q||(Q="user defined"),re={message:H,type:Q,validator:K}),this.validators.push(re),this;for(ue=0,W=arguments.length;ue<W;ue++){if($=arguments[ue],!p.isPOJO($)){var C="Invalid validator. Received ("+c($)+") "+$+". See https://mongoosejs.com/docs/api/schematype.html#SchemaType.prototype.validate()";throw new Error(C)}this.validate($.validator,$)}return this},S.prototype.required=function(K,H){var Q={};if(arguments.length>0&&K==null)return this.validators=this.validators.filter(function(W){return W.validator!==this.requiredValidator},this),this.isRequired=!1,delete this.originalRequiredValue,this;if(c(K)==="object"&&(H=(Q=K).message||H,K=K.isRequired),K===!1)return this.validators=this.validators.filter(function(W){return W.validator!==this.requiredValidator},this),this.isRequired=!1,delete this.originalRequiredValue,this;var re=this;this.isRequired=!0,this.requiredValidator=function(W){var $=this&&this.$__&&this.$__.cachedRequired;if($!=null&&!this.$__isSelected(re.path)&&!this[y](re.path))return!0;if($!=null&&re.path in $){var C=!$[re.path]||re.checkRequired(W,this);return delete $[re.path],C}return typeof K=="function"&&!K.apply(this)||re.checkRequired(W,this)},this.originalRequiredValue=K,typeof K=="string"&&(H=K,K=void 0);var ue=H||b.messages.general.required;return this.validators.unshift(Object.assign({},Q,{validator:this.requiredValidator,message:ue,type:"required"})),this},S.prototype.ref=function(K){return this.options.ref=K,this},S.prototype.getDefault=function(K,H,Q){var re;if(this.defaultValue==null)return this.defaultValue;if((re=typeof this.defaultValue=="function"?this.defaultValue===Date.now||this.defaultValue===Array||this.defaultValue.name.toLowerCase()==="objectid"?this.defaultValue.call(K):this.defaultValue.call(K,K):this.defaultValue)!=null){if(c(re)!=="object"||this.options&&this.options.shared||(re=o(re)),Q&&Q.skipCast)return this._applySetters(re,K);var ue=this.applySetters(re,K,H,void 0,j);return ue&&!Array.isArray(ue)&&ue.$isSingleNested&&(ue.$__parent=K),ue}return re},S.prototype._applySetters=function(K,H,Q,re,ue){var W=K;if(Q)return W;for(var $=this.setters,C=$.length-1;C>=0;C--)W=$[C].call(H,W,re,this,ue);return W},S.prototype._castNullish=function(K){return K},S.prototype.applySetters=function(K,H,Q,re,ue){var W=this._applySetters(K,H,Q,re,ue);return W==null?this._castNullish(W):W=this.cast(W,H,Q,re,ue)},S.prototype.applyGetters=function(K,H){var Q=K,re=this.getters,ue=re.length;if(ue===0)return Q;for(var W=0;W<ue;++W)Q=re[W].call(H,Q,this);return Q},S.prototype.select=function(K){return this.selected=!!K,this},S.prototype.doValidate=function(K,H,Q,re){var ue=this,W=!1,$=this.path;if(typeof H!="function")throw new TypeError("Must pass callback function to doValidate(), got ".concat(c(H)));var C=this.validators.filter(function(ae){return c(ae)==="object"&&ae!==null}),J=C.length;if(!J)return H(null);for(var F=function(){if(W)return 0;var ae,ce=C[I],Se=ce.validator,oe=l(ce)?Object.assign({},ce):o(ce);if(oe.path=re&&re.path?re.path:$,oe.fullPath=ue.$fullPath,oe.value=K,typeof K=="string"&&(oe.length=K.length,oe.value.length>30&&(oe.value=oe.value.slice(0,30)+"...")),Se instanceof RegExp)return G(Se.test(K),oe,Q),1;if(typeof Se!="function")return 1;if(K===void 0&&Se!==ue.requiredValidator)return G(!0,oe,Q),1;try{ae=oe.propsParameter?Se.call(Q,K,oe):Se.call(Q,K)}catch(Z){ae=!1,oe.reason=Z,Z.message&&(oe.message=Z.message)}ae!=null&&typeof ae.then=="function"?ae.then(function(Z){G(Z,oe,Q)},function(Z){oe.reason=Z,oe.message=Z.message,G(ae=!1,oe,Q)}):G(ae,oe,Q)},I=0,N=C.length;I<N&&F()!==0;++I);function G(ae,ce,Se){if(!W)if(ae===void 0||ae)--J<=0&&d(function(){H(null)});else{var oe=ce.ErrorConstructor||D;(W=new oe(ce,Se))[m]=!0,d(function(){H(W)})}}},S.prototype.doValidateSync=function(K,H,Q){var re=this.path;if(!this.validators.length)return null;var ue=this.validators;if(K===void 0){if(this.validators.length===0||this.validators[0].type!=="required")return null;ue=[this.validators[0]]}var W=null,$=0,C=ue.length;for($=0;$<C;++$){var J=ue[$];if(J!==null&&c(J)==="object"){var F=J.validator,I=l(J)?Object.assign({},J):o(J);I.path=Q&&Q.path?Q.path:re,I.fullPath=this.$fullPath,I.value=K,typeof K=="string"&&(I.length=K.length,I.value.length>30&&(I.value=I.value.slice(0,30)+"..."));var N=!1;if(!h(F)){if(F instanceof RegExp)W=A(F.test(K),I);else if(typeof F=="function"){try{N=I.propsParameter?F.call(H,K,I):F.call(H,K)}catch(G){N=!1,I.reason=G}if((N==null||typeof N.then!="function")&&(W=A(N,I)))break}}}}return W},S._isRef=function(K,H,Q,re){var ue=re&&K.options&&(K.options.ref||K.options.refPath);if(!ue&&Q&&Q.$__!=null){var W=Q.$__fullPath(K.path,!0),$=Q.ownerDocument();ue=W!=null&&$.$populated(W)||Q.$populated(K.path)}return!!ue&&(H==null||!(n.isBuffer(H)||H._bsontype==="Binary"||!p.isObject(H))||re)},S.prototype._castRef=function(K,H,Q,re){if(K==null)return K;if(K.$__!=null)return K.$__.wasPopulated=K.$__.wasPopulated||{value:K._doc._id},K;if(n.isBuffer(K)||!p.isObject(K)){if(Q)return K;throw new v(this.instance,K,this.path,null,this)}var ue,W,$,C=H.$__fullPath(this.path,!0),J=H.ownerDocument().$populated(C,!0),F=K;if(!(H.$__.populated&&H.$__.populated[C]&&H.$__.populated[C].options&&H.$__.populated[C].options.options&&H.$__.populated[C].options.options.lean)){var I=J?J.options[k]:H.constructor.db.model(this.options.ref);(F=I.hydrate(K,null,re)).$__.wasPopulated={value:F._doc._id,options:(ue={},W=k,$=I,(W=function(N){var G=function(ae){if(c(ae)!="object"||!ae)return ae;var ce=ae[Symbol.toPrimitive];if(ce!==void 0){var Se=ce.call(ae,"string");if(c(Se)!="object")return Se;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(ae)}(N);return c(G)=="symbol"?G:G+""}(W))in ue?Object.defineProperty(ue,W,{value:$,enumerable:!0,configurable:!0,writable:!0}):ue[W]=$,ue)}}return F},S.prototype.$conditionalHandlers={$all:function(K,H){var Q=this;return Array.isArray(K)?K.map(function(re){return Q.castForQuery(null,re,H)}):[this.castForQuery(null,K,H)]},$eq:M,$in:V,$ne:M,$nin:V,$exists:w,$type:g},S.prototype.castForQuery=function(K,H,Q){var re;if(K!=null){if(!(re=this.$conditionalHandlers[K]))throw new Error("Can't use "+K);return re.call(this,H,Q)}try{return this.applySetters(H,Q)}catch(ue){throw ue instanceof v&&ue.path===this.path&&this.$fullPath!=null&&(ue.path=this.$fullPath),ue}},S.checkRequired=function(K){return arguments.length!==0&&(this._checkRequired=K),this._checkRequired},S.prototype.checkRequired=function(K){return K!=null},S.prototype.clone=function(){var K=Object.assign({},this.options),H=new this.constructor(this.path,K,this.instance);return H.validators=this.validators.slice(),this.requiredValidator!==void 0&&(H.requiredValidator=this.requiredValidator),this.defaultValue!==void 0&&(H.defaultValue=this.defaultValue),this.$immutable!==void 0&&this.options.immutable===void 0&&(H.$immutable=this.$immutable,u(H)),this._index!==void 0&&(H._index=this._index),this.selected!==void 0&&(H.selected=this.selected),this.isRequired!==void 0&&(H.isRequired=this.isRequired),this.originalRequiredValue!==void 0&&(H.originalRequiredValue=this.originalRequiredValue),H.getters=this.getters.slice(),H.setters=this.setters.slice(),H},S.prototype.getEmbeddedSchemaType=function(){return this.$embeddedSchemaType},S.prototype._duplicateKeyErrorMessage=null,S.prototype.toJSONSchema=function(K){throw new Error("Converting unsupported SchemaType to JSON Schema: ".concat(this.instance,' at path "').concat(this.path,'"'))},S.prototype.autoEncryptionType=function(){return null},a.exports=i=S,i.CastError=v,i.ValidatorError=D},6451:(a,i,t)=>{"use strict";var n=t(8768).isPOJO;a.exports=function c(b){for(var x,w,g,o=Object.keys(b),u=o.length;u--;)g=b[w=o[u]],n(g)&&(b[w]=c(g)),b[w]!==void 0?x=!0:delete b[w];return x?b:void 0}},6511:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}function c(o,u){(u==null||u>o.length)&&(u=o.length);for(var h=0,l=Array(u);h<u;h++)l[h]=o[h];return l}function b(o,u){var h=Object.keys(o);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(o);u&&(l=l.filter(function(d){return Object.getOwnPropertyDescriptor(o,d).enumerable})),h.push.apply(h,l)}return h}function x(o){for(var u=1;u<arguments.length;u++){var h=arguments[u]!=null?arguments[u]:{};u%2?b(Object(h),!0).forEach(function(l){w(o,l,h[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(h)):b(Object(h)).forEach(function(l){Object.defineProperty(o,l,Object.getOwnPropertyDescriptor(h,l))})}return o}function w(o,u,h){return(u=function(l){var d=function(_){if(n(_)!="object"||!_)return _;var p=_[Symbol.toPrimitive];if(p!==void 0){var m=p.call(_,"string");if(n(m)!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(_)}(l);return n(d)=="symbol"?d:d+""}(u))in o?Object.defineProperty(o,u,{value:h,enumerable:!0,configurable:!0,writable:!0}):o[u]=h,o}t(8768);var g=a.exports=function(){};g.ctor=function(){var o=Array.prototype.slice.call(arguments),u=function(){g.apply(this,arguments),this.paths={},this.states={}};return(u.prototype=new g).constructor=u,u.prototype.stateNames=o,o.forEach(function(h){u.prototype[h]=function(l){this._changeState(l,h)}}),u},g.prototype._changeState=function(o,u){var h=this.paths[o];if(h!==u){var l=this.states[h];l&&delete l[o],this.paths[o]=u,this.states[u]=this.states[u]||{},this.states[u][o]=!0}},g.prototype.clear=function(o){if(this.states[o]!=null)for(var u,h=Object.keys(this.states[o]),l=h.length;l--;)u=h[l],delete this.states[o][u],delete this.paths[u]},g.prototype.clearPath=function(o){var u=this.paths[o];u&&(delete this.paths[o],delete this.states[u][o])},g.prototype.getStatePaths=function(o){return this.states[o]!=null?this.states[o]:{}},g.prototype.some=function(){var o=this,u=arguments.length?arguments:this.stateNames;return Array.prototype.some.call(u,function(h){return o.states[h]!=null&&Object.keys(o.states[h]).length})},g.prototype._iter=function(o){return function(){var u=Array.prototype.slice.call(arguments),h=u.pop();u.length||(u=this.stateNames);var l=this;return u.reduce(function(d,_){return l.states[_]==null?d:d.concat(Object.keys(l.states[_]))},[])[o](function(d,_,p){return h(d,_,p)})}},g.prototype.forEach=function(){return this.forEach=this._iter("forEach"),this.forEach.apply(this,arguments)},g.prototype.map=function(){return this.map=this._iter("map"),this.map.apply(this,arguments)},g.prototype.clone=function(){var o=new this.constructor;o.paths=x({},this.paths);var u,h=function(d,_){var p=typeof Symbol<"u"&&d[Symbol.iterator]||d["@@iterator"];if(!p){if(Array.isArray(d)||(p=function(j,S){if(j){if(typeof j=="string")return c(j,S);var A={}.toString.call(j).slice(8,-1);return A==="Object"&&j.constructor&&(A=j.constructor.name),A==="Map"||A==="Set"?Array.from(j):A==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(A)?c(j,S):void 0}}(d))||_&&d&&typeof d.length=="number"){p&&(d=p);var m=0,y=function(){};return{s:y,n:function(){return m>=d.length?{done:!0}:{done:!1,value:d[m++]}},e:function(j){throw j},f:y}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var k,v=!0,D=!1;return{s:function(){p=p.call(d)},n:function(){var j=p.next();return v=j.done,j},e:function(j){D=!0,k=j},f:function(){try{v||p.return==null||p.return()}finally{if(D)throw k}}}}(this.stateNames);try{for(h.s();!(u=h.n()).done;){var l=u.value;l in this.states&&(o.states[l]=this.states[l]==null?this.states[l]:x({},this.states[l]))}}catch(d){h.e(d)}finally{h.f()}return o}},6544:(a,i,t)=>{"use strict";function n(p){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},n(p)}var c;if(!Object.keys){var b=Object.prototype.hasOwnProperty,x=Object.prototype.toString,w=t(6312),g=Object.prototype.propertyIsEnumerable,o=!g.call({toString:null},"toString"),u=g.call(function(){},"prototype"),h=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(p){var m=p.constructor;return m&&m.prototype===p},d={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},_=function(){if(typeof window>"u")return!1;for(var p in window)try{if(!d["$"+p]&&b.call(window,p)&&window[p]!==null&&n(window[p])==="object")try{l(window[p])}catch{return!0}}catch{return!0}return!1}();c=function(p){var m=p!==null&&n(p)==="object",y=x.call(p)==="[object Function]",k=w(p),v=m&&x.call(p)==="[object String]",D=[];if(!m&&!y&&!k)throw new TypeError("Object.keys called on a non-object");var j=u&&y;if(v&&p.length>0&&!b.call(p,0))for(var S=0;S<p.length;++S)D.push(String(S));if(k&&p.length>0)for(var A=0;A<p.length;++A)D.push(String(A));else for(var M in p)j&&M==="prototype"||!b.call(p,M)||D.push(String(M));if(o)for(var V=function(H){if(typeof window>"u"||!_)return l(H);try{return l(H)}catch{return!1}}(p),K=0;K<h.length;++K)V&&h[K]==="constructor"||!b.call(p,h[K])||D.push(h[K]);return D}}a.exports=c},6547:(a,i,t)=>{"use strict";function n(l,d){var _=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);d&&(p=p.filter(function(m){return Object.getOwnPropertyDescriptor(l,m).enumerable})),_.push.apply(_,p)}return _}function c(l,d,_){return(d=function(p){var m=function(y){if(b(y)!="object"||!y)return y;var k=y[Symbol.toPrimitive];if(k!==void 0){var v=k.call(y,"string");if(b(v)!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(y)}(p);return b(m)=="symbol"?m:m+""}(d))in l?Object.defineProperty(l,d,{value:_,enumerable:!0,configurable:!0,writable:!0}):l[d]=_,l}function b(l){return b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},b(l)}var x=t(3550).EventEmitter,w=t(9380),g=t(8768),o=t(7930).documentArrayParent;function u(l,d,_,p,m){var y;g.isMongooseDocumentArray(d)?(this.__parentArray=d,this[o]=d.$parent()):(this.__parentArray=void 0,this[o]=void 0),this.$setIndex(m),this.$__parent=this[o],b(_)==="object"&&_!=null?(y=function(k){for(var v=1;v<arguments.length;v++){var D=arguments[v]!=null?arguments[v]:{};v%2?n(Object(D),!0).forEach(function(j){c(k,j,D[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(D)):n(Object(D)).forEach(function(j){Object.defineProperty(k,j,Object.getOwnPropertyDescriptor(D,j))})}return k}({isNew:!0},_),_=void 0):y={isNew:!0},w.call(this,l,p,this[o],_,y)}for(var h in u.prototype=Object.create(w.prototype),u.prototype.constructor=u,Object.defineProperty(u.prototype,"$isSingleNested",{configurable:!1,writable:!1,value:!1}),Object.defineProperty(u.prototype,"$isDocumentArrayElement",{configurable:!1,writable:!1,value:!0}),x.prototype)u[h]=x.prototype[h];u.prototype.$setIndex=function(l){if(this.__index=l,this.$__!=null&&this.$__.validationError!=null)for(var d=0,_=Object.keys(this.$__.validationError.errors);d<_.length;d++){var p=_[d];this.invalidate(p,this.$__.validationError.errors[p])}},u.prototype.populate=function(){throw new Error('Mongoose does not support calling populate() on nested docs. Instead of `doc.arr[0].populate("path")`, use `doc.populate("arr.0.path")`')},u.prototype.$__removeFromParent=function(){var l=this._doc._id;if(!l)throw new Error("For your own good, Mongoose does not know how to remove an ArraySubdocument that has no _id");this.__parentArray.pull({_id:l})},u.prototype.$__fullPath=function(l,d){return this.__index==null?null:(this.$__.fullPath||this.ownerDocument(),d?l?this.$__.fullPath+"."+l:this.$__.fullPath:l?this.$__.fullPath+"."+this.__index+"."+l:this.$__.fullPath+"."+this.__index)},u.prototype.$__pathRelativeToParent=function(l,d){return this.__index!=null&&this.__parentArray&&this.__parentArray.$path?d?l==null?this.__parentArray.$path():this.__parentArray.$path()+"."+l:l==null?this.__parentArray.$path()+"."+this.__index:this.__parentArray.$path()+"."+this.__index+"."+l:null},u.prototype.$parent=function(){return this[o]},u.prototype.parentArray=function(){return this.__parentArray},a.exports=u},6583:(a,i,t)=>{"use strict";function n(u){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},n(u)}var c,b=t(8863),x=t(1464);try{c=[].__proto__===Array.prototype}catch(u){if(!u||n(u)!=="object"||!("code"in u)||u.code!=="ERR_PROTO_ACCESS")throw u}var w=!!c&&x&&x(Object.prototype,"__proto__"),g=Object,o=g.getPrototypeOf;a.exports=w&&typeof w.get=="function"?b([w.get]):typeof o=="function"&&function(u){return o(u==null?u:g(u))}},6665:a=>{"use strict";a.exports=function(i,t){for(var n,c,b,x=t.split("."),w="",g=0;g<x.length;++g)if(i[w+=w.length?".":""+x[g]]){for(b=(c=Object.keys(i)).length,n=0;n<b;++n)c[g].indexOf(w+".")!==0||c[g].indexOf(t);return!0}return!1}},6730:a=>{"use strict";var i=Object.prototype.toString,t=Math.max,n=function(c,b){for(var x=[],w=0;w<c.length;w+=1)x[w]=c[w];for(var g=0;g<b.length;g+=1)x[g+c.length]=b[g];return x};a.exports=function(c){var b=this;if(typeof b!="function"||i.apply(b)!=="[object Function]")throw new TypeError("Function.prototype.bind called on incompatible "+b);for(var x,w=function(l){for(var d=[],_=1,p=0;_<l.length;_+=1,p+=1)d[p]=l[_];return d}(arguments),g=t(0,b.length-w.length),o=[],u=0;u<g;u++)o[u]="$"+u;if(x=Function("binder","return function ("+function(l){for(var d="",_=0;_<l.length;_+=1)d+=l[_],_+1<l.length&&(d+=",");return d}(o)+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof x){var l=b.apply(this,n(w,arguments));return Object(l)===l?l:this}return b.apply(c,n(w,arguments))}),b.prototype){var h=function(){};h.prototype=b.prototype,x.prototype=new h,h.prototype=null}return x}},6750:(a,i,t)=>{"use strict";function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}var c=t(988),b=t(9907),x=t(2268),w=t(1464);a.exports=function(g,o,u){if(!g||n(g)!=="object"&&typeof g!="function")throw new x("`obj` must be an object or a function`");if(typeof o!="string"&&n(o)!=="symbol")throw new x("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new x("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new x("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new x("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new x("`loose`, if provided, must be a boolean");var h=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,d=arguments.length>5?arguments[5]:null,_=arguments.length>6&&arguments[6],p=!!w&&w(g,o);if(c)c(g,o,{configurable:d===null&&p?p.configurable:!d,enumerable:h===null&&p?p.enumerable:!h,value:u,writable:l===null&&p?p.writable:!l});else{if(!_&&(h||l||d))throw new b("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");g[o]=u}}},6775:(a,i)=>{"use strict";i.byteLength=function(u){var h=w(u),l=h[0],d=h[1];return 3*(l+d)/4-d},i.toByteArray=function(u){var h,l,d=w(u),_=d[0],p=d[1],m=new c(function(v,D,j){return 3*(D+j)/4-j}(0,_,p)),y=0,k=p>0?_-4:_;for(l=0;l<k;l+=4)h=n[u.charCodeAt(l)]<<18|n[u.charCodeAt(l+1)]<<12|n[u.charCodeAt(l+2)]<<6|n[u.charCodeAt(l+3)],m[y++]=h>>16&255,m[y++]=h>>8&255,m[y++]=255&h;return p===2&&(h=n[u.charCodeAt(l)]<<2|n[u.charCodeAt(l+1)]>>4,m[y++]=255&h),p===1&&(h=n[u.charCodeAt(l)]<<10|n[u.charCodeAt(l+1)]<<4|n[u.charCodeAt(l+2)]>>2,m[y++]=h>>8&255,m[y++]=255&h),m},i.fromByteArray=function(u){for(var h,l=u.length,d=l%3,_=[],p=16383,m=0,y=l-d;m<y;m+=p)_.push(o(u,m,m+p>y?y:m+p));return d===1?(h=u[l-1],_.push(t[h>>2]+t[h<<4&63]+"==")):d===2&&(h=(u[l-2]<<8)+u[l-1],_.push(t[h>>10]+t[h>>4&63]+t[h<<2&63]+"=")),_.join("")};for(var t=[],n=[],c=typeof Uint8Array<"u"?Uint8Array:Array,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",x=0;x<64;++x)t[x]=b[x],n[b.charCodeAt(x)]=x;function w(u){var h=u.length;if(h%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var l=u.indexOf("=");return l===-1&&(l=h),[l,l===h?0:4-l%4]}function g(u){return t[u>>18&63]+t[u>>12&63]+t[u>>6&63]+t[63&u]}function o(u,h,l){for(var d,_=[],p=h;p<l;p+=3)d=(u[p]<<16&16711680)+(u[p+1]<<8&65280)+(255&u[p+2]),_.push(g(d));return _.join("")}n[45]=62,n[95]=63},6801:(a,i,t)=>{"use strict";function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}function c(){try{var g=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!g})()}function b(g){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},b(g)}function x(g,o){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},x(g,o)}var w=function(g){function o(h,l){var d;return function(_,p){if(!(_ instanceof p))throw new TypeError("Cannot call a class as a function")}(this,o),(d=function(_,p,m){return p=b(p),function(y,k){if(k&&(n(k)=="object"||typeof k=="function"))return k;if(k!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(v){if(v===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v}(y)}(_,c()?Reflect.construct(p,m||[],b(_).constructor):p.apply(_,m))}(this,o,[l=l||"Cannot populate path `"+h+"` because it is not in your schema. Set the `strictPopulate` option to false to override."])).path=h,d}return function(h,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(l&&l.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),l&&x(h,l)}(o,g),u=o,Object.defineProperty(u,"prototype",{writable:!1}),u;var u}(t(8213));Object.defineProperty(w.prototype,"name",{value:"StrictPopulateError"}),a.exports=w},6814:a=>{"use strict";a.exports=function(i){for(var t={},n=0,c=Object.keys(i);n<c.length;n++){var b=c[n];if(b.indexOf(".")!==-1)for(var x=b.split("."),w=x[0],g=0;g<x.length;++g)t[w]=1,g+1<x.length&&(w=w+"."+x[g+1]);else t[b]=1}return t}},6867:(a,i,t)=>{"use strict";function n(v){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},n(v)}function c(v,D){var j=Object.keys(v);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(v);D&&(S=S.filter(function(A){return Object.getOwnPropertyDescriptor(v,A).enumerable})),j.push.apply(j,S)}return j}function b(v){for(var D=1;D<arguments.length;D++){var j=arguments[D]!=null?arguments[D]:{};D%2?c(Object(j),!0).forEach(function(S){x(v,S,j[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(j)):c(Object(j)).forEach(function(S){Object.defineProperty(v,S,Object.getOwnPropertyDescriptor(j,S))})}return v}function x(v,D,j){return(D=o(D))in v?Object.defineProperty(v,D,{value:j,enumerable:!0,configurable:!0,writable:!0}):v[D]=j,v}function w(v,D){(D==null||D>v.length)&&(D=v.length);for(var j=0,S=Array(D);j<D;j++)S[j]=v[j];return S}function g(v,D){for(var j=0;j<D.length;j++){var S=D[j];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(v,o(S.key),S)}}function o(v){var D=function(j){if(n(j)!="object"||!j)return j;var S=j[Symbol.toPrimitive];if(S!==void 0){var A=S.call(j,"string");if(n(A)!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(j)}(v);return n(D)=="symbol"?D:D+""}function u(){try{var v=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(u=function(){return!!v})()}function h(){return h=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(v,D,j){var S=function(M,V){for(;!{}.hasOwnProperty.call(M,V)&&(M=l(M))!==null;);return M}(v,D);if(S){var A=Object.getOwnPropertyDescriptor(S,D);return A.get?A.get.call(arguments.length<3?v:j):A.value}},h.apply(null,arguments)}function l(v){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(D){return D.__proto__||Object.getPrototypeOf(D)},l(v)}function d(v,D){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(j,S){return j.__proto__=S,j},d(v,D)}var _=t(2081),p=t(241),m=t(6426),y=t(4327),k=function(v){function D(A,M){var V;return function(K,H){if(!(K instanceof H))throw new TypeError("Cannot call a class as a function")}(this,D),(V=function(K,H,Q){return H=l(H),function(re,ue){if(ue&&(n(ue)=="object"||typeof ue=="function"))return ue;if(ue!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(W){if(W===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return W}(re)}(K,u()?Reflect.construct(H,Q||[],l(K).constructor):H.apply(K,Q))}(this,D,[A,M,"Map"])).$isSchemaMap=!0,V}return function(A,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function");A.prototype=Object.create(M&&M.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),Object.defineProperty(A,"prototype",{writable:!1}),M&&d(A,M)}(D,v),j=D,S=[{key:"set",value:function(A,M){return m.set(A,M)}},{key:"cast",value:function(A,M,V,K,H){if(A instanceof _)return A;var Q=this.path;if(V){var re=new _({},Q,M,this.$__schemaType,H),ue=re.$__pathRelativeToParent!=null?re.$__pathRelativeToParent:re.$__path;if(A instanceof t.g.Map){var W,$=function(ae,ce){var Se=typeof Symbol<"u"&&ae[Symbol.iterator]||ae["@@iterator"];if(!Se){if(Array.isArray(ae)||(Se=function(X,de){if(X){if(typeof X=="string")return w(X,de);var q={}.toString.call(X).slice(8,-1);return q==="Object"&&X.constructor&&(q=X.constructor.name),q==="Map"||q==="Set"?Array.from(X):q==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(q)?w(X,de):void 0}}(ae))||ce&&ae&&typeof ae.length=="number"){Se&&(ae=Se);var oe=0,Z=function(){};return{s:Z,n:function(){return oe>=ae.length?{done:!0}:{done:!1,value:ae[oe++]}},e:function(X){throw X},f:Z}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var he,E=!0,z=!1;return{s:function(){Se=Se.call(ae)},n:function(){var X=Se.next();return E=X.done,X},e:function(X){z=!0,he=X},f:function(){try{E||Se.return==null||Se.return()}finally{if(z)throw he}}}}(A.keys());try{for($.s();!(W=$.n()).done;){var C=W.value,J=A.get(C);J=J==null?re.$__schemaType._castNullish(J):re.$__schemaType.cast(J,M,!0,null,b(b({},H),{},{path:ue+"."+C})),re.$init(C,J)}}catch(ae){$.e(ae)}finally{$.f()}}else for(var F=0,I=Object.keys(A);F<I.length;F++){var N=I[F],G=A[N];G=G==null?re.$__schemaType._castNullish(G):re.$__schemaType.cast(G,M,!0,null,b(b({},H),{},{path:ue+"."+N})),re.$init(N,G)}return re}return new _(A,Q,M,this.$__schemaType,H)}},{key:"clone",value:function(){var A,M,V,K=(A=D,M=this,typeof(V=h(l(A.prototype),"clone",M))=="function"?function(H){return V.apply(M,H)}:V)([]);return this.$__schemaType!=null&&(K.$__schemaType=this.$__schemaType.clone()),K}},{key:"getEmbeddedSchemaType",value:function(){return this.$__schemaType}},{key:"toJSONSchema",value:function(A){var M=A?.useBsonType,V=this.getEmbeddedSchemaType(),K=this.options.required&&typeof this.options.required!="function",H=y("object","object",M,K);return H.additionalProperties=V.toJSONSchema(A),H}},{key:"autoEncryptionType",value:function(){return"object"}}],S&&g(j.prototype,S),Object.defineProperty(j,"prototype",{writable:!1}),j;var j,S}(m);k.schemaName="Map",k.prototype.OptionsConstructor=p,k.defaultOptions={},a.exports=k},6948:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}function c(o,u){for(var h=0;h<u.length;h++){var l=u[h];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(o,x(l.key),l)}}function b(o,u,h){return u&&c(o.prototype,u),h&&c(o,h),Object.defineProperty(o,"prototype",{writable:!1}),o}function x(o){var u=function(h){if(n(h)!="object"||!h)return h;var l=h[Symbol.toPrimitive];if(l!==void 0){var d=l.call(h,"string");if(n(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(h)}(o);return n(u)=="symbol"?u:u+""}var w=t(4450),g=b(function o(u){if(function(h,l){if(!(h instanceof l))throw new TypeError("Cannot call a class as a function")}(this,o),this._docs={},this._childDocs=[],u!=null&&(u=w(u),Object.assign(this,u),n(u.subPopulate)==="object"&&(this.populate=u.subPopulate),u.perDocumentLimit!=null&&u.limit!=null))throw new Error("Can not use `limit` and `perDocumentLimit` at the same time. Path: `"+u.path+"`.")});a.exports=g},6949:(a,i,t)=>{"use strict";function n(_){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},n(_)}function c(_,p){for(var m=0;m<p.length;m++){var y=p[m];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(_,b(y.key),y)}}function b(_){var p=function(m){if(n(m)!="object"||!m)return m;var y=m[Symbol.toPrimitive];if(y!==void 0){var k=y.call(m,"string");if(n(k)!="object")return k;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(m)}(_);return n(p)=="symbol"?p:p+""}function x(){try{var _=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(x=function(){return!!_})()}function w(_){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(p){return p.__proto__||Object.getPrototypeOf(p)},w(_)}function g(_,p){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,y){return m.__proto__=y,m},g(_,p)}var o=t(8213),u=t(8260),h=t(7352),l=t(1875),d=function(_){function p(k){var v,D;return function(j,S){if(!(j instanceof S))throw new TypeError("Cannot call a class as a function")}(this,p),(v=function(j,S,A){return S=w(S),function(M,V){if(V&&(n(V)=="object"||typeof V=="function"))return V;if(V!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(K){if(K===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return K}(M)}(j,x()?Reflect.construct(S,A||[],w(j).constructor):S.apply(j,A))}(this,p,[D=u(k)==="model"?k.constructor.modelName+" validation failed":"Validation failed"])).errors={},v._message=D,k&&(k.$errors=v.errors),v}return function(k,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function");k.prototype=Object.create(v&&v.prototype,{constructor:{value:k,writable:!0,configurable:!0}}),Object.defineProperty(k,"prototype",{writable:!1}),v&&g(k,v)}(p,_),m=p,(y=[{key:"toString",value:function(){return this.name+": "+l(this)}},{key:"inspect",value:function(){return Object.assign(new Error(this.message),this)}},{key:"addError",value:function(k,v){if(v instanceof p)for(var D=v.errors,j=0,S=Object.keys(D);j<S.length;j++){var A=S[j];this.addError("".concat(k,".").concat(A),D[A])}else this.errors[k]=v,this.message=this._message+": "+l(this)}}])&&c(m.prototype,y),Object.defineProperty(m,"prototype",{writable:!1}),m;var m,y}(o);h.inspect.custom&&(d.prototype[h.inspect.custom]=d.prototype.inspect),Object.defineProperty(d.prototype,"toJSON",{enumerable:!1,writable:!1,configurable:!0,value:function(){return Object.assign({},this,{name:this.name,message:this.message})}}),Object.defineProperty(d.prototype,"name",{value:"ValidationError"}),a.exports=d},6974:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}function c(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!o})()}function b(o){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},b(o)}function x(o,u){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,l){return h.__proto__=l,h},x(o,u)}var w=function(o){function u(){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,u),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,u,arguments)}return function(l,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(d&&d.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),d&&x(l,d)}(u,o),h=u,Object.defineProperty(h,"prototype",{writable:!1}),h;var h}(t(8879)),g=t(5761);Object.defineProperty(w.prototype,"of",g),a.exports=w},6996:(a,i,t)=>{"use strict";function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}function c(){try{var g=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!g})()}function b(g){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},b(g)}function x(g,o){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},x(g,o)}var w=function(g){function o(h,l,d){var _;(function(m,y){if(!(m instanceof y))throw new TypeError("Cannot call a class as a function")})(this,o);var p=d.join(", ");return(_=function(m,y,k){return y=b(y),function(v,D){if(D&&(n(D)=="object"||typeof D=="function"))return D;if(D!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(j){if(j===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return j}(v)}(m,c()?Reflect.construct(y,k||[],b(m).constructor):y.apply(m,k))}(this,o,['No matching document found for id "'+h._doc._id+'" version '+l+' modifiedPaths "'+p+'"'])).version=l,_.modifiedPaths=d,_}return function(h,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(l&&l.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),l&&x(h,l)}(o,g),u=o,Object.defineProperty(u,"prototype",{writable:!1}),u;var u}(t(8213));Object.defineProperty(w.prototype,"name",{value:"VersionError"}),a.exports=w},7045:(a,i,t)=>{"use strict";function n(p){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},n(p)}function c(p,m){var y=Object.keys(p);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(p);m&&(k=k.filter(function(v){return Object.getOwnPropertyDescriptor(p,v).enumerable})),y.push.apply(y,k)}return y}function b(p){for(var m=1;m<arguments.length;m++){var y=arguments[m]!=null?arguments[m]:{};m%2?c(Object(y),!0).forEach(function(k){x(p,k,y[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(y)):c(Object(y)).forEach(function(k){Object.defineProperty(p,k,Object.getOwnPropertyDescriptor(y,k))})}return p}function x(p,m,y){return(m=function(k){var v=function(D){if(n(D)!="object"||!D)return D;var j=D[Symbol.toPrimitive];if(j!==void 0){var S=j.call(D,"string");if(n(S)!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(D)}(k);return n(v)=="symbol"?v:v+""}(m))in p?Object.defineProperty(p,m,{value:y,enumerable:!0,configurable:!0,writable:!0}):p[m]=y,p}var w=t(6426),g=w.CastError,o=t(9553),u=t(4327),h=t(3305);function l(p,m){w.call(this,p,m,"Decimal128")}function d(p){return this.cast(p)}l.schemaName="Decimal128",l.defaultOptions={},l.prototype=Object.create(w.prototype),l.prototype.constructor=l,l._cast=o,l.set=w.set,l.setters=[],l.get=w.get,l.cast=function(p){return arguments.length===0||(p===!1&&(p=this._defaultCaster),this._cast=p),this._cast},l._defaultCaster=function(p){if(p!=null&&!h(p,"Decimal128"))throw new Error;return p},l._checkRequired=function(p){return h(p,"Decimal128")},l.checkRequired=w.checkRequired,l.prototype.checkRequired=function(p,m){return w._isRef(this,p,m,!0)?!!p:(typeof this.constructor.checkRequired=="function"?this.constructor.checkRequired():l.checkRequired())(p)},l.prototype.cast=function(p,m,y,k,v){if(w._isRef(this,p,m,y))return h(p,"Decimal128")?p:this._castRef(p,m,y,v);var D;D=typeof this._castFunction=="function"?this._castFunction:typeof this.constructor.cast=="function"?this.constructor.cast():l.cast();try{return D(p)}catch(j){throw new g("Decimal128",p,this.path,j,this)}};var _=b(b({},w.prototype.$conditionalHandlers),{},{$gt:d,$gte:d,$lt:d,$lte:d});Object.defineProperty(l.prototype,"$conditionalHandlers",{enumerable:!1,value:_}),l.prototype.toJSONSchema=function(p){var m=this.options.required&&typeof this.options.required!="function";return u("string","decimal",p?.useBsonType,m)},l.prototype.autoEncryptionType=function(){return"decimal"},a.exports=l},7058:(a,i,t)=>{"use strict";var n=t(5832).hp;function c(T){return function(Y){if(Array.isArray(Y))return l(Y)}(T)||function(Y){if(typeof Symbol<"u"&&Y[Symbol.iterator]!=null||Y["@@iterator"]!=null)return Array.from(Y)}(T)||h(T)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function b(T,Y){var ie=Object.keys(T);if(Object.getOwnPropertySymbols){var me=Object.getOwnPropertySymbols(T);Y&&(me=me.filter(function(ne){return Object.getOwnPropertyDescriptor(T,ne).enumerable})),ie.push.apply(ie,me)}return ie}function x(T){for(var Y=1;Y<arguments.length;Y++){var ie=arguments[Y]!=null?arguments[Y]:{};Y%2?b(Object(ie),!0).forEach(function(me){w(T,me,ie[me])}):Object.getOwnPropertyDescriptors?Object.defineProperties(T,Object.getOwnPropertyDescriptors(ie)):b(Object(ie)).forEach(function(me){Object.defineProperty(T,me,Object.getOwnPropertyDescriptor(ie,me))})}return T}function w(T,Y,ie){return(Y=function(me){var ne=function(ye){if(g(ye)!="object"||!ye)return ye;var Re=ye[Symbol.toPrimitive];if(Re!==void 0){var Ie=Re.call(ye,"string");if(g(Ie)!="object")return Ie;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(ye)}(me);return g(ne)=="symbol"?ne:ne+""}(Y))in T?Object.defineProperty(T,Y,{value:ie,enumerable:!0,configurable:!0,writable:!0}):T[Y]=ie,T}function g(T){return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Y){return typeof Y}:function(Y){return Y&&typeof Symbol=="function"&&Y.constructor===Symbol&&Y!==Symbol.prototype?"symbol":typeof Y},g(T)}function o(T,Y){return function(ie){if(Array.isArray(ie))return ie}(T)||function(ie,me){var ne=ie==null?null:typeof Symbol<"u"&&ie[Symbol.iterator]||ie["@@iterator"];if(ne!=null){var ye,Re,Ie,je,Be=[],Me=!0,qe=!1;try{if(Ie=(ne=ne.call(ie)).next,me===0){if(Object(ne)!==ne)return;Me=!1}else for(;!(Me=(ye=Ie.call(ne)).done)&&(Be.push(ye.value),Be.length!==me);Me=!0);}catch(vt){qe=!0,Re=vt}finally{try{if(!Me&&ne.return!=null&&(je=ne.return(),Object(je)!==je))return}finally{if(qe)throw Re}}return Be}}(T,Y)||h(T,Y)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function u(T,Y){var ie=typeof Symbol<"u"&&T[Symbol.iterator]||T["@@iterator"];if(!ie){if(Array.isArray(T)||(ie=h(T))||Y&&T&&typeof T.length=="number"){ie&&(T=ie);var me=0,ne=function(){};return{s:ne,n:function(){return me>=T.length?{done:!0}:{done:!1,value:T[me++]}},e:function(je){throw je},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ye,Re=!0,Ie=!1;return{s:function(){ie=ie.call(T)},n:function(){var je=ie.next();return Re=je.done,je},e:function(je){Ie=!0,ye=je},f:function(){try{Re||ie.return==null||ie.return()}finally{if(Ie)throw ye}}}}function h(T,Y){if(T){if(typeof T=="string")return l(T,Y);var ie={}.toString.call(T).slice(8,-1);return ie==="Object"&&T.constructor&&(ie=T.constructor.name),ie==="Map"||ie==="Set"?Array.from(T):ie==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ie)?l(T,Y):void 0}}function l(T,Y){(Y==null||Y>T.length)&&(Y=T.length);for(var ie=0,me=Array(Y);ie<Y;ie++)me[ie]=T[ie];return me}var d,_=t(3550).EventEmitter,p=t(8297),m=t(8213),y=t(6426),k=t(8879),v=t(2069),D=t(622),j=t(486),S=t(4450),A=t(3703),M=t(8260),V=t(2003),K=t(5289),H=t(3381),Q=t(1199),re=t(9539),ue=t(5678),W=t(7834),$=t(2097),C=t(8768),J=t(533),F=/\.\d+(\.|$)/,I=t(1260).Ut,N=t(4957).middlewareFunctions,G=I.concat(N).reduce(function(T,Y){return T.add(Y)},new Set),ae=C.isPOJO,ce=0,Se=/^\d+$/;function oe(T,Y){if(!(this instanceof oe))return new oe(T,Y);if(this.obj=T,this.paths={},this.aliases={},this.subpaths={},this.virtuals={},this.singleNestedPaths={},this.nested={},this.inherits={},this.callQueue=[],this._indexes=[],this._searchIndexes=[],this.methods=Y&&Y.methods||{},this.methodOptions={},this.statics=Y&&Y.statics||{},this.tree={},this.query=Y&&Y.query||{},this.childSchemas=[],this.plugins=[],this.$id=++ce,this.mapPaths=[],this.encryptedFields={},this.s={hooks:new p},this.options=this.defaultOptions(Y),Array.isArray(T)){var ie,me=u(T);try{for(me.s();!(ie=me.n()).done;){var ne=ie.value;this.add(ne)}}catch(vt){me.e(vt)}finally{me.f()}}else T&&this.add(T);if(Y&&Y.virtuals)for(var ye=Y.virtuals,Re=0,Ie=Object.keys(ye);Re<Ie.length;Re++){var je=Ie[Re],Be=ye[je].options?ye[je].options:void 0,Me=this.virtual(je,Be);ye[je].get&&Me.get(ye[je].get),ye[je].set&&Me.set(ye[je].set)}var qe=T&&T._id&&C.isObject(T._id);!this.paths._id&&this.options._id&&!qe&&j(this),this.setupTimestamp(this.options.timestamps)}function Z(T,Y){for(var ie=0,me=Object.keys(Y);ie<me.length;ie++){var ne=me[ie],ye=null;if(Y[ne]!=null)ye=Y[ne];else{var Re=A(T.paths[ne],"options");if(Re==null)continue;ye=Re.alias}if(ye){var Ie=T.paths[ne].path;if(Array.isArray(ye)){var je,Be=u(ye);try{for(Be.s();!(je=Be.n()).done;){var Me=je.value;if(typeof Me!="string")throw new Error("Invalid value for alias option on "+Ie+", got "+Me);T.aliases[Me]=Ie,T.virtual(Me).get(function(qe){return function(){return typeof this.get=="function"?this.get(qe):this[qe]}}(Ie)).set(function(qe){return function(vt){return this.$set(qe,vt)}}(Ie))}}catch(qe){Be.e(qe)}finally{Be.f()}}else{if(typeof ye!="string")throw new Error("Invalid value for alias option on "+Ie+", got "+ye);T.aliases[ye]=Ie,T.virtual(ye).get(function(qe){return function(){return typeof this.get=="function"?this.get(qe):this[qe]}}(Ie)).set(function(qe){return function(vt){return this.$set(qe,vt)}}(Ie))}}}}oe.prototype=Object.create(_.prototype),oe.prototype.constructor=oe,oe.prototype.instanceOfSchema=!0,Object.defineProperty(oe.prototype,"$schemaType",{configurable:!1,enumerable:!1,writable:!0}),Object.defineProperty(oe.prototype,"childSchemas",{configurable:!1,enumerable:!0,writable:!0}),Object.defineProperty(oe.prototype,"virtuals",{configurable:!1,enumerable:!0,writable:!0}),oe.prototype.obj,oe.prototype.paths,oe.prototype.tree,oe.prototype.clone=function(){var T=this,Y=this._clone();return Y.on("init",function(ie){return T.emit("init",ie)}),Y},oe.prototype._clone=function(T){var Y=new(T=T||(this.base==null?oe:this.base.Schema))({},this._userProvidedOptions);Y.base=this.base,Y.obj=this.obj,Y.options=S(this.options),Y.callQueue=this.callQueue.map(function(Bt){return Bt}),Y.methods=S(this.methods),Y.methodOptions=S(this.methodOptions),Y.statics=S(this.statics),Y.query=S(this.query),Y.plugins=Array.prototype.slice.call(this.plugins),Y._indexes=S(this._indexes),Y._searchIndexes=S(this._searchIndexes),Y.s.hooks=this.s.hooks.clone(),Y.tree=S(this.tree),Y.paths=Object.fromEntries(Object.entries(this.paths).map(function(Bt){var Ht=o(Bt,2);return[Ht[0],Ht[1].clone()]})),Y.nested=S(this.nested),Y.subpaths=S(this.subpaths);for(var ie=0,me=Object.values(Y.paths);ie<me.length;ie++){var ne=me[ie];if(ne.$isSingleNested){for(var ye=ne.path,Re=0,Ie=Object.keys(ne.schema.paths);Re<Ie.length;Re++){var je=Ie[Re];Y.singleNestedPaths[ye+"."+je]=ne.schema.paths[je]}for(var Be=0,Me=Object.keys(ne.schema.singleNestedPaths);Be<Me.length;Be++){var qe=Me[Be];Y.singleNestedPaths[ye+"."+qe]=ne.schema.singleNestedPaths[qe]}for(var vt=0,jt=Object.keys(ne.schema.subpaths);vt<jt.length;vt++){var wt=jt[vt];Y.singleNestedPaths[ye+"."+wt]=ne.schema.subpaths[wt]}for(var ft=0,fr=Object.keys(ne.schema.nested);ft<fr.length;ft++){var Nt=fr[ft];Y.singleNestedPaths[ye+"."+Nt]="nested"}}}return Y._gatherChildSchemas(),Y.virtuals=S(this.virtuals),Y.$globalPluginsApplied=this.$globalPluginsApplied,Y.$isRootDiscriminator=this.$isRootDiscriminator,Y.$implicitlyCreated=this.$implicitlyCreated,Y.$id=++ce,Y.$originalSchemaId=this.$id,Y.mapPaths=[].concat(this.mapPaths),this.discriminatorMapping!=null&&(Y.discriminatorMapping=Object.assign({},this.discriminatorMapping)),this.discriminators!=null&&(Y.discriminators=Object.assign({},this.discriminators)),this._applyDiscriminators!=null&&(Y._applyDiscriminators=new Map(this._applyDiscriminators)),Y.aliases=Object.assign({},this.aliases),Y.encryptedFields=S(this.encryptedFields),Y},oe.prototype.pick=function(T,Y){var ie=new oe({},Y||this.options);if(!Array.isArray(T))throw new m('Schema#pick() only accepts an array argument, got "'+g(T)+'"');var me,ne=u(T);try{for(ne.s();!(me=ne.n()).done;){var ye=me.value;if(this._hasEncryptedField(ye)){var Re=this.encryptedFields[ye],Ie=this.path(ye);ie.add(w({},ye,w({encrypt:Re},this.options.typeKey,Ie)))}else if(this.nested[ye])ie.add(w({},ye,A(this.tree,ye)));else{var je=this.path(ye);if(je==null)throw new m("Path `"+ye+"` is not in the schema");ie.add(w({},ye,je))}}}catch(Be){ne.e(Be)}finally{ne.f()}return this._hasEncryptedFields()||(ie.options.encryptionType=null),ie},oe.prototype.omit=function(T,Y){var ie=new oe(this,Y||this.options);if(!Array.isArray(T))throw new m('Schema#omit() only accepts an array argument, got "'+g(T)+'"');for(var me in ie.remove(T),ie.singleNestedPaths)T.includes(me)&&delete ie.singleNestedPaths[me];return ie},oe.prototype.defaultOptions=function(T){this._userProvidedOptions=T==null?{}:S(T);var Y=this.base&&this.base.options||{};if((T=x({strict:!("strict"in Y)||Y.strict,strictQuery:"strictQuery"in Y&&Y.strictQuery,bufferCommands:!0,capped:!1,versionKey:"__v",optimisticConcurrency:!1,minimize:!0,autoIndex:null,discriminatorKey:"__t",shardKey:null,read:null,validateBeforeSave:!0,validateModifiedOnly:!1,_id:!0,id:!("id"in Y)||Y.id,typeKey:"type"},T)).versionKey&&typeof T.versionKey!="string")throw new m("`versionKey` must be falsy or string, got `"+g(T.versionKey)+"`");if(typeof T.read=="string"?T.read=K(T.read):Array.isArray(T.read)&&typeof T.read[0]=="string"&&(T.read={mode:K(T.read[0]),tags:T.read[1]}),T.optimisticConcurrency&&!T.versionKey)throw new m("Must set `versionKey` if using `optimisticConcurrency`");return T},oe.prototype.discriminator=function(T,Y,ie){return this._applyDiscriminators=this._applyDiscriminators||new Map,this._applyDiscriminators.set(T,{schema:Y,options:ie}),this},oe.prototype._defaultToObjectOptions=function(T){var Y=T?"toJSON":"toObject";if(this._defaultToObjectOptionsMap&&this._defaultToObjectOptionsMap[Y])return this._defaultToObjectOptionsMap[Y];var ie=this.base&&this.base.options&&this.base.options[Y]||{},me=this.options[Y]||{},ne=Object.assign({},ie,me);return this._defaultToObjectOptionsMap=this._defaultToObjectOptionsMap||{},this._defaultToObjectOptionsMap[Y]=ne,ne},oe.prototype.encryptionType=function(T){if(arguments.length===0)return this.options.encryptionType;if(typeof T!="string"&&T!==null)throw new Error("invalid `encryptionType`: ${encryptionType}");this.options.encryptionType=T},oe.prototype.add=function(T,Y){if(T instanceof oe||T!=null&&T.instanceOfSchema)return re(this,T),this;if(T._id===!1&&Y==null&&(this.options._id=!1),(Y=Y||"")==="__proto__."||Y==="constructor."||Y==="prototype.")return this;for(var ie=Object.keys(T),me=this.options.typeKey,ne=0,ye=ie;ne<ye.length;ne++){var Re=ye[ne];if(!C.specialProperties.has(Re)){var Ie=Y+Re,je=T[Re];if(je==null)throw new TypeError("Invalid value for schema path `"+Ie+'`, got value "'+je+'"');if(Re!=="_id"||je!==!1){var Be=!1;if(typeof je=="string"&&(Be=(this.base!=null?this.base.Schema.Types:oe.Types)[je.charAt(0).toUpperCase()+je.substring(1)]!=null),Re!=="_id"&&(g(je)!=="object"&&typeof je!="function"&&!Be||je==null))throw new TypeError("Invalid schema configuration: `".concat(je,"` is not ")+"a valid type at path `".concat(Re,"`. See ")+"https://bit.ly/mongoose-schematypes for a list of valid schema types.");if(je instanceof D||(je.constructor&&je.constructor.name||null)==="VirtualType")this.virtual(je);else{if(Array.isArray(je)&&je.length===1&&je[0]==null)throw new TypeError("Invalid value for schema Array path `"+Ie+'`, got value "'+je[0]+'"');if(ae(je)||je instanceof k)if(Object.keys(je).length<1)Y&&(this.nested[Y.substring(0,Y.length-1)]=!0),this.path(Ie,je);else if(!je[me]||me==="type"&&ae(je.type)&&je.type.type)this.nested[Ie]=!0,this.add(je,Ie+".");else{var Me=je[me];if(ae(Me)&&Object.keys(Me).length>0){Y&&(this.nested[Y.substring(0,Y.length-1)]=!0);var qe={};this._userProvidedOptions.typeKey&&(qe.typeKey=this._userProvidedOptions.typeKey),this._userProvidedOptions.strict!=null&&(qe.strict=this._userProvidedOptions.strict),this._userProvidedOptions.toObject!=null&&(qe.toObject=C.omit(this._userProvidedOptions.toObject,["transform"])),this._userProvidedOptions.toJSON!=null&&(qe.toJSON=C.omit(this._userProvidedOptions.toJSON,["transform"]));var vt=new oe(Me,qe);vt.$implicitlyCreated=!0;var jt=Object.assign({},je,w({},me,vt));this.path(Y+Re,jt)}else if(Y&&(this.nested[Y.substring(0,Y.length-1)]=!0),this.path(Y+Re,je),je!=null&&!je.instanceOfSchema&&C.isPOJO(je.discriminators)){var wt=this.path(Y+Re);for(var ft in je.discriminators)wt.discriminator(ft,je.discriminators[ft])}}else if(Y&&(this.nested[Y.substring(0,Y.length-1)]=!0),this.path(Y+Re,je),je[0]!=null&&!je[0].instanceOfSchema&&C.isPOJO(je[0].discriminators)){var fr=this.path(Y+Re);for(var Nt in je[0].discriminators)fr.discriminator(Nt,je[0].discriminators[Nt])}if(je.instanceOfSchema&&je.encryptionType()!=null){if(this.encryptionType()!=je.encryptionType())throw new Error("encryptionType of a nested schema must match the encryption type of the parent schema.");for(var Bt=0,Ht=Object.entries(je.encryptedFields);Bt<Ht.length;Bt++){var Lt=o(Ht[Bt],2),qt=Lt[0],Ir=Lt[1],ze=Ie+"."+qt;this._addEncryptedField(ze,Ir)}}else if(g(je)==="object"&&"encrypt"in je){var br=je.encrypt;if(this.encryptionType()==null)throw new Error("encryptionType must be provided");this._addEncryptedField(Ie,br)}else this._removeEncryptedField(Ie)}}}}var yr=Object.fromEntries(Object.entries(T).map(function(Ae){var Nr=o(Ae,1)[0];return[Y+Nr,null]}));return Z(this,yr),this},oe.prototype._addEncryptedField=function(T,Y){if(this.path(T).autoEncryptionType()==null)throw new Error("Invalid BSON type for FLE field: '".concat(T,"'"));this.encryptedFields[T]=S(Y)},oe.prototype._removeEncryptedField=function(T){delete this.encryptedFields[T]},oe.prototype._hasEncryptedFields=function(){return Object.keys(this.encryptedFields).length>0},oe.prototype._hasEncryptedField=function(T){return T in this.encryptedFields},oe.prototype._buildEncryptedFields=function(){var T=this;return{fields:Object.entries(this.encryptedFields).map(function(Y){var ie=o(Y,2),me=ie[0],ne=ie[1];return x({path:me,bsonType:T.path(me).autoEncryptionType()},ne)})}},oe.prototype._buildSchemaMap=function(){var T=this;return{bsonType:"object",properties:Object.entries(this.encryptedFields).reduce(function(Y,ie){var me=o(ie,2),ne=me[0],ye=me[1],Re=T.path(ne).autoEncryptionType();return function(Ie,je,Be){for(var Me=0,qe=Ie[Me];Me<Ie.length-1;qe=Ie[++Me])je[qe]=je[qe]==null?{bsonType:"object",properties:{}}:je[qe],je=je[qe].properties;je[qe]=Be}(ne.split("."),Y,{encrypt:x(x({},ye),{},{bsonType:Re})}),Y},{})}},oe.prototype.alias=function(T,Y){return Z(this,w({},T,Y)),this},oe.prototype.removeIndex=function(T){if(arguments.length>1)throw new Error("removeIndex() takes only 1 argument");if(g(T)!=="object"&&typeof T!="string")throw new Error("removeIndex() may only take either an object or a string as an argument");if(g(T)==="object")for(var Y=this._indexes.length-1;Y>=0;--Y)Q(this._indexes[Y][0],T)&&this._indexes.splice(Y,1);else for(var ie=this._indexes.length-1;ie>=0;--ie)this._indexes[ie][1]!=null&&this._indexes[ie][1].name===T&&this._indexes.splice(ie,1);return this},oe.prototype.clearIndexes=function(){return this._indexes.length=0,this},oe.prototype.searchIndex=function(T){return this._searchIndexes.push(T),this},oe.reserved=Object.create(null),oe.prototype.reserved=oe.reserved;var he=oe.reserved;function E(T){return/\.\d+/.test(T)?T.replace(/\.\d+\./g,".$.").replace(/\.\d+$/,".$"):T}function z(T,Y){if(T.mapPaths.length===0)return null;var ie,me=u(T.mapPaths);try{for(me.s();!(ie=me.n()).done;){var ne=ie.value,ye=ne.path.replace(/\.\$\*/g,"");if(Y===ye||Y.startsWith(ye+".")&&Y.slice(ye.length+1).indexOf(".")===-1)return ne;if(ne.schema&&Y.startsWith(ye+".")){var Re=Y.slice(ye.length+1);return Re=Re.slice(Re.indexOf(".")+1),ne.schema.paths[Re]}if(ne.$isSchemaMap&&Y.startsWith(ye+".")){var Ie=Y.slice(ye.length+1);Ie=Ie.slice(Ie.indexOf(".")+1);var je=ne.$__schemaType._presplitPath;if(Ie.indexOf(".")===-1&&je[je.length-1]==="$*")return ne.$__schemaType;if(Ie.indexOf(".")!==-1&&ne.$__schemaType.schema&&je[je.length-1]==="$*")return ne.$__schemaType.schema.path(Ie.slice(Ie.indexOf(".")+1))}}}catch(Be){me.e(Be)}finally{me.f()}return null}function X(T,Y,ie){var me=Y.split(/\.(\d+)\.|\.(\d+)$/).filter(Boolean);if(me.length<2)return T.paths.hasOwnProperty(me[0])?T.paths[me[0]]:"adhocOrUndefined";var ne=T.path(me[0]),ye=!1;if(!ne)return"adhocOrUndefined";for(var Re=me.length-1,Ie=1;Ie<me.length;++Ie){ye=!1;var je=me[Ie];if(Ie===Re&&ne&&!/\D/.test(je)){ne=ne.$isMongooseDocumentArray?ne.$embeddedSchemaType:ne instanceof d.Array?ne.caster:void 0;break}if(/\D/.test(je)){if(!ne||!ne.schema){ne=void 0;break}ye=ne.schema.pathType(je)==="nested",ne=ne.schema.path(je)}else ne instanceof d.Array&&Ie!==Re&&(ne=ne.caster)}return T.subpaths[ie]=ne,ne?"real":ye?"nested":"adhocOrUndefined"}function de(T,Y){var ie,me=u(T.childSchemas);try{for(me.s();!(ie=me.n()).done;){var ne=ie.value.schema;ne.$implicitlyCreated&&(Object.assign(ne.options,Y),de(ne,Y))}}catch(ye){me.e(ye)}finally{me.f()}}he.prototype=he.emit=he.listeners=he.removeListener=he.collection=he.errors=he.get=he.init=he.isModified=he.isNew=he.populated=he.remove=he.save=he.toObject=he.validate=1,he.collection=1,oe.prototype.path=function(T,Y){if(Y===void 0){if(this.paths[T]!=null)return this.paths[T];var ie=E(T),me=function(Ne,st,lt){if(Ne.paths.hasOwnProperty(st))return Ne.paths[st];if(Ne.subpaths.hasOwnProperty(lt)){var pt=Ne.subpaths[lt];return pt==="nested"?void 0:pt}if(Ne.singleNestedPaths.hasOwnProperty(lt)&&g(Ne.singleNestedPaths[lt])==="object"){var xt=Ne.singleNestedPaths[lt];return xt==="nested"?void 0:xt}return null}(this,T,ie);if(me!=null)return me;var ne=z(this,T);return ne??((me=this.hasMixedParent(ie))!=null?me:F.test(T)?function(Ne,st,lt){return X(Ne,st,lt),Ne.subpaths[lt]}(this,T,ie):void 0)}var ye=T.split(".")[0];if(he[ye]&&!this.options.suppressReservedKeysWarning){var Re="`".concat(ye,"` is a reserved schema pathname and may break some functionality. ")+"You are allowed to use it, but use at your own risk. To disable this warning pass `suppressReservedKeysWarning` as a schema option.";C.warn(Re)}g(Y)==="object"&&C.hasUserDefinedProperty(Y,"ref")&&J(Y.ref,T);var Ie,je=T.split(/\./),Be=je.pop(),Me=this.tree,qe="",vt=u(je);try{for(vt.s();!(Ie=vt.n()).done;){var jt=Ie.value;if(C.specialProperties.has(jt))throw new Error("Cannot set special property `"+jt+"` on a schema");if(qe=qe+=(qe.length>0?".":"")+jt,Me[jt]||(this.nested[qe]=!0,Me[jt]={}),g(Me[jt])!=="object"){var wt="Cannot set nested path `"+T+"`. Parent path `"+qe+"` already set to type "+Me[jt].name+".";throw new Error(wt)}Me=Me[jt]}}catch(Ne){vt.e(Ne)}finally{vt.f()}Me[Be]=S(Y),this.paths[T]=this.interpretAsType(T,Y,this.options);var ft=this.paths[T];if(this.childSchemas=this.childSchemas.filter(function(Ne){return Ne.path!==T}),ft.$isSchemaMap){var fr=T+".$*";this.paths[fr]=ft.$__schemaType,this.mapPaths.push(this.paths[fr]),ft.$__schemaType.$isSingleNested&&this.childSchemas.push({schema:ft.$__schemaType.schema,model:ft.$__schemaType.caster,path:T})}if(ft.$isSingleNested){for(var Nt=0,Bt=Object.keys(ft.schema.paths);Nt<Bt.length;Nt++){var Ht=Bt[Nt];this.singleNestedPaths[T+"."+Ht]=ft.schema.paths[Ht]}for(var Lt=0,qt=Object.keys(ft.schema.singleNestedPaths);Lt<qt.length;Lt++){var Ir=qt[Lt];this.singleNestedPaths[T+"."+Ir]=ft.schema.singleNestedPaths[Ir]}for(var ze=0,br=Object.keys(ft.schema.subpaths);ze<br.length;ze++){var yr=br[ze];this.singleNestedPaths[T+"."+yr]=ft.schema.subpaths[yr]}for(var Ae=0,Nr=Object.keys(ft.schema.nested);Ae<Nr.length;Ae++){var sa=Nr[Ae];this.singleNestedPaths[T+"."+sa]="nested"}Object.defineProperty(ft.schema,"base",{configurable:!0,enumerable:!1,writable:!1,value:this.base}),ft.caster.base=this.base,this.childSchemas.push({schema:ft.schema,model:ft.caster,path:T})}else ft.$isMongooseDocumentArray&&(Object.defineProperty(ft.schema,"base",{configurable:!0,enumerable:!1,writable:!1,value:this.base}),ft.casterConstructor.base=this.base,this.childSchemas.push({schema:ft.schema,model:ft.casterConstructor,path:T}));if(ft.$isMongooseArray&&ft.caster instanceof y){for(var Yr=T,kr=ft;kr.$isMongooseArray;)Yr+=".$",kr.$isMongooseDocumentArray?(kr.$embeddedSchemaType._arrayPath=Yr,kr.$embeddedSchemaType._arrayParentPath=T,kr=kr.$embeddedSchemaType):(kr.caster._arrayPath=Yr,kr.caster._arrayParentPath=T,kr=kr.caster),this.subpaths[Yr]=kr;for(var Vr=0,ua=[];Vr<ua.length;Vr++){var Xr=ua[Vr];this.subpaths[Xr.path]=Xr}}if(ft.$isMongooseDocumentArray){for(var ca=0,R=Object.keys(ft.schema.paths);ca<R.length;ca++){var ee=R[ca],fe=ft.schema.paths[ee];this.subpaths[T+"."+ee]=fe,g(fe)==="object"&&fe!=null&&fe.$parentSchemaDocArray==null&&(fe.$parentSchemaDocArray=ft)}for(var ge=0,xe=Object.keys(ft.schema.subpaths);ge<xe.length;ge++){var _e=xe[ge],Le=ft.schema.subpaths[_e];this.subpaths[T+"."+_e]=Le,g(Le)==="object"&&Le!=null&&Le.$parentSchemaDocArray==null&&(Le.$parentSchemaDocArray=ft)}for(var Fe=0,Qe=Object.keys(ft.schema.singleNestedPaths);Fe<Qe.length;Fe++){var Ve=Qe[Fe],Ge=ft.schema.singleNestedPaths[Ve];this.subpaths[T+"."+Ve]=Ge,g(Ge)==="object"&&Ge!=null&&Ge.$parentSchemaDocArray==null&&(Ge.$parentSchemaDocArray=ft)}}return this},oe.prototype._gatherChildSchemas=function(){for(var T=[],Y=0,ie=Object.keys(this.paths);Y<ie.length;Y++){var me=ie[Y];if(typeof me=="string"){var ne=this.paths[me];ne.$isMongooseDocumentArray||ne.$isSingleNested?T.push({schema:ne.schema,model:ne.caster,path:me}):ne.$isSchemaMap&&ne.$__schemaType.$isSingleNested&&T.push({schema:ne.$__schemaType.schema,model:ne.$__schemaType.caster,path:me})}}return this.childSchemas=T,T},Object.defineProperty(oe.prototype,"base",{configurable:!0,enumerable:!1,writable:!0,value:null}),oe.prototype.interpretAsType=function(T,Y,ie){if(Y instanceof y){if(Y.path===T)return Y;var me=Y.clone();return me.path=T,me}var ne=this.base!=null?this.base.Schema.Types:oe.Types,ye=this.base!=null?this.base.Types:t(9600);if(!(C.isPOJO(Y)||Y instanceof k)&&C.getFunctionName(Y.constructor)!=="Object"){var Re=Y;(Y={})[ie.typeKey]=Re}var Ie,je=Y[ie.typeKey]&&(Y[ie.typeKey]instanceof Function||ie.typeKey!=="type"||!Y.type.type)?Y[ie.typeKey]:{};if(je instanceof y){if(je.path===T)return je;var Be=je.clone();return Be.path=T,Be}if(C.isPOJO(je)||je==="mixed")return new ne.Mixed(T,Y);if(Array.isArray(je)||je===Array||je==="array"||je===ne.Array){var Me=je===Array||je==="array"?Y.cast||Y.of:je[0];if(Me&&Me.instanceOfSchema){if(!(Me instanceof oe)){if(!this.options._isMerging)throw new TypeError("Schema for array path `"+T+"` is from a different copy of the Mongoose module. Please make sure you're using the same version of Mongoose everywhere with `npm list mongoose`. If you are still getting this error, please add `new Schema()` around the path: "+"".concat(T,": new Schema(...)"));Me=new oe(Me)}return new ne.DocumentArray(T,Me,Y)}if(Me&&Me[ie.typeKey]&&Me[ie.typeKey].instanceOfSchema){if(!(Me[ie.typeKey]instanceof oe)){if(!this.options._isMerging)throw new TypeError("Schema for array path `"+T+"` is from a different copy of the Mongoose module. Please make sure you're using the same version of Mongoose everywhere with `npm list mongoose`. If you are still getting this error, please add `new Schema()` around the path: "+"".concat(T,": new Schema(...)"));Me[ie.typeKey]=new oe(Me[ie.typeKey])}return new ne.DocumentArray(T,Me[ie.typeKey],Y,Me)}if(Me!==void 0&&(Array.isArray(Me)||Me.type===Array||Me.type=="Array"))return Me&&Me.type=="Array"&&(Me.type=Array),new ne.Array(T,this.interpretAsType(T,Me,ie),Y);var qe=Me==null||!Me[ie.typeKey]||ie.typeKey==="type"&&Me.type.type?Me:Me[ie.typeKey];if(typeof Me=="string")Me=ne[Me.charAt(0).toUpperCase()+Me.substring(1)];else if(C.isPOJO(qe)){if(Object.keys(qe).length){var vt={minimize:ie.minimize};ie.typeKey&&(vt.typeKey=ie.typeKey),ie.hasOwnProperty("strict")&&(vt.strict=ie.strict),ie.hasOwnProperty("strictQuery")&&(vt.strictQuery=ie.strictQuery),ie.hasOwnProperty("toObject")&&(vt.toObject=C.omit(ie.toObject,["transform"])),ie.hasOwnProperty("toJSON")&&(vt.toJSON=C.omit(ie.toJSON,["transform"])),this._userProvidedOptions.hasOwnProperty("_id")?vt._id=this._userProvidedOptions._id:oe.Types.DocumentArray.defaultOptions._id!=null&&(vt._id=oe.Types.DocumentArray.defaultOptions._id);var jt=new oe(qe,vt);return jt.$implicitlyCreated=!0,new ne.DocumentArray(T,jt,Y)}return new ne.Array(T,ne.Mixed,Y)}if(Me){if(je=!Me[ie.typeKey]||ie.typeKey==="type"&&Me.type.type?Me:Me[ie.typeKey],Array.isArray(je))return new ne.Array(T,this.interpretAsType(T,je,ie),Y);if((Ie=typeof je=="string"?je:je.schemaName||C.getFunctionName(je))==="ClockDate"&&(Ie="Date"),Ie===void 0)throw new TypeError("Invalid schema configuration: "+"Could not determine the embedded type for array `".concat(T,"`. ")+"See https://mongoosejs.com/docs/guide.html#definition for more info on supported schema syntaxes.");if(!ne.hasOwnProperty(Ie))throw new TypeError("Invalid schema configuration: "+"`".concat(Ie,"` is not a valid type within the array `").concat(T,"`.")+"See https://bit.ly/mongoose-schematypes for a list of valid schema types.")}return new ne.Array(T,Me||ne.Mixed,Y,ie)}if(je&&je.instanceOfSchema)return new ne.Subdocument(je,T,Y);if((Ie=n.isBuffer(je)?"Buffer":typeof je=="function"||g(je)==="object"?je.schemaName||C.getFunctionName(je):je===ye.ObjectId?"ObjectId":je===ye.Decimal128?"Decimal128":je==null?""+je:je.toString())&&(Ie=Ie.charAt(0).toUpperCase()+Ie.substring(1)),Ie==="ObjectID"&&(Ie="ObjectId"),Ie==="ClockDate"&&(Ie="Date"),Ie===void 0)throw new TypeError("Invalid schema configuration: `".concat(T,"` schematype definition is ")+"invalid. See https://mongoosejs.com/docs/guide.html#definition for more info on supported schema syntaxes.");if(ne[Ie]==null)throw new TypeError("Invalid schema configuration: `".concat(Ie,"` is not ")+"a valid type at path `".concat(T,"`. See ")+"https://bit.ly/mongoose-schematypes for a list of valid schema types.");Ie==="Union"&&(Y.parentSchema=this);var wt=new ne[Ie](T,Y,ie);return wt.$isSchemaMap&&function(ft,fr,Nt,Bt,Ht){var Lt=Nt+".$*",qt={type:{}};C.hasUserDefinedProperty(Bt,"of")&&((qt=C.isPOJO(Bt.of)&&Object.keys(Bt.of).length>0&&!C.hasUserDefinedProperty(Bt.of,ft.options.typeKey)?w({},ft.options.typeKey,new oe(Bt.of)):C.isPOJO(Bt.of)?Object.assign({},Bt.of):w({},ft.options.typeKey,Bt.of))[ft.options.typeKey]&&qt[ft.options.typeKey].instanceOfSchema&&qt[ft.options.typeKey].eachPath(function(Ir,ze){if(ze.options.select===!0||ze.options.select===!1)throw new m('Cannot use schema-level projections (`select: true` or `select: false`) within maps at path "'+Nt+"."+Ir+'"')}),C.hasUserDefinedProperty(Bt,"ref")&&(qt.ref=Bt.ref)),fr.$__schemaType=ft.interpretAsType(Lt,qt,Ht)}(this,wt,T,Y,ie),wt},oe.prototype.eachPath=function(T){for(var Y=Object.keys(this.paths),ie=Y.length,me=0;me<ie;++me)T(Y[me],this.paths[Y[me]]);return this},oe.prototype.requiredPaths=function(T){if(this._requiredpaths&&!T)return this._requiredpaths;for(var Y=Object.keys(this.paths),ie=Y.length,me=[];ie--;){var ne=Y[ie];this.paths[ne].isRequired&&me.push(ne)}return this._requiredpaths=me,this._requiredpaths},oe.prototype.indexedPaths=function(){return this._indexedpaths||(this._indexedpaths=this.indexes()),this._indexedpaths},oe.prototype.pathType=function(T){if(this.paths.hasOwnProperty(T))return"real";if(this.virtuals.hasOwnProperty(T))return"virtual";if(this.nested.hasOwnProperty(T))return"nested";var Y=E(T);if(this.subpaths.hasOwnProperty(Y)||this.subpaths.hasOwnProperty(T))return"real";var ie=this.singleNestedPaths.hasOwnProperty(Y)||this.singleNestedPaths.hasOwnProperty(T);return ie?ie==="nested"?"nested":"real":z(this,T)!=null?"real":/\.\d+\.|\.\d+$/.test(T)?X(this,T,Y):"adhocOrUndefined"},oe.prototype.hasMixedParent=function(T){var Y=T.split(/\./g);T="";for(var ie=0;ie<Y.length;++ie)if(T=ie>0?T+"."+Y[ie]:Y[ie],this.paths.hasOwnProperty(T)&&this.paths[T]instanceof d.Mixed)return this.paths[T];return null},oe.prototype.setupTimestamp=function(T){return $(this,T)},oe.prototype.queue=function(T,Y){return this.callQueue.push([T,Y]),this},oe.prototype.pre=function(T){if(T instanceof RegExp){var Y,ie=Array.prototype.slice.call(arguments,1),me=u(G);try{for(me.s();!(Y=me.n()).done;){var ne=Y.value;T.test(ne)&&this.pre.apply(this,[ne].concat(ie))}}catch(Be){me.e(Be)}finally{me.f()}return this}if(Array.isArray(T)){var ye,Re=Array.prototype.slice.call(arguments,1),Ie=u(T);try{for(Ie.s();!(ye=Ie.n()).done;){var je=ye.value;this.pre.apply(this,[je].concat(Re))}}catch(Be){Ie.e(Be)}finally{Ie.f()}return this}return this.s.hooks.pre.apply(this.s.hooks,arguments),this},oe.prototype.post=function(T){if(T instanceof RegExp){var Y,ie=Array.prototype.slice.call(arguments,1),me=u(G);try{for(me.s();!(Y=me.n()).done;){var ne=Y.value;T.test(ne)&&this.post.apply(this,[ne].concat(ie))}}catch(Be){me.e(Be)}finally{me.f()}return this}if(Array.isArray(T)){var ye,Re=Array.prototype.slice.call(arguments,1),Ie=u(T);try{for(Ie.s();!(ye=Ie.n()).done;){var je=ye.value;this.post.apply(this,[je].concat(Re))}}catch(Be){Ie.e(Be)}finally{Ie.f()}return this}return this.s.hooks.post.apply(this.s.hooks,arguments),this},oe.prototype.plugin=function(T,Y){if(typeof T!="function")throw new Error('First param to `schema.plugin()` must be a function, got "'+g(T)+'"');if(Y&&Y.deduplicate){var ie,me=u(this.plugins);try{for(me.s();!(ie=me.n()).done;)if(ie.value.fn===T)return this}catch(ne){me.e(ne)}finally{me.f()}}return this.plugins.push({fn:T,opts:Y}),T(this,Y),this},oe.prototype.method=function(T,Y,ie){if(typeof T!="string")for(var me in T)this.methods[me]=T[me],this.methodOptions[me]=S(ie);else this.methods[T]=Y,this.methodOptions[T]=S(ie);return this},oe.prototype.static=function(T,Y){if(typeof T!="string")for(var ie in T)this.statics[ie]=T[ie];else this.statics[T]=Y;return this},oe.prototype.index=function(T,Y){for(var ie in T||(T={}),Y||(Y={}),Y.expires&&C.expires(Y),T)this.aliases[ie]&&(T=C.renameObjKey(T,ie,this.aliases[ie]));for(var me=0,ne=Object.keys(T);me<ne.length;me++){var ye=ne[me];T[ye]==="ascending"||T[ye]==="asc"?T[ye]=1:T[ye]!=="descending"&&T[ye]!=="desc"||(T[ye]=-1)}var Re,Ie=u(this.indexes());try{for(Ie.s();!(Re=Ie.n()).done;){var je=Re.value;Y.name==null&&je[1].name==null&&Q(je[0],T)&&C.warn("Duplicate schema index on ".concat(JSON.stringify(T),' found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.'))}}catch(Be){Ie.e(Be)}finally{Ie.f()}return this._indexes.push([T,Y]),this},oe.prototype.set=function(T,Y,ie){if(arguments.length===1)return this.options[T];switch(T){case"read":typeof Y=="string"?this.options[T]={mode:K(Y),tags:ie}:Array.isArray(Y)&&typeof Y[0]=="string"?this.options[T]={mode:K(Y[0]),tags:Y[1]}:this.options[T]=Y,this._userProvidedOptions[T]=this.options[T];break;case"timestamps":this.setupTimestamp(Y),this.options[T]=Y,this._userProvidedOptions[T]=this.options[T];break;case"_id":this.options[T]=Y,this._userProvidedOptions[T]=this.options[T],Y&&!this.paths._id?j(this):!Y&&this.paths._id!=null&&this.paths._id.auto&&this.remove("_id");break;default:this.options[T]=Y,this._userProvidedOptions[T]=this.options[T]}return T==="strict"&&de(this,{strict:Y}),T==="strictQuery"&&de(this,{strictQuery:Y}),T==="toObject"&&(delete(Y=x({},Y)).transform,de(this,{toObject:Y})),T==="toJSON"&&(delete(Y=x({},Y)).transform,de(this,{toJSON:Y})),this},oe.prototype.get=function(T){return this.options[T]};var q="2d 2dsphere hashed text".split(" ");function B(T,Y){var ie,me=Y.split("."),ne=me.pop(),ye=T.tree,Re=u(me);try{for(Re.s();!(ie=Re.n()).done;)ye=ye[ie.value]}catch(Ie){Re.e(Ie)}finally{Re.f()}delete ye[ne]}function te(T){return T.startsWith("$[")&&T.endsWith("]")}Object.defineProperty(oe,"indexTypes",{get:function(){return q},set:function(){throw new Error("Cannot overwrite Schema.indexTypes")}}),oe.prototype.indexes=function(){return V(this)},oe.prototype.virtual=function(T,Y){if(T instanceof D||M(T)==="VirtualType")return this.virtual(T.path,T.options);if(Y=new v(Y),C.hasUserDefinedProperty(Y,["ref","refPath"])){if(Y.localField==null)throw new Error("Reference virtuals require `localField` option");if(Y.foreignField==null)throw new Error("Reference virtuals require `foreignField` option");var ie=this.virtual(T);ie.options=Y,this.pre("init",function(qe,vt){if(ue.has(T,qe)){var jt=ue.get(T,qe);if(this.$$populatedVirtuals||(this.$$populatedVirtuals={}),Y.justOne||Y.count?this.$$populatedVirtuals[T]=Array.isArray(jt)?jt[0]:jt:this.$$populatedVirtuals[T]=Array.isArray(jt)?jt:jt==null?[]:[jt],vt!=null&&vt.hydratedPopulatedDocs&&!Y.count){var wt=ie._getModelNamesForPopulate(this),ft=this.$$populatedVirtuals[T];if(Array.isArray(ft)||ft.$__||wt?.length!==1){if(Array.isArray(ft)&&wt?.length===1){for(var fr=this.db.model(wt[0]),Nt=0;Nt<ft.length;++Nt)ft[Nt].$__||(ft[Nt]=fr.hydrate(ft[Nt],null,{hydratedPopulatedDocs:!0}));var Bt=Y.foreignField;this.$populated(T,ft.map(function(Lt){return Lt==null?Lt:Lt.get(typeof Bt=="function"?Bt.call(Lt,Lt):Bt)}),{populateModelSymbol:fr})}}else{var Ht=this.db.model(wt[0]);this.$$populatedVirtuals[T]=Ht.hydrate(ft)}}ue.unset(T,qe)}}),ie.set(function(qe){return this.$$populatedVirtuals||(this.$$populatedVirtuals={}),W(this.$$populatedVirtuals,T,qe,Y)}),typeof Y.get=="function"&&ie.get(Y.get);for(var me=T.split("."),ne=me[0],ye=0;ye<me.length-1;++ye)if(this.paths[ne]!=null){if(this.paths[ne].$isMongooseDocumentArray||this.paths[ne].$isSingleNested){var Re=me.slice(ye+1).join(".");this.paths[ne].schema.virtual(Re,Y);break}if(this.paths[ne].$isSchemaMap){var Ie=me.slice(ye+2).join(".");this.paths[ne].$__schemaType.schema.virtual(Ie,Y);break}ne+="."+me[ye+1]}return ie}var je=this.virtuals,Be=T.split(".");if(this.pathType(T)==="real")throw new Error('Virtual path "'+T+'" conflicts with a real path in the schema');if(je[T]=Be.reduce(function(qe,vt,jt){return qe[vt]||(qe[vt]=jt===Be.length-1?new D(Y,T):{}),qe[vt]},this.tree),Y&&Y.applyToArray&&Be.length>1){var Me=this.path(Be.slice(0,-1).join("."));if(Me&&Me.$isMongooseArray)return Me.virtual(Be[Be.length-1],Y);throw new m('Path "'.concat(Me,'" is not an array'))}return je[T]},oe.prototype.virtualpath=function(T){return this.virtuals.hasOwnProperty(T)?this.virtuals[T]:null},oe.prototype.remove=function(T){return typeof T=="string"&&(T=[T]),Array.isArray(T)&&T.forEach(function(Y){if(this.path(Y)!=null||this.nested[Y]){if(this.nested[Y]){var ie,me=u(Object.keys(this.paths).concat(Object.keys(this.nested)));try{for(me.s();!(ie=me.n()).done;){var ne=ie.value;ne.startsWith(Y+".")&&(delete this.paths[ne],delete this.nested[ne],B(this,ne))}}catch(ye){me.e(ye)}finally{me.f()}return delete this.nested[Y],void B(this,Y)}delete this.paths[Y],B(this,Y),this._removeEncryptedField(Y)}},this),this},oe.prototype.removeVirtual=function(T){if(typeof T=="string"&&(T=[T]),Array.isArray(T)){var Y,ie=u(T);try{for(ie.s();!(Y=ie.n()).done;){var me=Y.value;if(this.virtuals[me]==null)throw new m('Attempting to remove virtual "'.concat(me,'" that does not exist.'))}}catch(Ie){ie.e(Ie)}finally{ie.f()}var ne,ye=u(T);try{for(ye.s();!(ne=ye.n()).done;){var Re=ne.value;delete this.paths[Re],delete this.virtuals[Re],Re.indexOf(".")!==-1?ue.unset(Re,this.tree):delete this.tree[Re]}}catch(Ie){ye.e(Ie)}finally{ye.f()}}return this},oe.prototype.loadClass=function(T,Y){return T===Object.prototype||T===Function.prototype||T.prototype.hasOwnProperty("$isMongooseModelPrototype")||T.prototype.hasOwnProperty("$isMongooseDocumentPrototype")||(this.loadClass(Object.getPrototypeOf(T),Y),Y||Object.getOwnPropertyNames(T).forEach(function(ie){if(!ie.match(/^(length|name|prototype|constructor|__proto__)$/)){var me=Object.getOwnPropertyDescriptor(T,ie);me.hasOwnProperty("value")&&this.static(ie,me.value)}},this),Object.getOwnPropertyNames(T.prototype).forEach(function(ie){if(!ie.match(/^(constructor)$/)){var me=Object.getOwnPropertyDescriptor(T.prototype,ie);Y||typeof me.value=="function"&&this.method(ie,me.value),typeof me.get=="function"&&(this.virtuals[ie]&&(this.virtuals[ie].getters=[]),this.virtual(ie).get(me.get)),typeof me.set=="function"&&(this.virtuals[ie]&&(this.virtuals[ie].setters=[]),this.virtual(ie).set(me.set))}},this)),this},oe.prototype._getSchema=function(T){var Y=this.path(T),ie=[];if(Y)return Y.$fullPath=T,Y;for(var me=T.split("."),ne=0;ne<me.length;++ne)(me[ne]==="$"||te(me[ne]))&&(me[ne]="0"),Se.test(me[ne])&&(me[ne]="$");return function ye(Re,Ie){for(var je,Be,Me=Re.length+1;Me--;)if(Be=Re.slice(0,Me).join("."),je=Ie.path(Be)){if(ie.push(Be),je.caster){if(je.caster instanceof d.Mixed)return je.caster.$fullPath=ie.join("."),je.caster;if(Me!==Re.length){if(Me+1===Re.length&&je.$embeddedSchemaType&&(Re[Me]==="$"||te(Re[Me])))return je.$embeddedSchemaType;if(je.schema){var qe=void 0;return Re[Me]==="$"||te(Re[Me])?Me+1===Re.length?je.$embeddedSchemaType:((qe=ye(Re.slice(Me+1),je.schema))&&(qe.$parentSchemaDocArray=qe.$parentSchemaDocArray||(je.schema.$isSingleNested?null:je)),qe):((qe=ye(Re.slice(Me),je.schema))&&(qe.$parentSchemaDocArray=qe.$parentSchemaDocArray||(je.schema.$isSingleNested?null:je)),qe)}}}else if(je.$isSchemaMap){if(Me>=Re.length)return je;if(Me+1>=Re.length||je.$__schemaType instanceof d.Mixed)return je.$__schemaType;if(je.$__schemaType.schema!=null)return ye(Re.slice(Me+1),je.$__schemaType.schema)}return je.$fullPath=ie.join("."),je}}(me,this)},oe.prototype._getPathType=function(T){return this.path(T)?"real":function Y(ie,me){for(var ne,ye,Re=ie.length+1;Re--;){if(ye=ie.slice(0,Re).join("."),ne=me.path(ye))return ne.caster?ne.caster instanceof d.Mixed?{schema:ne,pathType:"mixed"}:Re!==ie.length&&ne.schema?ie[Re]==="$"||te(ie[Re])?Re===ie.length-1?{schema:ne,pathType:"nested"}:Y(ie.slice(Re+1),ne.schema):Y(ie.slice(Re),ne.schema):{schema:ne,pathType:ne.$isSingleNested?"nested":"array"}:{schema:ne,pathType:"real"};if(Re===ie.length&&me.nested[ye])return{schema:me,pathType:"nested"}}return{schema:ne||me,pathType:"undefined"}}(T.split("."),this)},oe.prototype._transformDuplicateKeyError=function(T){if(!this._duplicateKeyErrorMessagesByPath||T.code!==11e3&&T.code!==11001)return T;if(T.keyPattern!=null){var Y=T.keyPattern,ie=Object.keys(Y);if(ie.length!==1)return T;var me=ie[0];return this._duplicateKeyErrorMessagesByPath.hasOwnProperty(me)?new m(this._duplicateKeyErrorMessagesByPath[me],{cause:T}):T}return T},oe.prototype._preCompile=function(){this.plugin(H,{deduplicate:!0})},oe.prototype.toJSONSchema=function(T){for(var Y,ie=(Y=T?.useBsonType)!==null&&Y!==void 0&&Y,me=ie?{required:[],properties:{}}:{type:"object",required:[],properties:{}},ne=0,ye=Object.keys(this.paths);ne<ye.length;ne++){var Re=ye[ne],Ie=this.paths[Re];if(Ie._presplitPath.indexOf("$*")===-1){var je=me;if(Ie._presplitPath.length>1)for(var Be=0;Be<Ie._presplitPath.length-1;++Be){var Me=Ie._presplitPath[Be];je.properties[Me]==null&&(je.properties[Me]=ie?{bsonType:["object","null"],properties:{}}:{type:["object","null"],properties:{}}),je=je.properties[Me]}var qe=Ie._presplitPath[Ie._presplitPath.length-1],vt=!1;Re==="_id"?(je.required||(je.required=[]),je.required.push("_id"),vt=!0):Ie.options.required&&typeof Ie.options.required!="function"&&(je.required||(je.required=[]),je.required.push(qe),vt=!0),je.properties[qe]=Ie.toJSONSchema(T),Ie.options.enum&&(je.properties[qe].enum=vt?Ie.options.enum:[].concat(c(Ie.options.enum),[null]))}}return me.required.length===0&&delete me.required,me},a.exports=i=oe,oe.Types=d=t(7953),i.ObjectId=d.ObjectId},7160:(a,i)=>{"use strict";i.schemaMixedSymbol=Symbol.for("mongoose:schema_mixed"),i.builtInMiddleware=Symbol.for("mongoose:built-in-middleware")},7219:(a,i,t)=>{"use strict";function n(_){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},n(_)}function c(_,p){for(var m=0;m<p.length;m++){var y=p[m];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(_,b(y.key),y)}}function b(_){var p=function(m){if(n(m)!="object"||!m)return m;var y=m[Symbol.toPrimitive];if(y!==void 0){var k=y.call(m,"string");if(n(k)!="object")return k;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(m)}(_);return n(p)=="symbol"?p:p+""}function x(){try{var _=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(x=function(){return!!_})()}function w(_){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(p){return p.__proto__||Object.getPrototypeOf(p)},w(_)}function g(_,p){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,y){return m.__proto__=y,m},g(_,p)}var o=t(8213),u=t(2900),h=t(4070),l=t(5497),d=function(_){function p(){return function(k,v){if(!(k instanceof v))throw new TypeError("Cannot call a class as a function")}(this,p),function(k,v,D){return v=w(v),function(j,S){if(S&&(n(S)=="object"||typeof S=="function"))return S;if(S!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(A){if(A===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A}(j)}(k,x()?Reflect.construct(v,D||[],w(k).constructor):v.apply(k,D))}(this,p,arguments)}return function(k,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function");k.prototype=Object.create(v&&v.prototype,{constructor:{value:k,writable:!0,configurable:!0}}),Object.defineProperty(k,"prototype",{writable:!1}),v&&g(k,v)}(p,_),m=p,(y=[{key:"assimilateError",value:function(k){var v=k.reason,D=h(v)&&u(v)&&k.message.indexOf("bad auth")===-1&&k.message.indexOf("Authentication failed")===-1;for(var j in D?this.message="Could not connect to any servers in your MongoDB Atlas cluster. One common reason is that you're trying to access the database from an IP that isn't whitelisted. Make sure your current IP address is on your Atlas cluster's IP whitelist: https://www.mongodb.com/docs/atlas/security-whitelist/":l(v)?this.message="Mongoose is connecting with SSL enabled, but the server is not accepting SSL connections. Please ensure that the MongoDB server you are connecting to is configured to accept SSL connections. Learn more: https://mongoosejs.com/docs/tutorials/ssl.html":this.message=k.message,k)j!=="name"&&(this[j]=k[j]);return this.cause=v,this}}])&&c(m.prototype,y),Object.defineProperty(m,"prototype",{writable:!1}),m;var m,y}(o);Object.defineProperty(d.prototype,"name",{value:"MongooseServerSelectionError"}),a.exports=d},7236:a=>{"use strict";function i(t){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i(t)}a.exports=function(t){if(t==null||i(t)!=="object")return t;if(Array.isArray(t))for(var n=t.length-1;n>=0;--n)t[n]===void 0&&t.splice(n,1);for(var c=0,b=Object.keys(t);c<b.length;c++){var x=b[c];t[x]===void 0&&delete t[x]}return t}},7291:(a,i)=>{"use strict";function t(c){return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},t(c)}var n=Symbol("mongoose#trustedSymbol");i.trustedSymbol=n,i.trusted=function(c){return c==null||t(c)!=="object"||(c[n]=!0),c}},7300:a=>{"use strict";function i(t){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i(t)}a.exports=function(t){return t==null||i(t)!=="object"||!("$meta"in t)&&!("$slice"in t)}},7352:(a,i,t)=>{function n($){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},n($)}var c=Object.getOwnPropertyDescriptors||function($){for(var C=Object.keys($),J={},F=0;F<C.length;F++)J[C[F]]=Object.getOwnPropertyDescriptor($,C[F]);return J},b=/%[sdj%]/g;i.format=function($){if(!v($)){for(var C=[],J=0;J<arguments.length;J++)C.push(o(arguments[J]));return C.join(" ")}J=1;for(var F=arguments,I=F.length,N=String($).replace(b,function(ae){if(ae==="%%")return"%";if(J>=I)return ae;switch(ae){case"%s":return String(F[J++]);case"%d":return Number(F[J++]);case"%j":try{return JSON.stringify(F[J++])}catch{return"[Circular]"}default:return ae}}),G=F[J];J<I;G=F[++J])y(G)||!S(G)?N+=" "+G:N+=" "+o(G);return N},i.deprecate=function($,C){if({env:{}}.noDeprecation===!0)return $;var J=!1;return function(){if(!J){if({env:{}}.throwDeprecation)throw new Error(C);({env:{}}).traceDeprecation?console.trace(C):console.error(C),J=!0}return $.apply(this,arguments)}};var x={},w=/^$/;if({}.NODE_DEBUG){var g={}.NODE_DEBUG;g=g.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),w=new RegExp("^"+g+"$","i")}function o($,C){var J={seen:[],stylize:h};return arguments.length>=3&&(J.depth=arguments[2]),arguments.length>=4&&(J.colors=arguments[3]),m(C)?J.showHidden=C:C&&i._extend(J,C),D(J.showHidden)&&(J.showHidden=!1),D(J.depth)&&(J.depth=2),D(J.colors)&&(J.colors=!1),D(J.customInspect)&&(J.customInspect=!0),J.colors&&(J.stylize=u),l(J,$,J.depth)}function u($,C){var J=o.styles[C];return J?"\x1B["+o.colors[J][0]+"m"+$+"\x1B["+o.colors[J][1]+"m":$}function h($,C){return $}function l($,C,J){if($.customInspect&&C&&V(C.inspect)&&C.inspect!==i.inspect&&(!C.constructor||C.constructor.prototype!==C)){var F=C.inspect(J,$);return v(F)||(F=l($,F,J)),F}var I=function(he,E){if(D(E))return he.stylize("undefined","undefined");if(v(E)){var z="'"+JSON.stringify(E).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return he.stylize(z,"string")}return k(E)?he.stylize(""+E,"number"):m(E)?he.stylize(""+E,"boolean"):y(E)?he.stylize("null","null"):void 0}($,C);if(I)return I;var N=Object.keys(C),G=function(he){var E={};return he.forEach(function(z,X){E[z]=!0}),E}(N);if($.showHidden&&(N=Object.getOwnPropertyNames(C)),M(C)&&(N.indexOf("message")>=0||N.indexOf("description")>=0))return d(C);if(N.length===0){if(V(C)){var ae=C.name?": "+C.name:"";return $.stylize("[Function"+ae+"]","special")}if(j(C))return $.stylize(RegExp.prototype.toString.call(C),"regexp");if(A(C))return $.stylize(Date.prototype.toString.call(C),"date");if(M(C))return d(C)}var ce,Se="",oe=!1,Z=["{","}"];return p(C)&&(oe=!0,Z=["[","]"]),V(C)&&(Se=" [Function"+(C.name?": "+C.name:"")+"]"),j(C)&&(Se=" "+RegExp.prototype.toString.call(C)),A(C)&&(Se=" "+Date.prototype.toUTCString.call(C)),M(C)&&(Se=" "+d(C)),N.length!==0||oe&&C.length!=0?J<0?j(C)?$.stylize(RegExp.prototype.toString.call(C),"regexp"):$.stylize("[Object]","special"):($.seen.push(C),ce=oe?function(he,E,z,X,de){for(var q=[],B=0,te=E.length;B<te;++B)re(E,String(B))?q.push(_(he,E,z,X,String(B),!0)):q.push("");return de.forEach(function(T){T.match(/^\d+$/)||q.push(_(he,E,z,X,T,!0))}),q}($,C,J,G,N):N.map(function(he){return _($,C,J,G,he,oe)}),$.seen.pop(),function(he,E,z){return he.reduce(function(X,de){return de.indexOf(`
`),X+de.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?z[0]+(E===""?"":E+`
 `)+" "+he.join(`,
  `)+" "+z[1]:z[0]+E+" "+he.join(", ")+" "+z[1]}(ce,Se,Z)):Z[0]+Se+Z[1]}function d($){return"["+Error.prototype.toString.call($)+"]"}function _($,C,J,F,I,N){var G,ae,ce;if((ce=Object.getOwnPropertyDescriptor(C,I)||{value:C[I]}).get?ae=ce.set?$.stylize("[Getter/Setter]","special"):$.stylize("[Getter]","special"):ce.set&&(ae=$.stylize("[Setter]","special")),re(F,I)||(G="["+I+"]"),ae||($.seen.indexOf(ce.value)<0?(ae=y(J)?l($,ce.value,null):l($,ce.value,J-1)).indexOf(`
`)>-1&&(ae=N?ae.split(`
`).map(function(Se){return"  "+Se}).join(`
`).slice(2):`
`+ae.split(`
`).map(function(Se){return"   "+Se}).join(`
`)):ae=$.stylize("[Circular]","special")),D(G)){if(N&&I.match(/^\d+$/))return ae;(G=JSON.stringify(""+I)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(G=G.slice(1,-1),G=$.stylize(G,"name")):(G=G.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),G=$.stylize(G,"string"))}return G+": "+ae}function p($){return Array.isArray($)}function m($){return typeof $=="boolean"}function y($){return $===null}function k($){return typeof $=="number"}function v($){return typeof $=="string"}function D($){return $===void 0}function j($){return S($)&&K($)==="[object RegExp]"}function S($){return n($)==="object"&&$!==null}function A($){return S($)&&K($)==="[object Date]"}function M($){return S($)&&(K($)==="[object Error]"||$ instanceof Error)}function V($){return typeof $=="function"}function K($){return Object.prototype.toString.call($)}function H($){return $<10?"0"+$.toString(10):$.toString(10)}i.debuglog=function($){if($=$.toUpperCase(),!x[$])if(w.test($)){var C={env:{}}.pid;x[$]=function(){var J=i.format.apply(i,arguments);console.error("%s %d: %s",$,C,J)}}else x[$]=function(){};return x[$]},i.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},i.types=t(7595),i.isArray=p,i.isBoolean=m,i.isNull=y,i.isNullOrUndefined=function($){return $==null},i.isNumber=k,i.isString=v,i.isSymbol=function($){return n($)==="symbol"},i.isUndefined=D,i.isRegExp=j,i.types.isRegExp=j,i.isObject=S,i.isDate=A,i.types.isDate=A,i.isError=M,i.types.isNativeError=M,i.isFunction=V,i.isPrimitive=function($){return $===null||typeof $=="boolean"||typeof $=="number"||typeof $=="string"||n($)==="symbol"||$===void 0},i.isBuffer=t(7944);var Q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function re($,C){return Object.prototype.hasOwnProperty.call($,C)}i.log=function(){var $,C;console.log("%s - %s",(C=[H(($=new Date).getHours()),H($.getMinutes()),H($.getSeconds())].join(":"),[$.getDate(),Q[$.getMonth()],C].join(" ")),i.format.apply(i,arguments))},i.inherits=t(1679),i._extend=function($,C){if(!C||!S(C))return $;for(var J=Object.keys(C),F=J.length;F--;)$[J[F]]=C[J[F]];return $};var ue=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;function W($,C){if(!$){var J=new Error("Promise was rejected with a falsy value");J.reason=$,$=J}return C($)}i.promisify=function($){if(typeof $!="function")throw new TypeError('The "original" argument must be of type Function');if(ue&&$[ue]){var C;if(typeof(C=$[ue])!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(C,ue,{value:C,enumerable:!1,writable:!1,configurable:!0}),C}function C(){for(var J,F,I=new Promise(function(ae,ce){J=ae,F=ce}),N=[],G=0;G<arguments.length;G++)N.push(arguments[G]);N.push(function(ae,ce){ae?F(ae):J(ce)});try{$.apply(this,N)}catch(ae){F(ae)}return I}return Object.setPrototypeOf(C,Object.getPrototypeOf($)),ue&&Object.defineProperty(C,ue,{value:C,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(C,c($))},i.promisify.custom=ue,i.callbackify=function($){if(typeof $!="function")throw new TypeError('The "original" argument must be of type Function');function C(){for(var J=[],F=0;F<arguments.length;F++)J.push(arguments[F]);var I=J.pop();if(typeof I!="function")throw new TypeError("The last argument must be of type Function");var N=this,G=function(){return I.apply(N,arguments)};$.apply(this,J).then(function(ae){({env:{}}).nextTick(G.bind(null,null,ae))},function(ae){({env:{}}).nextTick(W.bind(null,ae,G))})}return Object.setPrototypeOf(C,Object.getPrototypeOf($)),Object.defineProperties(C,c($)),C}},7425:(a,i,t)=>{"use strict";var n=t(2696);a.exports=function(c,b){if(c==null||c.discriminators==null)return null;for(var x=0,w=Object.keys(c.discriminators);x<w.length;x++){var g=w[x],o=c.discriminators[g];if(o.discriminatorMapping!=null&&n(o.discriminatorMapping.value,b))return o}return null}},7430:(a,i,t)=>{"use strict";var n=t(5832).hp;function c(o){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},c(o)}var b=t(6353).Binary,x=t(3305),w=t(2497);t(3672),t(7352);function g(o){return o&&c(o)==="object"&&!(o instanceof Date)&&!x(o,"ObjectId")&&(!Array.isArray(o)||o.length!==0)&&!(o instanceof n)&&!x(o,"Decimal128")&&!(o instanceof b)}i.B=function o(u,h,l,d){var _,p=(_=u&&w(u)&&!n.isBuffer(u)?Object.keys(u.toObject({transform:!1,virtuals:!1})||{}):Object.keys(u||{})).length,m={};h=h?h+".":"";for(var y=0;y<p;++y){var k=_[y],v=u[k];m[h+k]=v;var D=d&&d.path&&d.path(h+k),j=d&&d.nested&&d.nested[h+k];if(!D||D.instance!=="Mixed"){if(g(v)){if(l&&l.skipArrays&&Array.isArray(v))continue;var S=o(v,h+k,l,d);for(var A in S)m[A]=S[A];Array.isArray(v)&&(m[h+k]=v)}if(j)for(var M=0,V=Object.keys(d.paths);M<V.length;M++){var K=V[M];K.startsWith(h+k+".")&&!m.hasOwnProperty(K)&&(m[K]=void 0)}}}return m}},7494:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}function c(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!o})()}function b(o){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},b(o)}function x(o,u){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,l){return h.__proto__=l,h},x(o,u)}var w=function(o){function u(){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,u),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,u,arguments)}return function(l,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(d&&d.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),d&&x(l,d)}(u,o),h=u,Object.defineProperty(h,"prototype",{writable:!1}),h;var h}(t(8879)),g=t(5761);Object.defineProperty(w.prototype,"_id",g),Object.defineProperty(w.prototype,"minimize",g),a.exports=w},7557:(a,i,t)=>{"use strict";function n(d){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},n(d)}function c(d,_,p){return(_=function(m){var y=function(k){if(n(k)!="object"||!k)return k;var v=k[Symbol.toPrimitive];if(v!==void 0){var D=v.call(k,"string");if(n(D)!="object")return D;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(k)}(m);return n(y)=="symbol"?y:y+""}(_))in d?Object.defineProperty(d,_,{value:p,enumerable:!0,configurable:!0,writable:!0}):d[_]=p,d}var b=t(8920),x=t(7930).arrayAtomicsSymbol,w=t(7930).arrayAtomicsBackupSymbol,g=t(7930).arrayParentSymbol,o=t(7930).arrayPathSymbol,u=t(7930).arraySchemaSymbol,h=Array.prototype.push,l=/^\d+$/;a.exports=function(d,_,p,m){var y;if(Array.isArray(d)){var k=d.length;if(k===0)y=new Array;else if(k===1)(y=new Array(1))[0]=d[0];else if(k<1e4)y=new Array,h.apply(y,d);else{y=new Array;for(var v=0;v<k;++v)h.call(y,d[v])}}else y=[];var D=c(c(c(c(c(c(c(c({},x,{}),w,void 0),o,_),u,m),g,void 0),"isMongooseArray",!0),"isMongooseArrayProxy",!0),"__array",y);d&&d[x]!=null&&(D[x]=d[x]),p!=null&&p.$__&&(D[g]=p,D[u]=m||p.schema.path(_));var j=new Proxy(y,{get:function(S,A){return D.hasOwnProperty(A)?D[A]:b.hasOwnProperty(A)?b[A]:m&&m.virtuals&&m.virtuals.hasOwnProperty(A)?m.virtuals[A].applyGetters(void 0,S):typeof A=="string"&&l.test(A)&&m?.$embeddedSchemaType!=null?m.$embeddedSchemaType.applyGetters(y[A],p):y[A]},set:function(S,A,M){return typeof A=="string"&&l.test(A)?b.set.call(j,A,M,!1):D.hasOwnProperty(A)?D[A]=M:m&&m.virtuals&&m.virtuals.hasOwnProperty(A)?m.virtuals[A].applySetters(M,S):y[A]=M,!0}});return j}},7591:a=>{"use strict";var i=null;a.exports.get=function(){return i},a.exports.set=function(t){i=t}},7595:(a,i,t)=>{"use strict";function n(J){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},n(J)}var c=t(5899),b=t(1905),x=t(9834),w=t(7911);function g(J){return J.call.bind(J)}var o=typeof BigInt<"u",u=typeof Symbol<"u",h=g(Object.prototype.toString),l=g(Number.prototype.valueOf),d=g(String.prototype.valueOf),_=g(Boolean.prototype.valueOf);if(o)var p=g(BigInt.prototype.valueOf);if(u)var m=g(Symbol.prototype.valueOf);function y(J,F){if(n(J)!=="object")return!1;try{return F(J),!0}catch{return!1}}function k(J){return h(J)==="[object Map]"}function v(J){return h(J)==="[object Set]"}function D(J){return h(J)==="[object WeakMap]"}function j(J){return h(J)==="[object WeakSet]"}function S(J){return h(J)==="[object ArrayBuffer]"}function A(J){return typeof ArrayBuffer<"u"&&(S.working?S(J):J instanceof ArrayBuffer)}function M(J){return h(J)==="[object DataView]"}function V(J){return typeof DataView<"u"&&(M.working?M(J):J instanceof DataView)}i.isArgumentsObject=c,i.isGeneratorFunction=b,i.isTypedArray=w,i.isPromise=function(J){return typeof Promise<"u"&&J instanceof Promise||J!==null&&n(J)==="object"&&typeof J.then=="function"&&typeof J.catch=="function"},i.isArrayBufferView=function(J){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(J):w(J)||V(J)},i.isUint8Array=function(J){return x(J)==="Uint8Array"},i.isUint8ClampedArray=function(J){return x(J)==="Uint8ClampedArray"},i.isUint16Array=function(J){return x(J)==="Uint16Array"},i.isUint32Array=function(J){return x(J)==="Uint32Array"},i.isInt8Array=function(J){return x(J)==="Int8Array"},i.isInt16Array=function(J){return x(J)==="Int16Array"},i.isInt32Array=function(J){return x(J)==="Int32Array"},i.isFloat32Array=function(J){return x(J)==="Float32Array"},i.isFloat64Array=function(J){return x(J)==="Float64Array"},i.isBigInt64Array=function(J){return x(J)==="BigInt64Array"},i.isBigUint64Array=function(J){return x(J)==="BigUint64Array"},k.working=typeof Map<"u"&&k(new Map),i.isMap=function(J){return typeof Map<"u"&&(k.working?k(J):J instanceof Map)},v.working=typeof Set<"u"&&v(new Set),i.isSet=function(J){return typeof Set<"u"&&(v.working?v(J):J instanceof Set)},D.working=typeof WeakMap<"u"&&D(new WeakMap),i.isWeakMap=function(J){return typeof WeakMap<"u"&&(D.working?D(J):J instanceof WeakMap)},j.working=typeof WeakSet<"u"&&j(new WeakSet),i.isWeakSet=function(J){return j(J)},S.working=typeof ArrayBuffer<"u"&&S(new ArrayBuffer),i.isArrayBuffer=A,M.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&M(new DataView(new ArrayBuffer(1),0,1)),i.isDataView=V;var K=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function H(J){return h(J)==="[object SharedArrayBuffer]"}function Q(J){return K!==void 0&&(H.working===void 0&&(H.working=H(new K)),H.working?H(J):J instanceof K)}function re(J){return y(J,l)}function ue(J){return y(J,d)}function W(J){return y(J,_)}function $(J){return o&&y(J,p)}function C(J){return u&&y(J,m)}i.isSharedArrayBuffer=Q,i.isAsyncFunction=function(J){return h(J)==="[object AsyncFunction]"},i.isMapIterator=function(J){return h(J)==="[object Map Iterator]"},i.isSetIterator=function(J){return h(J)==="[object Set Iterator]"},i.isGeneratorObject=function(J){return h(J)==="[object Generator]"},i.isWebAssemblyCompiledModule=function(J){return h(J)==="[object WebAssembly.Module]"},i.isNumberObject=re,i.isStringObject=ue,i.isBooleanObject=W,i.isBigIntObject=$,i.isSymbolObject=C,i.isBoxedPrimitive=function(J){return re(J)||ue(J)||W(J)||$(J)||C(J)},i.isAnyArrayBuffer=function(J){return typeof Uint8Array<"u"&&(A(J)||Q(J))},["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(J){Object.defineProperty(i,J,{enumerable:!1,value:function(){throw new Error(J+" is not supported in userland")}})})},7760:(a,i,t)=>{"use strict";function n(F,I){var N=Object.keys(F);if(Object.getOwnPropertySymbols){var G=Object.getOwnPropertySymbols(F);I&&(G=G.filter(function(ae){return Object.getOwnPropertyDescriptor(F,ae).enumerable})),N.push.apply(N,G)}return N}function c(F){for(var I=1;I<arguments.length;I++){var N=arguments[I]!=null?arguments[I]:{};I%2?n(Object(N),!0).forEach(function(G){b(F,G,N[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(N)):n(Object(N)).forEach(function(G){Object.defineProperty(F,G,Object.getOwnPropertyDescriptor(N,G))})}return F}function b(F,I,N){return(I=function(G){var ae=function(ce){if(w(ce)!="object"||!ce)return ce;var Se=ce[Symbol.toPrimitive];if(Se!==void 0){var oe=Se.call(ce,"string");if(w(oe)!="object")return oe;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(ce)}(G);return w(ae)=="symbol"?ae:ae+""}(I))in F?Object.defineProperty(F,I,{value:N,enumerable:!0,configurable:!0,writable:!0}):F[I]=N,F}function x(F,I){(I==null||I>F.length)&&(I=F.length);for(var N=0,G=Array(I);N<I;N++)G[N]=F[N];return G}function w(F){return w=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},w(F)}var g,o,u=t(8499),h=t(2555),l=t(8213),d=t(4592),_=t(6426),p=_.CastError,m=t(5022),y=t(2069),k=t(622),v=t(2073),D=t(7982),j=t(4450),S=t(8260),A=t(5110),M=t(7352),V=t(8768),K=t(5558).G,H=t(4327),Q=t(9604),re=t(1058),ue=Symbol("mongoose#isNestedArray"),W=Object.freeze({});function $(F,I,N,G){o||(o=t(9600).Embedded);var ae,ce,Se="type";if(G&&G.typeKey&&(Se=G.typeKey),this.schemaOptions=G,I){var oe={};V.isPOJO(I)&&(I[Se]?(delete(oe=j(I))[Se],I=I[Se]):I=m),N!=null&&N.ref!=null&&oe.ref==null&&(oe.ref=N.ref),I===Object&&(I=m);var Z=typeof I=="string"?I:V.getFunctionName(I),he=t(7953),E=he.hasOwnProperty(Z)?he[Z]:I;if(this.casterConstructor=E,this.casterConstructor instanceof $&&(this.casterConstructor[ue]=!0),typeof E!="function"||E.$isArraySubdocument||E.$isSchemaMap)this.caster=E,this.caster instanceof o||(this.caster.path=F);else{var z=this.caster instanceof o?null:F;this.caster=new E(z,oe)}this.$embeddedSchemaType=this.caster}if(this.$isMongooseArray=!0,_.call(this,F,N,"Array"),this.defaultValue!=null&&(ae=this.defaultValue,ce=typeof ae=="function"),!("defaultValue"in this)||this.defaultValue!=null){var X=function(){return ce?ae.call(this):ae!=null?[].concat(ae):[]};X.$runBeforeSetters=!ce,this.default(X)}}$.schemaName="Array",$.options={castNonArrays:!0},$.defaultOptions={},$.set=_.set,$.setters=[],$.get=_.get,$.prototype=Object.create(_.prototype),$.prototype.constructor=$,$.prototype.OptionsConstructor=d,$._checkRequired=_.prototype.checkRequired,$.checkRequired=_.checkRequired,$.prototype.virtuals=null,$.prototype.checkRequired=function(F,I){return w(F)==="object"&&_._isRef(this,F,I,!0)?!!F:(typeof this.constructor.checkRequired=="function"?this.constructor.checkRequired():$.checkRequired())(F)},$.prototype.enum=function(){for(var F=this;;){var I=F&&F.caster&&F.caster.instance;if(I!=="Array"){if(I!=="String"&&I!=="Number")throw new Error("`enum` can only be set on an array of strings or numbers , not "+I);break}F=F.caster}var N=arguments;return!Array.isArray(arguments)&&V.isObject(arguments)&&(N=V.object.vals(N)),F.caster.enum.apply(F.caster,N),this},$.prototype.applyGetters=function(F,I){return I!=null&&I.$__!=null&&I.$populated(this.path)?F:_.prototype.applyGetters.call(this,F,I)},$.prototype._applySetters=function(F,I,N,G){if(this.casterConstructor.$isMongooseArray&&$.options.castNonArrays&&!this[ue]){for(var ae=0,ce=this;ce!=null&&ce.$isMongooseArray&&!ce.$isMongooseDocumentArray;)++ae,ce=ce.casterConstructor;if(F!=null&&F.length!==0){var Se=v(F);if(Se.min===Se.max&&Se.max<ae&&Se.containsNonArrayItem)for(var oe=Se.max;oe<ae;++oe)F=[F]}}return _.prototype._applySetters.call(this,F,I,N,G)},$.prototype.cast=function(F,I,N,G,ae){var ce,Se;if(g||(g=t(9600).Array),Array.isArray(F)){if(!F.length&&I){var oe=I.schema.indexedPaths(),Z=this.path;for(ce=0,Se=oe.length;ce<Se;++ce){var he=oe[ce][0][Z];if(he==="2dsphere"||he==="2d")return}var E=this.path.endsWith(".coordinates")?this.path.substring(0,this.path.lastIndexOf(".")):null;if(E!=null){for(ce=0,Se=oe.length;ce<Se;++ce)if(oe[ce][0][E]==="2dsphere")return}}ae=ae||W;var z=V.isMongooseArray(F)?F.__array:F,X=ae.path||this.path;if(ae.arrayPathIndex!=null&&(X+="."+ae.arrayPathIndex),z=(F=g(z,X,I,this)).__array,N&&I!=null&&I.$__!=null&&I.$populated(this.path))return F;var de=this.caster,q=de.$isMongooseArray;if(de&&this.casterConstructor!==m)try{var B=z.length;for(ce=0;ce<B;ce++){var te={};q&&(ae.arrayPath!=null||de._arrayParentPath!=null)&&(te.arrayPathIndex=ce),ae.hydratedPopulatedDocs&&(te.hydratedPopulatedDocs=ae.hydratedPopulatedDocs),z[ce]=de.applySetters(z[ce],I,N,void 0,te)}}catch(Y){throw new p("["+Y.kind+"]",M.inspect(F),this.path+"."+ce,Y,this)}return F}var T=this.options.castNonArrays!=null?this.options.castNonArrays:$.options.castNonArrays;if(N||T)return I&&N&&I.markModified(this.path),this.cast([F],I,N);throw new p("Array",M.inspect(F),this.path,null,this)},$.prototype._castForPopulate=function(F,I){if(g||(g=t(9600).Array),Array.isArray(F)){var N,G=F.__array?F.__array:F,ae=G.length,ce=this.caster;if(ce&&this.casterConstructor!==m)try{for(N=0;N<ae;N++){var Se={};ce.$isMongooseArray&&ce._arrayParentPath!=null&&(Se.arrayPathIndex=N),G[N]=ce.cast(G[N],I,!1,void 0,Se)}}catch(oe){throw new p("["+oe.kind+"]",M.inspect(F),this.path+"."+N,oe,this)}return F}throw new p("Array",M.inspect(F),this.path,null,this)},$.prototype.$toObject=$.prototype.toObject,$.prototype.discriminator=function(){for(var F,I=this;I.$isMongooseArray&&!I.$isMongooseDocumentArray;)if((I=I.casterConstructor)==null||typeof I=="function")throw new l("You can only add an embedded discriminator on a document array, "+this.path+" is a plain array");return(F=I).discriminator.apply(F,arguments)},$.prototype.clone=function(){var F=Object.assign({},this.options),I=new this.constructor(this.path,this.caster,F,this.schemaOptions);return I.validators=this.validators.slice(),this.requiredValidator!==void 0&&(I.requiredValidator=this.requiredValidator),I},$.prototype._castForQuery=function(F,I){var N=this,G=this.casterConstructor;if(F&&G.discriminators&&G.schema&&G.schema.options&&G.schema.options.discriminatorKey)if(typeof F[G.schema.options.discriminatorKey]=="string"&&G.discriminators[F[G.schema.options.discriminatorKey]])G=G.discriminators[F[G.schema.options.discriminatorKey]];else{var ae=re(G.discriminators,F[G.schema.options.discriminatorKey]);ae&&(G=ae)}var ce=this.casterConstructor.prototype,Se=ce&&ce.castForQuery,oe=ce&&ce.cast,Z=G.castForQuery,he=this.caster;return Array.isArray(F)?(this.setters.reverse().forEach(function(E){F=E.call(N,F,N)}),F=F.map(function(E){return V.isObject(E)&&E.$elemMatch?E:Se?E=Se.call(he,null,E,I):oe?E=oe.call(he,E):Z?E=Z.call(he,null,E,I):E!=null?E=new G(E):E})):Se?F=Se.call(he,null,F,I):oe?F=oe.call(he,F):Z?F=Z.call(he,null,F,I):F!=null&&(F=new G(F)),F},$.prototype.castForQuery=function(F,I,N){var G;if(F!=null){if(!(G=this.$conditionalHandlers[F]))throw new Error("Can't use "+F+" with Array.");return G.call(this,I,N)}return this._castForQuery(I,N)},$.prototype.virtual=function(F,I){if(F instanceof k||S(F)==="VirtualType")return this.virtual(F.path,F.options);if(I=new y(I),V.hasUserDefinedProperty(I,["ref","refPath"]))throw new l("Cannot set populate virtual as a property of an array");var N=new k(I,F);return this.virtuals===null&&(this.virtuals={}),this.virtuals[F]=N,N};var C=$.prototype.$conditionalHandlers={};function J(F){return function(I,N){if(!Array.isArray(I))throw new TypeError("conditional "+F+" requires an array");var G,ae=[],ce=function(Z,he){var E=typeof Symbol<"u"&&Z[Symbol.iterator]||Z["@@iterator"];if(!E){if(Array.isArray(Z)||(E=function(te,T){if(te){if(typeof te=="string")return x(te,T);var Y={}.toString.call(te).slice(8,-1);return Y==="Object"&&te.constructor&&(Y=te.constructor.name),Y==="Map"||Y==="Set"?Array.from(te):Y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Y)?x(te,T):void 0}}(Z))||he&&Z&&typeof Z.length=="number"){E&&(Z=E);var z=0,X=function(){};return{s:X,n:function(){return z>=Z.length?{done:!0}:{done:!1,value:Z[z++]}},e:function(te){throw te},f:X}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var de,q=!0,B=!1;return{s:function(){E=E.call(Z)},n:function(){var te=E.next();return q=te.done,te},e:function(te){B=!0,de=te},f:function(){try{q||E.return==null||E.return()}finally{if(B)throw de}}}}(I);try{for(ce.s();!(G=ce.n()).done;){var Se,oe=G.value;ae.push(D((Se=this.casterConstructor.schema)!==null&&Se!==void 0?Se:N.schema,oe,null,this&&this.$$context))}}catch(Z){ce.e(Z)}finally{ce.f()}return ae}}C.$all=function(F,I){var N=this;return Array.isArray(F)||(F=[F]),F=F.map(function(G){if(!V.isObject(G))return G;if(G.$elemMatch!=null)return{$elemMatch:D(N.casterConstructor.schema,G.$elemMatch,null,N&&N.$$context)};var ae={};return ae[N.path]=G,D(N.casterConstructor.schema,ae,null,N&&N.$$context)[N.path]},this),this.castForQuery(null,F,I)},C.$options=String,C.$elemMatch=function(F,I){for(var N=Object.keys(F),G=N.length,ae=0;ae<G;++ae){var ce=N[ae],Se=F[ce];A(ce)&&Se!=null&&(F[ce]=this.castForQuery(ce,Se,I))}return F},C.$geoIntersects=Q.cast$geoIntersects,C.$or=J("$or"),C.$and=J("$and"),C.$nor=J("$nor"),C.$near=C.$nearSphere=Q.cast$near,C.$within=C.$geoWithin=Q.cast$within,C.$size=C.$minDistance=C.$maxDistance=K,C.$exists=u,C.$type=h,C.$eq=C.$gt=C.$gte=C.$lt=C.$lte=C.$not=C.$regex=C.$ne=$.prototype._castForQuery,C.$nin=_.prototype.$conditionalHandlers.$nin,C.$in=_.prototype.$conditionalHandlers.$in,$.prototype.toJSONSchema=function(F){var I=this.getEmbeddedSchemaType(),N=this.options.required&&typeof this.options.required!="function";return c(c({},H("array","array",F?.useBsonType,N)),{},{items:I.toJSONSchema(F)})},$.prototype.autoEncryptionType=function(){return"array"},a.exports=$},7768:(a,i,t)=>{"use strict";var n=t(2402);a.exports=function(c){return c==null?c:c===""?null:(typeof c!="string"&&typeof c!="boolean"||(c=Number(c)),n.ok(!isNaN(c)),c instanceof Number?c.valueOf():typeof c=="number"?c:Array.isArray(c)||typeof c.valueOf!="function"?c.toString&&!Array.isArray(c)&&c.toString()==Number(c)?Number(c):void n.ok(!1):Number(c.valueOf()))}},7834:a=>{"use strict";function i(t){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i(t)}a.exports=function(t,n,c,b){return b.justOne||b.count?(t[n]=Array.isArray(c)?c[0]:c,i(t[n])!=="object"&&(t[n]=b.count?c:null)):(t[n]=Array.isArray(c)?c:c==null?[]:[c],t[n]=t[n].filter(function(x){return x&&i(x)==="object"})),t[n]}},7860:a=>{"use strict";a.exports=function(i){for(var t=[],n="",c="DEFAULT",b=0;b<i.length;++b)c!=="IN_SQUARE_BRACKETS"||/\d/.test(i[b])||i[b]==="]"||(c="DEFAULT",n=t[t.length-1]+"["+n,t.splice(t.length-1,1)),i[b]==="["?(c!=="IMMEDIATELY_AFTER_SQUARE_BRACKETS"&&(t.push(n),n=""),c="IN_SQUARE_BRACKETS"):i[b]==="]"?c==="IN_SQUARE_BRACKETS"?(c="IMMEDIATELY_AFTER_SQUARE_BRACKETS",t.push(n),n=""):(c="DEFAULT",n+=i[b]):i[b]==="."?(c!=="IMMEDIATELY_AFTER_SQUARE_BRACKETS"&&(t.push(n),n=""),c="DEFAULT"):n+=i[b];return c!=="IMMEDIATELY_AFTER_SQUARE_BRACKETS"&&t.push(n),t}},7878:(a,i,t)=>{"use strict";var n=t(2273),c=t(4183);a.exports=function(){var b=c();return n(Number,{isNaN:b},{isNaN:function(){return Number.isNaN!==b}}),b}},7910:(a,i,t)=>{"use strict";var n=t(1058);a.exports=function(c,b,x){var w=c.schema.options.discriminatorKey,g=b!=null&&b[w];if(g==null&&(g=x),c.discriminators&&g!=null)if(c.discriminators[g])c=c.discriminators[g];else{var o=n(c.discriminators,g);o&&(c=o)}return c}},7911:(a,i,t)=>{"use strict";var n=t(9834);a.exports=function(c){return!!n(c)}},7930:(a,i)=>{"use strict";i.arrayAtomicsBackupSymbol=Symbol("mongoose#Array#atomicsBackup"),i.arrayAtomicsSymbol=Symbol("mongoose#Array#_atomics"),i.arrayParentSymbol=Symbol("mongoose#Array#_parent"),i.arrayPathSymbol=Symbol("mongoose#Array#_path"),i.arraySchemaSymbol=Symbol("mongoose#Array#_schema"),i.documentArrayParent=Symbol("mongoose#documentArrayParent"),i.documentIsSelected=Symbol("mongoose#Document#isSelected"),i.documentIsModified=Symbol("mongoose#Document#isModified"),i.documentModifiedPaths=Symbol("mongoose#Document#modifiedPaths"),i.documentSchemaSymbol=Symbol("mongoose#Document#schema"),i.getSymbol=Symbol("mongoose#Document#get"),i.modelSymbol=Symbol("mongoose#Model"),i.objectIdSymbol=Symbol("mongoose#ObjectId"),i.populateModelSymbol=Symbol("mongoose#PopulateOptions#Model"),i.schemaTypeSymbol=Symbol("mongoose#schemaType"),i.sessionNewDocuments=Symbol("mongoose#ClientSession#newDocuments"),i.scopeSymbol=Symbol("mongoose#Document#scope"),i.validatorErrorSymbol=Symbol("mongoose#validatorError")},7944:a=>{function i(t){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i(t)}a.exports=function(t){return t&&i(t)==="object"&&typeof t.copy=="function"&&typeof t.fill=="function"&&typeof t.readUInt8=="function"}},7953:(a,i,t)=>{"use strict";i.Array=t(7760),i.BigInt=t(3318),i.Boolean=t(6413),i.Buffer=t(2307),i.Date=t(2345),i.Decimal128=i.Decimal=t(7045),i.DocumentArray=t(9123),i.Double=t(1732),i.Int32=t(433),i.Map=t(6867),i.Mixed=t(5022),i.Number=t(3660),i.ObjectId=t(3091),i.String=t(8728),i.Subdocument=t(5098),i.UUID=t(2134),i.Union=t(8866),i.Oid=i.ObjectId,i.Object=i.Mixed,i.Bool=i.Boolean,i.ObjectID=i.ObjectId},7982:(a,i,t)=>{"use strict";function n(S,A){var M=typeof Symbol<"u"&&S[Symbol.iterator]||S["@@iterator"];if(!M){if(Array.isArray(S)||(M=function(ue,W){if(ue){if(typeof ue=="string")return c(ue,W);var $={}.toString.call(ue).slice(8,-1);return $==="Object"&&ue.constructor&&($=ue.constructor.name),$==="Map"||$==="Set"?Array.from(ue):$==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test($)?c(ue,W):void 0}}(S))||A&&S&&typeof S.length=="number"){M&&(S=M);var V=0,K=function(){};return{s:K,n:function(){return V>=S.length?{done:!0}:{done:!1,value:S[V++]}},e:function(ue){throw ue},f:K}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var H,Q=!0,re=!1;return{s:function(){M=M.call(S)},n:function(){var ue=M.next();return Q=ue.done,ue},e:function(ue){re=!0,H=ue},f:function(){try{Q||M.return==null||M.return()}finally{if(re)throw H}}}}function c(S,A){(A==null||A>S.length)&&(A=S.length);for(var M=0,V=Array(A);M<A;M++)V[M]=S[M];return V}function b(S){return b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},b(S)}var x=t(3609),w=t(8995),g=t(7953),o=t(170),u=t(1244),h=t(9064),l=t(3703),d=t(7425),_=t(5110),p=t(7352),m=t(608),y=t(2497),k=t(8768),v=["Polygon","MultiPolygon"];function D(S,A,M){if(Array.isArray(S))S.forEach(function(re,ue){if(Array.isArray(re)||m(re))return D(re,A,M);S[ue]=A.castForQuery(null,re,M)});else for(var V=Object.keys(S),K=V.length;K--;){var H=V[K],Q=S[H];Array.isArray(Q)||m(Q)?(D(Q,A,M),S[H]=Q):S[H]=A.castForQuery({val:Q,context:M})}}function j(S,A,M,V){if("strictQuery"in S)return S.strictQuery;if("strictQuery"in A)return A.strictQuery;var K=V&&V.mongooseCollection&&V.mongooseCollection.conn&&V.mongooseCollection.conn.base&&V.mongooseCollection.conn.base.options;return K&&"strictQuery"in K?K.strictQuery:M.strictQuery}a.exports=function S(A,M,V,K){if(Array.isArray(M))throw new Error("Query filter must be an object, got an array ",p.inspect(M));if(M==null)return M;A!=null&&A.discriminators!=null&&M[A.options.discriminatorKey]!=null&&(A=d(A,M[A.options.discriminatorKey])||A);var H,Q,re,ue,W,$,C=Object.keys(M),J=C.length;for(V=V||{};J--;)if($=M[ue=C[J]],ue==="$or"||ue==="$nor"||ue==="$and"){if(!Array.isArray($))throw new x("Array",$,ue);for(var F=$.length-1;F>=0;F--){if($[F]==null||b($[F])!=="object")throw new x("Object",$[F],ue+"."+F);var I=Object.keys($[F]).length,N=$[F][A.options.discriminatorKey];if(N==null)$[F]=S(A,$[F],V,K);else{var G=d(K.schema,N);$[F]=S(G||A,$[F],V,K)}Object.keys($[F]).length===0&&I!==0&&$.splice(F,1)}$.length===0&&delete M[ue]}else{if(ue==="$where"){if((W=b($))!=="string"&&W!=="function")throw new Error("Must have a string or function for $where");W==="function"&&(M[ue]=$.toString());continue}if(ue==="$expr"){$=o($,A);continue}if(ue==="$elemMatch")$=S(A,$,V,K);else if(ue==="$text")$=h($,ue);else if(ue!=="$comment"||A.paths.hasOwnProperty("$comment")){if(!A)continue;if(!(Q=A.path(ue)))for(var ae=ue.split("."),ce=ae.length;ce--;){var Se=ae.slice(0,ce).join("."),oe=ae.slice(ce).join("."),Z=A.path(Se),he=Z&&Z.schema&&Z.schema.options&&Z.schema.options.discriminatorKey;if(Z!=null&&(Z.schema&&Z.schema.discriminators)!=null&&he!=null&&oe!==he){var E=l(M,Se+"."+he),z=Z.schema.discriminators;typeof E=="string"&&z[E]!=null?Q=z[E].path(oe):E!=null&&Object.keys(E).length===1&&Array.isArray(E.$in)&&E.$in.length===1&&typeof E.$in[0]=="string"&&z[E.$in[0]]!=null&&(Q=z[E.$in[0]].path(oe))}}if(Q){if($==null)continue;if(k.isPOJO($))if(Object.keys($).some(_))for(var X=Object.keys($),de=void 0,q=X.length;q--;)if(re=$[de=X[q]],de==="$elemMatch")re&&Q!=null&&Q.schema!=null?S(Q.schema,re,V,K):re&&Q!=null&&Q.$isMongooseArray&&(k.isPOJO(re)&&re.$not!=null?S(A,re,V,K):$[de]=Q.castForQuery(de,re,K));else if(de==="$not"){if(re&&Q){if((H=Object.keys(re)).length&&_(H[0]))for(var B in re)re[B]=Q.castForQuery(B,re[B],K);else $[de]=Q.castForQuery(de,re,K);continue}}else $[de]=Q.castForQuery(de,re,K);else M[ue]=Q.castForQuery(null,$,K);else if(Array.isArray($)&&["Buffer","Array"].indexOf(Q.instance)===-1&&!V.sanitizeFilter){var te,T=[],Y=n($);try{for(Y.s();!(te=Y.n()).done;){var ie=te.value;T.push(Q.castForQuery(null,ie,K))}}catch(fr){Y.e(fr)}finally{Y.f()}M[ue]={$in:T}}else M[ue]=Q.castForQuery(null,$,K)}else{for(var me=ue.split("."),ne=me.length,ye=void 0,Re=void 0,Ie=void 0;ne--&&(ye=me.slice(0,ne).join("."),!(Q=A.path(ye))););if(Q){if(Q.caster&&Q.caster.schema){(Ie={})[Re=me.slice(ne).join(".")]=$;var je=S(Q.caster.schema,Ie,V,K)[Re];je===void 0?delete M[ue]:M[ue]=je}else M[ue]=$;continue}if(m($)){var Be="";if($.$near?Be="$near":$.$nearSphere?Be="$nearSphere":$.$within?Be="$within":$.$geoIntersects?Be="$geoIntersects":$.$geoWithin&&(Be="$geoWithin"),Be){var Me=new g.Number("__QueryCasting__"),qe=$[Be];if($.$maxDistance!=null&&($.$maxDistance=Me.castForQuery(null,$.$maxDistance,K)),$.$minDistance!=null&&($.$minDistance=Me.castForQuery(null,$.$minDistance,K)),Be==="$within"){var vt=qe.$center||qe.$centerSphere||qe.$box||qe.$polygon;if(!vt)throw new Error("Bad $within parameter: "+JSON.stringify($));qe=vt}else if(Be==="$near"&&typeof qe.type=="string"&&Array.isArray(qe.coordinates))qe=qe.coordinates;else if((Be==="$near"||Be==="$nearSphere"||Be==="$geoIntersects")&&qe.$geometry&&typeof qe.$geometry.type=="string"&&Array.isArray(qe.$geometry.coordinates))qe.$maxDistance!=null&&(qe.$maxDistance=Me.castForQuery(null,qe.$maxDistance,K)),qe.$minDistance!=null&&(qe.$minDistance=Me.castForQuery(null,qe.$minDistance,K)),y(qe.$geometry)&&(qe.$geometry=qe.$geometry.toObject({transform:!1,virtuals:!1})),qe=qe.$geometry.coordinates;else if(Be==="$geoWithin")if(qe.$geometry){y(qe.$geometry)&&(qe.$geometry=qe.$geometry.toObject({virtuals:!1}));var jt=qe.$geometry.type;if(v.indexOf(jt)===-1)throw new Error('Invalid geoJSON type for $geoWithin "'+jt+'", must be "Polygon" or "MultiPolygon"');qe=qe.$geometry.coordinates}else qe=qe.$box||qe.$polygon||qe.$center||qe.$centerSphere,y(qe)&&(qe=qe.toObject({virtuals:!1}));D(qe,Me,K);continue}}if(A.nested[ue])continue;var wt="strict"in V?V.strict:A.options.strict,ft=j(V,A._userProvidedOptions,A.options,K);if(V.upsert&&wt)throw wt==="throw"?new w(ue):new w(ue,'Path "'+ue+'" is not in schema, strict mode is `true`, and upsert is `true`.');if(ft==="throw")throw new w(ue,'Path "'+ue+`" is not in schema and strictQuery is 'throw'.`);ft&&delete M[ue]}}else $=u($,ue),M[ue]=$}return M}},8063:(a,i,t)=>{"use strict";function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}function c(){try{var g=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!g})()}function b(g){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},b(g)}function x(g,o){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},x(g,o)}var w=function(g){function o(h){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,o),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,o,[`Schema hasn't been registered for model "`+h+`".
Use mongoose.model(name, schema)`])}return function(h,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(l&&l.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),l&&x(h,l)}(o,g),u=o,Object.defineProperty(u,"prototype",{writable:!1}),u;var u}(t(8213));Object.defineProperty(w.prototype,"name",{value:"MissingSchemaError"}),a.exports=w},8093:a=>{"use strict";a.exports=Object},8133:(a,i,t)=>{"use strict";var n=t(8995);a.exports=function(c){var b,x;c.$immutable?(c.$immutableSetter=(b=c.path,x=c.options.immutable,function(w,g,o,u){if(this==null||this.$__==null||this.isNew||u&&u.overwriteImmutable||!(typeof x=="function"?x.call(this,this):x))return w;var h=this.$__.priorDoc!=null?this.$__.priorDoc.$__getValue(b):this.$__getValue(b);if(this.$__.strictMode==="throw"&&w!==h)throw new n(b,"Path `"+b+"` is immutable and strict mode is set to throw.",!0);return h}),c.set(c.$immutableSetter)):c.$immutableSetter&&(c.setters=c.setters.filter(function(w){return w!==c.$immutableSetter}),delete c.$immutableSetter)}},8188:a=>{"use strict";a.exports=URIError},8213:a=>{"use strict";function i(w){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},i(w)}function t(w){var g=typeof Map=="function"?new Map:void 0;return t=function(o){if(o===null||!function(h){try{return Function.toString.call(h).indexOf("[native code]")!==-1}catch{return typeof h=="function"}}(o))return o;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(g!==void 0){if(g.has(o))return g.get(o);g.set(o,u)}function u(){return function(h,l,d){if(n())return Reflect.construct.apply(null,arguments);var _=[null];_.push.apply(_,l);var p=new(h.bind.apply(h,_));return d&&c(p,d.prototype),p}(o,arguments,b(this).constructor)}return u.prototype=Object.create(o.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),c(u,o)},t(w)}function n(){try{var w=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(n=function(){return!!w})()}function c(w,g){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,u){return o.__proto__=u,o},c(w,g)}function b(w){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},b(w)}var x=function(w){function g(){return function(u,h){if(!(u instanceof h))throw new TypeError("Cannot call a class as a function")}(this,g),function(u,h,l){return h=b(h),function(d,_){if(_&&(i(_)=="object"||typeof _=="function"))return _;if(_!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}(d)}(u,n()?Reflect.construct(h,l||[],b(u).constructor):h.apply(u,l))}(this,g,arguments)}return function(u,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(h&&h.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),Object.defineProperty(u,"prototype",{writable:!1}),h&&c(u,h)}(g,w),o=g,Object.defineProperty(o,"prototype",{writable:!1}),o;var o}(t(Error));Object.defineProperty(x.prototype,"name",{value:"MongooseError"}),a.exports=x},8235:(a,i,t)=>{"use strict";var n=t(8213),c=t(6426),b=t(5098),x=t(7910);function w(g,o){if(this.$parentSchemaType=o&&o.$parentSchemaType,!this.$parentSchemaType)throw new n("Cannot create DocumentArrayElement schematype without a parent");delete o.$parentSchemaType,c.call(this,g,o,"DocumentArrayElement"),this.$isMongooseDocumentArrayElement=!0}w.schemaName="DocumentArrayElement",w.defaultOptions={},w.prototype=Object.create(c.prototype),w.prototype.constructor=w,w.prototype.cast=function(){var g;return(g=this.$parentSchemaType).cast.apply(g,arguments)[0]},w.prototype.doValidate=function(g,o,u,h){var l=x(this.caster,g);return!g||g instanceof l||(g=new l(g,u,null,null,h&&h.index!=null?h.index:null)),b.prototype.doValidate.call(this,g,o,u,h)},w.prototype.clone=function(){this.options.$parentSchemaType=this.$parentSchemaType;var g=c.prototype.clone.apply(this,arguments);return delete this.options.$parentSchemaType,g.caster=this.caster,g.schema=this.schema,g},a.exports=w},8250:(a,i,t)=>{"use strict";var n=t(5832).hp,c=t(6365),b=/[0-9a-f]{8}-[0-9a-f]{4}-[0-9][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}/i,x=c.Binary;function w(g){typeof g!="string"&&(g="");var o,u=(o=g.replace(/[{}-]/g,""))!=null&&n.from(o,"hex"),h=new c(u);return h._subtype=4,h}a.exports=function(g){if(g==null)return g;function o(u){var h=new c(u);return h._subtype=4,h}if(typeof g=="string"){if(b.test(g))return w(g);throw new Error('"'.concat(g,'" is not a valid UUID string'))}if(n.isBuffer(g))return o(g);if(g instanceof x)return o(g.value(!0));if(g.toString&&g.toString!==Object.prototype.toString&&b.test(g.toString()))return w(g.toString());throw new Error('"'.concat(g,'" cannot be casted to a UUID'))},a.exports.UUID_FORMAT=b},8260:a=>{"use strict";a.exports=function(i){if(i!=null&&typeof i.constructor=="function")return i.constructor.name}},8285:(a,i,t)=>{"use strict";var n=t(2400),c=t(2580),b=!1;a.exports=function(){return b?c:n},a.exports.setBrowser=function(x){b=x}},8297:a=>{"use strict";function i(p,m){var y=typeof Symbol<"u"&&p[Symbol.iterator]||p["@@iterator"];if(!y){if(Array.isArray(p)||(y=n(p))||m&&p&&typeof p.length=="number"){y&&(p=y);var k=0,v=function(){};return{s:v,n:function(){return k>=p.length?{done:!0}:{done:!1,value:p[k++]}},e:function(A){throw A},f:v}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var D,j=!0,S=!1;return{s:function(){y=y.call(p)},n:function(){var A=y.next();return j=A.done,A},e:function(A){S=!0,D=A},f:function(){try{j||y.return==null||y.return()}finally{if(S)throw D}}}}function t(p){return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},t(p)}function n(p,m){if(p){if(typeof p=="string")return c(p,m);var y={}.toString.call(p).slice(8,-1);return y==="Object"&&p.constructor&&(y=p.constructor.name),y==="Map"||y==="Set"?Array.from(p):y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(y)?c(p,m):void 0}}function c(p,m){(m==null||m>p.length)&&(m=p.length);for(var y=0,k=Array(m);y<m;y++)k[y]=p[y];return k}function b(p,m,y){if(w())return Reflect.construct.apply(null,arguments);var k=[null];k.push.apply(k,m);var v=new(p.bind.apply(p,k));return y&&x(v,y.prototype),v}function x(p,m){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,k){return y.__proto__=k,y},x(p,m)}function w(){try{var p=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(w=function(){return!!p})()}function g(){this._pres=new Map,this._posts=new Map}function o(p,m,y,k,v,D,j){return D.useErrorHandlers?p.execPost(y,k,v,{error:m},function(S){return typeof j=="function"&&j(S)}):typeof j=="function"&&j(m)}function u(p,m,y,k){var v;try{v=p.apply(m,y)}catch(D){return k(D)}h(v)&&v.then(function(){return k()},function(D){return k(D)})}function h(p){return t(p)==="object"&&p!==null&&typeof p.then=="function"}function l(p){var m=!1,y=this;return function(){var k=arguments;if(!m)return m=!0,d(function(){return p.apply(y,k)})}}g.skipWrappedFunction=function(){if(!(this instanceof g.skipWrappedFunction))return b(g.skipWrappedFunction,Array.prototype.slice.call(arguments));this.args=Array.prototype.slice.call(arguments)},g.overwriteResult=function(){if(!(this instanceof g.overwriteResult))return b(g.overwriteResult,Array.prototype.slice.call(arguments));this.args=Array.prototype.slice.call(arguments)},g.prototype.execPre=function(p,m,y,k){arguments.length===3&&(k=y,y=[]);var v=this._pres.get(p)||[],D=v.length,j=v.numAsync||0,S=0,A=j,M=!1,V=y,K=null;if(!D)return d(function(){k(null)});function H(){if(!(S>=D)){var re=v[S];if(re.isAsync){var ue=[l(Q),l(function(F){if(F){if(M)return;if(!(F instanceof g.skipWrappedFunction))return M=!0,k(F);K=F}if(--A===0&&S>=D)return k(K)})];u(re.fn,m,ue,ue[0])}else if(re.fn.length>0){for(var W=[l(Q)],$=arguments.length>=2?arguments:[null].concat(V),C=1;C<$.length;++C)C===$.length-1&&typeof $[C]=="function"||W.push($[C]);u(re.fn,m,W,W[0])}else{var J=null;try{J=re.fn.call(m)}catch(F){if(F!=null)return k(F)}if(h(J))J.then(function(){return Q()},function(F){return Q(F)});else{if(++S>=D)return A>0?void 0:d(function(){k(K)});H()}}}}function Q(re){if(re){if(M)return;if(!(re instanceof g.skipWrappedFunction))return M=!0,k(re);K=re}if(++S>=D)return A>0?void 0:k(K);H.apply(m,arguments)}H.apply(null,[null].concat(y))},g.prototype.execPreSync=function(p,m,y){for(var k=this._pres.get(p)||[],v=k.length,D=0;D<v;++D)k[D].fn.apply(m,y||[])},g.prototype.execPost=function(p,m,y,k,v){arguments.length<5&&(v=k,k=null);var D=this._posts.get(p)||[],j=D.length,S=0,A=null;if(k&&k.error&&(A=k.error),!j)return d(function(){v.apply(null,[A].concat(y))});(function M(){for(var V=D[S].fn,K=0,H=y.length,Q=[],re=0;re<H;++re)K+=y[re]&&y[re]._kareemIgnore?0:1,y[re]&&y[re]._kareemIgnore||Q.push(y[re]);if(A)if(_(D[S],K)){var ue=l(function(J){if(J){if(J instanceof g.overwriteResult)return y=J.args,++S>=j?v.call(null,A):M();A=J}if(++S>=j)return v.call(null,A);M()});u(V,m,[A].concat(Q).concat([ue]),ue)}else{if(++S>=j)return v.call(null,A);M()}else{var W=l(function(J){return J?J instanceof g.overwriteResult?(y=J.args,++S>=j?v.apply(null,[null].concat(y)):M()):(A=J,M()):++S>=j?v.apply(null,[null].concat(y)):void M()});if(_(D[S],K))return++S>=j?v.apply(null,[null].concat(y)):M();if(V.length===K+1)u(V,m,Q.concat([W]),W);else{var $,C;try{C=V.apply(m,Q)}catch(J){$=J,A=J}if(h(C))return C.then(function(J){W(J instanceof g.overwriteResult?J:null)},function(J){return W(J)});if(C instanceof g.overwriteResult&&(y=C.args),++S>=j)return v.apply(null,[$].concat(y));M()}}})()},g.prototype.execPostSync=function(p,m,y){for(var k=this._posts.get(p)||[],v=k.length,D=0;D<v;++D){var j=k[D].fn.apply(m,y||[]);j instanceof g.overwriteResult&&(y=j.args)}return y},g.prototype.createWrapperSync=function(p,m){var y=this;return function(){y.execPreSync(p,this,arguments);var k=m.apply(this,arguments);return y.execPostSync(p,this,[k])[0]}},g.prototype.wrap=function(p,m,y,k,v){var D=k.length>0?k[k.length-1]:null,j=Array.from(k);typeof D=="function"&&j.pop();var S=this,A=(v=v||{}).checkForPromise;this.execPre(p,y,k,function(M){if(M&&!(M instanceof g.skipWrappedFunction)){for(var V=v.numCallbackParams||0,K=v.contextParameter?[y]:[],H=K.length;H<V;++H)K.push(null);return o(S,M,p,y,K,v,D)}var Q,re,ue=m.length;if(M instanceof g.skipWrappedFunction)return Q=M.args[0],W.apply(void 0,[null].concat(function($){if(Array.isArray($))return c($)}(re=M.args)||function($){if(typeof Symbol<"u"&&$[Symbol.iterator]!=null||$["@@iterator"]!=null)return Array.from($)}(re)||n(re)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()));try{Q=m.apply(y,j.concat(W))}catch($){return W($)}if(A){if(h(Q))return Q.then(function($){return W(null,$)},function($){return W($)});if(ue<j.length+1)return W(null,Q)}function W(){var $=Array.from(arguments);if($.shift(),v.nullResultByDefault&&$.length===0&&$.push(null),arguments[0])return o(S,arguments[0],p,y,$,v,D);S.execPost(p,y,$,function(){D!==null&&(arguments[0]?D(arguments[0]):D.apply(y,arguments))})}})},g.prototype.filter=function(p){for(var m=this,y=this.clone(),k=Array.from(y._pres.keys()),v=function(){var K=j[D],H=m._pres.get(K).map(function(Q){return Object.assign({},Q,{name:K})}).filter(p);if(H.length===0)return y._pres.delete(K),1;H.numAsync=H.filter(function(Q){return Q.isAsync}).length,y._pres.set(K,H)},D=0,j=k;D<j.length;D++)v();for(var S=Array.from(y._posts.keys()),A=function(){var K=V[M],H=m._posts.get(K).map(function(Q){return Object.assign({},Q,{name:K})}).filter(p);if(H.length===0)return y._posts.delete(K),1;y._posts.set(K,H)},M=0,V=S;M<V.length;M++)A();return y},g.prototype.hasHooks=function(p){return this._pres.has(p)||this._posts.has(p)},g.prototype.createWrapper=function(p,m,y,k){var v=this;return this.hasHooks(p)?function(){var D=y||this;v.wrap(p,m,D,Array.from(arguments),k)}:function(){var D=arguments,j=this;d(function(){return m.apply(j,D)})}},g.prototype.pre=function(p,m,y,k,v){var D={};t(m)==="object"&&m!==null?m=(D=m).isAsync:typeof arguments[1]!="boolean"&&(y=m,m=!1);var j=this._pres.get(p)||[];if(this._pres.set(p,j),m&&(j.numAsync=j.numAsync||0,++j.numAsync),typeof y!="function")throw new Error('pre() requires a function, got "'+t(y)+'"');return v?j.unshift(Object.assign({},D,{fn:y,isAsync:m})):j.push(Object.assign({},D,{fn:y,isAsync:m})),this},g.prototype.post=function(p,m,y,k){var v=this._posts.get(p)||[];if(typeof m=="function"&&(k=!!y,y=m,m={}),typeof y!="function")throw new Error('post() requires a function, got "'+t(y)+'"');return k?v.unshift(Object.assign({},m,{fn:y})):v.push(Object.assign({},m,{fn:y})),this._posts.set(p,v),this},g.prototype.clone=function(){var p,m=new g,y=i(this._pres.keys());try{for(y.s();!(p=y.n()).done;){var k=p.value,v=this._pres.get(k).slice();v.numAsync=this._pres.get(k).numAsync,m._pres.set(k,v)}}catch(A){y.e(A)}finally{y.f()}var D,j=i(this._posts.keys());try{for(j.s();!(D=j.n()).done;){var S=D.value;m._posts.set(S,this._posts.get(S).slice())}}catch(A){j.e(A)}finally{j.f()}return m},g.prototype.merge=function(p,m){var y,k=(m=arguments.length===1||m)?this.clone():this,v=i(p._pres.keys());try{var D=function(){var M=y.value,V=k._pres.get(M)||[],K=p._pres.get(M).filter(function(Q){return V.map(function(re){return re.fn}).indexOf(Q.fn)===-1}),H=V.concat(K);H.numAsync=V.numAsync||0,H.numAsync+=K.filter(function(Q){return Q.isAsync}).length,k._pres.set(M,H)};for(v.s();!(y=v.n()).done;)D()}catch(M){v.e(M)}finally{v.f()}var j,S=i(p._posts.keys());try{var A=function(){var M=j.value,V=k._posts.get(M)||[],K=p._posts.get(M).filter(function(H){return V.indexOf(H)===-1});k._posts.set(M,V.concat(K))};for(S.s();!(j=S.n()).done;)A()}catch(M){S.e(M)}finally{S.f()}return k};var d=t({env:{}})==="object"&&{env:{}}!==null&&{env:{}}.nextTick||function(p){setTimeout(p,0)};function _(p,m){return!!p.errorHandler||p.fn.length===m+2}a.exports=g},8435:a=>{"use strict";a.exports=Math.min},8442:(a,i,t)=>{"use strict";var n=t(1898);a.exports=function(c){for(var b=0,x=Object.values(n);b<x.length;b++)(0,x[b])(c,{deduplicate:!0});c.plugins=Object.values(n).map(function(w){return{fn:w,opts:{deduplicate:!0}}}).concat(c.plugins)}},8499:(a,i,t)=>{"use strict";var n=t(8953);a.exports=function(c){var b=this!=null?this.path:null;return n(c,b)}},8517:(a,i,t)=>{"use strict";function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}function c(){try{var g=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!g})()}function b(g){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},b(g)}function x(g,o){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},x(g,o)}var w=function(g){function o(h,l,d){var _,p,m;(function(j,S){if(!(j instanceof S))throw new TypeError("Cannot call a class as a function")})(this,o);var y=(_=d?.matchedCount)!==null&&_!==void 0?_:0,k=(p=d?.insertedCount)!==null&&p!==void 0?p:0,v=l.map(function(j){return j._id}).join(", ");v.length>100&&(v=v.slice(0,100)+"...");var D=l.length-y-k;return(m=function(j,S,A){return S=b(S),function(M,V){if(V&&(n(V)=="object"||typeof V=="function"))return V;if(V!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(K){if(K===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return K}(M)}(j,c()?Reflect.construct(S,A||[],b(j).constructor):S.apply(j,A))}(this,o,["".concat(h,".bulkSave() was not able to update ").concat(D," of the given documents due to incorrect version or optimistic concurrency, document ids: ").concat(v)])).modelName=h,m.documents=l,m.bulkWriteResult=d,m.numDocumentsNotUpdated=D,m}return function(h,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(l&&l.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),l&&x(h,l)}(o,g),u=o,Object.defineProperty(u,"prototype",{writable:!1}),u;var u}(t(8213));Object.defineProperty(w.prototype,"name",{value:"MongooseBulkSaveIncompleteError"}),a.exports=w},8533:(a,i,t)=>{"use strict";var n=t(5832).hp;function c(o){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},c(o)}function b(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(b=function(){return!!o})()}function x(o){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},x(o)}function w(o,u){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,l){return h.__proto__=l,h},w(o,u)}t(7591).set(t(4026));var g=t(8285);g.setBrowser(!0),i.Error=t(3672),i.Schema=t(7058),i.Types=t(9600),i.VirtualType=t(622),i.SchemaType=t(6426),i.SchemaTypeOptions=t(8879),i.utils=t(8768),i.Document=g(),i.model=function(o,u){var h=function(l){function d(p,m){return function(y,k){if(!(y instanceof k))throw new TypeError("Cannot call a class as a function")}(this,d),function(y,k,v){return k=x(k),function(D,j){if(j&&(c(j)=="object"||typeof j=="function"))return j;if(j!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(S){if(S===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}(D)}(y,b()?Reflect.construct(k,v||[],x(y).constructor):k.apply(y,v))}(this,d,[p,u,m])}return function(p,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(m&&m.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),Object.defineProperty(p,"prototype",{writable:!1}),m&&w(p,m)}(d,l),_=d,Object.defineProperty(_,"prototype",{writable:!1}),_;var _}(i.Document);return h.modelName=o,h},typeof window<"u"&&(window.mongoose=a.exports,window.Buffer=n)},8633:a=>{"use strict";a.exports=Math.pow},8690:a=>{"use strict";function i(){var c,b,x=typeof Symbol=="function"?Symbol:{},w=x.iterator||"@@iterator",g=x.toStringTag||"@@toStringTag";function o(y,k,v,D){var j=k&&k.prototype instanceof h?k:h,S=Object.create(j.prototype);return t(S,"_invoke",function(A,M,V){var K,H,Q,re=0,ue=V||[],W=!1,$={p:0,n:0,v:c,a:C,f:C.bind(c,4),d:function(J,F){return K=J,H=0,Q=c,$.n=F,u}};function C(J,F){for(H=J,Q=F,b=0;!W&&re&&!I&&b<ue.length;b++){var I,N=ue[b],G=$.p,ae=N[2];J>3?(I=ae===F)&&(Q=N[(H=N[4])?5:(H=3,3)],N[4]=N[5]=c):N[0]<=G&&((I=J<2&&G<N[1])?(H=0,$.v=F,$.n=N[1]):G<ae&&(I=J<3||N[0]>F||F>ae)&&(N[4]=J,N[5]=F,$.n=ae,H=0))}if(I||J>1)return u;throw W=!0,F}return function(J,F,I){if(re>1)throw TypeError("Generator is already running");for(W&&F===1&&C(F,I),H=F,Q=I;(b=H<2?c:Q)||!W;){K||(H?H<3?(H>1&&($.n=-1),C(H,Q)):$.n=Q:$.v=Q);try{if(re=2,K){if(H||(J="next"),b=K[J]){if(!(b=b.call(K,Q)))throw TypeError("iterator result is not an object");if(!b.done)return b;Q=b.value,H<2&&(H=0)}else H===1&&(b=K.return)&&b.call(K),H<2&&(Q=TypeError("The iterator does not provide a '"+J+"' method"),H=1);K=c}else if((b=(W=$.n<0)?Q:A.call(M,$))!==u)break}catch(N){K=c,H=1,Q=N}finally{re=1}}return{value:b,done:W}}}(y,v,D),!0),S}var u={};function h(){}function l(){}function d(){}b=Object.getPrototypeOf;var _=[][w]?b(b([][w]())):(t(b={},w,function(){return this}),b),p=d.prototype=h.prototype=Object.create(_);function m(y){return Object.setPrototypeOf?Object.setPrototypeOf(y,d):(y.__proto__=d,t(y,g,"GeneratorFunction")),y.prototype=Object.create(p),y}return l.prototype=d,t(p,"constructor",d),t(d,"constructor",l),l.displayName="GeneratorFunction",t(d,g,"GeneratorFunction"),t(p),t(p,g,"Generator"),t(p,w,function(){return this}),t(p,"toString",function(){return"[object Generator]"}),(i=function(){return{w:o,m}})()}function t(c,b,x,w){var g=Object.defineProperty;try{g({},"",{})}catch{g=0}t=function(o,u,h,l){function d(_,p){t(o,_,function(m){return this._invoke(_,p,m)})}u?g?g(o,u,{value:h,enumerable:!l,configurable:!l,writable:!l}):o[u]=h:(d("next",0),d("throw",1),d("return",2))},t(c,b,x,w)}var n=i().m(function c(){return i().w(function(b){for(;;)if(b.n===0)return b.a(2)},c)}).constructor;a.exports=function(){return n}},8728:(a,i,t)=>{"use strict";function n(D,j){var S=Object.keys(D);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(D);j&&(A=A.filter(function(M){return Object.getOwnPropertyDescriptor(D,M).enumerable})),S.push.apply(S,A)}return S}function c(D){for(var j=1;j<arguments.length;j++){var S=arguments[j]!=null?arguments[j]:{};j%2?n(Object(S),!0).forEach(function(A){b(D,A,S[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(D,Object.getOwnPropertyDescriptors(S)):n(Object(S)).forEach(function(A){Object.defineProperty(D,A,Object.getOwnPropertyDescriptor(S,A))})}return D}function b(D,j,S){return(j=function(A){var M=function(V){if(x(V)!="object"||!V)return V;var K=V[Symbol.toPrimitive];if(K!==void 0){var H=K.call(V,"string");if(x(H)!="object")return H;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(V)}(A);return x(M)=="symbol"?M:M+""}(j))in D?Object.defineProperty(D,j,{value:S,enumerable:!0,configurable:!0,writable:!0}):D[j]=S,D}function x(D){return x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(j){return typeof j}:function(j){return j&&typeof Symbol=="function"&&j.constructor===Symbol&&j!==Symbol.prototype?"symbol":typeof j},x(D)}function w(D,j){(j==null||j>D.length)&&(j=D.length);for(var S=0,A=Array(j);S<j;S++)A[S]=D[S];return A}var g=t(6426),o=t(3672),u=t(9528),h=t(1244),l=t(4327),d=t(8768),_=t(3305),p=g.CastError;function m(D,j){this.enumValues=[],this.regExp=null,g.call(this,D,j,"String")}function y(D,j){return this.castForQuery(null,D,j)}function k(D){return D==null?this._castNullish(D):this.cast(D,this)}m.schemaName="String",m.defaultOptions={},m.prototype=Object.create(g.prototype),m.prototype.constructor=m,Object.defineProperty(m.prototype,"OptionsConstructor",{configurable:!1,enumerable:!1,writable:!1,value:u}),m._cast=h,m.cast=function(D){return arguments.length===0||(D===!1&&(D=this._defaultCaster),this._cast=D),this._cast},m._defaultCaster=function(D){if(D!=null&&typeof D!="string")throw new Error;return D},m.get=g.get,m.set=g.set,m.setters=[],m._checkRequired=function(D){return(D instanceof String||typeof D=="string")&&D.length},m.checkRequired=g.checkRequired,m.prototype.enum=function(){if(this.enumValidator&&(this.validators=this.validators.filter(function(K){return K.validator!==this.enumValidator},this),this.enumValidator=!1),arguments[0]===void 0||arguments[0]===!1)return this;var D,j;d.isObject(arguments[0])?Array.isArray(arguments[0].values)?(D=arguments[0].values,j=arguments[0].message):(D=d.object.vals(arguments[0]),j=o.messages.String.enum):(D=arguments,j=o.messages.String.enum);var S,A=function(K,H){var Q=typeof Symbol<"u"&&K[Symbol.iterator]||K["@@iterator"];if(!Q){if(Array.isArray(K)||(Q=function(J,F){if(J){if(typeof J=="string")return w(J,F);var I={}.toString.call(J).slice(8,-1);return I==="Object"&&J.constructor&&(I=J.constructor.name),I==="Map"||I==="Set"?Array.from(J):I==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(I)?w(J,F):void 0}}(K))||H&&K&&typeof K.length=="number"){Q&&(K=Q);var re=0,ue=function(){};return{s:ue,n:function(){return re>=K.length?{done:!0}:{done:!1,value:K[re++]}},e:function(J){throw J},f:ue}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var W,$=!0,C=!1;return{s:function(){Q=Q.call(K)},n:function(){var J=Q.next();return $=J.done,J},e:function(J){C=!0,W=J},f:function(){try{$||Q.return==null||Q.return()}finally{if(C)throw W}}}}(D);try{for(A.s();!(S=A.n()).done;){var M=S.value;M!==void 0&&this.enumValues.push(this.cast(M))}}catch(K){A.e(K)}finally{A.f()}var V=this.enumValues;return this.enumValidator=function(K){return K==null||~V.indexOf(K)},this.validators.push({validator:this.enumValidator,message:j,type:"enum",enumValues:V}),this},m.prototype.lowercase=function(D){var j=this;return arguments.length>0&&!D?this:this.set(function(S){return typeof S!="string"&&(S=j.cast(S)),S&&S.toLowerCase()})},m.prototype.uppercase=function(D){var j=this;return arguments.length>0&&!D?this:this.set(function(S){return typeof S!="string"&&(S=j.cast(S)),S&&S.toUpperCase()})},m.prototype.trim=function(D){var j=this;return arguments.length>0&&!D?this:this.set(function(S){return typeof S!="string"&&(S=j.cast(S)),S&&S.trim()})},m.prototype.minlength=function(D,j){if(this.minlengthValidator&&(this.validators=this.validators.filter(function(A){return A.validator!==this.minlengthValidator},this)),D!=null){var S=j||o.messages.String.minlength;S=S.replace(/{MINLENGTH}/,D),this.validators.push({validator:this.minlengthValidator=function(A){return A===null||A.length>=D},message:S,type:"minlength",minlength:D})}return this},m.prototype.minLength=m.prototype.minlength,m.prototype.maxlength=function(D,j){if(this.maxlengthValidator&&(this.validators=this.validators.filter(function(A){return A.validator!==this.maxlengthValidator},this)),D!=null){var S=j||o.messages.String.maxlength;S=S.replace(/{MAXLENGTH}/,D),this.validators.push({validator:this.maxlengthValidator=function(A){return A===null||A.length<=D},message:S,type:"maxlength",maxlength:D})}return this},m.prototype.maxLength=m.prototype.maxlength,m.prototype.match=function(D,j){var S=j||o.messages.String.match;return this.validators.push({validator:function(A){return!!D&&(D.lastIndex=0,A==null||A===""||D.test(A))},message:S,type:"regexp",regexp:D}),this},m.prototype.checkRequired=function(D,j){return x(D)==="object"&&g._isRef(this,D,j,!0)?D!=null:(typeof this.constructor.checkRequired=="function"?this.constructor.checkRequired():m.checkRequired())(D)},m.prototype.cast=function(D,j,S,A,M){if(typeof D!="string"&&g._isRef(this,D,j,S))return this._castRef(D,j,S,M);var V;V=typeof this._castFunction=="function"?this._castFunction:typeof this.constructor.cast=="function"?this.constructor.cast():m.cast();try{return V(D)}catch{throw new p("string",D,this.path,null,this)}};var v=c(c({},g.prototype.$conditionalHandlers),{},{$all:function(D,j){var S=this;return Array.isArray(D)?D.map(function(A){return S.castForQuery(null,A,j)}):[this.castForQuery(null,D,j)]},$gt:y,$gte:y,$lt:y,$lte:y,$options:k,$regex:function(D){return Object.prototype.toString.call(D)==="[object RegExp]"?D:k.call(this,D)},$not:y});Object.defineProperty(m.prototype,"$conditionalHandlers",{enumerable:!1,value:v}),m.prototype.castForQuery=function(D,j,S){var A;if(D!=null){if(!(A=this.$conditionalHandlers[D]))throw new Error("Can't use "+D+" with String.");return A.call(this,j,S)}if(Object.prototype.toString.call(j)==="[object RegExp]"||_(j,"BSONRegExp"))return j;try{return this.applySetters(j,S)}catch(M){throw M instanceof p&&M.path===this.path&&this.$fullPath!=null&&(M.path=this.$fullPath),M}},m.prototype.toJSONSchema=function(D){var j=this.options.required&&typeof this.options.required!="function";return l("string","string",D?.useBsonType,j)},m.prototype.autoEncryptionType=function(){return"string"},a.exports=m},8759:a=>{"use strict";a.exports=function(i){return i.replace(/\.\$(\[[^\]]*\])?(?=\.)/g,".0").replace(/\.\$(\[[^\]]*\])?$/g,".0")}},8768:(a,i,t)=>{"use strict";var n=t(5832).hp;function c(I,N){var G=Object.keys(I);if(Object.getOwnPropertySymbols){var ae=Object.getOwnPropertySymbols(I);N&&(ae=ae.filter(function(ce){return Object.getOwnPropertyDescriptor(I,ce).enumerable})),G.push.apply(G,ae)}return G}function b(I,N,G){return(N=function(ae){var ce=function(Se){if(o(Se)!="object"||!Se)return Se;var oe=Se[Symbol.toPrimitive];if(oe!==void 0){var Z=oe.call(Se,"string");if(o(Z)!="object")return Z;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Se)}(ae);return o(ce)=="symbol"?ce:ce+""}(N))in I?Object.defineProperty(I,N,{value:G,enumerable:!0,configurable:!0,writable:!0}):I[N]=G,I}function x(I,N){var G=typeof Symbol<"u"&&I[Symbol.iterator]||I["@@iterator"];if(!G){if(Array.isArray(I)||(G=w(I))||N&&I&&typeof I.length=="number"){G&&(I=G);var ae=0,ce=function(){};return{s:ce,n:function(){return ae>=I.length?{done:!0}:{done:!1,value:I[ae++]}},e:function(he){throw he},f:ce}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Se,oe=!0,Z=!1;return{s:function(){G=G.call(I)},n:function(){var he=G.next();return oe=he.done,he},e:function(he){Z=!0,Se=he},f:function(){try{oe||G.return==null||G.return()}finally{if(Z)throw Se}}}}function w(I,N){if(I){if(typeof I=="string")return g(I,N);var G={}.toString.call(I).slice(8,-1);return G==="Object"&&I.constructor&&(G=I.constructor.name),G==="Map"||G==="Set"?Array.from(I):G==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(G)?g(I,N):void 0}}function g(I,N){(N==null||N>I.length)&&(N=I.length);for(var G=0,ae=Array(N);G<N;G++)ae[G]=I[G];return ae}function o(I){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(N){return typeof N}:function(N){return N&&typeof Symbol=="function"&&N.constructor===Symbol&&N!==Symbol.prototype?"symbol":typeof N},o(I)}var u,h=t(6353).UUID,l=t(354),d=t(5678),_=t(5549),p=t(6948),m=t(4450),y=t(2746),k=t(608),v=t(1243),D=t(1347),j=t(3305),S=t(2789),A=t(9696),M=t(2497),V=t(5268),K=t(9539),H=t(2793),Q=t(7291).trustedSymbol;i.specialProperties=H,i.isMongooseArray=v.isMongooseArray,i.isMongooseDocumentArray=D.isMongooseDocumentArray,i.registerMongooseArray=v.registerMongooseArray,i.registerMongooseDocumentArray=D.registerMongooseDocumentArray;var re=/\s/,ue=/\s+/;i.toCollectionName=function(I,N){if(I==="system.profile"||I==="system.indexes")return I;if(typeof N=="function"){if(typeof I!="string")throw new TypeError("Collection name must be a string");if(I.length===0)throw new TypeError("Collection name cannot be empty");return N(I)}return I},i.deepEqual=function I(N,G){if(N===G)return!0;if(o(N)!=="object"||o(G)!=="object")return N===G;if(N instanceof Date&&G instanceof Date)return N.getTime()===G.getTime();if(j(N,"ObjectId")&&j(G,"ObjectId")||j(N,"Decimal128")&&j(G,"Decimal128"))return N.toString()===G.toString();if(N instanceof RegExp&&G instanceof RegExp)return N.source===G.source&&N.ignoreCase===G.ignoreCase&&N.multiline===G.multiline&&N.global===G.global&&N.dotAll===G.dotAll&&N.unicode===G.unicode&&N.sticky===G.sticky&&N.hasIndices===G.hasIndices;if(N==null||G==null||N.prototype!==G.prototype)return!1;if(N instanceof Map||G instanceof Map)return N instanceof Map&&G instanceof Map&&I(Array.from(N.keys()),Array.from(G.keys()))&&I(Array.from(N.values()),Array.from(G.values()));if(N instanceof Number&&G instanceof Number)return N.valueOf()===G.valueOf();if(n.isBuffer(N))return i.buffer.areEqual(N,G);if(Array.isArray(N)||Array.isArray(G)){if(!Array.isArray(N)||!Array.isArray(G))return!1;var ae=N.length;if(ae!==G.length)return!1;for(var ce=0;ce<ae;++ce)if(!I(N[ce],G[ce]))return!1;return!0}N.$__!=null?N=N._doc:M(N)&&(N=N.toObject()),G.$__!=null?G=G._doc:M(G)&&(G=G.toObject());var Se=Object.keys(N),oe=Object.keys(G),Z=Se.length;if(Z!==oe.length)return!1;for(var he=Z-1;he>=0;he--)if(Se[he]!==oe[he])return!1;for(var E=0,z=Se;E<z.length;E++){var X=z[E];if(!I(N[X],G[X]))return!1}return!0},i.last=function(I){if(I.length>0)return I[I.length-1]},i.promiseOrCallback=V,i.cloneArrays=function(I){return Array.isArray(I)?I.map(function(N){return i.cloneArrays(N)}):I},i.omit=function(I,N){if(N==null)return Object.assign({},I);Array.isArray(N)||(N=[N]);var G,ae=Object.assign({},I),ce=x(N);try{for(ce.s();!(G=ce.n()).done;)delete ae[G.value]}catch(Se){ce.e(Se)}finally{ce.f()}return ae},i.clonePOJOsAndArrays=function(I){if(I==null||I.$__!=null)return I;if(S(I)){I=function(oe){for(var Z=1;Z<arguments.length;Z++){var he=arguments[Z]!=null?arguments[Z]:{};Z%2?c(Object(he),!0).forEach(function(E){b(oe,E,he[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(oe,Object.getOwnPropertyDescriptors(he)):c(Object(he)).forEach(function(E){Object.defineProperty(oe,E,Object.getOwnPropertyDescriptor(he,E))})}return oe}({},I);for(var N=0,G=Object.keys(I);N<G.length;N++){var ae=G[N];I[ae]=i.clonePOJOsAndArrays(I[ae])}return I}if(Array.isArray(I)){I=function(oe){if(Array.isArray(oe))return g(oe)}(Se=I)||function(oe){if(typeof Symbol<"u"&&oe[Symbol.iterator]!=null||oe["@@iterator"]!=null)return Array.from(oe)}(Se)||w(Se)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}();for(var ce=0;ce<I.length;++ce)I[ce]=i.clonePOJOsAndArrays(I[ce]);return I}var Se;return I},i.merge=function I(N,G,ae,ce){ae=ae||{};var Se,oe=Object.keys(G),Z=0,he=oe.length;G[Q]&&(N[Q]=G[Q]),ce=ce||"";for(var E=ae.omitNested||{};Z<he;)if(Se=oe[Z++],!(ae.omit&&ae.omit[Se]||E[ce]||H.has(Se)))if(N[Se]==null)N[Se]=i.clonePOJOsAndArrays(G[Se]);else if(i.isObject(G[Se])){if(i.isObject(N[Se])||(N[Se]={}),G[Se]!=null){if(ae.isDiscriminatorSchemaMerge&&G[Se].$isSingleNested&&N[Se].$isMongooseDocumentArray||G[Se].$isMongooseDocumentArray&&N[Se].$isSingleNested)continue;if(G[Se].instanceOfSchema){N[Se].instanceOfSchema?K(N[Se],G[Se].clone(),ae.isDiscriminatorSchemaMerge):N[Se]=G[Se].clone();continue}if(j(G[Se],"ObjectId")){N[Se]=new _(G[Se]);continue}}I(N[Se],G[Se],ae,ce?ce+"."+Se:Se)}else ae.overwrite&&(N[Se]=G[Se]);return N},i.toObject=function I(N){var G;if(u||(u=t(2400)),N==null)return N;if(N instanceof u)return N.toObject();if(Array.isArray(N)){G=[];var ae,ce=x(N);try{for(ce.s();!(ae=ce.n()).done;){var Se=ae.value;G.push(I(Se))}}catch(E){ce.e(E)}finally{ce.f()}return G}if(i.isPOJO(N)){G={},N[Q]&&(G[Q]=N[Q]);for(var oe=0,Z=Object.keys(N);oe<Z.length;oe++){var he=Z[oe];H.has(he)||(G[he]=I(N[he]))}return G}return N},i.isObject=k,i.isPOJO=t(2789),i.isNonBuiltinObject=function(I){return!(o(I)!=="object"||i.isNativeObject(I)||i.isMongooseType(I)||I instanceof h||I==null)},i.isNativeObject=function(I){return Array.isArray(I)||I instanceof Date||I instanceof Boolean||I instanceof Number||I instanceof String},i.isEmptyObject=function(I){return I!=null&&o(I)==="object"&&Object.keys(I).length===0},i.hasKey=function(I,N){for(var G=0,ae=Object.keys(I);G<ae.length;G++){var ce=ae[G];if(ce===N||i.isPOJO(I[ce])&&i.hasKey(I[ce],N))return!0}return!1},i.tick=function(I){if(typeof I=="function")return function(){try{I.apply(this,arguments)}catch(N){y(function(){throw N})}}},i.isMongooseType=function(I){return j(I,"ObjectId")||j(I,"Decimal128")||I instanceof n},i.isMongooseObject=M,i.expires=function(I){I&&I.constructor.name==="Object"&&"expires"in I&&(I.expireAfterSeconds=typeof I.expires!="string"?I.expires:Math.round(l(I.expires)/1e3),delete I.expires)},i.populate=function(I,N,G,ae,ce,Se,oe,Z){var he,E=null;if(arguments.length===1){if(I instanceof p)return I._docs={},I._childDocs=[],[I];if(Array.isArray(I)){var z=(he=[],I.forEach(function(X){re.test(X.path)?X.path.split(ue).forEach(function(de){var q=Object.assign({},X);q.path=de,he.push(q)}):he.push(X)}),he);return z.map(function(X){return i.populate(X)[0]})}E=i.isObject(I)?Object.assign({},I):{path:I}}else E=o(G)==="object"?{path:I,select:N,match:G,options:ae}:{path:I,select:N,model:G,match:ae,options:ce,populate:Se,justOne:oe,count:Z};if(!(typeof E.path=="string"||Array.isArray(E.path)&&E.path.every(function(X){return typeof X=="string"})))throw new TypeError("utils.populate: invalid path. Expected string or array of strings. Got typeof `"+o(I)+"`");return function(X){if(Array.isArray(X.populate)){var de=[];X.populate.forEach(function(ie){if(re.test(ie.path)){var me=Object.assign({},ie);me.path.split(ue).forEach(function(ne){me.path=ne,de.push(i.populate(me)[0])})}else de.push(i.populate(ie)[0])}),X.populate=i.populate(de)}else X.populate!=null&&o(X.populate)==="object"&&(X.populate=i.populate(X.populate));var q=[],B=re.test(X.path)?X.path.split(ue):Array.isArray(X.path)?X.path:[X.path];X.options!=null&&(X.options=m(X.options));var te,T=x(B);try{for(T.s();!(te=T.n()).done;){var Y=te.value;q.push(new p(Object.assign({},X,{path:Y})))}}catch(ie){T.e(ie)}finally{T.f()}return q}(E)},i.getValue=function(I,N,G){return d.get(I,N,$,G)};var W=Object.freeze({getters:!1});function $(I,N){if(N==="$*"&&I instanceof Map)return I;var G=I?._doc||I;return G!=null&&G.isMongooseArrayProxy&&(G=G.__array),G instanceof Map?G.get(N,W):G[N]}i.setValue=function(I,N,G,ae,ce){d.set(I,N,G,"_doc",ae,ce)},i.object={},i.object.vals=function(I){for(var N=Object.keys(I),G=N.length,ae=[];G--;)ae.push(I[N[G]]);return ae};var C=Object.prototype.hasOwnProperty;i.object.hasOwnProperty=function(I,N){return C.call(I,N)},i.isNullOrUndefined=function(I){return I==null},i.array={},i.array.flatten=function I(N,G,ae){return ae||(ae=[]),N.forEach(function(ce){Array.isArray(ce)?I(ce,G,ae):G&&!G(ce)||ae.push(ce)}),ae};var J=Object.prototype.hasOwnProperty;i.hasUserDefinedProperty=function(I,N){if(I==null)return!1;if(Array.isArray(N)){var G,ae=x(N);try{for(ae.s();!(G=ae.n()).done;){var ce=G.value;if(i.hasUserDefinedProperty(I,ce))return!0}}catch(oe){ae.e(oe)}finally{ae.f()}return!1}if(J.call(I,N))return!0;if(o(I)==="object"&&N in I){var Se=I[N];return Se!==Object.prototype[N]&&Se!==Array.prototype[N]}return!1};var F=Math.pow(2,32)-1;i.isArrayIndex=function(I){return typeof I=="number"?I>=0&&I<=F:typeof I=="string"&&!!/^\d+$/.test(I)&&(I=+I)>=0&&I<=F},i.array.unique=function(I){var N,G=new Set,ae=new Set,ce=[],Se=x(I);try{for(Se.s();!(N=Se.n()).done;){var oe=N.value;if(typeof oe=="number"||typeof oe=="string"||oe==null){if(G.has(oe))continue;ce.push(oe),G.add(oe)}else if(j(oe,"ObjectId")){if(ae.has(oe.toString()))continue;ce.push(oe),ae.add(oe.toString())}else ce.push(oe)}}catch(Z){Se.e(Z)}finally{Se.f()}return ce},i.buffer={},i.buffer.areEqual=function(I,N){if(!n.isBuffer(I)||!n.isBuffer(N)||I.length!==N.length)return!1;for(var G=0,ae=I.length;G<ae;++G)if(I[G]!==N[G])return!1;return!0},i.getFunctionName=A,i.decorate=function(I,N){for(var G in N)H.has(G)||(I[G]=N[G])},i.mergeClone=function(I,N){M(N)&&(N=N.toObject({transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1}));for(var G,ae=Object.keys(N),ce=ae.length,Se=0;Se<ce;)if(G=ae[Se++],!H.has(G))if(I[G]===void 0)I[G]=m(N[G],{transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1});else{var oe=N[G];if(oe==null||!oe.valueOf||oe instanceof Date||(oe=oe.valueOf()),i.isObject(oe)){var Z=oe;M(oe)&&!oe.isMongooseBuffer&&(Z=Z.toObject({transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1})),oe.isMongooseBuffer&&(Z=n.from(Z)),i.mergeClone(I[G],Z)}else I[G]=m(oe,{flattenDecimals:!1})}},i.each=function(I,N){var G,ae=x(I);try{for(ae.s();!(G=ae.n()).done;)N(G.value)}catch(ce){ae.e(ce)}finally{ae.f()}},i.renameObjKey=function(I,N,G){return Object.keys(I).reduce(function(ae,ce){return ce===N?ae[G]=I[N]:ae[ce]=I[ce],ae},{})},i.getOption=function(I){var N,G=x(Array.prototype.slice.call(arguments,1));try{for(G.s();!(N=G.n()).done;){var ae=N.value;if(ae!=null&&ae[I]!=null)return ae[I]}}catch(ce){G.e(ce)}finally{G.f()}return null},i.noop=function(){},i.errorToPOJO=function(I){if(!(I instanceof Error))throw new Error("`error` must be `instanceof Error`.");var N,G={},ae=x(Object.getOwnPropertyNames(I));try{for(ae.s();!(N=ae.n()).done;){var ce=N.value;G[ce]=I[ce]}}catch(Se){ae.e(Se)}finally{ae.f()}return G},i.warn=function(I){return{env:{}}.emitWarning(I,{code:"MONGOOSE"})},i.injectTimestampsOption=function(I,N){N!=null&&(I.timestamps=N)}},8863:(a,i,t)=>{"use strict";var n=t(2354),c=t(2268),b=t(3123),x=t(5477);a.exports=function(w){if(w.length<1||typeof w[0]!="function")throw new c("a function is required");return x(n,b,w)}},8866:(a,i,t)=>{"use strict";function n(_){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},n(_)}function c(_,p){for(var m=0;m<p.length;m++){var y=p[m];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(_,b(y.key),y)}}function b(_){var p=function(m){if(n(m)!="object"||!m)return m;var y=m[Symbol.toPrimitive];if(y!==void 0){var k=y.call(m,"string");if(n(k)!="object")return k;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(m)}(_);return n(p)=="symbol"?p:p+""}function x(){try{var _=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(x=function(){return!!_})()}function w(){return w=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(_,p,m){var y=function(v,D){for(;!{}.hasOwnProperty.call(v,D)&&(v=g(v))!==null;);return v}(_,p);if(y){var k=Object.getOwnPropertyDescriptor(y,p);return k.get?k.get.call(arguments.length<3?_:m):k.value}},w.apply(null,arguments)}function g(_){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(p){return p.__proto__||Object.getPrototypeOf(p)},g(_)}function o(_,p){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,y){return m.__proto__=y,m},o(_,p)}var u=t(6974),h=t(6426),l=Symbol("firstValue"),d=function(_){function p(k,v){var D,j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(function(S,A){if(!(S instanceof A))throw new TypeError("Cannot call a class as a function")}(this,p),D=function(S,A,M){return A=g(A),function(V,K){if(K&&(n(K)=="object"||typeof K=="function"))return K;if(K!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(H){if(H===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return H}(V)}(S,x()?Reflect.construct(A,M||[],g(S).constructor):A.apply(S,M))}(this,p,[k,v,"Union"]),!v||!Array.isArray(v.of)||v.of.length===0)throw new Error("Union schema type requires an array of types");return D.schemaTypes=v.of.map(function(S){return v.parentSchema.interpretAsType(k,S,j)}),D}return function(k,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function");k.prototype=Object.create(v&&v.prototype,{constructor:{value:k,writable:!0,configurable:!0}}),Object.defineProperty(k,"prototype",{writable:!1}),v&&o(k,v)}(p,_),m=p,y=[{key:"cast",value:function(k,v,D,j,S){for(var A,M=l,V=0;V<this.schemaTypes.length;++V)try{var K=this.schemaTypes[V].cast(k,v,D,j,S);if(K===k)return K;M===l&&(M=K)}catch(H){A=H}if(M!==l)return M;throw A}},{key:"applySetters",value:function(k,v,D,j,S){for(var A,M=l,V=0;V<this.schemaTypes.length;++V)try{var K=this.schemaTypes[V]._applySetters(k,v,D,j,S);if((K=K==null?this.schemaTypes[V]._castNullish(K):this.schemaTypes[V].cast(K,v,D,j,S))===k)return K;M===l&&(M=K)}catch(H){A=H}if(M!==l)return M;throw A}},{key:"clone",value:function(){var k,v,D,j=(k=p,v=this,typeof(D=w(g(k.prototype),"clone",v))=="function"?function(S){return D.apply(v,S)}:D)([]);return j.schemaTypes=this.schemaTypes.map(function(S){return S.clone()}),j}}],y&&c(m.prototype,y),Object.defineProperty(m,"prototype",{writable:!1}),m;var m,y}(h);d.schemaName="Union",d.defaultOptions={},d.prototype.OptionsConstructor=u,a.exports=d},8879:(a,i,t)=>{"use strict";function n(u){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},n(u)}function c(u,h){for(var l=0;l<h.length;l++){var d=h[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(u,x(d.key),d)}}function b(u,h,l){return h&&c(u.prototype,h),l&&c(u,l),Object.defineProperty(u,"prototype",{writable:!1}),u}function x(u){var h=function(l){if(n(l)!="object"||!l)return l;var d=l[Symbol.toPrimitive];if(d!==void 0){var _=d.call(l,"string");if(n(_)!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(u);return n(h)=="symbol"?h:h+""}var w=t(4450),g=b(function u(h){if(function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,u),h==null)return this;Object.assign(this,w(h))}),o=t(5761);Object.defineProperty(g.prototype,"type",o),Object.defineProperty(g.prototype,"validate",o),Object.defineProperty(g.prototype,"cast",o),Object.defineProperty(g.prototype,"required",o),Object.defineProperty(g.prototype,"default",o),Object.defineProperty(g.prototype,"ref",o),Object.defineProperty(g.prototype,"refPath",o),Object.defineProperty(g.prototype,"select",o),Object.defineProperty(g.prototype,"index",o),Object.defineProperty(g.prototype,"unique",o),Object.defineProperty(g.prototype,"immutable",o),Object.defineProperty(g.prototype,"sparse",o),Object.defineProperty(g.prototype,"text",o),Object.defineProperty(g.prototype,"transform",o),a.exports=g},8920:(a,i,t)=>{"use strict";var n=t(5832).hp;function c(W){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function($){return typeof $}:function($){return $&&typeof Symbol=="function"&&$.constructor===Symbol&&$!==Symbol.prototype?"symbol":typeof $},c(W)}function b(W,$){var C=typeof Symbol<"u"&&W[Symbol.iterator]||W["@@iterator"];if(!C){if(Array.isArray(W)||(C=x(W))||$&&W&&typeof W.length=="number"){C&&(W=C);var J=0,F=function(){};return{s:F,n:function(){return J>=W.length?{done:!0}:{done:!1,value:W[J++]}},e:function(ae){throw ae},f:F}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var I,N=!0,G=!1;return{s:function(){C=C.call(W)},n:function(){var ae=C.next();return N=ae.done,ae},e:function(ae){G=!0,I=ae},f:function(){try{N||C.return==null||C.return()}finally{if(G)throw I}}}}function x(W,$){if(W){if(typeof W=="string")return w(W,$);var C={}.toString.call(W).slice(8,-1);return C==="Object"&&W.constructor&&(C=W.constructor.name),C==="Map"||C==="Set"?Array.from(W):C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C)?w(W,$):void 0}}function w(W,$){($==null||$>W.length)&&($=W.length);for(var C=0,J=Array($);C<$;C++)J[C]=W[C];return J}var g=t(2400),o=t(6547),u=t(8213),h=t(4473),l=t(4450),d=t(3303)._,_=t(5678),p=t(8768),m=t(3305),y=t(7930).arrayAtomicsSymbol,k=t(7930).arrayParentSymbol,v=t(7930).arrayPathSymbol,D=t(7930).arraySchemaSymbol,j=t(7930).populateModelSymbol,S=Symbol("mongoose#Array#sliced"),A=Array.prototype.push,M={$__getAtomics:function(){var W=[],$=Object.keys(this[y]||{}),C=$.length,J=Object.assign({},d,{_isNested:!0});if(C===0)return W[0]=["$set",this.toObject(J)],W;for(;C--;){var F=$[C],I=this[y][F];p.isMongooseObject(I)?I=I.toObject(J):Array.isArray(I)?I=this.toObject.call(I,J):I!=null&&Array.isArray(I.$each)?I.$each=this.toObject.call(I.$each,J):I!=null&&typeof I.valueOf=="function"&&(I=I.valueOf()),F==="$addToSet"&&(I={$each:I}),W.push([F,I])}return W},$atomics:function(){return this[y]},$parent:function(){return this[k]},$path:function(){return this[v]},$schemaType:function(){return this[D]},$shift:function(){this._registerAtomic("$pop",-1),this._markModified();var W=this.__array;if(!W._shifted)return W._shifted=!0,[].shift.call(W)},$pop:function(){if(this._registerAtomic("$pop",1),this._markModified(),!this._popped)return this._popped=!0,[].pop.call(this)},$schema:function(){return this[D]},_cast:function(W){var $,C=!1,J=this[k];if(J&&(C=J.$populated(this[v],!0)),C&&W!=null){if(($=C.options[j])==null)throw new u("No populated model found for path `"+this[v]+"`. This is likely a bug in Mongoose, please report an issue on github.com/Automattic/mongoose.");return(n.isBuffer(W)||m(W,"ObjectId")||!p.isObject(W))&&(W={_id:W}),W.schema&&W.schema.discriminatorMapping&&W.schema.discriminatorMapping.key!==void 0||(W=new $(W)),this[D].caster.applySetters(W,J,!0)}return this[D].caster.applySetters(W,J,!1)},_mapCast:function(W,$){return this._cast(W,this.length+$)},_markModified:function(W){var $,C=this[k];if(C){if($=this[v],arguments.length&&($=$+"."+W),$!=null&&$.endsWith(".$"))return this;C.markModified($,arguments.length!==0?W:C)}return this},_registerAtomic:function(W,$){if(!this[S]){if(W==="$set")return this[y]={$set:$},h(this[k],this[v]),this._markModified(),this;var C,J=this[y];if(W==="$pop"&&!("$pop"in J)){var F=this;this[k].once("save",function(){F._popped=F._shifted=null})}if(J.$set||Object.keys(J).length&&!(W in J))return this[y]={$set:this},this;if(W==="$pullAll"||W==="$addToSet")J[W]||(J[W]=[]),J[W]=J[W].concat($);else if(W==="$pullDocs"){var I=J.$pull||(J.$pull={});$[0]instanceof o?(C=I.$or||(I.$or=[]),Array.prototype.push.apply(C,$.map(function(oe){return oe.toObject({transform:function(Z,he){return oe==null||oe.$__==null||Object.keys(oe.$__.activePaths.getStatePaths("default")).forEach(function(E){_.unset(E,he),V(he,E)}),he},virtuals:!1})}))):(C=I._id||(I._id={$in:[]})).$in=C.$in.concat($)}else if(W==="$push")if(J.$push=J.$push||{$each:[]},$!=null&&p.hasUserDefinedProperty($,"$each"))J.$push=$;else if($.length===1)J.$push.$each.push($[0]);else if($.length<1e4){var N;(N=J.$push.$each).push.apply(N,function(oe){if(Array.isArray(oe))return w(oe)}(Se=$)||function(oe){if(typeof Symbol<"u"&&oe[Symbol.iterator]!=null||oe["@@iterator"]!=null)return Array.from(oe)}(Se)||x(Se)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}())}else{var G,ae=b($);try{for(ae.s();!(G=ae.n()).done;){var ce=G.value;J.$push.$each.push(ce)}}catch(oe){ae.e(oe)}finally{ae.f()}}else J[W]=$;return this}var Se},addToSet:function(){K(this,arguments),H(this,arguments);var W=[].map.call(arguments,this._mapCast,this),$=[],C="";W[0]instanceof o?C="doc":W[0]instanceof Date?C="date":m(W[0],"ObjectId")&&(C="ObjectId");var J=p.isMongooseArray(W)?W.__array:W,F=p.isMongooseArray(this)?this.__array:this;return J.forEach(function(I){var N,G=+I;switch(C){case"doc":N=this.some(function(ae){return ae.equals(I)});break;case"date":N=this.some(function(ae){return+ae===G});break;case"ObjectId":N=this.find(function(ae){return ae.toString()===I.toString()});break;default:N=~this.indexOf(I)}N||(this._markModified(),F.push(I),this._registerAtomic("$addToSet",I),[].push.call($,I))},this),$},hasAtomics:function(){return p.isPOJO(this[y])?Object.keys(this[y]).length:0},includes:function(W,$){return this.indexOf(W,$)!==-1},indexOf:function(W,$){m(W,"ObjectId")&&(W=W.toString()),$=$??0;for(var C=this.length,J=$;J<C;++J)if(W==this[J])return J;return-1},inspect:function(){return JSON.stringify(this)},nonAtomicPush:function(){var W=[].map.call(arguments,this._mapCast,this);this._markModified();var $=[].push.apply(this,W);return this._registerAtomic("$set",this),$},pop:function(){this._markModified();var W=[].pop.call(this);return this._registerAtomic("$set",this),W},pull:function(){var W=this,$=[].map.call(arguments,function(I,N){return W._cast(I,N,{defaults:!1})},this),C=this;p.isMongooseArray(C)&&(C=C.__array);var J,F=C.length;for(this._markModified();F--;)(J=C[F])instanceof g?$.some(function(I){return J.equals(I)})&&C.splice(F,1):~this.indexOf.call($,J)&&C.splice(F,1);return $[0]instanceof o?this._registerAtomic("$pullDocs",$.map(function(I){var N=I.$__getValue("_id");return N===void 0||I.$isDefault("_id")?I:N})):this._registerAtomic("$pullAll",$),h(this[k],this[v])>0&&this._registerAtomic("$set",this),this},push:function(){var W,$=arguments,C=$,J=$[0]!=null&&p.hasUserDefinedProperty($[0],"$each"),F=p.isMongooseArray(this)?this.__array:this;if(J&&(C=$[0],$=$[0].$each),this[D]==null)return A.apply(this,$);K(this,$),H(this,$),$=[].map.call($,this._mapCast,this);var I=this[y];return this._markModified(),J?(C.$each=$,(I.$push&&I.$push.$each&&I.$push.$each.length||0)!==0&&I.$push.$position!=C.$position?(C.$position!=null?([].splice.apply(F,[C.$position,0].concat($)),W=F.length):W=[].push.apply(F,$),this._registerAtomic("$set",this)):C.$position!=null?([].splice.apply(F,[C.$position,0].concat($)),W=this.length):W=[].push.apply(F,$)):(C=$,W=A.apply(F,$)),this._registerAtomic("$push",C),W},remove:function(){return this.pull.apply(this,arguments)},set:function(W,$,C){var J=this.__array;if(C)return J[W]=$,this;var F=M._cast.call(this,$,W);return M._markModified.call(this,W),J[W]=F,this},shift:function(){var W=p.isMongooseArray(this)?this.__array:this;this._markModified();var $=[].shift.call(W);return this._registerAtomic("$set",this),$},sort:function(){var W=p.isMongooseArray(this)?this.__array:this,$=[].sort.apply(W,arguments);return this._registerAtomic("$set",this),$},splice:function(){var W,$=p.isMongooseArray(this)?this.__array:this;if(this._markModified(),K(this,Array.prototype.slice.call(arguments,2)),arguments.length){var C;if(this[D]==null)C=arguments;else{C=[];for(var J=0;J<arguments.length;++J)C[J]=J<2?arguments[J]:this._cast(arguments[J],arguments[0]+(J-2))}W=[].splice.apply($,C),this._registerAtomic("$set",this)}return W},toBSON:function(){return this.toObject(d)},toObject:function(W){var $=p.isMongooseArray(this)?this.__array:this;return W&&W.depopulate?((W=l(W))._isNested=!0,[].concat($).map(function(C){return C instanceof g?C.toObject(W):C})):[].concat($)},$toObject:function(){return this.constructor.prototype.toObject.apply(this,arguments)},unshift:function(){var W;K(this,arguments),W=this[D]==null?arguments:[].map.call(arguments,this._cast,this);var $=p.isMongooseArray(this)?this.__array:this;return this._markModified(),[].unshift.apply($,W),this._registerAtomic("$set",this),this.length}};function V(W,$,C){if(typeof $=="string"){if($.indexOf(".")===-1)return;$=_.stringToParts($)}(C=C||0)>=$.length||W!=null&&c(W)==="object"&&(V(W[$[0]],$,C+1),W[$[0]]!=null&&c(W[$[0]])==="object"&&Object.keys(W[$[0]]).length===0&&delete W[$[0]])}function K(W,$){var C,J,F,I=W==null?null:W[D]&&W[D].caster&&W[D].caster.options&&W[D].caster.options.ref||null;W.length===0&&$.length!==0&&function(N,G){if(!G)return!1;var ae,ce=b(N);try{for(ce.s();!(ae=ce.n()).done;){var Se=ae.value;if(Se==null)return!1;var oe=Se.constructor;if(!(Se instanceof g)||oe.modelName!==G&&oe.baseModelName!==G)return!1}}catch(Z){ce.e(Z)}finally{ce.f()}return!0}($,I)&&W[k].$populated(W[v],[],(C={},J=j,F=$[0].constructor,(J=function(N){var G=function(ae){if(c(ae)!="object"||!ae)return ae;var ce=ae[Symbol.toPrimitive];if(ce!==void 0){var Se=ce.call(ae,"string");if(c(Se)!="object")return Se;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(ae)}(N);return c(G)=="symbol"?G:G+""}(J))in C?Object.defineProperty(C,J,{value:F,enumerable:!0,configurable:!0,writable:!0}):C[J]=F,C))}function H(W,$){var C=W==null?null:W[D]&&W[D].caster&&W[D].caster.options&&W[D].caster.options.ref||null,J=W[k],F=W[v];if(C&&J.populated(F)){var I,N=b($);try{for(N.s();!(I=N.n()).done;){var G=I.value;if(G!=null&&(c(G)!=="object"||G instanceof String||G instanceof Number||G instanceof n||p.isMongooseType(G))){J.depopulate(F);break}}}catch(ae){N.e(ae)}finally{N.f()}}}for(var Q=function(){var W=ue[re];if(Array.prototype[W]==null)return 1;M[W]=function(){var $=p.isMongooseArray(this)?this.__array:this,C=[].concat($);return C[W].apply(C,arguments)}},re=0,ue=["filter","flat","flatMap","map","slice"];re<ue.length;re++)Q();a.exports=M},8953:(a,i,t)=>{"use strict";var n=t(3609);a.exports=function(c,b){if(a.exports.convertToTrue.has(c))return!0;if(a.exports.convertToFalse.has(c))return!1;if(c==null)return c;throw new n("boolean",c,b)},a.exports.convertToTrue=new Set([!0,"true",1,"1","yes"]),a.exports.convertToFalse=new Set([!1,"false",0,"0","no"])},8995:(a,i,t)=>{"use strict";function n(g){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},n(g)}function c(){try{var g=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!g})()}function b(g){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},b(g)}function x(g,o){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},x(g,o)}var w=function(g){function o(h,l,d){var _;return function(p,m){if(!(p instanceof m))throw new TypeError("Cannot call a class as a function")}(this,o),(_=function(p,m,y){return m=b(m),function(k,v){if(v&&(n(v)=="object"||typeof v=="function"))return v;if(v!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(D){if(D===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}(k)}(p,c()?Reflect.construct(m,y||[],b(p).constructor):m.apply(p,y))}(this,o,[l=l||"Field `"+h+"` is not in schema and strict mode is set to throw."])).isImmutableError=!!d,_.path=h,_}return function(h,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(l&&l.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),l&&x(h,l)}(o,g),u=o,Object.defineProperty(u,"prototype",{writable:!1}),u;var u}(t(8213));Object.defineProperty(w.prototype,"name",{value:"StrictModeError"}),a.exports=w},9064:(a,i,t)=>{"use strict";function n(w){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},n(w)}var c=t(3609),b=t(8953),x=t(1244);a.exports=function(w,g){if(w==null||n(w)!=="object")throw new c("$text",w,g);return w.$search!=null&&(w.$search=x(w.$search,g+".$search")),w.$language!=null&&(w.$language=x(w.$language,g+".$language")),w.$caseSensitive!=null&&(w.$caseSensitive=b(w.$caseSensitive,g+".$castSensitive")),w.$diacriticSensitive!=null&&(w.$diacriticSensitive=b(w.$diacriticSensitive,g+".$diacriticSensitive")),w}},9068:(a,i,t)=>{"use strict";function n(M){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(V){return typeof V}:function(V){return V&&typeof Symbol=="function"&&V.constructor===Symbol&&V!==Symbol.prototype?"symbol":typeof V},n(M)}function c(M,V,K){return V in M?Object.defineProperty(M,V,{value:K,enumerable:!0,configurable:!0,writable:!0}):M[V]=K,M}function b(M,V){for(var K=0;K<V.length;K++){var H=V[K];H.enumerable=H.enumerable||!1,H.configurable=!0,"value"in H&&(H.writable=!0),Object.defineProperty(M,H.key,H)}}function x(M,V){return!V||l(V)!=="object"&&typeof V!="function"?w(M):V}function w(M){if(M===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M}function g(M){var V=typeof Map=="function"?new Map:void 0;return g=function(K){if(K===null||(H=K,Function.toString.call(H).indexOf("[native code]")===-1))return K;var H;if(typeof K!="function")throw new TypeError("Super expression must either be null or a function");if(V!==void 0){if(V.has(K))return V.get(K);V.set(K,Q)}function Q(){return o(K,arguments,h(this).constructor)}return Q.prototype=Object.create(K.prototype,{constructor:{value:Q,enumerable:!1,writable:!0,configurable:!0}}),u(Q,K)},g(M)}function o(M,V,K){return o=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}()?Reflect.construct:function(H,Q,re){var ue=[null];ue.push.apply(ue,Q);var W=new(Function.bind.apply(H,ue));return re&&u(W,re.prototype),W},o.apply(null,arguments)}function u(M,V){return u=Object.setPrototypeOf||function(K,H){return K.__proto__=H,K},u(M,V)}function h(M){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(V){return V.__proto__||Object.getPrototypeOf(V)},h(M)}function l(M){return l=typeof Symbol=="function"&&n(Symbol.iterator)==="symbol"?function(V){return n(V)}:function(V){return V&&typeof Symbol=="function"&&V.constructor===Symbol&&V!==Symbol.prototype?"symbol":n(V)},l(M)}var d=t(7352).inspect,_=t(3743).codes.ERR_INVALID_ARG_TYPE;function p(M,V,K){return(K===void 0||K>M.length)&&(K=M.length),M.substring(K-V.length,K)===V}var m="",y="",k="",v="",D={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"};function j(M){var V=Object.keys(M),K=Object.create(Object.getPrototypeOf(M));return V.forEach(function(H){K[H]=M[H]}),Object.defineProperty(K,"message",{value:M.message}),K}function S(M){return d(M,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}var A=function(M){function V(Q){var re;if(function(Se,oe){if(!(Se instanceof oe))throw new TypeError("Cannot call a class as a function")}(this,V),l(Q)!=="object"||Q===null)throw new _("options","Object",Q);var ue=Q.message,W=Q.operator,$=Q.stackStartFn,C=Q.actual,J=Q.expected,F=Error.stackTraceLimit;if(Error.stackTraceLimit=0,ue!=null)re=x(this,h(V).call(this,String(ue)));else if({env:{}}.stderr&&{env:{}}.stderr.isTTY&&({env:{}}.stderr&&{env:{}}.stderr.getColorDepth&&{env:{}}.stderr.getColorDepth()!==1?(m="\x1B[34m",y="\x1B[32m",v="\x1B[39m",k="\x1B[31m"):(m="",y="",v="",k="")),l(C)==="object"&&C!==null&&l(J)==="object"&&J!==null&&"stack"in C&&C instanceof Error&&"stack"in J&&J instanceof Error&&(C=j(C),J=j(J)),W==="deepStrictEqual"||W==="strictEqual")re=x(this,h(V).call(this,function(Se,oe,Z){var he="",E="",z=0,X="",de=!1,q=S(Se),B=q.split(`
`),te=S(oe).split(`
`),T=0,Y="";if(Z==="strictEqual"&&l(Se)==="object"&&l(oe)==="object"&&Se!==null&&oe!==null&&(Z="strictEqualObject"),B.length===1&&te.length===1&&B[0]!==te[0]){var ie=B[0].length+te[0].length;if(ie<=10){if(!(l(Se)==="object"&&Se!==null||l(oe)==="object"&&oe!==null||Se===0&&oe===0))return"".concat(D[Z],`

`)+"".concat(B[0]," !== ").concat(te[0],`
`)}else if(Z!=="strictEqualObject"&&ie<({env:{}}.stderr&&{env:{}}.stderr.isTTY?{env:{}}.stderr.columns:80)){for(;B[0][T]===te[0][T];)T++;T>2&&(Y=`
  `.concat(function(wt,ft){if(ft=Math.floor(ft),wt.length==0||ft==0)return"";var fr=wt.length*ft;for(ft=Math.floor(Math.log(ft)/Math.log(2));ft;)wt+=wt,ft--;return wt+wt.substring(0,fr-wt.length)}(" ",T),"^"),T=0)}}for(var me=B[B.length-1],ne=te[te.length-1];me===ne&&(T++<2?X=`
  `.concat(me).concat(X):he=me,B.pop(),te.pop(),B.length!==0&&te.length!==0);)me=B[B.length-1],ne=te[te.length-1];var ye=Math.max(B.length,te.length);if(ye===0){var Re=q.split(`
`);if(Re.length>30)for(Re[26]="".concat(m,"...").concat(v);Re.length>27;)Re.pop();return"".concat(D.notIdentical,`

`).concat(Re.join(`
`),`
`)}T>3&&(X=`
`.concat(m,"...").concat(v).concat(X),de=!0),he!==""&&(X=`
  `.concat(he).concat(X),he="");var Ie=0,je=D[Z]+`
`.concat(y,"+ actual").concat(v," ").concat(k,"- expected").concat(v),Be=" ".concat(m,"...").concat(v," Lines skipped");for(T=0;T<ye;T++){var Me=T-z;if(B.length<T+1)Me>1&&T>2&&(Me>4?(E+=`
`.concat(m,"...").concat(v),de=!0):Me>3&&(E+=`
  `.concat(te[T-2]),Ie++),E+=`
  `.concat(te[T-1]),Ie++),z=T,he+=`
`.concat(k,"-").concat(v," ").concat(te[T]),Ie++;else if(te.length<T+1)Me>1&&T>2&&(Me>4?(E+=`
`.concat(m,"...").concat(v),de=!0):Me>3&&(E+=`
  `.concat(B[T-2]),Ie++),E+=`
  `.concat(B[T-1]),Ie++),z=T,E+=`
`.concat(y,"+").concat(v," ").concat(B[T]),Ie++;else{var qe=te[T],vt=B[T],jt=vt!==qe&&(!p(vt,",")||vt.slice(0,-1)!==qe);jt&&p(qe,",")&&qe.slice(0,-1)===vt&&(jt=!1,vt+=","),jt?(Me>1&&T>2&&(Me>4?(E+=`
`.concat(m,"...").concat(v),de=!0):Me>3&&(E+=`
  `.concat(B[T-2]),Ie++),E+=`
  `.concat(B[T-1]),Ie++),z=T,E+=`
`.concat(y,"+").concat(v," ").concat(vt),he+=`
`.concat(k,"-").concat(v," ").concat(qe),Ie+=2):(E+=he,he="",Me!==1&&T!==0||(E+=`
  `.concat(vt),Ie++))}if(Ie>20&&T<ye-2)return"".concat(je).concat(Be,`
`).concat(E,`
`).concat(m,"...").concat(v).concat(he,`
`)+"".concat(m,"...").concat(v)}return"".concat(je).concat(de?Be:"",`
`).concat(E).concat(he).concat(X).concat(Y)}(C,J,W)));else if(W==="notDeepStrictEqual"||W==="notStrictEqual"){var I=D[W],N=S(C).split(`
`);if(W==="notStrictEqual"&&l(C)==="object"&&C!==null&&(I=D.notStrictEqualObject),N.length>30)for(N[26]="".concat(m,"...").concat(v);N.length>27;)N.pop();re=N.length===1?x(this,h(V).call(this,"".concat(I," ").concat(N[0]))):x(this,h(V).call(this,"".concat(I,`

`).concat(N.join(`
`),`
`)))}else{var G=S(C),ae="",ce=D[W];W==="notDeepEqual"||W==="notEqual"?(G="".concat(D[W],`

`).concat(G)).length>1024&&(G="".concat(G.slice(0,1021),"...")):(ae="".concat(S(J)),G.length>512&&(G="".concat(G.slice(0,509),"...")),ae.length>512&&(ae="".concat(ae.slice(0,509),"...")),W==="deepEqual"||W==="equal"?G="".concat(ce,`

`).concat(G,`

should equal

`):ae=" ".concat(W," ").concat(ae)),re=x(this,h(V).call(this,"".concat(G).concat(ae)))}return Error.stackTraceLimit=F,re.generatedMessage=!ue,Object.defineProperty(w(re),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),re.code="ERR_ASSERTION",re.actual=C,re.expected=J,re.operator=W,Error.captureStackTrace&&Error.captureStackTrace(w(re),$),re.stack,re.name="AssertionError",x(re)}var K,H;return function(Q,re){if(typeof re!="function"&&re!==null)throw new TypeError("Super expression must either be null or a function");Q.prototype=Object.create(re&&re.prototype,{constructor:{value:Q,writable:!0,configurable:!0}}),re&&u(Q,re)}(V,M),K=V,H=[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:d.custom,value:function(Q,re){return d(this,function(ue){for(var W=1;W<arguments.length;W++){var $=arguments[W]!=null?arguments[W]:{},C=Object.keys($);typeof Object.getOwnPropertySymbols=="function"&&(C=C.concat(Object.getOwnPropertySymbols($).filter(function(J){return Object.getOwnPropertyDescriptor($,J).enumerable}))),C.forEach(function(J){c(ue,J,$[J])})}return ue}({},re,{customInspect:!1,depth:0}))}}],H&&b(K.prototype,H),V}(g(Error));a.exports=A},9122:(a,i,t)=>{"use strict";var n=t(3900),c=t(988),b=t(8863),x=t(5804);a.exports=function(w){var g=b(arguments),o=w.length-(arguments.length-1);return n(g,1+(o>0?o:0),!0)},c?c(a.exports,"apply",{value:x}):a.exports.apply=x},9123:(a,i,t)=>{"use strict";function n($){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},n($)}function c($,C){var J=Object.keys($);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols($);C&&(F=F.filter(function(I){return Object.getOwnPropertyDescriptor($,I).enumerable})),J.push.apply(J,F)}return J}function b($){for(var C=1;C<arguments.length;C++){var J=arguments[C]!=null?arguments[C]:{};C%2?c(Object(J),!0).forEach(function(F){x($,F,J[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(J)):c(Object(J)).forEach(function(F){Object.defineProperty($,F,Object.getOwnPropertyDescriptor(J,F))})}return $}function x($,C,J){return(C=function(F){var I=function(N){if(n(N)!="object"||!N)return N;var G=N[Symbol.toPrimitive];if(G!==void 0){var ae=G.call(N,"string");if(n(ae)!="object")return ae;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(N)}(F);return n(I)=="symbol"?I:I+""}(C))in $?Object.defineProperty($,C,{value:J,enumerable:!0,configurable:!0,writable:!0}):$[C]=J,$}var w,g,o=t(3609),u=t(8235),h=t(3550).EventEmitter,l=t(7760),d=t(4561),_=t(6426),p=t(7982),m=t(4327),y=t(1469),k=t(1313),v=t(3216),D=t(5110),j=t(8768),S=t(7910),A=t(5537),M=t(7930).arrayAtomicsSymbol,V=t(7930).arrayPathSymbol,K=t(7930).documentArrayParent;function H($,C,J,F){if(C.options&&C.options.timeseries)throw new A($,"timeseries");var I=H.defaultOptions&&H.defaultOptions._id;I!=null&&((F=F||{})._id=I),F!=null&&F._id!=null?C=k(C,F):J!=null&&J._id!=null&&(C=k(C,J));var N=Q(C,J);N.prototype.$basePath=$,l.call(this,$,N,J),this.schema=C,this.schemaOptions=F||{},this.$isMongooseDocumentArray=!0,this.Constructor=N,N.base=C.base;var G=this.defaultValue;"defaultValue"in this&&G==null||this.default(function(){var ae=G.call(this);return ae==null||Array.isArray(ae)||(ae=[ae]),ae}),this.$embeddedSchemaType=new u($+".$",b(b({},F||{}),{},{$parentSchemaType:this})),this.$embeddedSchemaType.caster=this.Constructor,this.$embeddedSchemaType.schema=this.schema}function Q($,C,J){function F(){g.apply(this,arguments),this.__parentArray!=null&&this.__parentArray.getArrayParent()!=null&&this.$session(this.__parentArray.getArrayParent().$session())}g||(g=t(6547)),$._preCompile();var I=J!=null?J.prototype:g.prototype;for(var N in F.prototype=Object.create(I),F.prototype.$__setSchema($),F.schema=$,F.prototype.constructor=F,F.$isArraySubdocument=!0,F.events=new h,F.base=$.base,$.methods)F.prototype[N]=$.methods[N];for(var G in $.statics)F[G]=$.statics[G];for(var ae in h.prototype)F[ae]=h.prototype[ae];return F.options=C,F}H.schemaName="DocumentArray",H.options={castNonArrays:!0},H.prototype=Object.create(l.prototype),H.prototype.constructor=H,H.prototype.OptionsConstructor=d,Object.defineProperty(H.prototype,"$conditionalHandlers",{enumerable:!1,value:b({},l.prototype.$conditionalHandlers)}),H.prototype.discriminator=function($,C,J){var F;typeof $=="function"&&($=j.getFunctionName($)),J=J||{};var I=j.isPOJO(J)?J.value:J,N=typeof J.clone!="boolean"||J.clone;C.instanceOfSchema&&N&&(C=C.clone());var G=Q(C=y(this.casterConstructor,$,C,I,null,null,(F=J)===null||F===void 0?void 0:F.overwriteExisting),null,this.casterConstructor);G.baseCasterConstructor=this.casterConstructor;try{Object.defineProperty(G,"name",{value:$})}catch{}return this.casterConstructor.discriminators[$]=G,this.casterConstructor.discriminators[$]},H.prototype.doValidate=function($,C,J,F){w||(w=t(4878));var I=this;try{_.prototype.doValidate.call(this,$,function(N){if(N)return C(N);var G,ae=$&&$.length;if(!ae||F&&F.updateValidator)return C();function ce(E){E!=null&&(G=E),--ae||C(G)}j.isMongooseDocumentArray($)||($=new w($,I.path,J));for(var Se=0,oe=ae;Se<oe;++Se){var Z=$[Se];if(Z!=null){if(!(Z instanceof g)){var he=S(I.casterConstructor,$[Se]);Z=$[Se]=new he(Z,$,void 0,void 0,Se)}F==null||!F.validateModifiedOnly||Z.$isModified()?Z.$__validate(null,F,ce):--ae||C(G)}else--ae||C(G)}},J)}catch(N){return C(N)}},H.prototype.doValidateSync=function($,C,J){var F=_.prototype.doValidateSync.call(this,$,C);if(F!=null)return F;var I=$&&$.length,N=null;if(I){for(var G=0,ae=I;G<ae;++G){var ce=$[G];if(ce){if(!(ce instanceof g)){var Se=S(this.casterConstructor,$[G]);ce=$[G]=new Se(ce,$,void 0,void 0,G)}if(J==null||!J.validateModifiedOnly||ce.$isModified()){var oe=ce.validateSync(J);oe&&N==null&&(N=oe)}}}return N}},H.prototype.getDefault=function($,C,J){var F=typeof this.defaultValue=="function"?this.defaultValue.call($):this.defaultValue;if(F==null||J&&J.skipCast)return F;w||(w=t(4878)),Array.isArray(F)||(F=[F]),F=new w(F,this.path,$);for(var I=0;I<F.length;++I){var N=new(S(this.casterConstructor,F[I]))({},F,void 0,void 0,I);N.$init(F[I]),N.isNew=!0,Object.assign(N.$__.activePaths.default,N.$__.activePaths.init),N.$__.activePaths.init={},F[I]=N}return F};var re=Object.freeze({transform:!1,virtuals:!1}),ue=Object.freeze({skipId:!1,willInit:!0});function W($,C,J){if(J&&C){for(var F,I,N,G=$.path+".",ae=Object.keys(C),ce=ae.length,Se={};ce--;)if((I=ae[ce]).startsWith(G)){if((N=I.substring(G.length))==="$")continue;N.startsWith("$.")&&(N=N.substring(2)),F||(F=!0),Se[N]=C[I]}return F&&Se||void 0}}H.prototype.cast=function($,C,J,F,I){if(w||(w=t(4878)),$!=null&&$[V]!=null&&$===F)return $;var N,G,ae=(I=I||{}).path||this.path;if(!Array.isArray($)){if(!J&&!H.options.castNonArrays)throw new o("DocumentArray",$,this.path,null,this);return C&&J&&C.markModified(ae),this.cast([$],C,J,F,I)}I.skipDocumentArrayCast&&!j.isMongooseDocumentArray($)||($=new w($,ae,C,this)),F!=null&&($[M]=F[M]||{}),I.arrayPathIndex!=null&&($[V]=ae+"."+I.arrayPathIndex);for(var ce=j.isMongooseDocumentArray($)?$.__array:$,Se=ce.length,oe=0;oe<Se;++oe)if(ce[oe]){var Z=S(this.casterConstructor,ce[oe]),he=v(ce[oe],!0);if(ce[oe]!==he&&(ce[oe]=he),ce[oe]instanceof g){if(ce[oe][K]!==C)if(J){var E=new Z(null,$,ue,N,oe);ce[oe]=E.$init(ce[oe])}else{var z=new Z(ce[oe],$,void 0,void 0,oe);ce[oe]=z}ce[oe].__index==null&&ce[oe].$setIndex(oe)}else if(ce[oe]!=null)if(J)C?N||(N=W(this,C.$__.selected,J)):N=!0,G=new Z(null,$,ue,N,oe),ce[oe]=G.$init(ce[oe],I);else if(F&&typeof F.id=="function"&&(G=F.id(ce[oe]._id)),F&&G&&j.deepEqual(G.toObject(re),ce[oe]))G.set(ce[oe]),ce[oe]=G;else try{G=new Z(ce[oe],$,void 0,void 0,oe),ce[oe]=G}catch(X){throw new o("embedded",ce[oe],$[V],X,this)}}return $},H.prototype.clone=function(){var $=Object.assign({},this.options),C=new this.constructor(this.path,this.schema,$,this.schemaOptions);return C.validators=this.validators.slice(),this.requiredValidator!==void 0&&(C.requiredValidator=this.requiredValidator),C.Constructor.discriminators=Object.assign({},this.Constructor.discriminators),C._appliedDiscriminators=this._appliedDiscriminators,C},H.prototype.applyGetters=function($,C){return _.prototype.applyGetters.call(this,$,C)},H.defaultOptions={},H.set=_.set,H.setters=[],H.get=_.get,H.prototype.$conditionalHandlers.$elemMatch=function($,C){for(var J,F=Object.keys($),I=F.length,N=0;N<I;++N){var G=F[N],ae=$[G];D(G)&&ae!=null&&($[G]=this.castForQuery(G,ae,C))}var ce=this&&this.casterConstructor&&this.casterConstructor.schema&&this.casterConstructor.schema.options&&this.casterConstructor.schema.options.discriminatorKey,Se=this&&this.casterConstructor&&this.casterConstructor.schema&&this.casterConstructor.schema.discriminators||{};if(ce!=null&&$[ce]!=null&&Se[$[ce]]!=null)return p(Se[$[ce]],$,null,this&&this.$$context);var oe=(J=this.casterConstructor.schema)!==null&&J!==void 0?J:C.schema;return p(oe,$,null,this&&this.$$context)},H.prototype.toJSONSchema=function($){var C=m("object","object",$?.useBsonType,!1),J=this.options.required&&typeof this.options.required!="function";return b(b({},m("array","array",$?.useBsonType,J)),{},{items:b(b({},C),this.schema.toJSONSchema($))})},a.exports=H},9166:(a,i,t)=>{"use strict";function n(o,u){var h=typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(!h){if(Array.isArray(o)||(h=function(y,k){if(y){if(typeof y=="string")return c(y,k);var v={}.toString.call(y).slice(8,-1);return v==="Object"&&y.constructor&&(v=y.constructor.name),v==="Map"||v==="Set"?Array.from(y):v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v)?c(y,k):void 0}}(o))||u&&o&&typeof o.length=="number"){h&&(o=h);var l=0,d=function(){};return{s:d,n:function(){return l>=o.length?{done:!0}:{done:!1,value:o[l++]}},e:function(y){throw y},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _,p=!0,m=!1;return{s:function(){h=h.call(o)},n:function(){var y=h.next();return p=y.done,y},e:function(y){m=!0,_=y},f:function(){try{p||h.return==null||h.return()}finally{if(m)throw _}}}}function c(o,u){(u==null||u>o.length)&&(u=o.length);for(var h=0,l=Array(u);h<u;h++)l[h]=o[h];return l}var b=t(8759),x=t(3696);function w(o,u,h){if(u!=null){var l=Object.keys(u).some(function(M){return M[0]==="$"});if(l){if(u.$push&&A(u.$push),u.$addToSet&&A(u.$addToSet),u.$set!=null)for(var d=0,_=Object.keys(u.$set);d<_.length;d++){var p=_[d];g(h,p,u.$set,o)}if(u.$setOnInsert!=null)for(var m=0,y=Object.keys(u.$setOnInsert);m<y.length;m++){var k=y[m];g(h,k,u.$setOnInsert,o)}}var v,D=Object.keys(u).filter(function(M){return M[0]!=="$"}),j=n(D);try{for(j.s();!(v=j.n()).done;){var S=v.value;g(h,S,u,o)}}catch(M){j.e(M)}finally{j.f()}}function A(M){for(var V=function(){var Q=H[K],re=h.path(Q.replace(/\.\$\./i,".").replace(/.\$$/,""));if(M[Q]&&re&&re.$isMongooseDocumentArray&&re.schema.options.timestamps){var ue=re.schema.options.timestamps,W=x(ue,"createdAt"),$=x(ue,"updatedAt");M[Q].$each?M[Q].$each.forEach(function(C){$!=null&&(C[$]=o),W!=null&&(C[W]=o),w(o,C,re.schema)}):($!=null&&(M[Q][$]=o),W!=null&&(M[Q][W]=o),w(o,M[Q],re.schema))}},K=0,H=Object.keys(M);K<H.length;K++)V()}}function g(o,u,h,l){var d=b(u),_=o.path(d);if(_){for(var p=[],m=d.split("."),y=m.length-1;y>0;--y){var k=o.path(m.slice(0,y).join("."));k!=null&&(k.$isMongooseDocumentArray||k.$isSingleNested)&&p.push({parentPath:u.split(".").slice(0,y).join("."),parentSchemaType:k})}if(Array.isArray(h[u])&&_.$isMongooseDocumentArray)(function(W,$,C){var J=$.schema.options.timestamps,F=W.length;if(J)for(var I=x(J,"createdAt"),N=x(J,"updatedAt"),G=0;G<F;++G)N!=null&&(W[G][N]=C),I!=null&&(W[G][I]=C),w(C,W[G],$.schema);else for(var ae=0;ae<F;++ae)w(C,W[ae],$.schema)})(h[u],_,l);else if(h[u]&&_.$isSingleNested)(function(W,$,C){var J=$.schema.options.timestamps;if(J){var F=x(J,"createdAt"),I=x(J,"updatedAt");I!=null&&(W[I]=C),F!=null&&(W[F]=C),w(C,W,$.schema)}else w(C,W,$.schema)})(h[u],_,l);else if(p.length>0){var v,D=n(p);try{for(D.s();!(v=D.n()).done;){var j=v.value,S=j.parentPath,A=j.parentSchemaType,M=A.schema.options.timestamps,V=x(M,"updatedAt");if(M&&V!=null){if(A.$isSingleNested)h[S+"."+V]=l;else if(A.$isMongooseDocumentArray){var K=u.substring(S.length+1);if(/^\d+$/.test(K)){h[S+"."+K][V]=l;continue}var H=K.indexOf(".");h[S+"."+(K=H!==-1?K.substring(0,H):K)+"."+V]=l}}}}catch(W){D.e(W)}finally{D.f()}}else if(_.schema!=null&&_.schema!=o&&h[u]){var Q=_.schema.options.timestamps,re=x(Q,"createdAt"),ue=x(Q,"updatedAt");if(!Q)return;ue!=null&&(h[u][ue]=l),re!=null&&(h[u][re]=l)}}}a.exports=w},9183:a=>{"use strict";a.exports=function(i){return typeof i=="function"&&i.constructor&&i.constructor.name==="AsyncFunction"}},9206:a=>{"use strict";a.exports=EvalError},9247:(a,i,t)=>{"use strict";var n=t(2481),c=t(2273);a.exports=function(){var b=n();return c(Object,{is:b},{is:function(){return Object.is!==b}}),b}},9344:(a,i,t)=>{"use strict";function n(_){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},n(_)}var c,b=t(3071),x=t(953)(),w=t(5994),g=t(1464);if(x){var o=b("RegExp.prototype.exec"),u={},h=function(){throw u},l={toString:h,valueOf:h};n(Symbol.toPrimitive)==="symbol"&&(l[Symbol.toPrimitive]=h),c=function(_){if(!_||n(_)!=="object")return!1;var p=g(_,"lastIndex");if(!p||!w(p,"value"))return!1;try{o(_,l)}catch(m){return m===u}}}else{var d=b("Object.prototype.toString");c=function(_){return!(!_||n(_)!=="object"&&typeof _!="function")&&d(_)==="[object RegExp]"}}a.exports=c},9380:(a,i,t)=>{"use strict";function n(){var d,_,p=typeof Symbol=="function"?Symbol:{},m=p.iterator||"@@iterator",y=p.toStringTag||"@@toStringTag";function k(K,H,Q,re){var ue=H&&H.prototype instanceof D?H:D,W=Object.create(ue.prototype);return c(W,"_invoke",function($,C,J){var F,I,N,G=0,ae=J||[],ce=!1,Se={p:0,n:0,v:d,a:oe,f:oe.bind(d,4),d:function(Z,he){return F=Z,I=0,N=d,Se.n=he,v}};function oe(Z,he){for(I=Z,N=he,_=0;!ce&&G&&!E&&_<ae.length;_++){var E,z=ae[_],X=Se.p,de=z[2];Z>3?(E=de===he)&&(N=z[(I=z[4])?5:(I=3,3)],z[4]=z[5]=d):z[0]<=X&&((E=Z<2&&X<z[1])?(I=0,Se.v=he,Se.n=z[1]):X<de&&(E=Z<3||z[0]>he||he>de)&&(z[4]=Z,z[5]=he,Se.n=de,I=0))}if(E||Z>1)return v;throw ce=!0,he}return function(Z,he,E){if(G>1)throw TypeError("Generator is already running");for(ce&&he===1&&oe(he,E),I=he,N=E;(_=I<2?d:N)||!ce;){F||(I?I<3?(I>1&&(Se.n=-1),oe(I,N)):Se.n=N:Se.v=N);try{if(G=2,F){if(I||(Z="next"),_=F[Z]){if(!(_=_.call(F,N)))throw TypeError("iterator result is not an object");if(!_.done)return _;N=_.value,I<2&&(I=0)}else I===1&&(_=F.return)&&_.call(F),I<2&&(N=TypeError("The iterator does not provide a '"+Z+"' method"),I=1);F=d}else if((_=(ce=Se.n<0)?N:$.call(C,Se))!==v)break}catch(z){F=d,I=1,N=z}finally{G=1}}return{value:_,done:ce}}}(K,Q,re),!0),W}var v={};function D(){}function j(){}function S(){}_=Object.getPrototypeOf;var A=[][m]?_(_([][m]())):(c(_={},m,function(){return this}),_),M=S.prototype=D.prototype=Object.create(A);function V(K){return Object.setPrototypeOf?Object.setPrototypeOf(K,S):(K.__proto__=S,c(K,y,"GeneratorFunction")),K.prototype=Object.create(M),K}return j.prototype=S,c(M,"constructor",S),c(S,"constructor",j),j.displayName="GeneratorFunction",c(S,y,"GeneratorFunction"),c(M),c(M,y,"Generator"),c(M,m,function(){return this}),c(M,"toString",function(){return"[object Generator]"}),(n=function(){return{w:k,m:V}})()}function c(d,_,p,m){var y=Object.defineProperty;try{y({},"",{})}catch{y=0}c=function(k,v,D,j){function S(A,M){c(k,A,function(V){return this._invoke(A,M,V)})}v?y?y(k,v,{value:D,enumerable:!j,configurable:!j,writable:!j}):k[v]=D:(S("next",0),S("throw",1),S("return",2))},c(d,_,p,m)}function b(d,_,p,m,y,k,v){try{var D=d[k](v),j=D.value}catch(S){return void p(S)}D.done?_(j):Promise.resolve(j).then(m,y)}function x(d){return x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},x(d)}var w=t(2400),g=t(2746),o=t(3303)._,u=t(7352),h=t(8768);function l(d,_,p,m,y){if(x(m)==="object"&&m!=null&&y==null&&(y=m,m=void 0),p!=null){var k={isNew:p.isNew};"defaults"in p.$__&&(k.defaults=p.$__.defaults),y=Object.assign(k,y)}y!=null&&y.path!=null&&(this.$basePath=y.path),y!=null&&y.pathRelativeToParent!=null&&(this.$pathRelativeToParent=y.pathRelativeToParent);var v=y;y!=null&&y.path!=null&&delete(v=Object.assign({},y)).path,w.call(this,d,_,m,v),delete this.$__.priorDoc}a.exports=l,l.prototype=Object.create(w.prototype),Object.defineProperty(l.prototype,"$isSubdocument",{configurable:!1,writable:!1,value:!0}),Object.defineProperty(l.prototype,"$isSingleNested",{configurable:!1,writable:!1,value:!0}),l.prototype.toBSON=function(){return this.toObject(o)},l.prototype.save=function(){var d,_=(d=n().m(function p(m){var y=this;return n().w(function(k){for(;;)if(k.n===0)return(m=m||{}).suppressWarning||h.warn("mongoose: calling `save()` on a subdoc does **not** save the document to MongoDB, it only runs save middleware. Use `subdoc.save({ suppressWarning: true })` to hide this warning if you're sure this behavior is right for your app."),k.a(2,new Promise(function(v,D){y.$__save(function(j){if(j!=null)return D(j);v(y)})}))},p)}),function(){var p=this,m=arguments;return new Promise(function(y,k){var v=d.apply(p,m);function D(S){b(v,y,k,D,j,"next",S)}function j(S){b(v,y,k,D,j,"throw",S)}D(void 0)})});return function(p){return _.apply(this,arguments)}}(),l.prototype.$__fullPath=function(d){return this.$__.fullPath||this.ownerDocument(),d?this.$__.fullPath+"."+d:this.$__.fullPath},l.prototype.$__pathRelativeToParent=function(d){return this.$pathRelativeToParent!=null?d==null?this.$pathRelativeToParent:this.$pathRelativeToParent+"."+d:d==null?this.$basePath:this.$basePath?[this.$basePath,d].join("."):d},l.prototype.$__save=function(d){var _=this;return g(function(){return d(null,_)})},l.prototype.$isValid=function(d){var _=this.$parent(),p=this.$__pathRelativeToParent(d);return _!=null&&p!=null?_.$isValid(p):w.prototype.$isValid.call(this,d)},l.prototype.markModified=function(d){w.prototype.markModified.call(this,d);var _=this.$parent();if(_!=null){var p=this.$__pathRelativeToParent(d);if(p!=null){var m=this.$__pathRelativeToParent().replace(/\.$/,"");_.isDirectModified(m)||this.isNew||this.$__parent.markModified(p,this)}}},l.prototype.isModified=function(d,_,p){var m=this,y=this.$parent();return y!=null?(Array.isArray(d)||typeof d=="string"?d=(d=Array.isArray(d)?d:d.split(" ")).map(function(k){return m.$__pathRelativeToParent(k)}).filter(function(k){return k!=null}):d||(d=this.$__pathRelativeToParent()),y.$isModified(d,_,p)):w.prototype.isModified.call(this,d,_,p)},l.prototype.$markValid=function(d){w.prototype.$markValid.call(this,d);var _=this.$parent(),p=this.$__pathRelativeToParent(d);_!=null&&p!=null&&_.$markValid(p)},l.prototype.invalidate=function(d,_,p){w.prototype.invalidate.call(this,d,_,p);var m=this.$parent(),y=this.$__pathRelativeToParent(d);if(m!=null&&y!=null)m.invalidate(y,_,p);else if(_.kind==="cast"||_.name==="CastError"||y==null)throw _;return this.ownerDocument().$__.validationError},l.prototype.$ignore=function(d){w.prototype.$ignore.call(this,d);var _=this.$parent(),p=this.$__pathRelativeToParent(d);_!=null&&p!=null&&_.$ignore(p)},l.prototype.ownerDocument=function(){if(this.$__.ownerDocument)return this.$__.ownerDocument;for(var d=this,_=[],p=new Set([d]);typeof d.$__pathRelativeToParent=="function";){_.unshift(d.$__pathRelativeToParent(void 0,!0));var m=d.$parent();if(m==null)break;if(d=m,p.has(d))throw new Error("Infinite subdocument loop: subdoc with _id "+d._id+" is a parent of itself");p.add(d)}return this.$__.fullPath=_.join("."),this.$__.ownerDocument=d,this.$__.ownerDocument},l.prototype.$__fullPathWithIndexes=function(){for(var d=this,_=[],p=new Set([d]);typeof d.$__pathRelativeToParent=="function";){_.unshift(d.$__pathRelativeToParent(void 0,!1));var m=d.$parent();if(m==null)break;if(d=m,p.has(d))throw new Error("Infinite subdocument loop: subdoc with _id "+d._id+" is a parent of itself");p.add(d)}return _.join(".")},l.prototype.parent=function(){return this.$__parent},l.prototype.$parent=l.prototype.parent,l.prototype.$__deleteOne=function(d){if(d!=null)return d(null,this)},l.prototype.$__removeFromParent=function(){this.$__parent.set(this.$basePath,null)},l.prototype.deleteOne=function(d,_){if(typeof d=="function"&&(_=d,d=null),function(m){var y=m.ownerDocument();function k(){y.$removeListener("save",k),y.$removeListener("deleteOne",k),m.emit("deleteOne",m),m.constructor.emit("deleteOne",m)}y.$on("save",k),y.$on("deleteOne",k)}(this),!d||!d.noop){this.$__removeFromParent();var p=this.ownerDocument();p.$__.removedSubdocs=p.$__.removedSubdocs||[],p.$__.removedSubdocs.push(this)}return this.$__deleteOne(_)},l.prototype.populate=function(){throw new Error('Mongoose does not support calling populate() on nested docs. Instead of `doc.nested.populate("path")`, use `doc.populate("nested.path")`')},l.prototype.inspect=function(){return this.toObject()},u.inspect.custom&&(l.prototype[u.inspect.custom]=l.prototype.inspect),l.prototype.$toObject=function(d,_){var p,m,y,k,v=w.prototype.$toObject.call(this,d,_);if(Object.keys(v).length!==0||d?._calledWithOptions==null||!((p=(m=(y=d._calledWithOptions)===null||y===void 0?void 0:y.minimize)!==null&&m!==void 0?m:this==null||(k=this.$__schemaTypeOptions)===null||k===void 0?void 0:k.minimize)!==null&&p!==void 0?p:d.minimize)||this.constructor.$__required)return v}},9460:(a,i,t)=>{"use strict";var n=t(5832).hp,c=t(3609);function b(x,w){var g=Number(w);if(isNaN(g))throw new c("number",w,x);return g}a.exports=function(x){var w=this;return Array.isArray(x)?x.map(function(g){return b(w.path,g)}):n.isBuffer(x)?x:b(w.path,x)}},9471:a=>{"use strict";a.exports=Math.abs},9528:(a,i,t)=>{"use strict";function n(o){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},n(o)}function c(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(c=function(){return!!o})()}function b(o){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},b(o)}function x(o,u){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,l){return h.__proto__=l,h},x(o,u)}var w=function(o){function u(){return function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}(this,u),function(l,d,_){return d=b(d),function(p,m){if(m&&(n(m)=="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}(p)}(l,c()?Reflect.construct(d,_||[],b(l).constructor):d.apply(l,_))}(this,u,arguments)}return function(l,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(d&&d.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),d&&x(l,d)}(u,o),h=u,Object.defineProperty(h,"prototype",{writable:!1}),h;var h}(t(8879)),g=t(5761);Object.defineProperty(w.prototype,"enum",g),Object.defineProperty(w.prototype,"match",g),Object.defineProperty(w.prototype,"lowercase",g),Object.defineProperty(w.prototype,"trim",g),Object.defineProperty(w.prototype,"uppercase",g),Object.defineProperty(w.prototype,"minLength",g),Object.defineProperty(w.prototype,"minlength",g),Object.defineProperty(w.prototype,"maxLength",g),Object.defineProperty(w.prototype,"maxlength",g),Object.defineProperty(w.prototype,"populate",g),a.exports=w},9538:(a,i,t)=>{"use strict";function n(l){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},n(l)}function c(l,d){for(var _=0;_<d.length;_++){var p=d[_];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(l,b(p.key),p)}}function b(l){var d=function(_){if(n(_)!="object"||!_)return _;var p=_[Symbol.toPrimitive];if(p!==void 0){var m=p.call(_,"string");if(n(m)!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(_)}(l);return n(d)=="symbol"?d:d+""}function x(){try{var l=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(x=function(){return!!l})()}function w(l){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},w(l)}function g(l,d){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,p){return _.__proto__=p,_},g(l,d)}var o=t(8213),u=function(l){function d(m,y){var k;(function(j,S){if(!(j instanceof S))throw new TypeError("Cannot call a class as a function")})(this,d);var v=m.message;v||(v=o.messages.general.default);var D=h(v,m,y);return k=function(j,S,A){return S=w(S),function(M,V){if(V&&(n(V)=="object"||typeof V=="function"))return V;if(V!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(K){if(K===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return K}(M)}(j,x()?Reflect.construct(S,A||[],w(j).constructor):S.apply(j,A))}(this,d,[D]),m=Object.assign({},m,{message:D}),k.properties=m,k.kind=m.type,k.path=m.path,k.value=m.value,k.reason=m.reason,k}return function(m,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function");m.prototype=Object.create(y&&y.prototype,{constructor:{value:m,writable:!0,configurable:!0}}),Object.defineProperty(m,"prototype",{writable:!1}),y&&g(m,y)}(d,l),_=d,(p=[{key:"toString",value:function(){return this.message}},{key:"toJSON",value:function(){return Object.assign({name:this.name,message:this.message},this)}}])&&c(_.prototype,p),Object.defineProperty(_,"prototype",{writable:!1}),_;var _,p}(o);function h(l,d,_){if(typeof l=="function")return l(d,_);for(var p=0,m=Object.keys(d);p<m.length;p++){var y=m[p];y!=="message"&&(l=l.replace("{"+y.toUpperCase()+"}",d[y]))}return l}Object.defineProperty(u.prototype,"name",{value:"ValidatorError"}),Object.defineProperty(u.prototype,"properties",{enumerable:!1,writable:!0,value:null}),u.prototype.formatMessage=h,a.exports=u},9539:a=>{"use strict";function i(n,c){return function(b){if(Array.isArray(b))return b}(n)||function(b,x){var w=b==null?null:typeof Symbol<"u"&&b[Symbol.iterator]||b["@@iterator"];if(w!=null){var g,o,u,h,l=[],d=!0,_=!1;try{if(u=(w=w.call(b)).next,x===0){if(Object(w)!==w)return;d=!1}else for(;!(d=(g=u.call(w)).done)&&(l.push(g.value),l.length!==x);d=!0);}catch(p){_=!0,o=p}finally{try{if(!d&&w.return!=null&&(h=w.return(),Object(h)!==h))return}finally{if(_)throw o}}return l}}(n,c)||function(b,x){if(b){if(typeof b=="string")return t(b,x);var w={}.toString.call(b).slice(8,-1);return w==="Object"&&b.constructor&&(w=b.constructor.name),w==="Map"||w==="Set"?Array.from(b):w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w)?t(b,x):void 0}}(n,c)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function t(n,c){(c==null||c>n.length)&&(c=n.length);for(var b=0,x=Array(c);b<c;b++)x[b]=n[b];return x}a.exports=function(n,c,b){for(var x={},w=0,g=Object.keys(c.tree);w<g.length;w++){var o=g[w];b&&(n.paths[o]||n.nested[o]||n.singleNestedPaths[o])||(x[o]=c.tree[o])}n.options._isMerging=!0,n.add(x,null),delete n.options._isMerging,n.callQueue=n.callQueue.concat(c.callQueue),n.method(c.methods),n.static(c.statics);for(var u=0,h=Object.entries(c._userProvidedOptions);u<h.length;u++){var l=i(h[u],2),d=l[0],_=l[1];d in n._userProvidedOptions||n.set(d,_)}for(var p in c.query)n.query[p]=c.query[p];for(var m in c.virtuals)n.virtuals[m]=c.virtuals[m].clone();n._indexes=n._indexes.concat(c._indexes||[]),n.s.hooks.merge(c.s.hooks,!1)}},9553:(a,i,t)=>{"use strict";var n=t(5832).hp;function c(w){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},c(w)}var b=t(9639),x=t(2402);a.exports=function(w){return w==null?w:c(w)==="object"&&typeof w.$numberDecimal=="string"?b.fromString(w.$numberDecimal):w instanceof b?w:typeof w=="string"?b.fromString(w):typeof n=="function"&&n.isBuffer(w)||typeof Uint8Array=="function"&&w instanceof Uint8Array?new b(w):typeof w=="number"?b.fromString(String(w)):typeof w.valueOf=="function"&&typeof w.valueOf()=="string"?b.fromString(w.valueOf()):void x.ok(!1)}},9600:(a,i,t)=>{"use strict";i.Array=t(7557),i.Buffer=t(6365),i.Document=i.Embedded=t(6547),i.DocumentArray=t(4878),i.Double=t(2822),i.Decimal128=t(9639),i.ObjectId=t(5549),i.Map=t(2081),i.Subdocument=t(9380),i.UUID=t(1344)},9604:(a,i,t)=>{"use strict";var n=t(5558).p,c=t(5558).G;function b(w,g){switch(w.$geometry.type){case"Polygon":case"LineString":case"Point":n(w.$geometry.coordinates,g)}return x(g,w),w}function x(w,g){g.$maxDistance&&(g.$maxDistance=c.call(w,g.$maxDistance)),g.$minDistance&&(g.$minDistance=c.call(w,g.$minDistance))}i.cast$geoIntersects=function(w){if(w.$geometry)return b(w,this),w},i.cast$near=function(w){var g=t(7760);if(Array.isArray(w))return n(w,this),w;if(x(this,w),w&&w.$geometry)return b(w,this);if(!Array.isArray(w))throw new TypeError("$near must be either an array or an object with a $geometry property");return g.prototype.castForQuery.call(this,null,w)},i.cast$within=function(w){var g=this;if(x(this,w),w.$box||w.$polygon){var o=w.$box?"$box":"$polygon";w[o].forEach(function(h){if(!Array.isArray(h))throw new TypeError("Invalid $within $box argument. Expected an array, received "+h);h.forEach(function(l,d){h[d]=c.call(g,l)})})}else if(w.$center||w.$centerSphere){var u=w.$center?"$center":"$centerSphere";w[u].forEach(function(h,l){Array.isArray(h)?h.forEach(function(d,_){h[_]=c.call(g,d)}):w[u][l]=c.call(g,h)})}else w.$geometry&&b(w,this);return w}},9639:(a,i,t)=>{"use strict";a.exports=t(6353).Decimal128},9696:a=>{"use strict";var i=/^function\s*([^\s(]+)/;a.exports=function(t){return t.name||(t.toString().trim().match(i)||[])[1]}},9809:a=>{"use strict";function i(_){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},i(_)}var t,n,c=Function.prototype.toString,b=(typeof Reflect>"u"?"undefined":i(Reflect))==="object"&&Reflect!==null&&Reflect.apply;if(typeof b=="function"&&typeof Object.defineProperty=="function")try{t=Object.defineProperty({},"length",{get:function(){throw n}}),n={},b(function(){throw 42},null,t)}catch(_){_!==n&&(b=null)}else b=null;var x=/^\s*class\b/,w=function(_){try{var p=c.call(_);return x.test(p)}catch{return!1}},g=function(_){try{return!w(_)&&(c.call(_),!0)}catch{return!1}},o=Object.prototype.toString,u=typeof Symbol=="function"&&!!Symbol.toStringTag,h=!(0 in[,]),l=function(){return!1};if((typeof document>"u"?"undefined":i(document))==="object"){var d=document.all;o.call(d)===o.call(document.all)&&(l=function(_){if((h||!_)&&(_===void 0||i(_)==="object"))try{var p=o.call(_);return(p==="[object HTMLAllCollection]"||p==="[object HTML document.all class]"||p==="[object HTMLCollection]"||p==="[object Object]")&&_("")==null}catch{}return!1})}a.exports=b?function(_){if(l(_))return!0;if(!_||typeof _!="function"&&i(_)!=="object")return!1;try{b(_,null,t)}catch(p){if(p!==n)return!1}return!w(_)&&g(_)}:function(_){if(l(_))return!0;if(!_||typeof _!="function"&&i(_)!=="object")return!1;if(u)return g(_);if(w(_))return!1;var p=o.call(_);return!(p!=="[object Function]"&&p!=="[object GeneratorFunction]"&&!/^\[object HTML/.test(p))&&g(_)}},9834:(a,i,t)=>{"use strict";function n(y){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},n(y)}var c=t(3777),b=t(3426),x=t(9122),w=t(3071),g=t(1464),o=t(209),u=w("Object.prototype.toString"),h=t(953)(),l=typeof globalThis>"u"?t.g:globalThis,d=b(),_=w("String.prototype.slice"),p=w("Array.prototype.indexOf",!0)||function(y,k){for(var v=0;v<y.length;v+=1)if(y[v]===k)return v;return-1},m={__proto__:null};c(d,h&&g&&o?function(y){var k=new l[y];if(Symbol.toStringTag in k&&o){var v=o(k),D=g(v,Symbol.toStringTag);if(!D&&v){var j=o(v);D=g(j,Symbol.toStringTag)}m["$"+y]=x(D.get)}}:function(y){var k=new l[y],v=k.slice||k.set;v&&(m["$"+y]=x(v))}),a.exports=function(y){if(!y||n(y)!=="object")return!1;if(!h){var k=_(u(y),8,-1);return p(d,k)>-1?k:k==="Object"&&function(v){var D=!1;return c(m,function(j,S){if(!D)try{j(v),D=_(S,1)}catch{}}),D}(y)}return g?function(v){var D=!1;return c(m,function(j,S){if(!D)try{"$"+j(v)===S&&(D=_(S,1))}catch{}}),D}(y):null}},9848:a=>{"use strict";function i(t){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i(t)}a.exports=function(t){t.pre("save",!1,function(n,c){var b=this,x=this;if(this.$isSubdocument)return n();if(c&&i(c)==="object"&&"validateBeforeSave"in c?c.validateBeforeSave:this.$__schema.options.validateBeforeSave){var w=c&&i(c)==="object"&&"validateModifiedOnly"in c?{validateModifiedOnly:c.validateModifiedOnly}:null;this.$validate(w).then(function(){b.$op="save",n()},function(g){x.$__schema.s.hooks.execPost("save:error",x,[x],{error:g},function(o){x.$op="save",n(o)})})}else n()},null,!0)}},9870:a=>{"use strict";a.exports=Error},9907:a=>{"use strict";a.exports=SyntaxError},9939:a=>{"use strict";a.exports=RangeError}},r={};function f(a){var i=r[a];if(i!==void 0)return i.exports;var t=r[a]={exports:{}};return e[a](t,t.exports,f),t.exports}return f.d=(a,i)=>{for(var t in i)f.o(i,t)&&!f.o(a,t)&&Object.defineProperty(a,t,{enumerable:!0,get:i[t]})},f.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),f.o=(a,i)=>Object.prototype.hasOwnProperty.call(a,i),f.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},f(4829)})())});var Gt=sr(lr(),1);var ai=sr(lr(),1);var mo=(()=>{let e="__expirable__";return{set(r,f,a){let i=Date.now(),t={value:f,expiry:i+a};localStorage.setItem(`${e}${r}`,JSON.stringify(t))},get(r){let f=localStorage.getItem(`${e}${r}`);if(!f)return null;try{let a=JSON.parse(f);return Date.now()>a.expiry?(localStorage.removeItem(`${e}${r}`),null):a.value}catch{return null}},has(r){let f=localStorage.getItem(`${e}${r}`);if(!f)return!1;try{let a=JSON.parse(f);return Date.now()<=a.expiry}catch{return!1}},remove(r){localStorage.removeItem(`${e}${r}`)},cleanup(){let r=Object.keys(localStorage);for(let f of r)if(f.startsWith(e))try{let a=JSON.parse(localStorage.getItem(f));a?.expiry&&Date.now()>a.expiry&&localStorage.removeItem(f)}catch{}},init(r=36e5,f=null){this.cleanup(),f&&typeof f=="number"?setInterval(()=>this.cleanup(),f):setTimeout(()=>this.cleanup(),r+1e3)}}})(),ka=mo;Wr();var Ft={setAuthData(e,r,f){let a={token:e,userData:f,timestamp:Date.now()};r?ka.set("authData",a,7*24*60*60*1e3):sessionStorage.setItem("authData",JSON.stringify(a)),localStorage.setItem("token",e),f.budgetYear&&localStorage.setItem("budgetYear",f.budgetYear)},getAuthData(){let e=sessionStorage.getItem("authData");if(e)try{return JSON.parse(e)}catch{sessionStorage.removeItem("authData")}let r=ka.get("authData");return r||null},clearAuthData(){localStorage.removeItem("token"),localStorage.removeItem("budgetYear"),sessionStorage.removeItem("authData"),ka.remove("authData"),Object.keys(localStorage).forEach(f=>{(f.startsWith("__expirable__")||f.includes("auth")||f.includes("token"))&&localStorage.removeItem(f)}),Object.keys(sessionStorage).forEach(f=>{(f.includes("auth")||f.includes("token"))&&sessionStorage.removeItem(f)}),ka.cleanup()},isAuthenticated(){let e=this.getAuthData();return!!(e&&e.token)},getToken(){let e=this.getAuthData();return e?e.token:null},logout(){this.clearAuthData(),ct.info("Anda telah keluar dari sistem."),setTimeout(()=>{typeof window<"u"&&window.m&&window.m.route.set("/login")},1500)}},et={getUserData(){let e=Ft.getAuthData();return!e||!e.userData?{username:null,email:null,budgetYear:null,isAuthenticated:!1}:{username:e.userData.username,email:e.userData.email,role:e.userData.role,budgetYear:e.userData.budgetYear,isAuthenticated:!0,token:e.token,...e.userData.namaPerangkatDaerah&&{namaPerangkatDaerah:e.userData.namaPerangkatDaerah},...e.userData.perangkatDaerah&&{perangkatDaerah:e.userData.perangkatDaerah},...e.userData.subPerangkatDaerahId&&{subPerangkatDaerahId:e.userData.subPerangkatDaerahId},...e.userData.subPerangkatDaerah&&{subPerangkatDaerah:e.userData.subPerangkatDaerah}}},getUsername(){return this.getUserData().username},getEmail(){return this.getUserData().email},getBudgetYear(){return this.getUserData().budgetYear},getRole(){return this.getUserData().role},isAdmin(){return this.getRole()==="admin"},isOperator(){return this.getRole()==="operator"},isAuthenticated(){return Ft.isAuthenticated()}};var be={success(e,r=3e3){ct.success(e,r)},error(e,r=5e3){ct.error(e,r)},warning(e,r=4e3){ct.warning(e,r)},info(e,r=3e3){ct.info(e,r)},confirm(e,r,f){ia(e,r,f)},prompt(e,r,f,a={}){Wa(e,r,f,a)}},Ce={request:function(e,r={}){let f=Ft.getToken(),a={method:"GET",headers:{"Content-Type":"application/json",Authorization:f?`Bearer ${f}`:""},background:!0},i=e;return r.parentId&&r.level&&(i={bidang:`/api/bidang/urusan/${r.parentId}`,program:`/api/program/bidang/${r.parentId}`,kegiatan:`/api/kegiatan/program/${r.parentId}`,subkegiatan:`/api/subkegiatan/kegiatan/${r.parentId}`}[r.level]||e),ai.default.request({...a,...r,url:i,deserialize:function(t){return t},extract:function(t){if(t.status>=400){let n=new Error("Request failed");throw n.code=t.status,n.response={status:t.status,message:t.statusText},n}return t.responseText?JSON.parse(t.responseText):null}})},getAll:function(e){return this.request(`/api/${e}`).then(r=>r&&r.data!==void 0?r.data.data!==void 0&&Array.isArray(r.data.data)?{success:r.success!==void 0?r.success:!0,data:r.data.data,pagination:r.data.pagination}:Array.isArray(r.data)?{success:r.success!==void 0?r.success:!0,data:r.data}:(console.warn(`Response data is neither array nor nested for ${e}:`,r.data),{success:r.success!==void 0?r.success:!0,data:[]}):Array.isArray(r)?{success:!0,data:r}:r==null?(console.warn(`API response for ${e} is undefined/null, returning empty array`),{success:!0,data:[]}):(console.warn(`Unexpected response format for ${e}:`,typeof r,r),{success:!1,data:[]})).catch(r=>{throw console.error(`Error fetching ${e}:`,r),(r.code===401||r.response&&r.response.status===401)&&(Ft.clearAuthData(),be.warning("Sesi login telah berakhir. Silakan masuk kembali."),setTimeout(()=>{window.location.href="/login"},2e3)),r})},getByParent:function(e,r){let a={bidang:"urusan",program:"bidang",kegiatan:"program",subkegiatan:"kegiatan"}[e];return a?this.request(`/api/${e}/${a}/${r}`).then(i=>i.data||[]).catch(i=>(console.error(`Error fetching ${e} by ${a}:`,i),be.error(`Gagal memuat data ${e}`),[])):(console.error("Invalid level for getByParent:",e),Promise.resolve([]))},getById:function(e,r){return this.request(`/api/${e}/${r}`).then(f=>f.data).catch(f=>(console.error(`Error fetching ${e} by ID:`,f),be.error(`Gagal memuat data ${e}`),null))},create:function(e,r){return this.request(`/api/${e}`,{method:"POST",body:r}).then(f=>(f&&f.message?be.success(f.message):be.success(`${e.charAt(0).toUpperCase()+e.slice(1)} berhasil ditambahkan!`),f&&f.data?f.data:f)).catch(f=>{throw console.error(`Error creating ${e}:`,f),f.code===401||f.response&&f.response.status===401?(Ft.clearAuthData(),be.warning("Sesi login telah berakhir. Silakan masuk kembali."),setTimeout(()=>{typeof window<"u"&&window.m&&window.m.route.set("/login")},1500)):f.response&&f.response.message?be.error(f.response.message):f.message?be.error(f.message):f.data&&f.data.message?be.error(f.data.message):be.error(`Gagal membuat ${e}. Silakan coba lagi.`),f})},createWithFile:function(e,r){let f=Ft.getToken();return fetch(`/api/${e}`,{method:"POST",headers:{Authorization:f?`Bearer ${f}`:""},body:r}).then(a=>a.ok?a.json():a.json().then(i=>{throw new Error(i.message||`HTTP error! status: ${a.status}`)})).then(a=>(a&&a.message?be.success(a.message):be.success(`${e.charAt(0).toUpperCase()+e.slice(1)} berhasil ditambahkan!`),a&&a.data?a.data:a)).catch(a=>{throw console.error(`Error creating ${e} with file:`,a),a.message&&a.message.includes("401")?(Ft.clearAuthData(),be.warning("Sesi login telah berakhir. Silakan masuk kembali."),setTimeout(()=>{typeof window<"u"&&window.m&&window.m.route.set("/login")},1500)):a.message?be.error(a.message):be.error(`Gagal membuat ${e}. Silakan coba lagi.`),a})},updateWithFile:function(e,r,f){let a=Ft.getToken();return fetch(`/api/${e}/${r}`,{method:"PUT",headers:{Authorization:a?`Bearer ${a}`:""},body:f}).then(i=>i.ok?i.json():i.json().then(t=>{throw new Error(t.message||`HTTP error! status: ${i.status}`)})).then(i=>(i&&i.message?be.success(i.message):be.success(`${e.charAt(0).toUpperCase()+e.slice(1)} berhasil diperbarui!`),i&&i.data?i.data:i)).catch(i=>{throw console.error(`Error updating ${e} with file:`,i),i.message&&i.message.includes("401")?(Ft.clearAuthData(),be.warning("Sesi login telah berakhir. Silakan masuk kembali."),setTimeout(()=>{typeof window<"u"&&window.m&&window.m.route.set("/login")},1500)):i.message?be.error(i.message):be.error(`Gagal memperbarui ${e}. Silakan coba lagi.`),i})},update:function(e,r,f){return this.request(`/api/${e}/${r}`,{method:"PUT",body:f}).then(a=>(a&&a.message?be.success(a.message):be.success(`${e.charAt(0).toUpperCase()+e.slice(1)} berhasil diperbarui!`),a&&a.data?a.data:a)).catch(a=>{throw console.error(`Error updating ${e}:`,a),a.code===401||a.response&&a.response.status===401?(Ft.clearAuthData(),be.warning("Sesi login telah berakhir. Silakan masuk kembali."),setTimeout(()=>{typeof window<"u"&&window.m&&window.m.route.set("/login")},1500)):a.response&&a.response.message?be.error(a.response.message):a.message?be.error(a.message):a.data&&a.data.message?be.error(a.data.message):be.error(`Gagal memperbarui ${e}. Silakan coba lagi.`),a})},delete:function(e,r,f){return new Promise((a,i)=>{be.confirm(`Apakah Anda yakin ingin menghapus ${f}?`,()=>{this.request(`/api/${e}/${r}`,{method:"DELETE"}).then(t=>{t&&t.message?be.success(t.message):be.success(`${f} berhasil dihapus!`),a(t)}).catch(t=>{console.error(`Error deleting ${e}:`,t),t.code===401||t.response&&t.response.status===401?(Ft.clearAuthData(),be.warning("Sesi login telah berakhir. Silakan masuk kembali."),setTimeout(()=>{typeof window<"u"&&window.m&&window.m.route.set("/login")},1500)):t.response&&t.response.message?be.error(t.response.message):t.message?be.error(t.message):t.data&&t.data.message?be.error(t.data.message):be.error(`Gagal menghapus ${f}. Silakan coba lagi.`),i(t)})},()=>{a(null)})})}};var Te=sr(lr(),1);Wr();var yo={oninit:function(e){this.isSidebarOpen=!0,this.title=e.attrs.title||"SIMRAPU",this.settingsDropdown=!1,this.perencanaanDropdown=!1,this.monitoringDropdown=!1,this.evaluasiDropdown=!1,this.pelaporanDropdown=!1,this.penyediaDropdown=!1,this.isDbConnected=!0,this.connectionCheckInterval=null,this.connectionRetries=0,this.maxRetries=3,this.startConnectionMonitoring()},onremove:function(){this.connectionCheckInterval&&clearInterval(this.connectionCheckInterval)},startConnectionMonitoring:function(){let e=async()=>{try{if((await fetch("/api/auth/health",{method:"GET",headers:{Authorization:`Bearer ${Ft.getToken()}`,"Content-Type":"application/json"}})).ok)this.isDbConnected=!0,this.connectionRetries=0,this.wasDisconnected&&(ct.success("Koneksi database telah pulih"),this.wasDisconnected=!1);else throw new Error("Database health check failed")}catch(r){console.error("Database connection check failed:",r),this.connectionRetries++,this.connectionRetries>=this.maxRetries&&(this.isDbConnected=!1,this.wasDisconnected=!0,ct.error("Koneksi database terputus. Beberapa fitur mungkin tidak tersedia."))}Te.default.redraw()};e(),this.connectionCheckInterval=setInterval(e,3e4)},getConnectionStatus:function(){return this.isDbConnected?{color:"text-green-500",bgColor:"bg-green-50",text:"Terhubung",icon:"ri-wifi-line"}:{color:"text-red-500",bgColor:"bg-red-50",text:"Terputus",icon:"ri-wifi-off-line"}},toggleSidebar:function(){this.isSidebarOpen=!this.isSidebarOpen},handleLogout:function(){ia("Apakah Anda yakin ingin keluar?",()=>{Ft.clearAuthData(),ct.success("Berhasil keluar dari sistem"),setTimeout(()=>{Te.default.route.set("/")},1e3)},()=>{ct.info("Logout dibatalkan")})},handleDocumentClick:function(e){!e.target.closest(".settings-dropdown")&&this.settingsDropdown&&(this.settingsDropdown=!1,Te.default.redraw()),!e.target.closest(".perencanaan-dropdown")&&this.perencanaanDropdown&&(this.perencanaanDropdown=!1,Te.default.redraw()),!e.target.closest(".monitoring-dropdown")&&this.monitoringDropdown&&(this.monitoringDropdown=!1,Te.default.redraw()),!e.target.closest(".evaluasi-dropdown")&&this.evaluasiDropdown&&(this.evaluasiDropdown=!1,Te.default.redraw()),!e.target.closest(".pelaporan-dropdown")&&this.pelaporanDropdown&&(this.pelaporanDropdown=!1,Te.default.redraw())},view:function(e){let r=et.isAuthenticated(),f=et.isAdmin(),a=et.isOperator(),i=this.getConnectionStatus();return(0,Te.default)("div",{class:"flex h-screen bg-gray-100",onclick:t=>this.handleDocumentClick(t)},[r?(0,Te.default)("div",{class:`${this.isSidebarOpen?"w-64":"w-16"} bg-white border-r border-gray-200 flex flex-col transition-all duration-300 ease-in-out`},[(0,Te.default)("div",{class:"flex items-center justify-between p-4 border-b border-gray-200"},[this.isSidebarOpen?(0,Te.default)("div",{class:"flex items-center space-x-3"},[(0,Te.default)("div",{class:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center"},[(0,Te.default)("i",{class:"ri-government-line text-white text-lg"})]),(0,Te.default)("div",[(0,Te.default)("h1",{class:"font-semibold text-gray-900"},"SIMRAPU"),(0,Te.default)("p",{class:"text-xs text-gray-500"},"Budget Management")])]):(0,Te.default)("div",{class:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center mx-auto"},[(0,Te.default)("i",{class:"ri-government-line text-white text-lg"})]),(0,Te.default)("button",{class:"text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100",onclick:()=>this.toggleSidebar()},[(0,Te.default)("i",{class:`text-lg ${this.isSidebarOpen?"ri-menu-fold-line":"ri-menu-unfold-line"}`})])]),(0,Te.default)("div",{class:"flex-1 py-4"},[(0,Te.default)("ul",{class:"space-y-1"},[(0,Te.default)("li",[(0,Te.default)("a",{href:et.isAdmin()?"/dashboard":"/operator-dashboard",class:`flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg mx-2 transition-colors ${this.isSidebarOpen?"space-x-3":"justify-center"} ${Te.default.route.get()===(et.isAdmin()?"/dashboard":"/operator-dashboard")?"bg-blue-50 border-l-4 border-blue-500 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-home-line text-lg"}),this.isSidebarOpen&&(0,Te.default)("span",{class:"font-medium"},"Dashboard")])]),et.isAdmin()?[(0,Te.default)("li",{class:"relative perencanaan-dropdown"},[(0,Te.default)("button",{class:`w-full flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg mx-2 transition-colors ${this.isSidebarOpen?"space-x-3 justify-start":"justify-center"} ${Te.default.route.get()==="/anggaran"?"bg-blue-50 border-l-4 border-blue-500 text-blue-700":""}`,onclick:()=>{this.isSidebarOpen&&(this.perencanaanDropdown=!this.perencanaanDropdown)}},[(0,Te.default)("i",{class:"ri-file-list-line text-lg"}),this.isSidebarOpen&&[(0,Te.default)("span",{class:"font-medium flex-1 text-left"},"Perencanaan"),(0,Te.default)("i",{class:`ri-arrow-down-s-line text-sm transition-transform ${this.perencanaanDropdown?"rotate-180":""}`})]]),this.isSidebarOpen&&this.perencanaanDropdown&&(0,Te.default)("div",{class:"absolute left-0 top-full mt-1 w-full bg-white border border-gray-200 rounded-lg shadow-lg z-50"},[(0,Te.default)("a",{href:"/anggaran",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/anggaran"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-wallet-3-line mr-3 text-base"}),"Anggaran"]),(0,Te.default)("a",{href:"/kinerja",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/kinerja"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-line-chart-line mr-3 text-base"}),"Kinerja"])])]),(0,Te.default)("li",{class:"relative monitoring-dropdown"},[(0,Te.default)("button",{class:`w-full flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg mx-2 transition-colors ${this.isSidebarOpen?"space-x-3 justify-start":"justify-center"} ${Te.default.route.get()==="/realisasi"||Te.default.route.get()==="/pencapaian"?"bg-blue-50 border-l-4 border-blue-500 text-blue-700":""}`,onclick:()=>{this.isSidebarOpen&&(this.monitoringDropdown=!this.monitoringDropdown)}},[(0,Te.default)("i",{class:"ri-eye-line text-lg"}),this.isSidebarOpen&&[(0,Te.default)("span",{class:"font-medium flex-1 text-left"},"Monitoring"),(0,Te.default)("i",{class:`ri-arrow-down-s-line text-sm transition-transform ${this.monitoringDropdown?"rotate-180":""}`})]]),this.isSidebarOpen&&this.monitoringDropdown&&(0,Te.default)("div",{class:"absolute left-0 top-full mt-1 w-full bg-white border border-gray-200 rounded-lg shadow-lg z-50"},[(0,Te.default)("a",{href:"/realisasi",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/realisasi"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-money-dollar-circle-line mr-3 text-base"}),"Realisasi"]),(0,Te.default)("a",{href:"/pencapaian",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/pencapaian"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-trophy-line mr-3 text-base"}),"Pencapaian"])])]),(0,Te.default)("li",{class:"relative evaluasi-dropdown"},[(0,Te.default)("button",{class:`w-full flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg mx-2 transition-colors ${this.isSidebarOpen?"space-x-3 justify-start":"justify-center"}`,onclick:()=>{this.isSidebarOpen&&(this.evaluasiDropdown=!this.evaluasiDropdown)}},[(0,Te.default)("i",{class:"ri-clipboard-line text-lg"}),this.isSidebarOpen&&[(0,Te.default)("span",{class:"font-medium flex-1 text-left"},"Evaluasi"),(0,Te.default)("i",{class:`ri-arrow-down-s-line text-sm transition-transform ${this.evaluasiDropdown?"rotate-180":""}`})]]),this.isSidebarOpen&&this.evaluasiDropdown&&(0,Te.default)("div",{class:"absolute left-0 top-full mt-1 w-full bg-white border border-gray-200 rounded-lg shadow-lg z-50"},[(0,Te.default)("a",{href:"/evaluasi-realisasi",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/evaluasi-realisasi"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-money-dollar-circle-line mr-3 text-base"}),"Realisasi"]),(0,Te.default)("a",{href:"/evaluasi-kinerja",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/evaluasi-kinerja"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-trophy-line mr-3 text-base"}),"Kinerja"])])]),(0,Te.default)("li",{class:"relative pelaporan-dropdown"},[(0,Te.default)("button",{class:`w-full flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg mx-2 transition-colors ${this.isSidebarOpen?"space-x-3 justify-start":"justify-center"}`,onclick:()=>{this.isSidebarOpen&&(this.pelaporanDropdown=!this.pelaporanDropdown)}},[(0,Te.default)("i",{class:"ri-file-chart-line text-lg"}),this.isSidebarOpen&&[(0,Te.default)("span",{class:"font-medium flex-1 text-left"},"Pelaporan"),(0,Te.default)("i",{class:`ri-arrow-down-s-line text-sm transition-transform ${this.pelaporanDropdown?"rotate-180":""}`})]]),this.isSidebarOpen&&this.pelaporanDropdown&&(0,Te.default)("div",{class:"absolute left-0 top-full mt-1 w-full bg-white border border-gray-200 rounded-lg shadow-lg z-50"},[(0,Te.default)("a",{href:"/laporan-anggaran",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/laporan-anggaran"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-wallet-line mr-3 text-base"}),"Anggaran"]),(0,Te.default)("a",{href:"/laporan-realisasi",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/laporan-realisasi"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-money-dollar-circle-line mr-3 text-base"}),"Realisasi"]),(0,Te.default)("a",{href:"/laporan-kinerja",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/laporan-kinerja"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-line-chart-line mr-3 text-base"}),"Kinerja"]),(0,Te.default)("a",{href:"/laporan-konsolidasi",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/laporan-konsolidasi"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-bar-chart-line mr-3 text-base"}),"Konsolidasi"])])])]:[],et.isOperator()?[(0,Te.default)("li",[(0,Te.default)("a",{href:"/operator-pengadaan",class:`flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg mx-2 transition-colors ${this.isSidebarOpen?"space-x-3":"justify-center"} ${Te.default.route.get()==="/operator-pengadaan"?"bg-blue-50 border-l-4 border-blue-500 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-shopping-bag-line text-lg"}),this.isSidebarOpen&&(0,Te.default)("span",{class:"font-medium"},"Pengadaan")])]),(0,Te.default)("li",[(0,Te.default)("a",{href:"/operator-monitoring",class:`flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg mx-2 transition-colors ${this.isSidebarOpen?"space-x-3":"justify-center"} ${Te.default.route.get()==="/operator-monitoring"?"bg-blue-50 border-l-4 border-blue-500 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-eye-line text-lg"}),this.isSidebarOpen&&(0,Te.default)("span",{class:"font-medium"},"Monitoring")])])]:null])]),(0,Te.default)("div",{class:"p-4 border-t border-gray-200"},[(0,Te.default)("li",{class:"relative settings-dropdown"},[(0,Te.default)("button",{class:`w-full flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-700 rounded-lg mx-2 transition-colors ${this.isSidebarOpen?"space-x-3 justify-start":"justify-center"} ${Te.default.route.get()==="/bidang-subkegiatan"||Te.default.route.get()==="/penyedia"||Te.default.route.get()==="/jenis-pengadaan"?"bg-blue-50 border-l-4 border-blue-500 text-blue-700":""}`,onclick:()=>{this.isSidebarOpen&&(this.settingsDropdown=!this.settingsDropdown)}},[(0,Te.default)("i",{class:"ri-settings-line text-lg"}),this.isSidebarOpen&&[(0,Te.default)("span",{class:"font-medium flex-1 text-left"},"Pengaturan"),(0,Te.default)("i",{class:`ri-arrow-down-s-line text-sm transition-transform ${this.settingsDropdown?"rotate-180":""}`})]]),this.isSidebarOpen&&this.settingsDropdown&&(0,Te.default)("div",{class:"absolute left-0 bottom-full mb-1 w-full bg-white border border-gray-200 rounded-lg shadow-lg z-50"},[(0,Te.default)("a",{href:"/perangkat-daerah",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/perangkat-daerah"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-building-line mr-3 text-base"}),"Perangkat Daerah"]),(0,Te.default)("a",{href:"/bidang-subkegiatan",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/bidang-subkegiatan"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-node-tree mr-3 text-base"}),"Program-Kegiatan"]),(0,Te.default)("a",{href:"/kode-rekening-sumber-dana",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/kode-rekening-sumber-dana"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-wallet-line mr-3 text-base"}),"Kode Rekening dan Sumber Dana"]),(0,Te.default)("a",{href:"/penyedia",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/penyedia"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-truck-line mr-3 text-base"}),"Penyedia Barang/Jasa"]),(0,Te.default)("a",{href:"/jenis-pengadaan",class:`flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors ${Te.default.route.get()==="/jenis-pengadaan"?"bg-blue-50 text-blue-700":""}`,oncreate:Te.default.route.link},[(0,Te.default)("i",{class:"ri-list-settings-line mr-3 text-base"}),"Jenis dan Metode Pengadaan"])])])]),(0,Te.default)("div",{class:"p-4 border-t border-gray-200"},[(0,Te.default)("button",{class:`w-full flex items-center justify-center space-x-2 px-3 py-2 rounded-lg bg-red-50 hover:bg-red-100 text-red-600 hover:text-red-700 transition-colors ${this.isSidebarOpen?"space-x-2":""}`,onclick:()=>this.handleLogout()},[(0,Te.default)("i",{class:"ri-logout-box-line text-lg"}),this.isSidebarOpen&&(0,Te.default)("span","Log Out")])])]):null,(0,Te.default)("div",{class:"flex-1 flex flex-col overflow-hidden"},[(0,Te.default)("header",{class:"bg-white border-b border-gray-200"},[(0,Te.default)("div",{class:"flex items-center justify-between p-4"},[(0,Te.default)("h2",{class:"text-lg font-semibold text-gray-800"},["SIMRAPU"," ",(()=>{let t=et.getUserData();return t&&t.namaPerangkatDaerah?(0,Te.default)("span",{class:"text-blue-600 font-medium"},`- ${t.namaPerangkatDaerah}`):null})()]),(0,Te.default)("div",{class:"flex items-center space-x-4"},[(0,Te.default)("div",{class:"hidden sm:flex items-center space-x-2 text-sm text-gray-700"},[(0,Te.default)("span",et.getBudgetYear()||"No Budget Year"),(0,Te.default)("button",{class:"text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100",onclick:()=>Te.default.route.set("/profile")},[(0,Te.default)("i",{class:"ri-user-line text-lg"})])]),(0,Te.default)("button",{onclick:()=>this.handleLogout(),class:"text-gray-500 hover:text-red-600 p-2 rounded-full hover:bg-gray-100 flex items-center"},[(0,Te.default)("i",{class:"ri-logout-box-line text-lg"})])])])]),(0,Te.default)("main",{class:"flex-1 overflow-y-auto p-6 bg-gray-50"},[e.children]),(0,Te.default)("footer",{class:"bg-white border-t border-gray-200 py-4 px-6"},[(0,Te.default)("div",{class:"text-sm text-center space-y-2"},[(0,Te.default)("p",{class:"text-gray-600"},"\xA9 2026 SIMRAPU - Sistem Informasi Manajemen Realisasi Anggaran Pekerjaan Umum"),(0,Te.default)("div",{class:"flex justify-center space-x-4"},[(0,Te.default)("a",{href:"#",class:"text-gray-500 hover:text-gray-700 text-sm"},"About"),(0,Te.default)("a",{href:"#",class:"text-gray-500 hover:text-gray-700 text-sm"},"Contact"),(0,Te.default)("a",{href:"#",class:"text-gray-500 hover:text-gray-700 text-sm"},"Help")])])])]),!this.isDbConnected&&r&&(0,Te.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",style:"backdrop-filter: blur(2px);"},[(0,Te.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 transform transition-all"},[(0,Te.default)("div",{class:"bg-gradient-to-r from-red-500 to-red-600 text-white p-6 rounded-t-xl"},[(0,Te.default)("div",{class:"flex items-center justify-between"},[(0,Te.default)("div",{class:"flex items-center space-x-4"},[(0,Te.default)("div",{class:"w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center"},[(0,Te.default)("i",{class:"ri-wifi-off-line text-3xl",style:"animation: pulse 2s infinite;"})]),(0,Te.default)("div",[(0,Te.default)("h3",{class:"text-xl font-bold",style:"text-shadow: 0 1px 2px rgba(0,0,0,0.1);"},"Koneksi Terputus"),(0,Te.default)("p",{class:"text-white text-opacity-90 text-sm"},"Database tidak dapat diakses")])])])]),(0,Te.default)("div",{class:"p-6"},[(0,Te.default)("div",{class:"text-center mb-6"},[(0,Te.default)("div",{class:`inline-flex items-center space-x-2 px-4 py-2 rounded-full text-sm font-medium ${i.bgColor} ${i.color}`},[(0,Te.default)("i",{class:`${i.icon} text-lg`}),(0,Te.default)("span",`Status: ${i.text}`)])]),(0,Te.default)("div",{class:"bg-gray-50 p-4 rounded-lg mb-4"},[(0,Te.default)("div",{class:"flex items-start space-x-3"},[(0,Te.default)("i",{class:"ri-information-line text-blue-500 text-lg mt-0.5"}),(0,Te.default)("div",[(0,Te.default)("p",{class:"text-sm text-gray-700 font-medium mb-1"},"Yang terjadi:"),(0,Te.default)("ul",{class:"text-sm text-gray-600 space-y-1"},[(0,Te.default)("li","\u2022 Koneksi ke database MongoDB terputus"),(0,Te.default)("li","\u2022 Data tidak dapat disimpan atau dimuat"),(0,Te.default)("li","\u2022 Beberapa fitur mungkin tidak berfungsi")])])])]),(0,Te.default)("div",{class:"bg-amber-50 border border-amber-200 p-3 rounded-lg"},[(0,Te.default)("div",{class:"flex items-center space-x-2"},[(0,Te.default)("i",{class:"ri-time-line text-amber-600"}),(0,Te.default)("p",{class:"text-sm text-amber-800 font-medium"},"Sistem akan mencoba menghubungkan ulang secara otomatis...")])])]),(0,Te.default)("div",{class:"flex justify-end gap-3 pt-4 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-xl"},[(0,Te.default)("button",{class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2",onclick:()=>{this.connectionRetries=0,this.startConnectionMonitoring(),ct.info("Memeriksa koneksi database...")}},[(0,Te.default)("i",{class:"ri-refresh-line"}),(0,Te.default)("span","Coba Lagi")])])])]),r&&this.isDbConnected&&(0,Te.default)("div",{class:"fixed top-4 right-4 z-40"},[(0,Te.default)("div",{class:`inline-flex items-center space-x-2 px-3 py-2 rounded-full text-xs font-medium ${i.bgColor} ${i.color} shadow-lg`,title:"Koneksi database aktif"},[(0,Te.default)("div",{class:"w-2 h-2 bg-current rounded-full animate-pulse"}),(0,Te.default)("span",i.text)])])])}},Ta=yo;var Jt=sr(lr(),1);Wr();var vo={username:"",password:"",selectedBudgetYear:"",showPassword:!1,rememberMe:!1,isLoading:!1,budgetYears:[{year:2026,status:"Murni",value:"2026-Murni"},{year:2026,status:"PAK",value:"2026-PAK"}],view:function(){return(0,Jt.default)("div",{class:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8"},[(0,Jt.default)("div",{class:"sm:mx-auto sm:w-full sm:max-w-md"},[(0,Jt.default)("div",{class:"text-center"},[(0,Jt.default)("h2",{class:"mt-6 text-3xl font-bold text-gray-900"},"SIMRAPU Login"),(0,Jt.default)("p",{class:"mt-2 text-sm text-gray-600"},"Sistem Informasi Manajemen Realisasi Anggaran Pekerjaan Umum")])]),(0,Jt.default)("div",{class:"mt-8 sm:mx-auto sm:w-full sm:max-w-md"},[(0,Jt.default)("div",{class:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10"},[(0,Jt.default)("form",{class:"space-y-6",onsubmit:this.handleSubmit.bind(this)},[(0,Jt.default)("div",[(0,Jt.default)("label",{for:"username",class:"block text-sm font-medium text-gray-700"},"Username"),(0,Jt.default)("div",{class:"mt-1 relative"},[(0,Jt.default)("input",{id:"username",name:"username",type:"text",required:!0,class:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Masukkan username Anda",value:this.username,oninput:e=>this.username=e.target.value})])]),(0,Jt.default)("div",[(0,Jt.default)("label",{for:"password",class:"block text-sm font-medium text-gray-700"},"Password"),(0,Jt.default)("div",{class:"mt-1 relative"},[(0,Jt.default)("input",{id:"password",name:"password",type:this.showPassword?"text":"password",required:!0,class:"appearance-none block w-full pr-10 pl-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Masukkan password Anda",value:this.password,oninput:e=>this.password=e.target.value}),(0,Jt.default)("button",{type:"button",class:"absolute inset-y-0 right-0 pr-3 flex items-center",onclick:()=>this.showPassword=!this.showPassword},[(0,Jt.default)("i",{class:`ri-${this.showPassword?"eye-off":"eye"}-line text-gray-400 hover:text-gray-600`})])])]),(0,Jt.default)("div",[(0,Jt.default)("label",{for:"budgetYear",class:"block text-sm font-medium text-gray-700"},"Tahun Anggaran"),(0,Jt.default)("div",{class:"mt-1 relative"},[(0,Jt.default)("select",{id:"budgetYear",name:"budgetYear",required:!0,class:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:this.selectedBudgetYear,onchange:e=>this.selectedBudgetYear=e.target.value},[(0,Jt.default)("option",{value:""},"Pilih Tahun Anggaran"),this.budgetYears.map(e=>(0,Jt.default)("option",{value:e.value,key:e.value},`${e.year} (${e.status})`))])])]),(0,Jt.default)("div",{class:"flex items-center"},[(0,Jt.default)("input",{id:"rememberMe",name:"rememberMe",type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:this.rememberMe,onchange:e=>this.rememberMe=e.target.checked}),(0,Jt.default)("label",{for:"rememberMe",class:"ml-2 block text-sm text-gray-900"},"Ingat saya")]),(0,Jt.default)("div",[(0,Jt.default)("button",{type:"submit",disabled:this.isLoading,class:`group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white ${this.isLoading?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500`},[(0,Jt.default)("span",{class:"absolute left-0 inset-y-0 flex items-center pl-3"},[this.isLoading?(0,Jt.default)("svg",{class:"animate-spin h-5 w-5 text-blue-500",fill:"none",viewBox:"0 0 24 24"},[(0,Jt.default)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),(0,Jt.default)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]):(0,Jt.default)("svg",{class:"h-5 w-5 text-blue-500 group-hover:text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[(0,Jt.default)("path",{"fill-rule":"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z","clip-rule":"evenodd"})])]),this.isLoading?"Memproses...":"Masuk"])])])])])])},handleSubmit:function(e){if(e.preventDefault(),!this.username||!this.password||!this.selectedBudgetYear){ct.error("Harap isi semua field");return}this.isLoading=!0,Jt.default.redraw(),this.authenticateWithAPI()},authenticateWithAPI:async function(){try{console.log("Attempting login for user:",this.username);try{let i=await fetch("/api/auth/login",{method:"OPTIONS"}).catch(()=>{throw new Error("Server not running")})}catch{ct.error("Backend server tidak berjalan. Jalankan server terlebih dahulu dengan perintah: npm start"),this.isLoading=!1,Jt.default.redraw();return}let e=new AbortController,r=setTimeout(()=>e.abort(),1e4),f=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,password:this.password,budgetYear:this.selectedBudgetYear}),signal:e.signal});clearTimeout(r);let a=await f.json();if(console.log("API Response:",{status:f.status,data:a}),f.ok){let i=a.token,t={username:a.user.username,email:a.user.email||a.user.namaLengkap,role:a.user.role,budgetYear:a.user.budgetYear};a.user.role==="operator"?(t.subPerangkatDaerahId=a.user.subPerangkatDaerahId,t.subPerangkatDaerah=a.user.subPerangkatDaerah,a.user.subPerangkatDaerah?.nama&&(t.namaPerangkatDaerah=a.user.subPerangkatDaerah.nama)):a.user.role==="admin"&&(t.perangkatDaerah=a.user.perangkatDaerah,a.user.perangkatDaerah?.nama&&(t.namaPerangkatDaerah=a.user.perangkatDaerah.nama)),console.log("Login.js - Final userData before storage:",t),console.log("Login.js - Device data check:",{role:a.user.role,subPerangkatDaerah:a.user.subPerangkatDaerah,subPerangkatDaerahNama:a.user.subPerangkatDaerah?.nama,perangkatDaerah:a.user.perangkatDaerah,perangkatDaerahNama:a.user.perangkatDaerah?.nama}),console.log("Login successful - User data:",t),Ft.setAuthData(i,this.rememberMe,t);let n=a.user.role==="operator"?"Operator":a.user.role==="vendor"?"Vendor":"Admin";ct.clear(),ct.success(`Selamat datang, ${a.user.username}! (Role: ${n})`),this.username="",this.password="",this.selectedBudgetYear="",this.rememberMe=!1,this.isLoading=!1,Jt.default.redraw(),setTimeout(()=>{this.cleanupAllOverlays(),a.user.role==="operator"?Jt.default.route.set("/operator-dashboard"):a.user.role==="vendor"?Jt.default.route.set("/vendor-layout"):Jt.default.route.set("/dashboard")},500)}else ct.error(a.message||"Username atau password salah"),this.isLoading=!1,Jt.default.redraw()}catch(e){console.error("Login error:",e),e.name==="AbortError"?ct.error("Server tidak merespons. Pastikan backend server sedang berjalan."):ct.error("Terjadi kesalahan saat menghubungi server"),this.isLoading=!1,Jt.default.redraw(),console.log("Loading state set to false, forcing redraw")}},cleanupAllOverlays:function(){ct.clear(),[".toast",".toast-confirmation",".toast-prompt",'[class*="toast"]','[style*="z-index: 9999"]','[style*="z-index: 9998"]','[style*="z-index: 50"]','[style*="position: fixed"]'].forEach(f=>{try{document.querySelectorAll(f).forEach(i=>{i&&i.parentNode&&(i.parentNode.removeChild(i),console.log("Removed overlay element:",f))})}catch{}}),document.querySelectorAll("*").forEach(f=>{let a=window.getComputedStyle(f),i=a.position,t=a.zIndex;i==="fixed"&&(parseInt(t)>=50||t==="auto")&&(t==="9999"||t==="9998"||f.className.includes("toast")||f.className.includes("modal")||f.className.includes("overlay"))&&f.parentNode&&(f.parentNode.removeChild(f),console.log("Force removed persistent overlay element"))}),console.log("All overlays and persistent elements cleaned up before navigation")}},ga=vo;var Pt=sr(lr(),1);var xo={oninit:function(e){this.userData=et.getUserData()},view:function(){return(0,Pt.default)("div",{class:"p-6 bg-gray-50 min-h-full"},[(0,Pt.default)("div",{class:"mb-8"},[(0,Pt.default)("h1",{class:"text-3xl font-bold text-gray-900 mb-2"},"Dashboard"),(0,Pt.default)("p",{class:"text-gray-600"},`Welcome back, ${this.userData.username||"User"}!`),(0,Pt.default)("p",{class:"text-sm text-gray-500 mt-1"},`Budget Year: ${this.userData.budgetYear?`${this.userData.budgetYear.year} (${this.userData.budgetYear.status})`:"Not selected"}`)]),(0,Pt.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},[(0,Pt.default)("div",{class:"bg-white rounded-lg shadow p-6 border-l-4 border-blue-500"},[(0,Pt.default)("div",{class:"flex items-center"},[(0,Pt.default)("div",{class:"p-2 bg-blue-100 rounded-lg"},[(0,Pt.default)("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,Pt.default)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})])]),(0,Pt.default)("div",{class:"ml-4"},[(0,Pt.default)("p",{class:"text-sm font-medium text-gray-600"},"Total Budget"),(0,Pt.default)("p",{class:"text-2xl font-semibold text-gray-900"},"Rp 0")])])]),(0,Pt.default)("div",{class:"bg-white rounded-lg shadow p-6 border-l-4 border-green-500"},[(0,Pt.default)("div",{class:"flex items-center"},[(0,Pt.default)("div",{class:"p-2 bg-green-100 rounded-lg"},[(0,Pt.default)("svg",{class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,Pt.default)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])]),(0,Pt.default)("div",{class:"ml-4"},[(0,Pt.default)("p",{class:"text-sm font-medium text-gray-600"},"Realization"),(0,Pt.default)("p",{class:"text-2xl font-semibold text-gray-900"},"Rp 0")])])]),(0,Pt.default)("div",{class:"bg-white rounded-lg shadow p-6 border-l-4 border-yellow-500"},[(0,Pt.default)("div",{class:"flex items-center"},[(0,Pt.default)("div",{class:"p-2 bg-yellow-100 rounded-lg"},[(0,Pt.default)("svg",{class:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,Pt.default)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})])]),(0,Pt.default)("div",{class:"ml-4"},[(0,Pt.default)("p",{class:"text-sm font-medium text-gray-600"},"Active Projects"),(0,Pt.default)("p",{class:"text-2xl font-semibold text-gray-900"},"0")])])]),(0,Pt.default)("div",{class:"bg-white rounded-lg shadow p-6 border-l-4 border-red-500"},[(0,Pt.default)("div",{class:"flex items-center"},[(0,Pt.default)("div",{class:"p-2 bg-red-100 rounded-lg"},[(0,Pt.default)("svg",{class:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,Pt.default)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])]),(0,Pt.default)("div",{class:"ml-4"},[(0,Pt.default)("p",{class:"text-sm font-medium text-gray-600"},"Pending Approvals"),(0,Pt.default)("p",{class:"text-2xl font-semibold text-gray-900"},"0")])])]),(0,Pt.default)("div",{class:"bg-white rounded-lg shadow p-6 border-l-4 border-orange-500"},[(0,Pt.default)("div",{class:"flex items-center"},[(0,Pt.default)("div",{class:"p-2 bg-orange-100 rounded-lg"},[(0,Pt.default)("i",{class:"ri-file-chart-line text-xl text-orange-600"})]),(0,Pt.default)("div",{class:"ml-4"},[(0,Pt.default)("p",{class:"text-sm font-medium text-gray-600"},"Laporan Tersedia"),(0,Pt.default)("p",{class:"text-2xl font-bold text-gray-900"},"4")])])])]),(0,Pt.default)("div",{class:"bg-white rounded-lg shadow p-6 mb-6"},[(0,Pt.default)("h2",{class:"text-lg font-medium text-gray-900 mb-4 flex items-center"},[(0,Pt.default)("i",{class:"ri-file-chart-line mr-2 text-blue-500"}),"Laporan & Analisis"]),(0,Pt.default)("div",{class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"},[(0,Pt.default)("button",{class:"flex flex-col items-center justify-center px-4 py-3 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onclick:()=>Pt.default.route.set("/laporan-anggaran")},[(0,Pt.default)("i",{class:"ri-wallet-line text-2xl text-blue-500 mb-2"}),(0,Pt.default)("span","Laporan"),(0,Pt.default)("span","Anggaran")]),(0,Pt.default)("button",{class:"flex flex-col items-center justify-center px-4 py-3 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onclick:()=>Pt.default.route.set("/laporan-realisasi")},[(0,Pt.default)("i",{class:"ri-money-dollar-circle-line text-2xl text-green-500 mb-2"}),(0,Pt.default)("span","Laporan"),(0,Pt.default)("span","Realisasi")]),(0,Pt.default)("button",{class:"flex flex-col items-center justify-center px-4 py-3 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onclick:()=>Pt.default.route.set("/laporan-kinerja")},[(0,Pt.default)("i",{class:"ri-line-chart-line text-2xl text-purple-500 mb-2"}),(0,Pt.default)("span","Laporan"),(0,Pt.default)("span","Kinerja")]),(0,Pt.default)("button",{class:"flex flex-col items-center justify-center px-4 py-3 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onclick:()=>Pt.default.route.set("/laporan-konsolidasi")},[(0,Pt.default)("i",{class:"ri-bar-chart-line text-2xl text-orange-500 mb-2"}),(0,Pt.default)("span","Laporan"),(0,Pt.default)("span","Konsolidasi")])])]),(0,Pt.default)("div",{class:"bg-white rounded-lg shadow p-6"},[(0,Pt.default)("h2",{class:"text-lg font-medium text-gray-900 mb-4 flex items-center"},[(0,Pt.default)("i",{class:"ri-settings-line mr-2 text-gray-500"}),"Manajemen Data"]),(0,Pt.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},[(0,Pt.default)("button",{class:"flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[(0,Pt.default)("i",{class:"ri-add-line mr-2 text-gray-500"}),"Tambah Proyek Baru"]),(0,Pt.default)("button",{class:"flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[(0,Pt.default)("i",{class:"ri-file-list-line mr-2 text-gray-500"}),"Laporan Generate"]),(0,Pt.default)("button",{class:"flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[(0,Pt.default)("i",{class:"ri-settings-line mr-2 text-gray-500"}),"Pengaturan Sistem"])])])])}},ni=xo;var ht=sr(lr(),1);var wo={isLoading:!1,currentUser:null,unitInfo:null,dashboardData:{paketCount:0,totalBudget:0,activePackages:0,completedPackages:0,recentActivity:[]},oninit:function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),ht.default.route.set("/login");return}if(this.currentUser=et.getUserData(),this.currentUser.role!=="operator"){be.warning("Halaman ini hanya dapat diakses oleh operator"),ht.default.route.set("/dashboard");return}this.loadDashboardData()},loadDashboardData:async function(){this.isLoading=!0,ht.default.redraw();try{let r=et.getUserData().subPerangkatDaerahId,f=new Date().getFullYear(),i=["2026-Murni","2026-PAK"][0];if(!r){be.warning("Informasi unit kerja tidak ditemukan");return}let t=await Ce.request(`/api/subperangkatdaerah/${r}`);this.unitInfo=t.data;let c=(await Ce.request(`/api/pengadaan?subPerangkatDaerahId=${r}&budgetYear=${encodeURIComponent(i)}`)).data||[];this.dashboardData={paketCount:c.length,totalBudget:c.reduce((b,x)=>b+(x.estimatedBudget||0),0),activePackages:c.filter(b=>b.status==="active").length,completedPackages:c.filter(b=>b.status==="completed").length,recentActivity:c.sort((b,x)=>new Date(x.updatedAt||x.createdAt)-new Date(b.updatedAt||b.createdAt)).slice(0,5)},console.log("Dashboard data loaded:",this.dashboardData)}catch(e){console.error("Error loading dashboard data:",e),e.message&&e.message.includes("404")?(be.warning("Data pengadaan tidak ditemukan untuk unit kerja ini"),this.dashboardData={paketCount:0,totalBudget:0,activePackages:0,completedPackages:0,recentActivity:[]}):e.message&&e.message.includes("500")?be.error("Terjadi kesalahan server saat memuat data"):be.error("Gagal memuat data dashboard. Pastikan koneksi server berjalan normal.")}this.isLoading=!1,ht.default.redraw()},view:function(){return!this.currentUser||this.currentUser.role!=="operator"?(0,ht.default)("div",{class:"flex justify-center items-center h-64"},[(0,ht.default)("div",{class:"text-center"},[(0,ht.default)("i",{class:"ri-shield-user-line text-6xl text-gray-400 mb-4"}),(0,ht.default)("h3",{class:"text-lg font-semibold text-gray-600"},"Akses Ditolak"),(0,ht.default)("p",{class:"text-gray-500"},"Halaman ini hanya dapat diakses oleh operator")])]):(0,ht.default)("div",{class:"space-y-6"},[(0,ht.default)("div",{class:"bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-6"},[(0,ht.default)("div",{class:"flex items-center justify-between"},[(0,ht.default)("div",[(0,ht.default)("h1",{class:"text-2xl font-bold"},"Dashboard Unit"),(0,ht.default)("p",{class:"text-blue-100 mt-1"},this.unitInfo?.nama||"Unit Kerja"),(0,ht.default)("p",{class:"text-blue-200 text-sm mt-1"},`Pimpinan: ${this.unitInfo?.pimpinan||"Tidak ada data"}`)]),(0,ht.default)("div",{class:"text-right"},[(0,ht.default)("div",{class:"w-16 h-16 bg-white bg-opacity-75 rounded-full flex items-center justify-center"},[(0,ht.default)("i",{class:"ri-building-fill text-2xl"})])])])]),(0,ht.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},[(0,ht.default)("div",{class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},[(0,ht.default)("div",{class:"flex items-center justify-between"},[(0,ht.default)("div",[(0,ht.default)("p",{class:"text-sm font-medium text-gray-600"},"Total Paket"),(0,ht.default)("p",{class:"text-2xl font-bold text-gray-900"},this.dashboardData?.paketCount||0)]),(0,ht.default)("div",{class:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center"},[(0,ht.default)("i",{class:"ri-shopping-bag-line text-blue-600 text-xl"})])])]),(0,ht.default)("div",{class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},[(0,ht.default)("div",{class:"flex items-center justify-between"},[(0,ht.default)("div",[(0,ht.default)("p",{class:"text-sm font-medium text-gray-600"},"Total Anggaran"),(0,ht.default)("p",{class:"text-2xl font-bold text-gray-900"},`Rp ${(this.dashboardData.totalBudget||0).toLocaleString("id-ID")}`)]),(0,ht.default)("div",{class:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center"},[(0,ht.default)("i",{class:"ri-money-dollar-circle-line text-green-600 text-xl"})])])]),(0,ht.default)("div",{class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},[(0,ht.default)("div",{class:"flex items-center justify-between"},[(0,ht.default)("div",[(0,ht.default)("p",{class:"text-sm font-medium text-gray-600"},"Paket Aktif"),(0,ht.default)("p",{class:"text-2xl font-bold text-gray-900"},this.dashboardData?.activePackages||0)]),(0,ht.default)("div",{class:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center"},[(0,ht.default)("i",{class:"ri-play-circle-line text-yellow-600 text-xl"})])])]),(0,ht.default)("div",{class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},[(0,ht.default)("div",{class:"flex items-center justify-between"},[(0,ht.default)("div",[(0,ht.default)("p",{class:"text-sm font-medium text-gray-600"},"Paket Selesai"),(0,ht.default)("p",{class:"text-2xl font-bold text-gray-900"},this.dashboardData?.completedPackages||0)]),(0,ht.default)("div",{class:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center"},[(0,ht.default)("i",{class:"ri-check-circle-line text-purple-600 text-xl"})])])])]),(0,ht.default)("div",{class:"bg-white rounded-lg shadow-sm border border-gray-200"},[(0,ht.default)("div",{class:"p-6 border-b border-gray-200"},[(0,ht.default)("h3",{class:"text-lg font-semibold text-gray-900"},"Aktivitas Terbaru"),(0,ht.default)("p",{class:"text-sm text-gray-500 mt-1"},"Paket kegiatan yang baru dibuat atau diupdate")]),this.isLoading?(0,ht.default)("div",{class:"flex justify-center items-center h-32"},[(0,ht.default)("div",{class:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):this.dashboardData.recentActivity.length===0?(0,ht.default)("div",{class:"text-center py-12"},[(0,ht.default)("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 mb-4"},[(0,ht.default)("i",{class:"ri-time-fill text-blue-500"})]),(0,ht.default)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Belum ada aktivitas"),(0,ht.default)("p",{class:"text-gray-500"},"Paket kegiatan yang baru dibuat akan muncul di sini")]):(0,ht.default)("div",{class:"divide-y divide-gray-200"},[this.dashboardData.recentActivity.map(e=>(0,ht.default)("div",{class:"p-4 hover:bg-gray-50 transition-colors"},[(0,ht.default)("div",{class:"flex items-center justify-between"},[(0,ht.default)("div",{class:"flex items-center space-x-3"},[(0,ht.default)("div",{class:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold",style:`background-color: ${e.status==="active"?"#FEF3C7":e.status==="completed"?"#D1FAE5":"#F3F4F6"}; color: ${e.status==="active"?"#D97706":e.status==="completed"?"#065F46":"#6B7280"};`},e.kode?.substring(0,2)||"PK"),(0,ht.default)("div",[(0,ht.default)("p",{class:"text-sm font-medium text-gray-900"},e.nama||"Nama paket"),(0,ht.default)("p",{class:"text-xs text-gray-500"},`Kode: ${e.kode||"Tidak ada"}`)])]),(0,ht.default)("div",{class:"text-right"},[(0,ht.default)("div",{class:"flex items-center space-x-2"},[(0,ht.default)("span",{class:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${e.status==="active"?"bg-green-100 text-green-800":e.status==="completed"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`},e.status||"draft"),(0,ht.default)("span",{class:"text-sm text-gray-500"},`Rp ${(e.estimatedBudget||0).toLocaleString("id-ID")}`)])])])]))])]),(0,ht.default)("div",{class:"bg-white rounded-lg shadow-sm border border-gray-200"},[(0,ht.default)("div",{class:"p-6 border-b border-gray-200"},[(0,ht.default)("h3",{class:"text-lg font-semibold text-gray-900"},"Aksi Cepat"),(0,ht.default)("p",{class:"text-sm text-gray-500 mt-1"},"Menuju halaman yang sering digunakan")]),(0,ht.default)("div",{class:"p-6"},[(0,ht.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,ht.default)("a",{href:"/operator/pengadaan",class:"flex items-center p-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200 shadow-lg hover:shadow-xl"},[(0,ht.default)("div",{class:"w-12 h-12 bg-white bg-opacity-75 rounded-full flex items-center justify-center mr-4"},[(0,ht.default)("i",{class:"ri-shopping-bag-fill text-xl text-gray-700"})]),(0,ht.default)("div",[(0,ht.default)("h4",{class:"font-semibold"},"Kelola Pengadaan"),(0,ht.default)("p",{class:"text-green-100 text-sm"},"Lihat dan kelola paket kegiatan")])]),(0,ht.default)("a",{href:"/operator/pengadaan",class:"flex items-center p-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl"},[(0,ht.default)("div",{class:"w-12 h-12 bg-white bg-opacity-75 rounded-full flex items-center justify-center mr-4"},[(0,ht.default)("i",{class:"ri-add-circle-fill text-xl text-gray-700"})]),(0,ht.default)("div",[(0,ht.default)("h4",{class:"font-semibold"},"Tambah Paket Baru"),(0,ht.default)("p",{class:"text-blue-100 text-sm"},"Buat paket kegiatan baru")])])])])])])}},ii=wo;var ve=sr(lr(),1);Wr();var ko={isLoading:!1,userData:null,selectedKontrak:null,showRealisasiModal:!1,showKontrakDetail:!1,perangkatDaerah:null,penyedia:null,realisasiFormData:{terminId:"",laporanDate:"",periodeMulai:"",periodeSampai:"",realisasiFisik:0,realisasiBelanja:0,laporanFile:null,laporanPreview:null},kontrakList:[],filteredKontrak:[],availableTermin:[],searchQuery:"",statusFilter:"all",oninit:function(){if(!et.isAuthenticated()){ct.warning("Silakan masuk terlebih dahulu"),ve.default.route.set("/login");return}if(this.userData=et.getUserData(),this.userData.role!=="vendor"){ct.warning("Akses ditolak. Halaman ini hanya untuk vendor."),ve.default.route.set("/dashboard");return}this.loadOrganizationalData(),this.loadKontrak()},loadOrganizationalData:async function(){try{let e=await Ce.request("/api/perangkatdaerah");if(e.data&&e.data.length>0&&(this.perangkatDaerah=e.data[0]),this.userData.penyediaId){let r=await Ce.request(`/api/penyedia/${this.userData.penyediaId}`);this.penyedia=r.data}}catch(e){console.error("Error loading organizational data:",e)}},loadKontrak:async function(){this.isLoading=!0;try{let e=await Ce.request("/api/kontrak/by-penyedia",{params:{penyediaId:this.userData.penyediaId,budgetYear:this.userData.budgetYear.value||this.userData.budgetYear}});this.kontrakList=e.data||[],this.filteredKontrak=this.kontrakList,this.searchQuery="",this.statusFilter="all"}catch(e){console.error("Error loading kontrak:",e),ct.error("Gagal memuat data kontrak")}finally{this.isLoading=!1,ve.default.redraw()}},handleSearch:function(){if(!this.searchQuery)this.filteredKontrak=this.kontrakList;else{let e=this.searchQuery.toLowerCase();this.filteredKontrak=this.kontrakList.filter(r=>r.noKontrak.toLowerCase().includes(e)||r.kodeSirupLkpp.toLowerCase().includes(e)||r.lokasi.toLowerCase().includes(e))}},filterByStatus:function(){if(this.statusFilter==="all")this.filteredKontrak=this.kontrakList;else{let e=new Date;this.filteredKontrak=this.kontrakList.filter(r=>{let f=new Date(r.tglPelaksanaanSampai);switch(this.statusFilter){case"active":return f>e&&r.status!=="completed";case"completed":return r.status==="completed"||f<=e;default:return!0}})}},openKontrakDetail:async function(e){this.selectedKontrak=e,this.showKontrakDetail=!0,await this.loadTerminForKontrak(e._id),ve.default.redraw()},closeKontrakDetail:function(){this.showKontrakDetail=!1,this.selectedKontrak=null,this.availableTermin=[]},loadTerminForKontrak:async function(e){try{let r=await Ce.request("/api/termin/by-kontrak",{params:{kontrakId:e}});this.availableTermin=r.data||[]}catch(r){console.error("Error loading termin:",r),this.availableTermin=[]}},hasTerminRealisasi:function(e){return e.realisasiFisik!==void 0&&e.realisasiFisik!==null&&e.realisasiFisik>0||e.realisasiBelanja!==void 0&&e.realisasiBelanja!==null&&e.realisasiBelanja>0||!!e.laporanDate},openRealisasiModal:function(e){console.log("\u{1F4DD} openRealisasiModal called with termin:",e.termin),console.log("\u{1F4DD} Termin ID:",e._id);let r=new Date().toISOString().split("T")[0],f=e.realisasiFisik!==void 0&&e.realisasiFisik!==null;if(console.log("\u{1F4DD} Has existing realisasi:",f),console.log("\u{1F4DD} Termin realisasi data:",{realisasiFisik:e.realisasiFisik,realisasiBelanja:e.realisasiBelanja,laporanDate:e.laporanDate}),this.realisasiFormData={terminId:e._id,laporanDate:e.laporanDate?e.laporanDate.split("T")[0]:r,periodeMulai:e.periodeMulai?e.periodeMulai.split("T")[0]:this.selectedKontrak.tglPelaksanaanDari||"",periodeSampai:e.periodeSampai?e.periodeSampai.split("T")[0]:this.selectedKontrak.tglPelaksanaanSampai||"",realisasiFisik:e.realisasiFisik||0,realisasiBelanja:e.realisasiBelanja||0,laporanFile:null,laporanPreview:null,isEditing:f},console.log("\u{1F4DD} Form data created:",this.realisasiFormData),e.laporanFile&&e.laporanFile.filename)try{console.log("\u{1F4DD} Full laporanFile structure:",e.laporanFile),console.log("\u{1F4DD} laporanFile.data type:",typeof e.laporanFile.data),console.log("\u{1F4DD} laporanFile.data constructor:",e.laporanFile.data?.constructor?.name),console.log("\u{1F4DD} laporanFile contentType:",e.laporanFile.contentType);let a=e.laporanFile.data?typeof e.laporanFile.data=="number"?e.laporanFile.data:e.laporanFile.data.length||0:0;console.log("\u{1F4DD} File size detected:",a);let i=null;if(e.laporanFile.data&&e.laporanFile.contentType){if(console.log("\u{1F504} Attempting to convert database file to data URL..."),e.laporanFile.data&&typeof e.laporanFile.data=="object"){if(Buffer.isBuffer(e.laporanFile.data)||e.laporanFile.data.constructor?.name==="Buffer"||e.laporanFile.data.type==="Buffer"&&Array.isArray(e.laporanFile.data.data)){console.log("\u{1F504} Converting Buffer to base64...");let n;e.laporanFile.data.type==="Buffer"&&Array.isArray(e.laporanFile.data.data)?n=Buffer.from(e.laporanFile.data.data):e.laporanFile.data.constructor?.name==="Buffer"?n=e.laporanFile.data:e.laporanFile.data.buffer?n=Buffer.from(e.laporanFile.data.buffer):n=Buffer.from(e.laporanFile.data);let c=n.toString("base64");i=`data:${e.laporanFile.contentType};base64,${c}`,console.log("\u2705 Generated data URL from Buffer:",i.substring(0,100)+"..."),console.log("\u2705 Base64 length:",c.length)}else if(e.laporanFile.data.type==="Buffer"&&Array.isArray(e.laporanFile.data.data)){console.log("\u{1F504} Converting MongoDB Buffer object to base64...");let c=Buffer.from(e.laporanFile.data.data).toString("base64");i=`data:${e.laporanFile.contentType};base64,${c}`,console.log("\u2705 Generated data URL from MongoDB Buffer object:",i.substring(0,100)+"...")}}if(!i&&typeof e.laporanFile.data=="string"&&(e.laporanFile.data.startsWith("data:")?(console.log("\u2705 Data is already a data URL"),i=e.laporanFile.data):/^[A-Za-z0-9+/]*={0,2}$/.test(e.laporanFile.data)&&e.laporanFile.data.length>100&&(console.log("\u2705 Data appears to be base64 encoded"),i=`data:${e.laporanFile.contentType};base64,${e.laporanFile.data}`,console.log("\u2705 Generated data URL from base64 string:",i.substring(0,100)+"..."))),!i&&e.laporanFile.data&&typeof e.laporanFile.data=="object"){if(e.laporanFile.data._bsontype==="Binary"||e.laporanFile.data._bsontype==="Binary"){console.log("\u{1F504} Converting BSON Binary to base64...");let n=Buffer.from(e.laporanFile.data.value||e.laporanFile.data.buffer||e.laporanFile.data.data).toString("base64");i=`data:${e.laporanFile.contentType};base64,${n}`,console.log("\u2705 Generated data URL from BSON Binary:",i.substring(0,100)+"...")}else if(e.laporanFile.data.buffer&&typeof e.laporanFile.data.buffer=="object"){console.log("\u{1F504} Converting data with buffer property...");let n=Buffer.from(e.laporanFile.data.buffer).toString("base64");i=`data:${e.laporanFile.contentType};base64,${n}`,console.log("\u2705 Generated data URL from buffer property:",i.substring(0,100)+"...")}}i||(console.log("\u{1F4DD} Full laporanFile structure for debugging:",JSON.stringify(e.laporanFile,null,2)),console.log("\u{1F4DD} Data property:",e.laporanFile.data),console.log("\u{1F4DD} Data type:",typeof e.laporanFile.data),console.log("\u{1F4DD} Data constructor:",e.laporanFile.data?.constructor?.name))}console.log("\u{1F4DD} Final dataUrl result:",i?"SUCCESS - "+i.substring(0,100)+"...":"FAILED - No data URL generated"),this.realisasiFormData.laporanPreview={name:e.laporanFile.filename,size:a,type:e.laporanFile.contentType||"application/pdf",lastModified:new Date,isExisting:!0,dataUrl:i},console.log("\u{1F4DD} File preview created:",this.realisasiFormData.laporanPreview)}catch(a){console.error("\u274C Error creating file preview:",a),console.error("\u{1F4DD} Error details:",a.message),console.error("\u{1F4DD} Stack trace:",a.stack),this.realisasiFormData.laporanPreview={name:e.laporanFile.filename,size:0,type:e.laporanFile.contentType||"application/pdf",lastModified:new Date,isExisting:!0,dataUrl:null}}this.showRealisasiModal=!0,console.log("\u{1F4DD} Modal state set to true, forcing redraw"),ve.default.redraw(),console.log("\u{1F4DD} Redraw completed")},closeRealisasiModal:function(){this.showRealisasiModal=!1,this.realisasiFormData={terminId:"",laporanDate:"",periodeMulai:"",periodeSampai:"",realisasiFisik:0,realisasiBelanja:0,laporanFile:null,laporanPreview:null}},handleFileUpload:function(e){let r=e.target.files[0];if(!r)return;if(r.type!=="application/pdf"){ct.error("Hanya file PDF yang diperbolehkan");return}if(r.size>1024*1024){ct.error("Ukuran file maksimal 1MB");return}console.log("PDF file selected:",{name:r.name,size:r.size,type:r.type,lastModified:new Date(r.lastModified)});let f=new FileReader;f.onload=a=>{this.realisasiFormData.laporanFile=r,this.realisasiFormData.laporanPreview={name:r.name,size:r.size,type:r.type,lastModified:new Date(r.lastModified),dataUrl:a.target.result},console.log("PDF file and preview set:",this.realisasiFormData.laporanPreview),ve.default.redraw()},f.onerror=a=>{console.error("Error reading PDF file:",a),ct.error("Gagal membaca file PDF")},f.readAsDataURL(r)},removeFile:function(){this.realisasiFormData.laporanFile=null,this.realisasiFormData.laporanPreview=null,this.realisasiFormData.isEditing&&console.log("\u{1F4DD} Removing new file upload, keeping existing file reference");let e=document.querySelector('input[type="file"][accept="application/pdf"]');e&&(e.value=""),ve.default.redraw()},saveRealisasi:async function(){if(!this.realisasiFormData.laporanDate){ct.error("Tanggal laporan harus diisi");return}if(!this.realisasiFormData.periodeMulai||!this.realisasiFormData.periodeSampai){ct.error("Periode mulai dan selesai harus diisi");return}if(new Date(this.realisasiFormData.periodeMulai)>new Date(this.realisasiFormData.periodeSampai)){ct.error("Periode mulai tidak boleh lebih besar dari periode selesai");return}if(this.selectedKontrak){let e=new Date(this.selectedKontrak.tglPelaksanaanDari),r=new Date(this.selectedKontrak.tglPelaksanaanSampai),f=new Date(this.realisasiFormData.periodeMulai),a=new Date(this.realisasiFormData.periodeSampai);if(f<e||f>r){ct.error("Periode mulai harus berada dalam rentang tanggal kontrak");return}if(a<e||a>r){ct.error("Periode selesai harus berada dalam rentang tanggal kontrak");return}}if(this.realisasiFormData.realisasiFisik<0||this.realisasiFormData.realisasiFisik>100){ct.error("Realisasi fisik harus antara 0-100%");return}if(this.realisasiFormData.realisasiBelanja<0){ct.error("Realisasi belanja tidak boleh negatif");return}this.isLoading=!0;try{let e=new FormData;e.append("terminId",this.realisasiFormData.terminId),e.append("laporanDate",this.realisasiFormData.laporanDate),e.append("periodeMulai",this.realisasiFormData.periodeMulai),e.append("periodeSampai",this.realisasiFormData.periodeSampai),e.append("realisasiFisik",this.realisasiFormData.realisasiFisik.toString()),e.append("realisasiBelanja",this.realisasiFormData.realisasiBelanja.toString()),this.realisasiFormData.laporanFile&&e.append("laporan",this.realisasiFormData.laporanFile);let r=Ft.getToken(),f=await fetch("/api/vendor/realisasi",{method:"POST",headers:{Authorization:r?`Bearer ${r}`:""},body:e});if(!f.ok){let i=await f.json();throw new Error(i.message||`HTTP error! status: ${f.status}`)}let a=await f.json();ct.success(a.message||"Realisasi berhasil disimpan"),this.closeRealisasiModal(),this.selectedKontrak&&await this.loadTerminForKontrak(this.selectedKontrak._id)}catch(e){console.error("Error saving realisasi:",e),ct.error(`Gagal menyimpan realisasi: ${e.message}`)}finally{this.isLoading=!1,ve.default.redraw()}},getProgressPercentage:function(e){if(!e.termin||e.termin.length===0)return 0;let r=e.termin.filter(a=>this.hasTerminRealisasi(a));if(r.length>0){let a=r.reduce((i,t)=>i+(t.realisasiFisik||0),0);return Math.round(a/r.length)}let f=e.termin.reduce((a,i)=>a+(i.persentaseDana||0),0);return Math.round(f/e.termin.length)},hasReportedRealisasi:function(e){return!e.termin||e.termin.length===0?!1:e.termin.some(r=>this.hasTerminRealisasi(r))},isOverdue:function(e){let r=new Date;return new Date(e.tglPelaksanaanSampai)<r&&e.status!=="completed"},getStatusColor:function(e){return e.status==="completed"?"bg-green-100 text-green-800":this.isOverdue(e)?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"},getStatusText:function(e){return e.status==="completed"?"Selesai":this.isOverdue(e)?"Terlambat":"Aktif"},formatCurrency:function(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e)},formatNumber:function(e){return!e||isNaN(e)?"0":new Intl.NumberFormat("id-ID").format(e)},parseFormattedNumber:function(e){if(!e)return 0;let r=e.replace(/[^\d]/g,"");return parseInt(r)||0},formatDate:function(e){return new Date(e).toLocaleDateString("id-ID")},logout:function(){be.confirm("Apakah Anda yakin ingin keluar?",()=>{Ft.clearAuthData(),ve.default.route.set("/login")})},view:function(){return(0,ve.default)("div",{class:"min-h-screen bg-gray-50"},[(0,ve.default)("div",{class:"bg-white shadow-sm border-b border-gray-200"},[(0,ve.default)("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},[(0,ve.default)("div",{class:"flex justify-between items-center py-4"},[(0,ve.default)("div",[(0,ve.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Portal Penyedia Barang dan Jasa"),(0,ve.default)("div",{class:"mt-2 space-y-1"},[this.perangkatDaerah&&(0,ve.default)("p",{class:"text-sm text-gray-700 font-medium"},`${this.perangkatDaerah.nama}`),this.perangkatDaerah&&this.perangkatDaerah.namaPemda&&(0,ve.default)("p",{class:"text-sm text-gray-600"},this.perangkatDaerah.namaPemda),this.penyedia&&(0,ve.default)("div",{class:"mt-2"},[(0,ve.default)("p",{class:"text-sm text-gray-800 font-medium"},this.penyedia.NamaVendor),this.penyedia.Alamat&&(0,ve.default)("p",{class:"text-sm text-gray-600"},this.penyedia.Alamat)]),(0,ve.default)("p",{class:"text-xs text-gray-500 mt-1"},`Pengguna: ${this.userData?.username} | ${this.userData?.budgetYear?`${this.userData.budgetYear.year}-${this.userData.budgetYear.status}`:"N/A"}`)])]),(0,ve.default)("button",{class:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors",onclick:()=>this.logout()},[(0,ve.default)("i",{class:"ri-logout-box-r-line mr-2"}),"Keluar"])])])]),(0,ve.default)("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},[(0,ve.default)("div",{class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},[(0,ve.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,ve.default)("div",{class:"flex items-center"},[(0,ve.default)("div",{class:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"},[(0,ve.default)("i",{class:"ri-file-list-3-line text-blue-600 text-xl"})]),(0,ve.default)("div",{class:"ml-4"},[(0,ve.default)("p",{class:"text-sm font-medium text-gray-600"},"Total Kontrak"),(0,ve.default)("p",{class:"text-2xl font-bold text-gray-900"},this.kontrakList.length)])])]),(0,ve.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,ve.default)("div",{class:"flex items-center"},[(0,ve.default)("div",{class:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center"},[(0,ve.default)("i",{class:"ri-check-line text-green-600 text-xl"})]),(0,ve.default)("div",{class:"ml-4"},[(0,ve.default)("p",{class:"text-sm font-medium text-gray-600"},"Kontrak Selesai"),(0,ve.default)("p",{class:"text-2xl font-bold text-gray-900"},this.kontrakList.filter(e=>e.status==="completed").length)])])]),(0,ve.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,ve.default)("div",{class:"flex items-center"},[(0,ve.default)("div",{class:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center"},[(0,ve.default)("i",{class:"ri-time-line text-yellow-600 text-xl"})]),(0,ve.default)("div",{class:"ml-4"},[(0,ve.default)("p",{class:"text-sm font-medium text-gray-600"},"Kontrak Aktif"),(0,ve.default)("p",{class:"text-2xl font-bold text-gray-900"},this.kontrakList.filter(e=>!this.isOverdue(e)&&e.status!=="completed").length)])])]),(0,ve.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,ve.default)("div",{class:"flex items-center"},[(0,ve.default)("div",{class:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center"},[(0,ve.default)("i",{class:"ri-error-warning-line text-red-600 text-xl"})]),(0,ve.default)("div",{class:"ml-4"},[(0,ve.default)("p",{class:"text-sm font-medium text-gray-600"},"Terlambat"),(0,ve.default)("p",{class:"text-2xl font-bold text-gray-900"},this.kontrakList.filter(e=>this.isOverdue(e)).length)])])])]),(0,ve.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,ve.default)("div",{class:"p-6 border-b border-gray-200"},[(0,ve.default)("div",{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},[(0,ve.default)("div",[(0,ve.default)("h2",{class:"text-lg font-semibold text-gray-900"},"Daftar Kontrak"),(0,ve.default)("p",{class:"text-sm text-gray-600 mt-1"},"Kontrak yang tersedia untuk pelaporan realisasi")])])]),(0,ve.default)("div",{class:"p-6 border-b border-gray-200 bg-gray-50"},[(0,ve.default)("div",{class:"flex flex-col sm:flex-row gap-4"},[(0,ve.default)("div",{class:"flex-1"},[(0,ve.default)("div",{class:"relative"},[(0,ve.default)("input",{type:"text",placeholder:"Cari kontrak...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:this.searchQuery,oninput:e=>{this.searchQuery=e.target.value,this.handleSearch()}}),(0,ve.default)("i",{class:"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})])]),(0,ve.default)("select",{class:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:this.statusFilter,onchange:e=>{this.statusFilter=e.target.value,this.filterByStatus()}},[(0,ve.default)("option",{value:"all"},"Semua Status"),(0,ve.default)("option",{value:"active"},"Aktif"),(0,ve.default)("option",{value:"completed"},"Selesai")])])]),(0,ve.default)("div",{class:"p-6"},[this.isLoading?(0,ve.default)("div",{class:"flex justify-center items-center py-12"},[(0,ve.default)("div",{class:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):this.filteredKontrak.length===0?(0,ve.default)("div",{class:"text-center py-12"},[(0,ve.default)("i",{class:"ri-file-list-line text-4xl text-gray-400 mb-4"}),(0,ve.default)("p",{class:"text-gray-500"},"Belum ada kontrak")]):(0,ve.default)("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},[this.filteredKontrak.map(e=>{let r=this.getProgressPercentage(e),f=this.hasReportedRealisasi(e),a=this.isOverdue(e),i=f?"border-green-500 bg-green-50 shadow-lg ring-1 ring-green-200":a?"border-red-200 bg-red-50/40":"border-gray-200 bg-white",t=f?"bg-green-500":a?"bg-red-500":"bg-blue-600";return(0,ve.default)("div",{key:e._id,class:`rounded-lg p-6 transition-all cursor-pointer hover:shadow-lg hover:-translate-y-0.5 ${i}`,onclick:()=>this.openKontrakDetail(e)},[(0,ve.default)("div",{class:"flex justify-between items-start mb-4 gap-3"},[(0,ve.default)("div",[(0,ve.default)("h3",{class:"font-semibold text-gray-900 text-lg"},e.noKontrak),(0,ve.default)("p",{class:"text-sm text-gray-600 mt-1"},e.kodeSirupLkpp),this.penyedia&&(0,ve.default)("p",{class:"text-[11px] text-gray-500 mt-0.5"},this.penyedia.NamaVendor)]),(0,ve.default)("div",{class:"flex flex-col items-end space-y-1"},[(0,ve.default)("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${this.getStatusColor(e)}`},this.getStatusText(e)),f&&(0,ve.default)("span",{class:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-green-100 text-green-800 border border-green-200"},[(0,ve.default)("i",{class:"ri-check-double-line mr-1 text-[11px]"}),"Realisasi dilaporkan"]),a&&!f&&(0,ve.default)("span",{class:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium bg-red-50 text-red-700 border border-red-200"},[(0,ve.default)("i",{class:"ri-alert-line mr-1 text-[11px]"}),"Terlambat, belum ada realisasi"])])]),(0,ve.default)("div",{class:"grid grid-cols-2 gap-4 mb-4"},[(0,ve.default)("div",[(0,ve.default)("p",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Nilai Kontrak"),(0,ve.default)("p",{class:"font-semibold text-gray-900"},this.formatCurrency(e.nilaiKontrak))]),(0,ve.default)("div",[(0,ve.default)("p",{class:"text-xs text-gray-500 uppercase tracking-wide flex items-center gap-1"},["Progress",f&&(0,ve.default)("span",{class:"inline-flex items-center px-1.5 py-0.5 rounded-full text-[9px] bg-green-600 text-white"},"Real")]),(0,ve.default)("div",{class:"flex items-center mt-1"},[(0,ve.default)("div",{class:"w-20 bg-gray-200 rounded-full h-2 mr-2 overflow-hidden"},[(0,ve.default)("div",{class:`${t} h-2 rounded-full transition-all duration-300`,style:{width:`${r}%`}})]),(0,ve.default)("span",{class:`text-xs font-semibold ${f?"text-green-700":a?"text-red-700":"text-gray-900"}`},`${r}%`)])])]),(0,ve.default)("div",{class:"text-sm text-gray-600"},[(0,ve.default)("div",{class:"flex items-center mb-1"},[(0,ve.default)("i",{class:"ri-map-pin-line mr-2"}),e.lokasi]),(0,ve.default)("div",{class:"flex items-center"},[(0,ve.default)("i",{class:"ri-calendar-line mr-2"}),`${this.formatDate(e.tglPelaksanaanDari)} - ${this.formatDate(e.tglPelaksanaanSampai)}`])])])})])])])]),this.showKontrakDetail&&this.selectedKontrak&&(0,ve.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onclick:e=>{e.target===e.currentTarget&&this.closeKontrakDetail()}},[(0,ve.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"},[(0,ve.default)("div",{class:"bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-t-xl"},[(0,ve.default)("div",{class:"flex items-center justify-between"},[(0,ve.default)("div",[(0,ve.default)("h3",{class:"text-xl font-bold"},"Detail Kontrak"),(0,ve.default)("p",{class:"text-white text-opacity-80 text-sm"},this.selectedKontrak.noKontrak)]),(0,ve.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeKontrakDetail()},[(0,ve.default)("i",{class:"ri-close-fill"})])])]),(0,ve.default)("div",{class:"p-6"},[(0,ve.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},[(0,ve.default)("div",[(0,ve.default)("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"Informasi Kontrak"),(0,ve.default)("div",{class:"space-y-3"},[(0,ve.default)("div",[(0,ve.default)("span",{class:"text-sm text-gray-600"},"No. Kontrak: "),(0,ve.default)("span",{class:"font-medium"},this.selectedKontrak.noKontrak)]),(0,ve.default)("div",[(0,ve.default)("span",{class:"text-sm text-gray-600"},"Kode SIRUP/LKPP: "),(0,ve.default)("span",{class:"font-medium"},this.selectedKontrak.kodeSirupLkpp)]),(0,ve.default)("div",[(0,ve.default)("span",{class:"text-sm text-gray-600"},"Nilai Kontrak: "),(0,ve.default)("span",{class:"font-medium"},this.formatCurrency(this.selectedKontrak.nilaiKontrak))]),(0,ve.default)("div",[(0,ve.default)("span",{class:"text-sm text-gray-600"},"Lokasi: "),(0,ve.default)("span",{class:"font-medium"},this.selectedKontrak.lokasi)]),(0,ve.default)("div",[(0,ve.default)("span",{class:"text-sm text-gray-600"},"Periode: "),(0,ve.default)("span",{class:"font-medium"},`${this.formatDate(this.selectedKontrak.tglPelaksanaanDari)} - ${this.formatDate(this.selectedKontrak.tglPelaksanaanSampai)}`)])])]),(0,ve.default)("div",[(0,ve.default)("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"Progress Summary"),(0,ve.default)("div",{class:"bg-gray-50 rounded-lg p-4"},[(0,ve.default)("div",{class:"flex justify-between items-center mb-2"},[(0,ve.default)("span",{class:"text-sm text-gray-600"},"Progress Keseluruhan"),(0,ve.default)("span",{class:"font-bold text-blue-600"},`${this.getProgressPercentage(this.selectedKontrak)}%`)]),(0,ve.default)("div",{class:"w-full bg-gray-200 rounded-full h-3"},[(0,ve.default)("div",{class:"bg-blue-600 h-3 rounded-full transition-all duration-300",style:{width:`${this.getProgressPercentage(this.selectedKontrak)}%`}})])])])]),(0,ve.default)("div",[(0,ve.default)("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"Termin Pembayaran"),this.availableTermin.length===0?(0,ve.default)("div",{class:"text-center py-8 text-gray-500"},[(0,ve.default)("i",{class:"ri-file-list-line text-3xl mb-2"}),(0,ve.default)("p","Belum ada termin")]):(0,ve.default)("div",{class:"space-y-4"},[this.availableTermin.sort((e,r)=>{let f=a=>typeof a=="string"?{I:1,II:2,III:3,IV:4,V:5,VI:6,VII:7,VIII:8,IX:9,X:10}[a.toUpperCase()]||parseInt(a)||999:0;return f(e.termin)-f(r.termin)}).map(e=>{let r=e.realisasiFisik!==void 0&&e.realisasiFisik!==null&&e.realisasiFisik>0,f=e.laporanFile&&e.laporanFile.filename,a=r||e.realisasiBelanja&&e.realisasiBelanja>0;return(0,ve.default)("div",{key:e._id,class:`border rounded-lg p-4 ${a?"border-green-200 bg-green-50":"border-gray-200"}`},[(0,ve.default)("div",{class:"flex justify-between items-start"},[(0,ve.default)("div",[(0,ve.default)("div",{class:"flex items-center gap-2 mb-1"},[(0,ve.default)("h5",{class:"font-medium text-gray-900"},e.termin),a&&(0,ve.default)("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},[(0,ve.default)("i",{class:"ri-check-line mr-1"}),"Dilaporkan"]),f&&(0,ve.default)("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},[(0,ve.default)("i",{class:"ri-file-pdf-line mr-1"}),"PDF"])]),(0,ve.default)("p",{class:"text-sm text-gray-600 mb-2"},`Persentase: ${e.persentaseDana}% | Dana: ${this.formatCurrency(e.jumlahDana)}`),a?(0,ve.default)("div",{class:"bg-white rounded p-3 border border-gray-200 mt-2"},[(0,ve.default)("div",{class:"grid grid-cols-2 gap-4 text-sm"},[(0,ve.default)("div",[(0,ve.default)("span",{class:"text-gray-500"},"Realisasi Fisik: "),(0,ve.default)("span",{class:"font-medium text-green-700"},`${e.realisasiFisik||0}%`)]),(0,ve.default)("div",[(0,ve.default)("span",{class:"text-gray-500"},"Realisasi Belanja: "),(0,ve.default)("span",{class:"font-medium text-green-700"},this.formatCurrency(e.realisasiBelanja||0))])]),e.laporanDate&&(0,ve.default)("div",{class:"mt-2 text-xs text-gray-500"},[(0,ve.default)("i",{class:"ri-calendar-line mr-1"}),`Dilaporkan: ${this.formatDate(e.laporanDate)}`]),e.periodeMulai&&e.periodeSampai&&(0,ve.default)("div",{class:"text-xs text-gray-500"},[(0,ve.default)("i",{class:"ri-time-line mr-1"}),`Periode: ${this.formatDate(e.periodeMulai)} - ${this.formatDate(e.periodeSampai)}`])]):null]),(0,ve.default)("div",{class:"flex items-center space-x-2"},[e.isPaid?(0,ve.default)("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},"Sudah Dibayar"):(0,ve.default)("div",{class:"flex flex-col gap-2"},[a?(0,ve.default)("button",{class:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors",onclick:i=>{i.preventDefault(),i.stopPropagation(),console.log("\u{1F527} Edit button clicked for termin:",e.termin),console.log("\u{1F527} Termin data:",e),this.openRealisasiModal(e)},title:"Klik untuk edit laporan realisasi"},[(0,ve.default)("i",{class:"ri-edit-line mr-1"}),"Edit Laporan"]):(0,ve.default)("button",{class:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors",onclick:i=>{i.stopPropagation(),this.openRealisasiModal(e)}},"Lapor Realisasi")])])])])})])])])])]),this.showRealisasiModal&&(0,ve.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onclick:e=>{e.target===e.currentTarget&&this.closeRealisasiModal()}},[(0,ve.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-6xl w-full"},[(0,ve.default)("div",{class:"bg-gradient-to-r from-green-500 to-teal-600 text-white p-6 rounded-t-xl"},[(0,ve.default)("div",{class:"flex items-center justify-between"},[(0,ve.default)("div",[(0,ve.default)("h3",{class:"text-xl font-bold"},this.realisasiFormData.isEditing?"Edit Realisasi":"Lapor Realisasi"),(0,ve.default)("p",{class:"text-white text-opacity-80 text-sm"},"Input data realisasi progresso berdasarkan periode")]),(0,ve.default)("button",{class:"w-8 h-8 bg-green-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeRealisasiModal()},[(0,ve.default)("i",{class:"ri-close-fill"})])])]),(0,ve.default)("div",{class:"p-6"},[(0,ve.default)("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},[(0,ve.default)("div",{class:"space-y-4"},[(0,ve.default)("div",[(0,ve.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,ve.default)("i",{class:"ri-calendar-todo-line mr-1 text-purple-500"}),"Tanggal Laporan"]),(0,ve.default)("input",{type:"date",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200",value:this.realisasiFormData.laporanDate,oninput:e=>{this.realisasiFormData.laporanDate=e.target.value}})]),(0,ve.default)("div",[(0,ve.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,ve.default)("i",{class:"ri-calendar-line mr-1 text-blue-500"}),"Periode Mulai"]),this.selectedKontrak&&(0,ve.default)("p",{class:"text-xs text-gray-500 mb-2"},`Kontrak mulai: ${this.selectedKontrak.tglPelaksanaanDari?new Date(this.selectedKontrak.tglPelaksanaanDari).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"}`),(0,ve.default)("input",{type:"date",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200",value:this.realisasiFormData.periodeMulai,min:this.selectedKontrak?this.selectedKontrak.tglPelaksanaanDari:"",max:this.selectedKontrak?this.selectedKontrak.tglPelaksanaanSampai:"",oninput:e=>{this.realisasiFormData.periodeMulai=e.target.value}})]),(0,ve.default)("div",[(0,ve.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,ve.default)("i",{class:"ri-calendar-line mr-1 text-green-500"}),"Periode Sampai"]),this.selectedKontrak&&(0,ve.default)("p",{class:"text-xs text-gray-500 mb-2"},`Kontrak selesai: ${this.selectedKontrak.tglPelaksanaanSampai?new Date(this.selectedKontrak.tglPelaksanaanSampai).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"}`),(0,ve.default)("input",{type:"date",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-200",value:this.realisasiFormData.periodeSampai,min:this.selectedKontrak?this.selectedKontrak.tglPelaksanaanDari:"",max:this.selectedKontrak?this.selectedKontrak.tglPelaksanaanSampai:"",oninput:e=>{this.realisasiFormData.periodeSampai=e.target.value}})]),(0,ve.default)("div",[(0,ve.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,ve.default)("i",{class:"ri-bar-chart-line mr-1 text-green-500"}),"Realisasi Fisik"]),(0,ve.default)("div",{class:"relative"},[(0,ve.default)("input",{type:"number",min:"0",max:"100",step:"0.1",class:"w-full px-4 py-3 pr-8 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-200",placeholder:"0-100",value:this.realisasiFormData.realisasiFisik||"",oninput:e=>{let r=parseFloat(e.target.value)||0;this.realisasiFormData.realisasiFisik=Math.min(Math.max(r,0),100)}}),(0,ve.default)("div",{class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm pointer-events-none"},"%")])]),(0,ve.default)("div",[(0,ve.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,ve.default)("i",{class:"ri-money-dollar-circle-line mr-1 text-amber-500"}),"Realisasi Belanja (Rp)"]),(0,ve.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all duration-200",placeholder:"0",value:this.realisasiFormData.realisasiBelanja?this.formatNumber(this.realisasiFormData.realisasiBelanja):"",oninput:e=>{let r=this.parseFormattedNumber(e.target.value);this.realisasiFormData.realisasiBelanja=r,e.target.value=this.formatNumber(r)}})]),(0,ve.default)("div",[(0,ve.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,ve.default)("i",{class:"ri-file-pdf-line mr-1 text-red-500"}),"Laporan (PDF max 1MB)"]),(0,ve.default)("input",{type:"file",accept:"application/pdf",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all duration-200",onchange:e=>this.handleFileUpload(e)}),this.realisasiFormData.laporanPreview&&!this.realisasiFormData.laporanPreview.isExisting&&(0,ve.default)("div",{class:"mt-3 p-3 bg-red-50 rounded-lg border border-red-200"},[(0,ve.default)("div",{class:"flex items-center justify-between"},[(0,ve.default)("div",[(0,ve.default)("div",{class:"flex items-center text-sm font-medium text-red-800"},[(0,ve.default)("i",{class:"ri-file-pdf-line mr-2"}),this.realisasiFormData.laporanPreview.name]),(0,ve.default)("div",{class:"text-xs text-red-600 mt-1"},`Size: ${(this.realisasiFormData.laporanPreview.size/1024).toFixed(1)} KB | Type: ${this.realisasiFormData.laporanPreview.type}`)]),(0,ve.default)("button",{type:"button",class:"ml-3 text-red-500 hover:text-red-700 text-sm",onclick:()=>this.removeFile()},[(0,ve.default)("i",{class:"ri-delete-bin-line mr-1"}),"Remove"])])]),this.realisasiFormData.laporanPreview&&this.realisasiFormData.laporanPreview.isExisting&&(0,ve.default)("div",{class:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200"},[(0,ve.default)("div",{class:"flex items-center justify-between"},[(0,ve.default)("div",[(0,ve.default)("div",{class:"flex items-center text-sm font-medium text-blue-800"},[(0,ve.default)("i",{class:"ri-file-pdf-line mr-2"}),this.realisasiFormData.laporanPreview.name,(0,ve.default)("span",{class:"ml-2 text-xs bg-blue-100 px-2 py-1 rounded"},"File Database")]),(0,ve.default)("div",{class:"text-xs text-blue-600 mt-1"},"File tersimpan di database. Upload file baru untuk mengganti.")])])])])]),(0,ve.default)("div",{class:"bg-gray-50 rounded-lg p-4"},[(0,ve.default)("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"Preview Laporan"),this.realisasiFormData.laporanPreview?(0,ve.default)("div",{class:"space-y-4"},[(0,ve.default)("div",{class:"bg-white rounded-lg p-4 border border-gray-200"},[(0,ve.default)("div",{class:"flex items-center text-sm text-gray-600"},[(0,ve.default)("i",{class:"ri-file-pdf-line text-red-500 mr-2"}),(0,ve.default)("span",{class:"font-medium"},this.realisasiFormData.laporanPreview.name),this.realisasiFormData.laporanPreview.size?(0,ve.default)("span",{class:"ml-2 text-xs"},`(${this.realisasiFormData.laporanPreview.size?(this.realisasiFormData.laporanPreview.size/1024).toFixed(1):"N/A"} KB)`):null])]),this.realisasiFormData.laporanFile||this.realisasiFormData.laporanPreview&&this.realisasiFormData.laporanPreview.dataUrl?(0,ve.default)("div",{class:"h-80 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 overflow-hidden"},[(0,ve.default)("iframe",{src:this.realisasiFormData.laporanFile?URL.createObjectURL(this.realisasiFormData.laporanFile):this.realisasiFormData.laporanPreview.dataUrl,class:"w-full h-full border-0",title:"PDF Preview"})]):(0,ve.default)("div",{class:"h-80 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center"},[(0,ve.default)("div",{class:"text-center"},[(0,ve.default)("i",{class:"ri-file-pdf-line text-4xl text-gray-400 mb-2"}),(0,ve.default)("p",{class:"text-gray-600 font-medium"},this.realisasiFormData.laporanPreview.name),(0,ve.default)("p",{class:"text-xs text-gray-500 mt-1"},"File tersimpan di database"),(0,ve.default)("p",{class:"text-xs text-gray-500"},"Upload file baru untuk mengganti")])]),(0,ve.default)("div",{class:"text-xs text-gray-500 text-center mt-2"},[this.realisasiFormData.laporanFile?"PDF dapat dilihat menggunakan browser atau diunduh untuk review":"File tersimpan di database - upload file baru untuk memperbarui"])]):(0,ve.default)("div",{class:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center"},[(0,ve.default)("i",{class:"ri-file-add-line text-4xl text-gray-400 mb-4"}),(0,ve.default)("p",{class:"text-gray-500 mb-2"},"Upload file PDF untuk preview"),(0,ve.default)("p",{class:"text-xs text-gray-400"},"File akan muncul di viewer setelah upload")])])])]),(0,ve.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-xl"},[(0,ve.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.closeRealisasiModal()},[(0,ve.default)("i",{class:"ri-close-fill"}),(0,ve.default)("span","Batal")]),(0,ve.default)("button",{class:`px-6 py-3 bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 ${this.isLoading?"opacity-75 cursor-not-allowed":""}`,onclick:()=>this.saveRealisasi(),disabled:this.isLoading},[this.isLoading?(0,ve.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,ve.default)("i",{class:"ri-save-line"}),(0,ve.default)("span",this.isLoading?"Menyimpan...":this.realisasiFormData.isEditing?"Perbarui Laporan":"Simpan Laporan")])])])])])}},oi=ko;var Ee=sr(lr(),1);var Qr=sr(si(),1),So=new Qr.default.Schema({kode:{type:String,required:!0,unique:!0},nama:{type:String,required:!0}},{timestamps:!0}),Xa=new Qr.default.Schema({kode:{type:String,required:!0},nama:{type:String,required:!0},urusanId:{type:Qr.default.Schema.Types.ObjectId,ref:"Urusan",required:!0}},{timestamps:!0}),Za=new Qr.default.Schema({kode:{type:String,required:!0},nama:{type:String,required:!0},bidangId:{type:Qr.default.Schema.Types.ObjectId,ref:"Bidang",required:!0}},{timestamps:!0}),en=new Qr.default.Schema({kode:{type:String,required:!0},nama:{type:String,required:!0},programId:{type:Qr.default.Schema.Types.ObjectId,ref:"Program",required:!0}},{timestamps:!0}),tn=new Qr.default.Schema({kode:{type:String,required:!0},nama:{type:String,required:!0},kinerja:{type:String,required:!0},indikator:{type:String,required:!0},satuan:{type:String,required:!0},kegiatanId:{type:Qr.default.Schema.Types.ObjectId,ref:"Kegiatan",required:!0}},{timestamps:!0});Xa.index({kode:1,urusanId:1});Xa.index({urusanId:1});Za.index({kode:1,bidangId:1});Za.index({bidangId:1});en.index({kode:1,programId:1});en.index({programId:1});tn.index({kode:1,kegiatanId:1});tn.index({kegiatanId:1});var Us=Qr.default.model("Urusan",So),Cs=Qr.default.model("Bidang",Xa),Vs=Qr.default.model("Program",Za),qs=Qr.default.model("Kegiatan",en),zs=Qr.default.model("SubKegiatan",tn);Wr();var Po={isLoading:!1,data:{urusan:[],bidang:[],program:[],kegiatan:[],subKegiatan:[]},showModal:!1,modalMode:"create",modalLevel:"",currentItem:null,formData:{kode:"",nama:"",kinerja:"",indikator:"",satuan:""},openAccordions:new Set,oninit:function(){if(!et.isAuthenticated()){ct.warning("\u{1F510} Akses ditolak. Silakan masuk terlebih dahulu."),Ee.default.route.set("/login");return}this.vnode&&this.vnode.attrs&&this.vnode.attrs.setTitle&&this.vnode.attrs.setTitle("Manajemen Urusan s.d. Sub Kegiatan"),this.userData=et.getUserData(),this.loadHierarchyData()},loadHierarchyData:async function(){this.isLoading=!0,Ee.default.redraw();try{if(console.log("\u{1F504} Loading hierarchy data..."),!et.isAuthenticated()){console.log("\u274C User not authenticated, redirecting to login"),ct.warning("Silakan masuk terlebih dahulu"),Ee.default.route.set("/login");return}if(!Ft.getToken()){console.log("\u274C No token available, clearing auth data and redirecting to login"),Ft.clearAuthData(),ct.warning("Sesi login tidak valid. Silakan masuk kembali."),setTimeout(()=>Ee.default.route.set("/login"),1500);return}console.log("\u2705 Token available, proceeding with data load..."),console.log("\u2705 User authenticated, loading data..."),console.log("Token available:",!!Ft.getToken()),console.log("Token preview:",Ft.getToken()?.substring(0,20)+"..."),console.log("\u{1F504} Making parallel API requests for hierarchy data...");let[r,f,a,i,t]=await Promise.all([Ce.getAll("urusan").catch(c=>(console.error("\u274C Error fetching urusan:",c),{success:!1,data:[]})),Ce.getAll("bidang").catch(c=>(console.error("\u274C Error fetching bidang:",c),{success:!1,data:[]})),Ce.getAll("program").catch(c=>(console.error("\u274C Error fetching program:",c),{success:!1,data:[]})),Ce.getAll("kegiatan").catch(c=>(console.error("\u274C Error fetching kegiatan:",c),{success:!1,data:[]})),Ce.getAll("subkegiatan").catch(c=>(console.error("\u274C Error fetching subkegiatan:",c),{success:!1,data:[]}))]);console.log("\u{1F4CA} API Responses:",{urusan:{success:r?.success,dataLength:r?.data?.length||0},bidang:{success:f?.success,dataLength:f?.data?.length||0},program:{success:a?.success,dataLength:a?.data?.length||0},kegiatan:{success:i?.success,dataLength:i?.data?.length||0},subKegiatan:{success:t?.success,dataLength:t?.data?.length||0}}),this.data.urusan=Array.isArray(r.data)?r.data:[],this.data.bidang=Array.isArray(f.data)?f.data:[],this.data.program=Array.isArray(a.data)?a.data:[],this.data.kegiatan=Array.isArray(i.data)?i.data:[],this.data.subKegiatan=Array.isArray(t.data)?t.data:[],console.log("\u2705 Hierarchy data loaded:",{urusan:this.data.urusan?.length||0,bidang:this.data.bidang?.length||0,program:this.data.program?.length||0,kegiatan:this.data.kegiatan?.length||0,subKegiatan:this.data.subKegiatan?.length||0}),Array.isArray(this.data.urusan)||(console.warn("\u26A0\uFE0F Urusan data is not an array, fixing..."),this.data.urusan=[]),Array.isArray(this.data.bidang)||(console.warn("\u26A0\uFE0F Bidang data is not an array, fixing..."),this.data.bidang=[]),Array.isArray(this.data.program)||(console.warn("\u26A0\uFE0F Program data is not an array, fixing..."),this.data.program=[]),Array.isArray(this.data.kegiatan)||(console.warn("\u26A0\uFE0F Kegiatan data is not an array, fixing..."),this.data.kegiatan=[]),Array.isArray(this.data.subKegiatan)||(console.warn("\u26A0\uFE0F SubKegiatan data is not an array, fixing..."),this.data.subKegiatan=[]),console.log("\u{1F50D} Urusan data:",this.data.urusan.map(c=>({id:c._id,kode:c.kode,nama:c.nama,bidangCount:this.getBidangByUrusan(c._id).length}))),console.log("\u{1F50D} Bidang data:",this.data.bidang.map(c=>({id:c._id,kode:c.kode,nama:c.nama,urusanId:c.urusanId?._id||c.urusanId,urusanIdType:typeof c.urusanId})));let n=this.data.bidang.filter(c=>{let b=c.urusanId?._id||c.urusanId;return!this.data.urusan.some(x=>x._id===b)});n.length>0&&console.warn("\u26A0\uFE0F Found orphaned bidang (no matching urusan):",n)}catch(e){console.error("\u274C Error loading hierarchy data:",e),e.code===401||e.response&&e.response.status===401?(console.log("\u274C Authentication error, redirecting to login"),ct.warning("Sesi login telah berakhir. Silakan masuk kembali."),Ee.default.route.set("/login")):e.message&&(e.message.includes("Failed to fetch")||e.message.includes("NetworkError"))?ct.error("Tidak dapat terhubung ke server. Periksa koneksi internet Anda."):ct.error("Gagal memuat data hierarki")}this.isLoading=!1,Ee.default.redraw()},openCreateModal:function(e,r=null){this.modalMode="create",this.modalLevel=e,this.currentItem={parentId:r},this.formData={kode:"",nama:"",kinerja:"",indikator:"",satuan:""},this.showModal=!0,Ee.default.redraw()},openEditModal:function(e,r){this.modalMode="edit",this.modalLevel=e,this.currentItem=r,this.formData={kode:r.kode||"",nama:r.nama||""},e==="subkegiatan"&&(this.formData.kinerja=r.kinerja||"",this.formData.indikator=r.indikator||"",this.formData.satuan=r.satuan||""),this.showModal=!0,Ee.default.redraw()},openDeleteModal:function(e,r){this.modalMode="delete",this.modalLevel=e,this.currentItem=r,this.showModal=!0,Ee.default.redraw()},closeModal:function(){this.showModal=!1,this.currentItem=null,Ee.default.redraw()},saveItem:async function(){if(!et.isAuthenticated()){ct.warning("Sesi login telah berakhir. Silakan masuk kembali."),Ee.default.route.set("/login");return}if(!this.formData.kode||!this.formData.nama){ct.warning("\u26A0\uFE0F Kode dan nama harus diisi dengan lengkap!");return}this.isLoading=!0,Ee.default.redraw();try{let e=this.modalLevel,r;if(this.modalMode==="create"){let f={...this.formData,...this.currentItem.parentId&&{[`${this.modalLevel==="bidang"?"urusan":this.modalLevel==="program"?"bidang":this.modalLevel==="kegiatan"?"program":"kegiatan"}Id`]:this.currentItem.parentId}};r=await Ce.create(e,f)}else r=await Ce.update(e,this.currentItem._id,this.formData);r&&(this.closeModal(),this.loadHierarchyData())}catch(e){console.error("Error saving item:",e)}this.isLoading=!1,Ee.default.redraw()},deleteItem:async function(){if(!et.isAuthenticated()){ct.warning("Sesi login telah berakhir. Silakan masuk kembali."),Ee.default.route.set("/login");return}if(this.currentItem){try{let e=Ft.getToken();if(!e){ct.error("Token autentikasi tidak ditemukan");return}let f={urusan:"bidang",bidang:"program",program:"kegiatan",kegiatan:"subkegiatan"}[this.modalLevel];if(f){let a=await fetch(`/api/${f}?${this.modalLevel}Id=${this.currentItem._id}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(a.ok){let t=(await a.json()).data||[];if(t.length>0){let n=t.slice(0,5).map(w=>`\u2022 ${w.kode} - ${w.nama}`).join(`
`),c=t.length-5,b=c>0?`
...dan ${c} lagi`:"";ia(`${{urusan:"Urusan",bidang:"Bidang",program:"Program",kegiatan:"Kegiatan"}[this.modalLevel]} "${this.currentItem.nama}" memiliki ${t.length} anak dalam hierarki dan tidak dapat dihapus:

${n}${b}

Hapus semua ${f} anak terlebih dahulu sebelum menghapus ${this.modalLevel} ini.`,()=>{ct.info(`Hapus semua ${f} anak terlebih dahulu`)},()=>{ct.info("Penghapusan dibatalkan")});return}}}if(this.modalLevel==="subkegiatan"){let a=await fetch(`/api/anggaran?subKegiatanId=${this.currentItem._id}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(a.ok){let t=(await a.json()).data||[];if(t.length>0){let n=t.map(c=>`\u2022 ${c.budgetYear} - Rp ${new Intl.NumberFormat("id-ID").format(c.totalAmount)}`).join(`
`);ia(`SubKegiatan "${this.currentItem.nama}" sedang digunakan dalam ${t.length} anggaran dan tidak dapat dihapus:

${n}

Hapus anggaran terlebih dahulu sebelum menghapus subkegiatan ini.`,()=>{ct.info("Hapus anggaran terlebih dahulu")},()=>{ct.info("Penghapusan dibatalkan")});return}}}}catch(e){console.error("Error checking hierarchical relationships:",e),ct.error("Gagal memeriksa hubungan hierarki");return}this.isLoading=!0,Ee.default.redraw();try{let e=this.modalLevel,r=`${this.formData.kode} - ${this.formData.nama}`;await Ce.delete(e,this.currentItem._id,r)&&(this.closeModal(),this.loadHierarchyData())}catch(e){console.error("Error deleting item:",e)}this.isLoading=!1,Ee.default.redraw()}},toggleAccordion:function(e){this.openAccordions.has(e)?this.openAccordions.delete(e):this.openAccordions.add(e),Ee.default.redraw()},isAccordionOpen:function(e){return this.openAccordions.has(e)},getBidangByUrusan:function(e){return Array.isArray(this.data.bidang)?this.data.bidang.filter(r=>(r.urusanId?._id||r.urusanId)===e):(console.warn("\u26A0\uFE0F Bidang data is not an array"),[])},getProgramByBidang:function(e){return Array.isArray(this.data.program)?this.data.program.filter(r=>(r.bidangId?._id||r.bidangId)===e):(console.warn("\u26A0\uFE0F Program data is not an array"),[])},getKegiatanByProgram:function(e){return Array.isArray(this.data.kegiatan)?this.data.kegiatan.filter(r=>(r.programId?._id||r.programId)===e):(console.warn("\u26A0\uFE0F Kegiatan data is not an array"),[])},getSubKegiatanByKegiatan:function(e){return Array.isArray(this.data.subKegiatan)?this.data.subKegiatan.filter(r=>(r.kegiatanId?._id||r.kegiatanId)===e):(console.warn("\u26A0\uFE0F SubKegiatan data is not an array"),[])},renderItemActions:function(e,r){return(0,Ee.default)("div",{class:"flex gap-1",style:"display: flex; align-items: center; flex-shrink: 0;"},[(0,Ee.default)("button",{class:"w-8 h-8 bg-transparent hover:bg-gray-100 rounded border border-gray-300 flex items-center justify-center flex-shrink-0",onclick:f=>{f.stopPropagation(),this.openEditModal(e,r)},title:"Edit"},[(0,Ee.default)("i",{class:"ri-edit-line text-yellow-500 text-sm"})]),(0,Ee.default)("button",{class:"w-8 h-8 bg-transparent hover:bg-gray-100 rounded border border-gray-300 flex items-center justify-center flex-shrink-0",onclick:f=>{f.stopPropagation(),this.openDeleteModal(e,r)},title:"Delete"},[(0,Ee.default)("i",{class:"ri-delete-bin-line text-red-500 text-sm"})])])},renderModal:function(){if(!this.showModal)return null;let r={urusan:"Urusan",bidang:"Bidang",program:"Program",kegiatan:"Kegiatan",subkegiatan:"Sub Kegiatan"}[this.modalLevel];return(0,Ee.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onclick:f=>f.target===f.currentTarget&&this.closeModal()},[(0,Ee.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 transform transition-all",onclick:f=>f.stopPropagation()},[(0,Ee.default)("div",{class:`bg-gradient-to-r ${this.modalMode==="delete"?"from-red-500 to-red-600":"from-blue-500 to-purple-600"} text-white p-6 rounded-t-xl`},[(0,Ee.default)("div",{class:"flex items-center justify-between"},[(0,Ee.default)("div",{class:"flex items-center space-x-3"},[(0,Ee.default)("div",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center"},[(0,Ee.default)("i",{class:`ri-${this.modalMode==="delete"?"delete-bin":this.modalMode==="create"?"add":"edit"}-line text-xl text-white`})]),(0,Ee.default)("div",[(0,Ee.default)("h3",{class:"text-xl font-bold"},[`${this.modalMode==="create"?"Tambah":this.modalMode==="edit"?"Edit":"Hapus"} ${r}`]),(0,Ee.default)("p",{class:"text-white text-opacity-80 text-sm"},[this.modalMode==="delete"?"Konfirmasi penghapusan data":`Formulir ${r.toLowerCase()}`])])]),(0,Ee.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeModal()},[(0,Ee.default)("i",{class:"ri-close-fill"})])])]),(0,Ee.default)("div",{class:"p-6"},[this.modalMode==="delete"&&(0,Ee.default)("div",{class:"text-center py-6"},[(0,Ee.default)("div",{class:"mx-auto mb-4 w-16 h-16 bg-red-100 rounded-full flex items-center justify-center"},[(0,Ee.default)("i",{class:"ri-delete-bin-line text-2xl text-red-500"})]),(0,Ee.default)("p",{class:"text-gray-700 font-medium mb-2"},`Hapus ${r}:`),(0,Ee.default)("p",{class:"text-gray-600 mb-2"},`"${this.currentItem?.nama}"`),(0,Ee.default)("p",{class:"text-red-500 text-sm"},"\u26A0\uFE0F Tindakan ini tidak dapat dibatalkan.")]),(this.modalMode==="create"||this.modalMode==="edit")&&(0,Ee.default)("div",{class:"space-y-6"},[(0,Ee.default)("div",{class:"grid grid-cols-1 gap-6"},[(0,Ee.default)("div",[(0,Ee.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ee.default)("i",{class:"ri-hashtag mr-1 text-blue-500"}),"Kode"]),(0,Ee.default)("div",{class:"relative"},[(0,Ee.default)("input",{type:"text",class:"w-full pl-4 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:`Contoh: ${r==="Urusan"?"01":r==="Bidang"?"01.01":r==="Program"?"01.01.01":"01.01.01.01"}`,value:this.formData.kode,oninput:f=>this.formData.kode=f.target.value}),(0,Ee.default)("div",{class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm"},this.formData.kode.length+"/10")])]),(0,Ee.default)("div",[(0,Ee.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ee.default)("i",{class:"ri-text mr-1 text-green-500"}),"Nama"]),(0,Ee.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:`Masukkan nama lengkap ${r.toLowerCase()}`,value:this.formData.nama,oninput:f=>this.formData.nama=f.target.value})])]),this.modalLevel==="subkegiatan"&&(0,Ee.default)("div",{class:"space-y-6 border-t border-gray-200 pt-6"},[(0,Ee.default)("div",{class:"text-center mb-4"},[(0,Ee.default)("div",{class:"inline-flex items-center space-x-2 bg-amber-50 text-amber-700 px-3 py-1 rounded-full text-sm font-medium"},[(0,Ee.default)("i",{class:"ri-star-line"}),(0,Ee.default)("span","Field Khusus Sub Kegiatan")])]),(0,Ee.default)("div",[(0,Ee.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ee.default)("i",{class:"ri-target-line mr-1 text-amber-500"}),"Target Kinerja"]),(0,Ee.default)("textarea",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all duration-200 bg-gray-50 focus:bg-white resize-vertical",placeholder:"Contoh: Tercapainya 100% pelayanan administrasi perijinan",rows:"3",value:this.formData.kinerja,oninput:f=>this.formData.kinerja=f.target.value})]),(0,Ee.default)("div",{class:"grid grid-cols-2 gap-6"},[(0,Ee.default)("div",[(0,Ee.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ee.default)("i",{class:"ri-bar-chart-line mr-1 text-emerald-500"}),"Indikator"]),(0,Ee.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Contoh: Jumlah dokumen",value:this.formData.indikator,oninput:f=>this.formData.indikator=f.target.value})]),(0,Ee.default)("div",[(0,Ee.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ee.default)("i",{class:"ri-scales-line mr-1 text-violet-500"}),"Satuan"]),(0,Ee.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-violet-500 focus:ring-2 focus:ring-violet-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Contoh: Dokumen",value:this.formData.satuan,oninput:f=>this.formData.satuan=f.target.value})])])])]),(0,Ee.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-xl"},[(0,Ee.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.closeModal()},[(0,Ee.default)("i",{class:"ri-close-fill"}),(0,Ee.default)("span","Batal")]),this.modalMode==="delete"?(0,Ee.default)("button",{class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2",onclick:()=>this.deleteItem()},[(0,Ee.default)("i",{class:"ri-delete-bin-line"}),(0,Ee.default)("span","Hapus")]):(0,Ee.default)("button",{class:`px-6 py-3 ${this.isLoading?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700"} text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2`,disabled:this.isLoading,onclick:()=>this.saveItem()},[this.isLoading?(0,Ee.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,Ee.default)("i",{class:"ri-save-line"}),(0,Ee.default)("span",this.isLoading?"Menyimpan...":"Simpan")])])])])])},view:function(){return(0,Ee.default)("div",{class:"min-h-screen bg-gray-200",style:"width: 100%; overflow-x: hidden;"},[(0,Ee.default)("div",{class:"bg-white border-b border-gray-300 p-3 sm:p-6"},[(0,Ee.default)("div",{class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3 sm:gap-0"},[(0,Ee.default)("div",[(0,Ee.default)("h1",{class:"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900"},"Manajemen Urusan s.d. Sub Kegiatan"),(0,Ee.default)("p",{class:"text-sm sm:text-base text-gray-500 mt-1"},"Hierarki Struktur Urusan sampai dengan Sub Kegiatan")]),(0,Ee.default)("div",{class:"flex gap-3"},[(0,Ee.default)("button",{class:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm sm:text-base",onclick:()=>this.openCreateModal("urusan")},[(0,Ee.default)("i",{class:"ri-add-line mr-2"}),(0,Ee.default)("span",{class:"hidden sm:inline"},"Tambah Urusan")]),(0,Ee.default)("button",{class:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm sm:text-base",onclick:()=>this.loadHierarchyData()},[(0,Ee.default)("i",{class:"ri-refresh-line mr-2"}),(0,Ee.default)("span",{class:"hidden sm:inline"},"Refresh Data")])])])]),this.isLoading&&(0,Ee.default)("div",{class:"flex justify-center items-center py-12"},[(0,Ee.default)("div",{class:"flex items-center space-x-2"},[(0,Ee.default)("span",{class:"w-8 h-8 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin"}),(0,Ee.default)("span",{class:"text-gray-500"},"Memuat data hierarki...")])]),!this.isLoading&&(0,Ee.default)("div",{class:"p-3 sm:p-6 space-y-3 sm:space-y-4",style:"width: 100%; padding-right: 2rem;"},[this.data.urusan.map((e,r)=>{let f=this.getBidangByUrusan(e._id).length,a=this.getBidangByUrusan(e._id);return console.log(`\u{1F50D} Rendering Urusan ${r}:`,{id:e._id,kode:e.kode,nama:e.nama,bidangCount:f,hasBidang:f>0,bidangData:a.map(i=>({id:i._id,kode:i.kode,urusanId:i.urusanId}))}),(0,Ee.default)("details",{class:"bg-white border border-gray-300 rounded-lg mb-3",key:e._id,"data-urusan-index":r,"data-urusan-id":e._id,"data-bidang-count":f,style:"position: relative; width: 100%; min-height: 4rem;"},[(0,Ee.default)("summary",{class:"text-lg font-semibold flex items-center justify-between cursor-pointer list-none p-4 min-h-[3rem] select-none","data-debug-urusan":`kode:${e.kode}, bidang:${this.getBidangByUrusan(e._id).length}`,style:"display: flex; align-items: center; justify-content: space-between; width: 100%; min-height: 3rem; padding-right: 2rem;"},[(0,Ee.default)("div",{class:"flex items-center space-x-2 sm:space-x-3 flex-1 min-w-0",style:"flex: 1; min-width: 0;"},[(0,Ee.default)("i",{class:"ri-folder-line text-blue-500 text-xl flex-shrink-0"}),(0,Ee.default)("div",{class:"min-w-0 flex-1"},[(0,Ee.default)("span",{class:"font-mono"},e.kode),(0,Ee.default)("span",{class:"mx-1 sm:mx-2"},"-"),(0,Ee.default)("span",{class:"truncate"},e.nama)])]),(0,Ee.default)("div",{class:"flex items-center gap-1 sm:gap-2 flex-shrink-0","data-badge-count":this.getBidangByUrusan(e._id).length,style:"flex-shrink: 0; margin-left: auto; margin-right: 1rem; display: flex; align-items: center; gap: 0.25rem; min-width: max-content; width: auto; max-width: 50%;"},[(0,Ee.default)("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-500 text-white flex-shrink-0",style:"white-space: nowrap;"},`${this.getBidangByUrusan(e._id).length} Bidang`),(0,Ee.default)("button",{class:"w-8 h-8 bg-blue-500 hover:bg-blue-600 text-white rounded flex items-center justify-center flex-shrink-0",onclick:i=>{i.stopPropagation(),this.openCreateModal("bidang",e._id)}},[(0,Ee.default)("i",{class:"ri-add-line text-sm"})]),this.renderItemActions("urusan",e)])]),(0,Ee.default)("div",{class:"p-4 bg-gray-50"},[this.getBidangByUrusan(e._id).map(i=>(0,Ee.default)("div",{class:"ml-3 sm:ml-6 mt-3 sm:mt-4"},[(0,Ee.default)("details",{class:"bg-gray-50 border border-gray-300 rounded-lg"},[(0,Ee.default)("summary",{class:"text-base font-medium flex items-center justify-between cursor-pointer list-none p-3 min-h-[2.5rem] select-none",style:"display: flex; align-items: center; justify-content: space-between; width: 100%; min-height: 2.5rem; padding-right: 2rem;"},[(0,Ee.default)("div",{class:"flex items-center space-x-2 sm:space-x-3 flex-1 min-w-0"},[(0,Ee.default)("i",{class:"ri-folder-2-line text-gray-500 text-lg flex-shrink-0"}),(0,Ee.default)("div",{class:"min-w-0 flex-1"},[(0,Ee.default)("span",{class:"font-mono"},i.kode),(0,Ee.default)("span",{class:"mx-1 sm:mx-2"},"-"),(0,Ee.default)("span",{class:"truncate"},i.nama)])]),(0,Ee.default)("div",{class:"flex items-center gap-1 sm:gap-2 flex-shrink-0 ml-auto",style:"margin-right: 1rem; max-width: 50%;"},[(0,Ee.default)("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-500 text-white"},`${this.getProgramByBidang(i._id).length} Program`),(0,Ee.default)("button",{class:"w-8 h-8 bg-gray-500 hover:bg-gray-600 text-white rounded flex items-center justify-center",onclick:t=>{t.stopPropagation(),this.openCreateModal("program",i._id)}},[(0,Ee.default)("i",{class:"ri-add-line text-sm"})]),(0,Ee.default)("div",{class:"flex gap-1",onclick:t=>t.stopPropagation()},this.renderItemActions("bidang",i))])]),(0,Ee.default)("div",{class:"p-4 bg-white"},[this.getProgramByBidang(i._id).map(t=>(0,Ee.default)("div",{class:"ml-3 sm:ml-6 mt-3 sm:mt-4"},[(0,Ee.default)("details",{class:"bg-gray-50 border border-gray-300 rounded-lg"},[(0,Ee.default)("summary",{class:"text-sm font-medium flex items-center justify-between cursor-pointer list-none p-3 min-h-[2.25rem] select-none",style:"display: flex; align-items: center; justify-content: space-between; width: 100%; min-height: 2.25rem; padding-right: 2rem;"},[(0,Ee.default)("div",{class:"flex items-center space-x-2 sm:space-x-3 flex-1 min-w-0"},[(0,Ee.default)("i",{class:"ri-folder-3-line text-purple-500 text-base flex-shrink-0"}),(0,Ee.default)("div",{class:"min-w-0 flex-1"},[(0,Ee.default)("span",{class:"font-mono"},t.kode),(0,Ee.default)("span",{class:"mx-1 sm:mx-2"},"-"),(0,Ee.default)("span",{class:"truncate"},t.nama)])]),(0,Ee.default)("div",{class:"flex items-center gap-1 sm:gap-2 flex-shrink-0 ml-auto",style:"margin-right: 1rem; max-width: 50%;"},[(0,Ee.default)("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-500 text-white"},`${this.getKegiatanByProgram(t._id).length} Kegiatan`),(0,Ee.default)("button",{class:"w-8 h-8 bg-purple-500 hover:bg-purple-600 text-white rounded flex items-center justify-center",onclick:n=>{n.stopPropagation(),this.openCreateModal("kegiatan",t._id)}},[(0,Ee.default)("i",{class:"ri-add-line text-sm"})]),(0,Ee.default)("div",{class:"flex gap-1",onclick:n=>n.stopPropagation()},this.renderItemActions("program",t))])]),(0,Ee.default)("div",{class:"p-4 bg-white"},[this.getKegiatanByProgram(t._id).map(n=>(0,Ee.default)("div",{class:"ml-3 sm:ml-6 mt-3 sm:mt-4"},[(0,Ee.default)("details",{class:"bg-gray-50 border border-gray-300 rounded-lg"},[(0,Ee.default)("summary",{class:"text-sm font-medium flex items-center justify-between cursor-pointer list-none p-3 min-h-[2.25rem] select-none",style:"display: flex; align-items: center; justify-content: space-between; width: 100%; min-height: 2.25rem; padding-right: 2rem;"},[(0,Ee.default)("div",{class:"flex items-center space-x-2 sm:space-x-3 flex-1 min-w-0"},[(0,Ee.default)("i",{class:"ri-folder-4-line text-cyan-500 text-base flex-shrink-0"}),(0,Ee.default)("div",{class:"min-w-0 flex-1"},[(0,Ee.default)("span",{class:"font-mono"},n.kode),(0,Ee.default)("span",{class:"mx-1 sm:mx-2"},"-"),(0,Ee.default)("span",{class:"truncate"},n.nama)])]),(0,Ee.default)("div",{class:"flex items-center gap-1 sm:gap-2 flex-shrink-0 ml-auto",style:"margin-right: 1rem; max-width: 50%;"},[(0,Ee.default)("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-cyan-500 text-white"},`${this.getSubKegiatanByKegiatan(n._id).length} Sub Kegiatan`),(0,Ee.default)("button",{class:"w-8 h-8 bg-cyan-500 hover:bg-cyan-600 text-white rounded flex items-center justify-center",onclick:c=>{c.stopPropagation(),this.openCreateModal("subkegiatan",n._id)}},[(0,Ee.default)("i",{class:"ri-add-line text-sm"})]),(0,Ee.default)("div",{class:"flex gap-1",onclick:c=>c.stopPropagation()},this.renderItemActions("kegiatan",n))])]),(0,Ee.default)("div",{class:"p-4 bg-white"},[(0,Ee.default)("div",{class:"ml-3 sm:ml-6 mt-3 sm:mt-4 space-y-2 sm:space-y-3"},[this.getSubKegiatanByKegiatan(n._id).map(c=>(0,Ee.default)("div",{class:"bg-white border border-gray-300 rounded-lg p-3 sm:p-4 hover:bg-gray-50 transition-colors"},[(0,Ee.default)("div",{class:"flex items-start justify-between"},[(0,Ee.default)("div",{class:"flex-1"},[(0,Ee.default)("div",{class:"flex items-center space-x-3 mb-2"},[(0,Ee.default)("i",{class:"ri-folder-5-line text-green-500"}),(0,Ee.default)("div",[(0,Ee.default)("span",{class:"font-mono text-sm"},c.kode),(0,Ee.default)("span",{class:"mx-2 text-gray-400"},"-"),(0,Ee.default)("span",{class:"font-medium"},c.nama)])]),(0,Ee.default)("div",{class:"ml-3 sm:ml-6 space-y-1 text-xs sm:text-sm text-gray-500"},[(0,Ee.default)("div",[(0,Ee.default)("span",{class:"font-medium"},"Kinerja: "),(0,Ee.default)("span",c.kinerja)]),(0,Ee.default)("div",[(0,Ee.default)("span",{class:"font-medium"},"Indikator: "),(0,Ee.default)("span",c.indikator)]),(0,Ee.default)("div",[(0,Ee.default)("span",{class:"font-medium"},"Satuan: "),(0,Ee.default)("span",c.satuan)])])]),this.renderItemActions("subkegiatan",c)])])),this.getSubKegiatanByKegiatan(n._id).length===0&&(0,Ee.default)("div",{class:"text-center py-8 text-gray-400 bg-white border border-dashed border-gray-300 rounded-lg"},[(0,Ee.default)("i",{class:"ri-folder-5-line text-3xl mb-2 text-gray-300"}),(0,Ee.default)("p","Belum ada Sub Kegiatan"),(0,Ee.default)("p",{class:"text-sm"},"Klik tombol + untuk menambah Sub Kegiatan baru")])])])])])),this.getKegiatanByProgram(t._id).length===0&&(0,Ee.default)("div",{class:"text-center py-8 text-gray-400 bg-white border border-dashed border-gray-300 rounded-lg"},[(0,Ee.default)("i",{class:"ri-folder-4-line text-3xl mb-2 text-gray-300"}),(0,Ee.default)("p","Belum ada Kegiatan"),(0,Ee.default)("p",{class:"text-sm"},"Klik tombol + untuk menambah Kegiatan baru")])])])])),this.getProgramByBidang(i._id).length===0&&(0,Ee.default)("div",{class:"text-center py-8 text-gray-400 bg-white border border-dashed border-gray-300 rounded-lg"},[(0,Ee.default)("i",{class:"ri-folder-3-line text-3xl mb-2 text-gray-300"}),(0,Ee.default)("p","Belum ada Program"),(0,Ee.default)("p",{class:"text-sm"},"Klik tombol + untuk menambah Program baru")])])])])),this.getBidangByUrusan(e._id).length===0&&(0,Ee.default)("div",{class:"text-center py-8 text-gray-400 bg-white border border-dashed border-gray-300 rounded-lg"},[(0,Ee.default)("i",{class:"ri-folder-2-line text-3xl mb-2 text-gray-300"}),(0,Ee.default)("p","Belum ada Bidang"),(0,Ee.default)("p",{class:"text-sm"},"Klik tombol + untuk menambah Bidang baru")])])])}),this.data.urusan.length===0&&(0,Ee.default)("div",{class:"text-center py-12 text-gray-400"},[(0,Ee.default)("i",{class:"ri-folder-line text-6xl mb-4 text-gray-300"}),(0,Ee.default)("h3",{class:"text-xl font-semibold mb-2"},"Belum ada data hierarki"),(0,Ee.default)("p",{class:"mb-4"},"Data akan muncul di sini setelah diimpor dari CSV"),(0,Ee.default)("button",{class:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded",onclick:()=>this.loadHierarchyData()},[(0,Ee.default)("i",{class:"ri-refresh-line mr-2"}),"Muat Ulang Data"])])]),this.renderModal()])}},li=Po;var kt=sr(lr(),1);var mt=sr(lr(),1),_o={view:function(e){let r=e.attrs.state;if(!r.isEditing&&!r.data)return(0,mt.default)("div",{class:"text-center py-12"},[(0,mt.default)("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 mb-4"},[(0,mt.default)("i",{class:"ri-building-line text-blue-500"})]),(0,mt.default)("h3",{class:"text-lg font-medium text-gray-900"},"Belum ada data Perangkat Daerah"),(0,mt.default)("p",{class:"text-sm text-gray-500"},"Silakan tambahkan data Perangkat Daerah terlebih dahulu")]);if(r.isEditing)return(0,mt.default)("div",{class:"space-y-6"},[(0,mt.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[(0,mt.default)("div",[(0,mt.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Nama Pemda"),(0,mt.default)("input",{type:"text",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-blue-500 ${r.errors.namaPemda?"border-red-500":"border-gray-200"}`,placeholder:"Contoh: Pemerintah Kabupaten/Kota",value:r.formData.namaPemda,oninput:a=>{r.formData={...r.formData,namaPemda:a.target.value}}}),r.errors.namaPemda&&(0,mt.default)("p",{class:"mt-1 text-sm text-red-600"},r.errors.namaPemda)]),(0,mt.default)("div",[(0,mt.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Nama Perangkat Daerah"),(0,mt.default)("input",{type:"text",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-green-500 ${r.errors.nama?"border-red-500":"border-gray-200"}`,placeholder:"Contoh: Dinas Pekerjaan Umum dan Penataan Ruang",value:r.formData.nama,oninput:a=>{r.formData={...r.formData,nama:a.target.value}}}),r.errors.nama&&(0,mt.default)("p",{class:"mt-1 text-sm text-red-600"},r.errors.nama)]),(0,mt.default)("div",[(0,mt.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Kode Organisasi"),(0,mt.default)("input",{type:"text",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-purple-500 ${r.errors.kodeOrganisasi?"border-red-500":"border-gray-200"}`,placeholder:"Contoh: 1.01.01",value:r.formData.kodeOrganisasi,oninput:a=>{r.formData={...r.formData,kodeOrganisasi:a.target.value}}}),r.errors.kodeOrganisasi&&(0,mt.default)("p",{class:"mt-1 text-sm text-red-600"},r.errors.kodeOrganisasi)]),(0,mt.default)("div",[(0,mt.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Jenis"),(0,mt.default)("select",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-amber-500",value:r.formData.jenis,oninput:a=>{r.formData={...r.formData,jenis:a.target.value}}},[(0,mt.default)("option",{value:"Dinas"},"Dinas"),(0,mt.default)("option",{value:"Badan"},"Badan"),(0,mt.default)("option",{value:"Satuan Kerja"},"Satuan Kerja"),(0,mt.default)("option",{value:"Kecamatan"},"Kecamatan"),(0,mt.default)("option",{value:"Kelurahan"},"Kelurahan"),(0,mt.default)("option",{value:"Lainnya"},"Lainnya")])])]),(0,mt.default)("div",{class:"flex justify-end space-x-3"},[(0,mt.default)("button",{class:"px-5 py-2.5 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",onclick:()=>r.toggleEdit(),disabled:r.isLoading},"Batal"),(0,mt.default)("button",{class:`px-5 py-2.5 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 ${r.isLoading?"cursor-not-allowed opacity-50":""}`,onclick:()=>r.saveItem(),disabled:r.isLoading},r.isLoading?"Menyimpan...":"Simpan")])]);let f=r.data;return(0,mt.default)("div",{class:"space-y-6"},[(0,mt.default)("div",{class:"flex justify-between items-start"},[(0,mt.default)("div",[(0,mt.default)("h2",{class:"text-xl font-bold text-gray-900"},f.nama),(0,mt.default)("div",{class:"mt-1 flex items-center"},[(0,mt.default)("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},f.jenis),(0,mt.default)("span",{class:"ml-2 font-mono text-sm text-gray-600"},f.namaPemda)])])]),(0,mt.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,mt.default)("div",[(0,mt.default)("h3",{class:"text-sm font-medium text-gray-500"},"Kode Organisasi"),(0,mt.default)("p",{class:"mt-1 text-sm text-gray-900"},f.kodeOrganisasi||"-")]),f.alamat&&(0,mt.default)("div",[(0,mt.default)("h3",{class:"text-sm font-medium text-gray-500"},"Alamat"),(0,mt.default)("p",{class:"mt-1 text-sm text-gray-900"},f.alamat)]),f.email&&(0,mt.default)("div",[(0,mt.default)("h3",{class:"text-sm font-medium text-gray-500"},"Email"),(0,mt.default)("p",{class:"mt-1 text-sm text-gray-900"},f.email)]),f.telepon&&(0,mt.default)("div",[(0,mt.default)("h3",{class:"text-sm font-medium text-gray-500"},"Telepon"),(0,mt.default)("p",{class:"mt-1 text-sm text-gray-900"},f.telepon)]),f.website&&(0,mt.default)("div",[(0,mt.default)("h3",{class:"text-sm font-medium text-gray-500"},"Website"),(0,mt.default)("p",{class:"mt-1 text-sm text-gray-900"},f.website)])]),(0,mt.default)("div",{class:"mt-8"},[(0,mt.default)("div",{class:"flex justify-between items-center mb-4"},[(0,mt.default)("h3",{class:"text-lg font-semibold text-gray-900"},"Sub Organisasi"),(0,mt.default)("button",{class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white text-sm font-medium rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200",onclick:()=>r.startQuickAddSubOrg(),disabled:r.addingSubOrg||r.isLoading},[(0,mt.default)("i",{class:`mr-2 ${r.addingSubOrg?"ri-close-line":"ri-add-line"}`}),r.addingSubOrg?"Batal":"Tambah Sub Organisasi"])]),r.addingSubOrg&&(0,mt.default)("div",{class:"bg-white border border-gray-200 rounded-lg p-4 mb-4"},[(0,mt.default)("div",{class:"flex gap-2"},[(0,mt.default)("input",{type:"text",class:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Masukkan nama sub organisasi",value:r.newSubOrgName,oninput:a=>{r.newSubOrgName=a.target.value},onkeydown:a=>{a.key==="Enter"?r.saveNewSubOrg():a.key==="Escape"&&r.cancelAddSubOrg()}}),(0,mt.default)("button",{class:"px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",onclick:()=>r.saveNewSubOrg(),disabled:r.isLoading},r.isLoading?(0,mt.default)("div",{class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,mt.default)("i",{class:"ri-check-line"}))])]),r.isLoadingSubOrg?(0,mt.default)("div",{class:"flex justify-center items-center h-32"},[(0,mt.default)("div",{class:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):r.subOrganizations.length===0&&!r.addingSubOrg?(0,mt.default)("div",{class:"text-center py-12"},[(0,mt.default)("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 mb-4"},[(0,mt.default)("i",{class:"ri-building-line text-blue-500"})]),(0,mt.default)("p",{class:"text-sm text-gray-500"},"Belum ada sub organisasi")]):(0,mt.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},r.subOrganizations.map(a=>(0,mt.default)("div",{key:a._id,class:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow duration-200"},[r.editingSubOrgId===a._id?(0,mt.default)("div",[(0,mt.default)("div",{class:"flex gap-2 mb-2"},[(0,mt.default)("input",{type:"text",class:"flex-1 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:r.editingSubOrgName,oninput:i=>{r.editingSubOrgName=i.target.value},onkeydown:i=>{i.key==="Enter"?r.saveEditSubOrg():i.key==="Escape"&&r.cancelEditSubOrg()}})]),(0,mt.default)("div",{class:"flex justify-end space-x-1"},[(0,mt.default)("button",{class:"px-2 py-1 text-xs text-gray-600 hover:text-gray-800",onclick:()=>r.cancelEditSubOrg()},[(0,mt.default)("i",{class:"ri-close-line mr-1"}),"Batal"]),(0,mt.default)("button",{class:"px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",onclick:()=>r.saveEditSubOrg(),disabled:r.isLoading},r.isLoading?(0,mt.default)("div",{class:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin mr-1"}):(0,mt.default)("i",{class:"ri-check-line mr-1"}))])]):(0,mt.default)("div",{class:"flex justify-between items-start"},[(0,mt.default)("h3",{class:"font-medium text-gray-900 text-sm flex-1"},a.nama),(0,mt.default)("div",{class:"flex space-x-1"},[(0,mt.default)("button",{class:"text-blue-600 hover:text-blue-900 text-xs",onclick:()=>r.startEditSubOrg(a._id,a.nama)},[(0,mt.default)("i",{class:"ri-edit-line"})]),(0,mt.default)("button",{class:"text-red-600 hover:text-red-900 text-xs",onclick:()=>r.deleteSubOrganization(a._id)},[(0,mt.default)("i",{class:"ri-delete-bin-line"})])])])])))])])}},ui=_o;var at=sr(lr(),1),Do={view:function(e){let r=e.attrs.state;return(0,at.default)("div",{class:"space-y-6"},[(0,at.default)("div",{class:"flex justify-between items-center"},[(0,at.default)("div",[(0,at.default)("h3",{class:"text-lg font-semibold text-gray-900"},"Daftar Pejabat"),(0,at.default)("p",{class:"text-sm text-gray-600 mt-1"},"Kelola data pejabat dan jabatan")]),(0,at.default)("button",{class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white text-sm font-medium rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200",onclick:()=>r.openPejabatModal("create")},[(0,at.default)("i",{class:"ri-add-line mr-2"}),"Tambah Pejabat"])]),r.pejabatData.length===0?(0,at.default)("div",{class:"text-center py-12"},[(0,at.default)("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 mb-4"},[(0,at.default)("i",{class:"ri-user-line text-blue-500"})]),(0,at.default)("p",{class:"text-sm text-gray-500"},"Belum ada data pejabat")]):(0,at.default)("div",{class:"space-y-4"},r.pejabatData.map(f=>(0,at.default)("div",{key:f._id,class:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow duration-200"},[(0,at.default)("div",{class:"flex justify-between items-center"},[(0,at.default)("div",[(0,at.default)("h3",{class:"font-medium text-gray-900 text-sm"},f.nama),f.jabatanStrukturalList&&f.jabatanStrukturalList.length>0?f.jabatanStrukturalList.filter(a=>a.isActive).map(a=>(0,at.default)("p",{class:"text-sm text-gray-600"},a.position)):f.jabatanStruktural&&(0,at.default)("p",{class:"text-sm text-gray-600"},f.jabatanStruktural),f.jabatanFungsional&&(0,at.default)("p",{class:"text-sm text-gray-600"},f.jabatanFungsional)]),(0,at.default)("div",{class:"flex space-x-2"},[(0,at.default)("button",{class:"text-blue-600 hover:text-blue-900 text-sm",onclick:()=>r.openPejabatModal("edit",f)},"Edit"),(0,at.default)("button",{class:"text-red-600 hover:text-red-900 text-sm",onclick:()=>r.deletePejabat(f)},"Hapus")])])]))),r.showPejabatModal&&(0,at.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},[(0,at.default)("div",{class:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},[(0,at.default)("div",{class:"flex justify-between items-center mb-4"},[(0,at.default)("h2",{class:"text-xl font-bold text-gray-900"},r.pejabatModalMode==="edit"?"Edit Pejabat":"Tambah Pejabat"),(0,at.default)("button",{class:"text-gray-400 hover:text-gray-600",onclick:()=>r.closePejabatModal()},[(0,at.default)("i",{class:"ri-close-line text-xl"})])]),(0,at.default)("form",{class:"space-y-4"},[(0,at.default)("div",[(0,at.default)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nama"),(0,at.default)("input",{type:"text",class:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.pejabatErrors.nama?"border-red-500":"border-gray-300"}`,placeholder:"Masukkan nama",value:r.pejabatFormData.nama,oninput:f=>{r.pejabatFormData.nama=f.target.value}}),r.pejabatErrors.nama&&(0,at.default)("p",{class:"mt-1 text-sm text-red-600"},r.pejabatErrors.nama)]),(0,at.default)("div",[(0,at.default)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"NIP"),(0,at.default)("input",{type:"text",maxlength:18,pattern:"[0-9]{18}",class:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.pejabatErrors.nip?"border-red-500":"border-gray-300"}`,placeholder:"Masukkan NIP (18 digit angka)",value:r.pejabatFormData.nip,oninput:f=>{let a=f.target.value.replace(/[^0-9]/g,"").slice(0,18);f.target.value=a,r.pejabatFormData.nip=a}}),r.pejabatErrors.nip&&(0,at.default)("p",{class:"mt-1 text-sm text-red-600"},r.pejabatErrors.nip)]),(0,at.default)("div",[(0,at.default)("div",{class:"flex justify-between items-center mb-3"},[(0,at.default)("label",{class:"block text-sm font-medium text-gray-700"},"Jabatan Struktural"),(0,at.default)("button",{type:"button",class:"inline-flex items-center px-3 py-1 bg-green-600 text-white text-xs font-medium rounded-md hover:bg-green-700 transition-all duration-200",onclick:()=>r.addJabatanStruktural()},[(0,at.default)("i",{class:"ri-add-line mr-1"}),"Tambah Jabatan"])]),r.pejabatFormData.jabatanStrukturalList&&r.pejabatFormData.jabatanStrukturalList.length>0?(0,at.default)("div",{class:"space-y-2 mb-4"},r.pejabatFormData.jabatanStrukturalList.map((f,a)=>(0,at.default)("div",{key:a,class:"flex items-center space-x-2 bg-gray-50 p-3 rounded-md border border-gray-200"},[(0,at.default)("div",{class:"flex-1"},[(0,at.default)("div",{class:"text-sm font-medium text-gray-700"},f.position),f.subOrganisasiId&&(f.subOrganisasiId==="main_org"?(0,at.default)("div",{class:"text-xs text-gray-500"},"Organisasi: "+(r.data?.nama||"Perangkat Daerah")+" (Main Organisasi)"):(0,at.default)("div",{class:"text-xs text-gray-500"},"Sub Organisasi: "+r.subOrganizations.find(i=>i._id===f.subOrganisasiId)?.nama||""))]),(0,at.default)("button",{type:"button",class:"text-red-600 hover:text-red-800 text-sm",onclick:()=>r.removeJabatanStruktural(a)},[(0,at.default)("i",{class:"ri-delete-bin-line"})])]))):(0,at.default)("div",{class:"text-sm text-gray-500 text-center py-4 border border-dashed border-gray-300 rounded-md"},"Belum ada Jabatan Struktural"),r.showJabatanStrukturalForm&&(0,at.default)("div",{class:"border border-gray-200 rounded-md p-4 bg-white space-y-4"},[(0,at.default)("div",[(0,at.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[(0,at.default)("i",{class:"ri-building-line mr-1 text-blue-500"}),"1. Pilih Organisasi/Sub Organisasi"]),(0,at.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:r.newJabatanStruktural.subOrganisasiId||"",oninput:f=>{r.newJabatanStruktural.subOrganisasiId=f.target.value,r.newJabatanStruktural.subOrganisasiId&&r.newJabatanStruktural.role&&r.checkPositionAvailability()}},[(0,at.default)("option",{value:""},"-- Pilih Organisasi/Sub Organisasi --"),r.data&&r.data.nama&&(0,at.default)("option",{value:"main_org",disabled:!1},`\u2605 ${r.data.nama} (Main Organisasi)`),(0,at.default)("option",{value:"",disabled:!0},"\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500"),...r.subOrganizations.map(f=>(0,at.default)("option",{value:f._id},`\u2003\u2003${f.nama}`))])]),(0,at.default)("div",[(0,at.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[(0,at.default)("i",{class:"ri-user-line mr-1 text-green-500"}),"2. Pilih Peran"]),(0,at.default)("div",{class:"space-y-2"},[(0,at.default)("label",{class:"flex items-center space-x-2 cursor-pointer"},[(0,at.default)("input",{type:"radio",name:"role",value:"Kepala",checked:r.newJabatanStruktural.role==="Kepala",onchange:f=>{r.newJabatanStruktural.role=f.target.value,r.newJabatanStruktural.subOrganisasiId&&r.checkPositionAvailability()}}),(0,at.default)("span",{class:"text-sm text-gray-700"},"Kepala"),(0,at.default)("span",{class:"text-xs text-gray-500 ml-2"},"(Posisi tetap)")]),(0,at.default)("label",{class:"flex items-center space-x-2 cursor-pointer"},[(0,at.default)("input",{type:"radio",name:"role",value:"Plt. Kepala",checked:r.newJabatanStruktural.role==="Plt. Kepala",onchange:f=>{r.newJabatanStruktural.role=f.target.value,r.newJabatanStruktural.subOrganisasiId&&r.checkPositionAvailability()}}),(0,at.default)("span",{class:"text-sm text-gray-700"},"Plt. Kepala"),(0,at.default)("span",{class:"text-xs text-gray-500 ml-2"},"(Posisi sementara)")])])]),r.newJabatanStruktural.subOrganisasiId&&r.newJabatanStruktural.role&&(()=>{let f="",a=!1;if(r.newJabatanStruktural.subOrganisasiId==="main_org")a=!0,f=`${r.newJabatanStruktural.role} ${r.data?.nama||"Perangkat Daerah"}`;else{let i=r.subOrganizations.find(t=>t._id===r.newJabatanStruktural.subOrganisasiId);f=i?`${r.newJabatanStruktural.role} ${i.nama}`:""}return(0,at.default)("div",{class:"bg-blue-50 border border-blue-200 rounded-md p-3"},[(0,at.default)("div",{class:"flex items-center"},[(0,at.default)("i",{class:"ri-eye-line text-blue-500 mr-2"}),(0,at.default)("p",{class:"text-sm font-medium text-blue-800"},f),a&&(0,at.default)("span",{class:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full"},"Organisasi Utama")])])})(),r.positionConflictWarning&&(0,at.default)("div",{class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},[(0,at.default)("div",{class:"flex items-start"},[(0,at.default)("i",{class:"ri-warning-line text-yellow-600 mr-2 mt-0.5"}),(0,at.default)("div",[(0,at.default)("p",{class:"text-sm text-yellow-800 font-medium"},"Peringatan!"),(0,at.default)("p",{class:"text-sm text-yellow-700 mt-1"},r.positionConflictWarning),(0,at.default)("button",{type:"button",class:"mt-2 px-3 py-1 bg-yellow-600 text-white text-xs rounded hover:bg-yellow-700",onclick:()=>r.forceAddJabatanStruktural=!0},"Konfirmasi Dulu")])])]),(0,at.default)("div",{class:"flex justify-end space-x-2 pt-2 border-t border-gray-200"},[(0,at.default)("button",{type:"button",class:"px-3 py-1 text-sm border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",onclick:()=>r.cancelAddJabatanStruktural()},"Batal"),(0,at.default)("button",{type:"button",class:`px-3 py-1 text-sm rounded-md text-white ${!r.newJabatanStruktural.subOrganisasiId||r.positionConflictWarning&&!r.forceAddJabatanStruktural?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,onclick:()=>r.saveJabatanStruktural(),disabled:!r.newJabatanStruktural.subOrganisasiId||r.positionConflictWarning&&!r.forceAddJabatanStruktural},"Tambah Jabatan")])]),r.pejabatErrors.jabatanStruktural&&(0,at.default)("p",{class:"mt-2 text-sm text-red-600"},r.pejabatErrors.jabatanStruktural)]),(0,at.default)("div",[(0,at.default)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Jabatan Fungsional"),(0,at.default)("select",{class:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.pejabatErrors.jabatanFungsional?"border-red-500":"border-gray-300"}`,value:r.pejabatFormData.jabatanFungsional,oninput:f=>{r.pejabatFormData.jabatanFungsional=f.target.value}},r.jabatanFungsionalOptions.map(f=>(0,at.default)("option",{value:f.value},f.label)))]),(0,at.default)("div",[(0,at.default)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email"),(0,at.default)("input",{type:"email",class:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.pejabatErrors.email?"border-red-500":"border-gray-300"}`,placeholder:"Masukkan email",value:r.pejabatFormData.email,oninput:f=>{r.pejabatFormData.email=f.target.value}}),r.pejabatErrors.email&&(0,at.default)("p",{class:"mt-1 text-sm text-red-600"},r.pejabatErrors.email)]),(0,at.default)("div",[(0,at.default)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Telepon"),(0,at.default)("input",{type:"text",class:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.pejabatErrors.telepon?"border-red-500":"border-gray-300"}`,placeholder:"Masukkan telepon",value:r.pejabatFormData.telepon,oninput:f=>{r.pejabatFormData.telepon=f.target.value}}),r.pejabatErrors.telepon&&(0,at.default)("p",{class:"mt-1 text-sm text-red-600"},r.pejabatErrors.telepon)]),(0,at.default)("div",[(0,at.default)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status"),(0,at.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:r.pejabatFormData.status,oninput:f=>{r.pejabatFormData.status=f.target.value}},[(0,at.default)("option",{value:"Aktif"},"Aktif"),(0,at.default)("option",{value:"Tidak Aktif"},"Tidak Aktif")])])]),(0,at.default)("div",{class:"flex justify-end space-x-3 mt-6"},[(0,at.default)("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",onclick:()=>r.closePejabatModal(),disabled:r.isLoading},"Batal"),(0,at.default)("button",{type:"button",class:`px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 ${r.isLoading?"cursor-not-allowed opacity-50":""}`,onclick:()=>r.savePejabat(),disabled:r.isLoading},r.isLoading?"Menyimpan...":r.pejabatModalMode==="edit"?"Perbarui":"Simpan")])])])])}},ci=Do;var _t=sr(lr(),1),jo=e=>e==="admin"?"Administrator":e==="operator"?"Operator":e==="vendor"?"Penyedia B/J":e==="pengawas"?"Pengawas":e||"-",Oo=e=>e==="admin"?"bg-red-100 text-red-800":e==="operator"?"bg-blue-100 text-blue-800":e==="vendor"?"bg-green-100 text-green-800":e==="pengawas"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-700",$o={view:function(e){let r=e.attrs.state;return(0,_t.default)("div",{class:"space-y-6"},[(0,_t.default)("div",{class:"flex justify-between items-center"},[(0,_t.default)("div",[(0,_t.default)("h3",{class:"text-lg font-semibold text-gray-900"},"Daftar Pengguna"),(0,_t.default)("p",{class:"text-sm text-gray-600 mt-1"},"Kelola akun pengguna sistem")]),(0,_t.default)("button",{class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white text-sm font-medium rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200",onclick:()=>r.openUserModal("create")},[(0,_t.default)("i",{class:"ri-add-line mr-2"}),"Tambah Pengguna"])]),r.isLoadingUsers?(0,_t.default)("div",{class:"flex justify-center items-center h-32"},[(0,_t.default)("div",{class:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):r.userData.length===0?(0,_t.default)("div",{class:"text-center py-12"},[(0,_t.default)("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 mb-4"},[(0,_t.default)("i",{class:"ri-user-settings-line text-blue-500"})]),(0,_t.default)("p",{class:"text-sm text-gray-500"},"Belum ada data pengguna")]):(0,_t.default)("div",{class:"space-y-4"},r.userData.map(f=>{let a=f.subPerangkatDaerahId?r.subPerangkatDaerahList.find(t=>t._id===f.subPerangkatDaerahId||typeof f.subPerangkatDaerahId=="object"&&t._id===f.subPerangkatDaerahId._id):null,i=null;if(f.penyediaId&&r.penyediaList&&r.penyediaList.length){let t=r.penyediaList.find(n=>n._id===f.penyediaId||typeof f.penyediaId=="object"&&n._id===f.penyediaId._id);t&&(i=t.NamaVendor||t.nama)}return(0,_t.default)("div",{key:f._id,class:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow duration-200"},[(0,_t.default)("div",{class:"flex justify-between items-start gap-4"},[(0,_t.default)("div",{class:"space-y-1"},[(0,_t.default)("h3",{class:"font-medium text-gray-900 text-sm"},f.namaLengkap||f.username),(0,_t.default)("p",{class:"text-sm text-gray-600"},f.email),(0,_t.default)("div",{class:"flex flex-wrap items-center gap-2 mt-1"},[(0,_t.default)("span",{class:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Oo(f.role)}`},jo(f.role)),a&&(0,_t.default)("span",{class:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-purple-50 text-purple-700 border border-purple-100"},[(0,_t.default)("i",{class:"ri-building-2-line mr-1 text-[11px]"}),a.nama]),i&&(0,_t.default)("span",{class:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-green-50 text-green-700 border border-green-100"},[(0,_t.default)("i",{class:"ri-truck-line mr-1 text-[11px]"}),i])])]),(0,_t.default)("div",{class:"flex flex-col items-end space-y-1"},[(0,_t.default)("button",{class:"text-blue-600 hover:text-blue-900 text-sm",onclick:()=>r.openUserModal("edit",f)},"Edit"),(0,_t.default)("button",{class:"text-red-600 hover:text-red-900 text-sm",onclick:()=>r.deleteUser(f)},"Hapus")])])])})),r.showUserModal&&(0,_t.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},[(0,_t.default)("div",{class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},[(0,_t.default)("div",{class:"flex justify-between items-center mb-4"},[(0,_t.default)("h2",{class:"text-xl font-bold text-gray-900"},r.userModalMode==="edit"?"Edit Pengguna":"Tambah Pengguna"),(0,_t.default)("button",{class:"text-gray-400 hover:text-gray-600",onclick:()=>r.closeUserModal()},[(0,_t.default)("i",{class:"ri-close-line text-xl"})])]),(0,_t.default)("form",{class:"space-y-4"},[(0,_t.default)("div",[(0,_t.default)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nama Lengkap"),(0,_t.default)("input",{type:"text",class:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.userErrors.namaLengkap?"border-red-500":"border-gray-300"}`,placeholder:"Masukkan nama lengkap",value:r.userFormData.namaLengkap,oninput:f=>{r.userFormData.namaLengkap=f.target.value}}),r.userErrors.namaLengkap&&(0,_t.default)("p",{class:"mt-1 text-sm text-red-600"},r.userErrors.namaLengkap)]),(0,_t.default)("div",[(0,_t.default)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Username"),(0,_t.default)("input",{type:"text",class:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.userErrors.username?"border-red-500":"border-gray-300"}`,placeholder:"Masukkan username",value:r.userFormData.username,oninput:f=>{r.userFormData.username=f.target.value}}),r.userErrors.username&&(0,_t.default)("p",{class:"mt-1 text-sm text-red-600"},r.userErrors.username)]),(0,_t.default)("div",[(0,_t.default)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email"),(0,_t.default)("input",{type:"email",class:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.userErrors.email?"border-red-500":"border-gray-300"}`,placeholder:"Masukkan email",value:r.userFormData.email,oninput:f=>{r.userFormData.email=f.target.value}}),r.userErrors.email&&(0,_t.default)("p",{class:"mt-1 text-sm text-red-600"},r.userErrors.email)]),(0,_t.default)("div",[(0,_t.default)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},r.userModalMode==="edit"?"Password (kosongkan jika tidak ingin mengubah)":"Password"),(0,_t.default)("input",{type:"password",class:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.userErrors.password?"border-red-500":"border-gray-300"}`,placeholder:r.userModalMode==="edit"?"Password baru (opsional)":"Masukkan password",value:r.userFormData.password,oninput:f=>{r.userFormData.password=f.target.value}}),r.userErrors.password&&(0,_t.default)("p",{class:"mt-1 text-sm text-red-600"},r.userErrors.password)]),(0,_t.default)("div",[(0,_t.default)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Role"),(0,_t.default)("select",{class:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.userErrors.role?"border-red-500":"border-gray-300"}`,value:r.userFormData.role,oninput:f=>{r.userFormData.role=f.target.value}},[(0,_t.default)("option",{value:"operator"},"Operator"),(0,_t.default)("option",{value:"admin"},"Administrator"),(0,_t.default)("option",{value:"vendor"},"Penyedia B/J"),(0,_t.default)("option",{value:"pengawas"},"Pengawas")]),r.userErrors.role&&(0,_t.default)("p",{class:"mt-1 text-sm text-red-600"},r.userErrors.role)]),(r.userFormData.role==="operator"||r.userFormData.role==="pengawas")&&(0,_t.default)("div",[(0,_t.default)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},r.userFormData.role==="pengawas"?"Sub Organisasi (Wajib untuk Pengawas)":"Sub Organisasi (Opsional)"),r.isLoadingSubOrgForUsers?(0,_t.default)("div",{class:"text-sm text-gray-500 py-2"},"Memuat..."):(0,_t.default)("select",{class:`w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${r.userFormData.role==="pengawas"&&!r.userFormData.subPerangkatDaerahId?"border-red-400":""}`,value:r.userFormData.subPerangkatDaerahId||"",oninput:f=>{r.userFormData.subPerangkatDaerahId=f.target.value||null}},[(0,_t.default)("option",{value:"",disabled:r.userFormData.role==="pengawas"},r.userFormData.role==="pengawas"?"-- Pilih Sub Organisasi (Wajib) --":"-- Tidak ada --"),r.subPerangkatDaerahList.map(f=>(0,_t.default)("option",{value:f._id},f.nama))]),r.userFormData.role==="pengawas"&&!r.userFormData.subPerangkatDaerahId&&(0,_t.default)("p",{class:"mt-1 text-xs text-red-600"},"Pengawas wajib terikat pada satu Sub Organisasi untuk penugasan kontrak.")]),r.userFormData.role==="vendor"&&(0,_t.default)("div",[(0,_t.default)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Penyedia (Opsional)"),r.isLoadingPenyedia?(0,_t.default)("div",{class:"text-sm text-gray-500 py-2"},"Memuat..."):(0,_t.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:r.userFormData.penyediaId||"",oninput:f=>{r.userFormData.penyediaId=f.target.value||null}},[(0,_t.default)("option",{value:""},"-- Tidak ada --"),r.penyediaList.map(f=>(0,_t.default)("option",{value:f._id},f.NamaVendor||f.nama||"(Tanpa Nama)"))])])]),(0,_t.default)("div",{class:"flex justify-end space-x-3 mt-6"},[(0,_t.default)("button",{type:"button",class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",onclick:()=>r.closeUserModal(),disabled:r.isLoadingUsers},"Batal"),(0,_t.default)("button",{type:"button",class:`px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 ${r.isLoadingUsers?"cursor-not-allowed opacity-50":""}`,onclick:()=>r.saveUser(),disabled:r.isLoadingUsers},r.isLoadingUsers?"Menyimpan...":r.userModalMode==="edit"?"Perbarui":"Simpan")])])])])}},di=$o;var $t=sr(lr(),1),Ao={view:function(e){let r=e.attrs.state,f=r.selectedPengawasId&&(r.pengawasList||[]).find(c=>c._id===r.selectedPengawasId)||null,a=new Set((r.pengawasAssignments||[]).filter(c=>c.kontrakId).map(c=>typeof c.kontrakId=="object"?c.kontrakId._id:c.kontrakId)),i=(r.kontrakSearchQuery||"").toLowerCase(),t=(r.kontrakList||[]).filter(c=>{if(!i)return!0;let b=(c.noKontrak||"").toLowerCase(),x=(c.kodeSirupLkpp||"").toLowerCase(),w=(c.lokasi||"").toLowerCase();return b.includes(i)||x.includes(i)||w.includes(i)});Array.isArray(r.selectedKontrakIds)||(r.selectedKontrakIds=[]);let n=(c,b)=>{let x=new Set(r.selectedKontrakIds||[]);b?x.add(c):x.delete(c),r.selectedKontrakIds=Array.from(x)};return(0,$t.default)("div",{class:"space-y-6"},[(0,$t.default)("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},[(0,$t.default)("div",[(0,$t.default)("h3",{class:"text-lg font-semibold text-gray-900"},"Pengawas Lapangan"),(0,$t.default)("p",{class:"text-sm text-gray-600 mt-1"},"Kelola penugasan kontrak kepada Pengawas berdasarkan Surat Keputusan (SK).")])]),(0,$t.default)("div",{class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},[(0,$t.default)("div",{class:"bg-white rounded-xl border border-gray-200 p-4 space-y-3"},[(0,$t.default)("div",{class:"flex items-center justify-between mb-1"},[(0,$t.default)("h4",{class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},[(0,$t.default)("i",{class:"ri-shield-user-line text-blue-500"}),"Daftar Pengawas"]),r.isLoadingPengawasList&&(0,$t.default)("div",{class:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})]),(!r.pengawasList||r.pengawasList.length===0)&&!r.isLoadingPengawasList?(0,$t.default)("p",{class:"text-sm text-gray-500"},"Belum ada pengguna dengan peran Pengawas. Tambahkan pada tab Pengguna."):(0,$t.default)("div",{class:"space-y-1 max-h-72 overflow-y-auto"},(r.pengawasList||[]).map(c=>(0,$t.default)("button",{key:c._id,class:`w-full text-left px-3 py-2 rounded-lg text-sm border transition-colors ${r.selectedPengawasId===c._id?"bg-blue-50 border-blue-400 text-blue-700":"bg-white border-gray-200 text-gray-700 hover:bg-gray-50"}`,onclick:()=>{r.selectedPengawasId=c._id,r.loadPengawasAssignments&&r.loadPengawasAssignments(c._id)}},[(0,$t.default)("div",{class:"font-semibold truncate"},c.username||c.email),c.subPerangkatDaerahId&&(0,$t.default)("div",{class:"flex items-center gap-1 text-xs text-purple-700 mt-0.5"},[(0,$t.default)("i",{class:"ri-building-2-line"}),typeof c.subPerangkatDaerahId=="object"?c.subPerangkatDaerahId.nama||"Sub Organisasi":"Sub Organisasi Pengawas"])]))),f&&(0,$t.default)("div",{class:"mt-3 p-2 bg-blue-50 border border-blue-100 rounded-lg text-xs text-blue-800"},[(0,$t.default)("div",{class:"font-semibold mb-1"},"Pengawas terpilih"),(0,$t.default)("div",f.username||f.email)])]),(0,$t.default)("div",{class:"lg:col-span-2 bg-white rounded-xl border border-gray-200 p-4 space-y-4"},[(0,$t.default)("div",{class:"space-y-3 border-b border-gray-100 pb-3"},[(0,$t.default)("h4",{class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},[(0,$t.default)("i",{class:"ri-file-shield-2-line text-green-500"}),"Surat Keputusan (SK) Penugasan"]),(0,$t.default)("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm"},[(0,$t.default)("div",[(0,$t.default)("label",{class:"block text-[11px] font-medium text-gray-700 mb-1"},"Nomor SK"),(0,$t.default)("input",{type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:r.skForm.skNumber,oninput:c=>{r.skForm.skNumber=c.target.value}})]),(0,$t.default)("div",[(0,$t.default)("label",{class:"block text-[11px] font-medium text-gray-700 mb-1"},"Tanggal SK"),(0,$t.default)("input",{type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:r.skForm.skDate,oninput:c=>{r.skForm.skDate=c.target.value}})]),(0,$t.default)("div",[(0,$t.default)("label",{class:"block text-[11px] font-medium text-gray-700 mb-1"},"File SK (PDF, maks 1MB)"),(0,$t.default)("input",{type:"file",accept:"application/pdf",class:"w-full text-[10px] px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onchange:c=>r.handleSkFileChange&&r.handleSkFileChange(c)}),r.skForm.fileName&&(0,$t.default)("div",{class:"mt-1 space-y-1"},[(0,$t.default)("p",{class:"text-[10px] text-gray-600"},`${r.skForm.fileName} (${(r.skForm.fileSize/1024).toFixed(1)} KB)`),(0,$t.default)("button",{type:"button",class:"border border-gray-200 rounded-md bg-gray-50 px-2 py-1 flex items-center gap-1 hover:bg-gray-100 text-[10px] text-blue-700",onclick:()=>{if(console.log("Preview SK clicked",{hasLocalFile:!!(r.skForm&&r.skForm.file),fileName:r.skForm&&r.skForm.fileName,assignmentsCount:(r.pengawasAssignments||[]).length,selectedPengawasId:r.selectedPengawasId}),r.skForm&&r.skForm.file){try{let o=URL.createObjectURL(r.skForm.file);console.log("Preview SK - opening local blob URL",o),window.open(o,"_blank","noopener")}catch(o){console.error("Preview SK - failed to open local file",o)}return}let c=r.pengawasAssignments||[];if(!r.selectedPengawasId||!c.length){console.warn("Preview SK: no pengawasAssignments available or no pengawas selected");return}let b=c.find(o=>o.skFile&&o.skFile.filename)||c[0];if(console.log("Preview SK - chosen assignment for preview",b),!b||!b._id){console.warn("Preview SK: no assignment with valid _id found");return}let x=typeof window<"u"&&window.localStorage&&window.localStorage.getItem("token")||null;if(!x){console.warn("Preview SK: no auth token found in localStorage");return}let w=`/api/pengawas-kontrak/${b._id}/sk-file`;console.log("Preview SK - requesting from backend",w);let g=new XMLHttpRequest;g.open("GET",w,!0),g.setRequestHeader("Authorization",`Bearer ${x}`),g.responseType="blob",g.onload=function(){if(console.log("Preview SK - XHR load status",g.status),g.status===200){let o=g.response;if(!o){console.error("Preview SK: empty blob response");return}let u=URL.createObjectURL(o);console.log("Preview SK - opening blob URL",u),window.open(u,"_blank","noopener")}else{console.error("Preview SK: gagal memuat file SK:",g.status);try{let o=new FileReader;o.onload=()=>{console.error("Preview SK error body:",o.result)},g.response&&o.readAsText(g.response)}catch{}}},g.onerror=function(){console.error("Preview SK: kesalahan jaringan saat memuat file SK")},g.send()}},[(0,$t.default)("i",{class:"ri-file-pdf-line text-red-500 text-xs"}),(0,$t.default)("span","Buka pratinjau SK (PDF)")])]),r.skErrors.file&&(0,$t.default)("p",{class:"mt-1 text-[10px] text-red-600"},r.skErrors.file)])])]),(0,$t.default)("div",{class:"space-y-3"},[(0,$t.default)("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between gap-3"},[(0,$t.default)("div",[(0,$t.default)("h4",{class:"text-sm font-semibold text-gray-800"},"Daftar Kontrak"),(0,$t.default)("p",{class:"text-sm text-gray-500"},"Pilih kontrak yang akan ditugaskan kepada Pengawas terpilih berdasarkan SK di atas.")]),(0,$t.default)("div",{class:"flex items-center gap-2"},[(0,$t.default)("div",{class:"relative"},[(0,$t.default)("input",{type:"text",placeholder:"Cari kontrak (nomor / SIRUP / lokasi)...",class:"w-56 pl-8 pr-3 py-1.5 text-xs border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:r.kontrakSearchQuery,oninput:c=>{r.kontrakSearchQuery=c.target.value}}),(0,$t.default)("i",{class:"ri-search-line text-gray-400 text-xs absolute left-2.5 top-1/2 -translate-y-1/2"})])])]),r.isLoadingKontrakList?(0,$t.default)("div",{class:"flex justify-center items-center py-10"},[(0,$t.default)("div",{class:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):t.length===0?(0,$t.default)("p",{class:"text-sm text-gray-500 py-6"},"Belum ada data kontrak untuk ditampilkan."):(0,$t.default)("div",{class:"space-y-3"},[(0,$t.default)("div",{class:"border border-gray-200 rounded-lg max-h-72 overflow-y-auto"},t.map(c=>{let b=c._id,x=a.has(b),w=(r.selectedKontrakIds||[]).includes(b);return(0,$t.default)("label",{key:b,class:`flex items-start gap-2 px-3 py-2 border-b last:border-b-0 text-xs cursor-pointer hover:bg-blue-50 ${x?"bg-green-50/60":"bg-white"}`},[(0,$t.default)("input",{type:"checkbox",class:"mt-1 w-3 h-3 text-blue-600 border-gray-300 rounded",disabled:!r.selectedPengawasId,checked:w,onclick:g=>{if(!r.selectedPengawasId){g.preventDefault();return}n(b,g.target.checked),g.stopPropagation()}}),(0,$t.default)("div",{class:"flex-1 space-y-0.5"},[(0,$t.default)("div",{class:"flex items-center gap-2"},[(0,$t.default)("span",{class:"font-semibold text-gray-800"},c.noKontrak),x&&(0,$t.default)("span",{class:"inline-flex items-center px-1.5 py-0.5 rounded-full bg-green-100 text-green-700 border border-green-200"},[(0,$t.default)("i",{class:"ri-check-double-line mr-1"}),"Sudah ditugaskan"])]),(0,$t.default)("div",{class:"text-gray-600"},c.kodeSirupLkpp||"-"),(0,$t.default)("div",{class:"text-gray-500"},c.lokasi||"-")])])})),(0,$t.default)("div",{class:"flex justify-end gap-2 pt-2"},[(0,$t.default)("button",{type:"button",class:"px-3 py-1.5 text-xs border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",onclick:()=>{r.skForm={skNumber:"",skDate:"",file:null,fileName:"",fileSize:0},r.skErrors={},r.selectedKontrakIds=[]}},"Reset SK"),(0,$t.default)("button",{type:"button",class:`px-4 py-1.5 text-xs rounded-md text-white bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 flex items-center gap-1 ${r.selectedPengawasId?"":"opacity-60 cursor-not-allowed"}`,disabled:!r.selectedPengawasId,onclick:()=>{if(!r.submitPengawasAssignments||!r.selectedPengawasId)return;let c=Array.from(new Set(r.selectedKontrakIds||[]));console.log("Simpan / Update Penugasan clicked",{selectedPengawasId:r.selectedPengawasId,targetKontrakIds:c}),r.submitPengawasAssignments(c)}},[(0,$t.default)("i",{class:"ri-save-line text-[11px]"}),"Simpan / Update Penugasan"])])])])])])])}},fi=Ao;var Io={oncreate:function(e){console.log("PerangkatDaerah component created/mounted"),console.log("Is authenticated:",et.isAuthenticated()),console.log("Is admin:",et.isAdmin()),console.log("User role:",et.getRole());let r=document.getElementById("perangkat-daerah-tab-container");r&&this.mountActiveTab(r)},isLoading:!1,data:null,activeTab:"organisasi",pengawasList:[],isLoadingPengawasList:!1,kontrakList:[],isLoadingKontrakList:!1,kontrakSearchQuery:"",selectedPengawasId:"",selectedPengawas:null,pengawasAssignments:[],isLoadingAssignments:!1,skForm:{skNumber:"",skDate:"",file:null,fileName:"",fileSize:0},skErrors:{},userData:[],showUserModal:!1,userModalMode:"create",userEditingItem:null,userFormData:{username:"",email:"",namaLengkap:"",password:"",role:"operator",subPerangkatDaerahId:"",penyediaId:""},userErrors:{},subPerangkatDaerahList:[],penyediaList:[],isLoadingUsers:!1,isLoadingSubOrgForUsers:!1,isLoadingPenyedia:!1,pejabatList:[],isLoadingPejabat:!1,pejabatData:[],showPejabatModal:!1,pejabatModalMode:"create",pejabatEditingItem:null,jabatanFungsionalOptions:[{value:"",label:"-- Pilih Jabatan Fungsional --"},{value:"Pengguna Anggaran",label:"Pengguna Anggaran"},{value:"Kuasa Pengguna Anggaran",label:"Kuasa Pengguna Anggaran"},{value:"Pejabat Pelaksana Teknis Kegiatan",label:"Pejabat Pelaksana Teknis Kegiatan"},{value:"Ketua Panitia",label:"Ketua Panitia"},{value:"Pejabat Pengadaan",label:"Pejabat Pengadaan"}],getAvailableJabatanStrukturalOptions:function(){let e=[{value:"",label:"-- Pilih Jabatan Struktural --"}];return this.subOrganizations.forEach(r=>{e.push({value:`Kepala ${r.nama}`,label:`Kepala ${r.nama}`},{value:`Plt. Kepala ${r.nama}`,label:`Plt. Kepala ${r.nama}`})}),e},showJabatanStrukturalForm:!1,newJabatanStruktural:{subOrganisasiId:"",role:"Kepala"},positionConflictWarning:"",forceAddJabatanStruktural:!1,pejabatFormData:{nama:"",jabatanStrukturalList:[],jabatanStruktural:"",jabatanFungsional:"",email:"",telepon:"",status:"",nip:""},pejabatErrors:{},subOrganizations:[],isLoadingSubOrg:!1,addingSubOrg:!1,newSubOrgName:"",editingSubOrgId:null,editingSubOrgName:"",errors:{},oninit:function(){console.log("PerangkatDaerah oninit() called"),this.isEditing=!1,this.isLoading=!1,this.formData={_id:null,namaPemda:"",nama:"",alamat:"",kodeOrganisasi:"",email:"",telepon:"",website:"",jenis:"Dinas",logoFile:null,logoPreview:null},this.errors={},console.log("oninit completed, starting data loading"),this.loadData(),this.loadPejabatData(),this.loadPejabatManagementData(),this.loadUserManagementData(),this.loadSubPerangkatDaerahForUsers(),this.loadPenyediaForUsers(),this.loadSubOrganizations()},loadPejabatManagementData:async function(){try{let e=await Ce.getAll("pejabat");this.pejabatData=e.data||[]}catch(e){console.error("Error loading pejabat data:",e),this.pejabatData=[]}kt.default.redraw()},loadPejabatData:async function(){this.isLoadingPejabat=!0,kt.default.redraw();try{let e=await Ce.getAll("pejabat");e&&e.data?this.pejabatList=e.data.filter(r=>r.status==="Aktif"):this.pejabatList=[]}catch(e){console.error("Error loading pejabat data:",e),this.pejabatList=[]}this.isLoadingPejabat=!1,kt.default.redraw()},loadUserManagementData:async function(){this.isLoadingUsers=!0,kt.default.redraw();try{let e=await Ce.getAll("user");e&&e.data?this.userData=e.data:this.userData=[]}catch(e){console.error("Error loading user data:",e),this.userData=[],be.error("Gagal memuat data pengguna")}this.isLoadingUsers=!1,kt.default.redraw()},loadSubPerangkatDaerahForUsers:async function(){this.isLoadingSubOrgForUsers=!0,kt.default.redraw();try{let e=await Ce.getAll("subperangkatdaerah");e&&e.data?this.subPerangkatDaerahList=e.data:this.subPerangkatDaerahList=[]}catch(e){console.error("Error loading sub organizations for users:",e),this.subPerangkatDaerahList=[]}this.isLoadingSubOrgForUsers=!1,kt.default.redraw()},loadPenyediaForUsers:async function(){this.isLoadingPenyedia=!0,kt.default.redraw();try{let e=await Ce.getAll("penyedia");e&&e.data?this.penyediaList=e.data:this.penyediaList=[]}catch(e){console.error("Error loading penyedia for users:",e),this.penyediaList=[]}this.isLoadingPenyedia=!1,kt.default.redraw()},loadSubOrganizations:async function(){if(console.log("Loading sub organizations..."),console.log("Current data:",this.data),!this.data||!this.data._id){console.log("No data or _id available for sub organizations");return}this.isLoadingSubOrg=!0,kt.default.redraw();try{let e=await Ce.request("/api/subperangkatdaerah",{params:{perangkatDaerahId:this.data._id}});console.log("Sub organizations API result:",e),e&&e.data?this.subOrganizations=e.data:this.subOrganizations=[]}catch(e){console.error("Error loading sub organizations:",e),this.subOrganizations=[]}console.log("Final sub organizations data:",this.subOrganizations),this.isLoadingSubOrg=!1,kt.default.redraw()},startQuickAddSubOrg:function(){this.addingSubOrg=!0,this.newSubOrgName="",kt.default.redraw()},cancelAddSubOrg:function(){this.addingSubOrg=!1,this.newSubOrgName="",kt.default.redraw()},saveNewSubOrg:async function(){if(!this.newSubOrgName.trim()){be.error("Nama sub organisasi harus diisi");return}this.isLoading=!0,kt.default.redraw();try{let e={nama:this.newSubOrgName.trim(),perangkatDaerahId:this.data._id};console.log("Creating sub organization with data:",e),await Ce.create("subperangkatdaerah",e),be.success("Sub organisasi berhasil ditambahkan"),this.cancelAddSubOrg(),kt.default.redraw(),await this.loadSubOrganizations(),kt.default.redraw(),console.log("Sub organization saved and UI updated"),await this.loadPejabatManagementData()}catch(e){console.error("Error creating sub organization:",e),be.error("Gagal menyimpan sub organisasi")}finally{this.isLoading=!1,kt.default.redraw()}},deleteSubOrganization:async function(e){try{await Ce.delete("subperangkatdaerah",e,"Sub organisasi"),await this.loadSubOrganizations()}catch(r){console.error("Error deleting sub organization:",r)}},startEditSubOrg:function(e,r){this.editingSubOrgId=e,this.editingSubOrgName=r,kt.default.redraw()},cancelEditSubOrg:function(){this.editingSubOrgId=null,this.editingSubOrgName="",kt.default.redraw()},saveEditSubOrg:async function(){if(!this.editingSubOrgName.trim()){be.error("Nama sub organisasi tidak boleh kosong");return}this.isLoading=!0,kt.default.redraw();try{let e={nama:this.editingSubOrgName.trim(),perangkatDaerahId:this.data._id};console.log("Updating sub organization:",this.editingSubOrgId,"with data:",e),await Ce.update("subperangkatdaerah",this.editingSubOrgId,e),be.success("Sub organisasi berhasil diperbarui"),this.cancelEditSubOrg(),await this.loadSubOrganizations()}catch(e){console.error("Error updating sub organization:",e),be.error("Gagal memperbarui sub organisasi")}finally{this.isLoading=!1,kt.default.redraw()}},resetPejabatForm:function(){this.pejabatFormData={nama:"",jabatanStrukturalList:[],jabatanStruktural:"",jabatanFungsional:"",email:"",telepon:"",status:"",nip:""},this.pejabatErrors={},this.resetJabatanStrukturalState()},resetJabatanStrukturalState:function(){this.showJabatanStrukturalForm=!1,this.newJabatanStruktural={subOrganisasiId:"",role:"Kepala"},this.positionConflictWarning="",this.forceAddJabatanStruktural=!1},addJabatanStruktural:function(){this.showJabatanStrukturalForm=!0,this.newJabatanStruktural={subOrganisasiId:"",role:"Kepala"},this.positionConflictWarning="",this.forceAddJabatanStruktural=!1,kt.default.redraw()},cancelAddJabatanStruktural:function(){this.showJabatanStrukturalForm=!1,this.newJabatanStruktural={subOrganisasiId:"",role:"Kepala"},this.positionConflictWarning="",this.forceAddJabatanStruktural=!1,kt.default.redraw()},saveJabatanStruktural:function(){if(!this.newJabatanStruktural.subOrganisasiId.trim()){be.error("Organisasi/Sub organisasi harus dipilih");return}let e="",r=!1;if(this.newJabatanStruktural.subOrganisasiId==="main_org")r=!0,e=`${this.newJabatanStruktural.role} ${this.data?.nama||"Perangkat Daerah"}`,this.pejabatFormData.jabatanStrukturalList.push({position:e,subOrganisasiId:null,assignedAt:new Date,isActive:!0});else{let f=this.subOrganizations.find(a=>a._id===this.newJabatanStruktural.subOrganisasiId);if(!f){be.error("Sub organisasi tidak ditemukan");return}e=`${this.newJabatanStruktural.role} ${f.nama}`,this.pejabatFormData.jabatanStrukturalList.push({position:e,subOrganisasiId:this.newJabatanStruktural.subOrganisasiId,assignedAt:new Date,isActive:!0})}this.cancelAddJabatanStruktural(),be.success(`Jabatan Struktural berhasil ditambahkan${r?" (Organisasi Utama)":""}`)},removeJabatanStruktural:function(e){be.confirm("Hapus Jabatan Struktural ini?",()=>{this.pejabatFormData.jabatanStrukturalList.splice(e,1),kt.default.redraw()})},checkPositionAvailability:async function(){this.positionConflictWarning="",this.forceAddJabatanStruktural=!1;let{subOrganisasiId:e,role:r}=this.newJabatanStruktural;if(!e||!r)return;let f=this.subOrganizations.find(b=>b._id===e);if(!f)return;let a=`${r} ${f.nama}`,i=r==="Kepala"?"Plt. Kepala":"Kepala",t=`${i} ${f.nama}`;if((this.pejabatFormData.jabatanStrukturalList||[]).some(b=>b.position===t&&b.isActive)){this.positionConflictWarning=`Sub organisasi "${f.nama}" sudah memiliki posisi "${i}". Tidak dapat menambahkan "${r}" karena aturan bisnis mencegah seseorang memiliki kedua posisi tersebut.`,this.forceAddJabatanStruktural=!1,kt.default.redraw();return}try{let b={position:a,subOrganisasiId:e};this.pejabatModalMode==="edit"&&this.pejabatEditingItem&&(b.excludeId=this.pejabatEditingItem._id);let x=await Ce.request("/api/pejabat/check-position",{method:"GET",params:b});if(x&&x.data&&!x.data.isAvailable){let w=x.data.conflictWith;this.positionConflictWarning=`Posisi "${a}" sudah terisi oleh "${w.nama}". Klik tombol "Konfirmasi Dulu" untuk tetap menambahkan.`}}catch(b){console.error("Error checking position availability:",b)}kt.default.redraw()},validatePejabatForm:function(){this.pejabatErrors={},this.pejabatFormData.nama.trim()||(this.pejabatErrors.nama="Nama harus diisi");let e=this.pejabatFormData.jabatanStrukturalList.length>0||this.pejabatFormData.jabatanStruktural.trim(),r=this.pejabatFormData.jabatanFungsional.trim();return!e&&!r&&(this.pejabatErrors.jabatan="Setidaknya satu jabatan (Struktural atau Fungsional) harus dipilih"),Object.keys(this.pejabatErrors).length===0},openPejabatModal:function(e="create",r=null){this.pejabatModalMode=e,this.showPejabatModal=!0,e==="edit"&&r?(this.pejabatEditingItem=r,this.pejabatFormData={nama:r.nama||"",jabatanStrukturalList:r.jabatanStrukturalList&&r.jabatanStrukturalList.length>0?r.jabatanStrukturalList.filter(f=>f.isActive).map(f=>({position:f.position,subOrganisasiId:f.subOrganisasiId,assignedAt:f.assignedAt,isActive:f.isActive})):[],jabatanStruktural:r.jabatanStruktural||"",jabatanFungsional:r.jabatanFungsional||"",email:r.email||"",telepon:r.telepon||"",status:r.status||"Aktif",nip:r.nip||""},console.log("Edit mode loaded jabatanStrukturalList:",this.pejabatFormData.jabatanStrukturalList)):(this.pejabatEditingItem=null,this.resetPejabatForm()),this.resetJabatanStrukturalState(),kt.default.redraw()},closePejabatModal:function(){this.showPejabatModal=!1,this.pejabatEditingItem=null,this.resetPejabatForm(),kt.default.redraw()},savePejabat:async function(){if(!this.validatePejabatForm()){be.error("Harap perbaiki kesalahan pada formulir"),kt.default.redraw();return}this.isLoading=!0,kt.default.redraw();try{if(this.pejabatModalMode==="edit"){if(!this.pejabatEditingItem||!this.pejabatEditingItem._id){be.error("Data pejabat tidak ditemukan untuk diupdate");return}await Ce.update("pejabat",this.pejabatEditingItem._id,this.pejabatFormData)}else await Ce.create("pejabat",this.pejabatFormData);this.closePejabatModal(),await this.loadPejabatManagementData(),be.success("Data pejabat berhasil disimpan")}catch(e){console.error("Error saving pejabat:",e);let r="Gagal menyimpan data pejabat";e&&e.message?r=e.message:e.response&&e.response.message&&(r=e.response.message),be.error(r)}this.isLoading=!1,kt.default.redraw()},deletePejabat:async function(e){be.confirm(`Apakah Anda yakin ingin menghapus pejabat "${e.nama}"?`,async()=>{try{await Ce.delete("pejabat",e._id,e.nama),await this.loadPejabatManagementData()}catch(r){console.error("Error deleting pejabat:",r)}})},resetUserForm:function(){this.userFormData={username:"",email:"",namaLengkap:"",password:"",role:"operator",subPerangkatDaerahId:"",penyediaId:""},this.userErrors={}},validateUserForm:function(){return this.userErrors={},this.userFormData.username.trim()||(this.userErrors.username="Username harus diisi"),this.userFormData.email.trim()||(this.userErrors.email="Email harus diisi"),this.userModalMode==="create"&&!this.userFormData.password.trim()&&(this.userErrors.password="Password harus diisi"),this.userFormData.role.trim()||(this.userErrors.role="Role harus dipilih"),Object.keys(this.userErrors).length===0},openUserModal:function(e="create",r=null){if(this.userModalMode=e,this.showUserModal=!0,e==="edit"&&r){this.userEditingItem=r;let f="";r.subPerangkatDaerahId&&(typeof r.subPerangkatDaerahId=="string"?f=r.subPerangkatDaerahId:typeof r.subPerangkatDaerahId=="object"&&r.subPerangkatDaerahId._id&&(f=r.subPerangkatDaerahId._id));let a="";r.penyediaId&&(typeof r.penyediaId=="string"?a=r.penyediaId:typeof r.penyediaId=="object"&&r.penyediaId._id&&(a=r.penyediaId._id)),this.userFormData={username:r.username||"",email:r.email||"",namaLengkap:r.namaLengkap||"",password:"",role:r.role||"operator",subPerangkatDaerahId:f,penyediaId:a}}else this.userEditingItem=null,this.resetUserForm();kt.default.redraw()},closeUserModal:function(){this.showUserModal=!1,this.userEditingItem=null,this.resetUserForm(),kt.default.redraw()},saveUser:async function(){if(!this.validateUserForm()){be.error("Harap perbaiki kesalahan pada formulir"),kt.default.redraw();return}this.isLoadingUsers=!0,kt.default.redraw();try{if(this.userModalMode==="edit"){if(!this.userEditingItem||!this.userEditingItem._id){be.error("Data pengguna tidak ditemukan untuk diupdate");return}let e={username:this.userFormData.username,email:this.userFormData.email,namaLengkap:this.userFormData.namaLengkap,role:this.userFormData.role,subPerangkatDaerahId:this.userFormData.subPerangkatDaerahId||null,penyediaId:this.userFormData.penyediaId||null};this.userFormData.password.trim()&&(e.password=this.userFormData.password),await Ce.update("user",this.userEditingItem._id,e)}else{let e={username:this.userFormData.username,email:this.userFormData.email,namaLengkap:this.userFormData.namaLengkap,password:this.userFormData.password,role:this.userFormData.role,subPerangkatDaerahId:this.userFormData.subPerangkatDaerahId||null,penyediaId:this.userFormData.penyediaId||null};await Ce.create("user",e)}this.closeUserModal(),await this.loadUserManagementData(),be.success("Data pengguna berhasil disimpan")}catch(e){console.error("Error saving user:",e)}this.isLoadingUsers=!1,kt.default.redraw()},deleteUser:async function(e){be.confirm(`Apakah Anda yakin ingin menghapus pengguna "${e.username}"?`,async()=>{try{await Ce.delete("user",e._id,e.username),await this.loadUserManagementData()}catch(r){console.error("Error deleting user:",r)}})},loadData:async function(){this.isLoading=!0,kt.default.redraw();try{let e=await Ce.getAll("perangkatdaerah");console.log("Raw response from API:",e),e&&e.data&&e.data.length>0?(this.existingData=e.data[0],this.data=e.data[0],console.log("Existing data loaded:",this.existingData),console.log("Existing data _id:",this.existingData._id),this.formData={_id:this.existingData._id,namaPemda:this.existingData.namaPemda||"",nama:this.existingData.nama||"",alamat:this.existingData.alamat||"",kodeOrganisasi:this.existingData.kodeOrganisasi||"",email:this.existingData.email||"",telepon:this.existingData.telepon||"",website:this.existingData.website||"",jenis:this.existingData.jenis||"Dinas",logoFile:null,logoPreview:null},console.log("Form data populated with _id:",this.formData._id)):(this.existingData=null,this.formData={_id:null,namaPemda:"",nama:"",alamat:"",kodeOrganisasi:"",email:"",telepon:"",website:"",jenis:"Dinas",logoFile:null,logoPreview:null},console.log("No existing data found, form reset to empty state")),this.isLoading=!1,kt.default.redraw(),this.data&&this.data._id&&await this.loadSubOrganizations()}catch(e){console.error("Error loading data:",e),be.error("Gagal memuat data Perangkat Daerah"),this.isLoading=!1,kt.default.redraw()}},toggleEdit:function(){this.isEditing?this.isEditing=!1:this.isEditing=!0},resetForm:function(){this.existingData?this.formData={_id:this.existingData._id,namaPemda:this.existingData.namaPemda||"",nama:this.existingData.nama||"",alamat:this.existingData.alamat||"",kodeOrganisasi:this.existingData.kodeOrganisasi||"",email:this.existingData.email||"",telepon:this.existingData.telepon||"",website:this.existingData.website||"",jenis:this.existingData.jenis||"Dinas",logoFile:null,logoPreview:null}:this.formData={_id:null,namaPemda:"",nama:"",alamat:"",kodeOrganisasi:"",email:"",telepon:"",website:"",jenis:"Dinas",logoFile:null,logoPreview:null},this.errors={}},saveItem:async function(){if(this.errors={},this.formData.namaPemda.trim()||(this.errors.namaPemda="Nama Pemda wajib diisi"),this.formData.nama.trim()||(this.errors.nama="Nama Perangkat Daerah wajib diisi"),this.formData.kodeOrganisasi.trim()||(this.errors.kodeOrganisasi="Kode Organisasi wajib diisi"),Object.keys(this.errors).length>0){be.error("Harap perbaiki kesalahan pada formulir"),kt.default.redraw();return}this.isLoading=!0,kt.default.redraw();try{let e={...this.formData};delete e.logoFile,delete e.logoPreview,console.log("Final formData being sent to API:",e),console.log("FormData _id value:",e._id),await this.sendToAPI(e),this.isEditing=!1,be.success("Perangkat Daerah berhasil disimpan"),await this.loadData(),kt.default.redraw()}catch(e){console.error("Error saving data:",e);let r="Gagal menyimpan data Perangkat Daerah";e.response&&e.response.message?r=e.response.message:e.message&&(r=e.message),be.error(r)}finally{this.isLoading=!1,kt.default.redraw()}},sendToAPI:async function(e){let r;e._id?(console.log("Updating existing perangkat daerah with ID:",e._id),r=await Ce.update("perangkatdaerah",e._id,e),this.data=r):(console.log("Creating new perangkat daerah"),r=await Ce.create("perangkatdaerah",e),this.data=r)},switchTab:function(e){this.activeTab=e,e==="pengawasLapangan"&&(this.loadPengawasList(),this.loadKontrakList())},loadPengawasList:async function(){this.isLoadingPengawasList=!0,kt.default.redraw();try{let e=await Ce.getAll("user"),r=e&&e.data||[];this.pengawasList=r.filter(f=>f.role==="pengawas")}catch(e){console.error("Error loading pengawas list:",e),this.pengawasList=[],be.error("Gagal memuat data pengawas")}this.isLoadingPengawasList=!1,kt.default.redraw()},loadKontrakList:async function(){this.isLoadingKontrakList=!0,kt.default.redraw();try{let e=await Ce.request("/api/kontrak",{method:"GET"});this.kontrakList=e&&e.data||[]}catch(e){console.error("Error loading kontrak list for pengawas:",e),this.kontrakList=[],be.error("Gagal memuat data kontrak untuk pengawas")}this.isLoadingKontrakList=!1,kt.default.redraw()},loadPengawasAssignments:async function(e){if(!e){this.pengawasAssignments=[],this.selectedPengawas=null,this.skForm={skNumber:"",skDate:"",file:null,fileName:"",fileSize:0},this.skErrors={};return}this.isLoadingAssignments=!0,kt.default.redraw();try{let r=await Ce.request("/api/pengawas-kontrak",{method:"GET",params:{pengawasId:e,active:!0}}),f=r&&r.data||[];if(this.pengawasAssignments=f,this.selectedPengawas=this.pengawasList.find(a=>a._id===e)||null,f.length>0){let a=f[0]||{},i=a.skNumber||"",t=a.skDate?new Date(a.skDate).toISOString().slice(0,10):"",n=a.skFile&&(a.skFile.filename||a.skFile.size||a.skFile.contentType);this.skForm={skNumber:i,skDate:t,file:null,fileName:n?a.skFile.filename||"SK.pdf":"",fileSize:n&&a.skFile.size||0}}else this.skForm={skNumber:"",skDate:"",file:null,fileName:"",fileSize:0};this.skErrors={}}catch(r){console.error("Error loading pengawas-kontrak assignments:",r),this.pengawasAssignments=[],this.skForm={skNumber:"",skDate:"",file:null,fileName:"",fileSize:0},this.skErrors={},be.error("Gagal memuat penugasan pengawas")}this.isLoadingAssignments=!1,kt.default.redraw()},handleSkFileChange:function(e){let r=e.target.files&&e.target.files[0];if(this.skErrors={},!r){this.skForm.file=null,this.skForm.fileName="",this.skForm.fileSize=0;return}if(r.type!=="application/pdf"){this.skErrors.file="File SK harus dalam format PDF",this.skForm.file=null,this.skForm.fileName="",this.skForm.fileSize=0,be.error("File SK harus PDF");return}if(r.size>1024*1024){this.skErrors.file="Ukuran file SK maksimal 1MB",this.skForm.file=null,this.skForm.fileName="",this.skForm.fileSize=0,be.error("Ukuran file SK maksimal 1MB");return}this.skForm.file=r,this.skForm.fileName=r.name,this.skForm.fileSize=r.size},validateSkForm:function(){return this.skErrors={},this.selectedPengawasId||(this.skErrors.pengawas="Pilih pengawas terlebih dahulu"),!this.skForm.skNumber&&!this.skForm.file&&(this.skErrors.sk="Nomor SK atau file SK harus diisi"),Object.keys(this.skErrors).length===0},submitPengawasAssignments:async function(e){if(!this.validateSkForm()){be.error("Harap lengkapi data SK dan pilih pengawas"),kt.default.redraw();return}if(!e||e.length===0){be.warning("Belum ada kontrak yang dipilih untuk penugasan");return}try{let r=new FormData;r.append("pengawasId",this.selectedPengawasId),(e||[]).forEach(a=>{a&&r.append("kontrakIds[]",a)}),this.skForm.skNumber&&r.append("skNumber",this.skForm.skNumber),this.skForm.skDate&&r.append("skDate",this.skForm.skDate),this.skForm.file&&r.append("skFile",this.skForm.file,this.skForm.file.name||"sk.pdf");let f=Ft.getToken&&Ft.getToken()||(typeof localStorage<"u"?localStorage.getItem("token"):null);await kt.default.request({method:"POST",url:"/api/pengawas-kontrak",body:r,serialize:a=>a,headers:f?{Authorization:`Bearer ${f}`}:{}}),be.success("Penugasan pengawas berhasil disimpan"),this.skForm={skNumber:"",skDate:"",file:null,fileName:"",fileSize:0},this.selectedKontrakIds=[],await this.loadPengawasAssignments(this.selectedPengawasId)}catch(r){console.error("Error submitting pengawas-kontrak assignments:",r);let f="Gagal menyimpan penugasan pengawas";r&&(typeof r.message=="string"?f=r.message:r.response&&typeof r.response.message=="string"?f=r.response.message:typeof r=="string"&&(f=r)),be.error(f)}finally{kt.default.redraw()}},view:function(){return console.log("PerangkatDaerah view() called - using mounted tab components"),(0,kt.default)("div",{class:"space-y-6"},[(0,kt.default)("div",{class:"flex justify-between items-center"},[(0,kt.default)("div",[(0,kt.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Perangkat Daerah"),(0,kt.default)("p",{class:"text-gray-600 mt-1"},"Kelola data organisasi perangkat daerah")]),(0,kt.default)("button",{class:`px-4 py-2 rounded-lg font-medium transition-all duration-200 ${this.isEditing?"bg-white border-2 border-gray-300 text-gray-700 hover:bg-gray-50":"bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700"}`,onclick:()=>this.toggleEdit(),disabled:this.isLoading},[(0,kt.default)("i",{class:`mr-2 ${this.isEditing?"ri-close-fill":"ri-edit-line"}`}),this.isEditing?"Batal":"Edit Perangkat Daerah"])]),(0,kt.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,kt.default)("div",{class:"border-b border-gray-200"},[(0,kt.default)("nav",{class:"flex space-x-8 px-6"},[(0,kt.default)("button",{class:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${this.activeTab==="organisasi"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:()=>this.switchTab("organisasi")},[(0,kt.default)("i",{class:"ri-building-line mr-2"}),"Organisasi"]),(0,kt.default)("button",{class:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${this.activeTab==="pejabat"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:()=>this.switchTab("pejabat")},[(0,kt.default)("i",{class:"ri-user-line mr-2"}),"Pejabat"]),(0,kt.default)("button",{class:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${this.activeTab==="pengguna"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:()=>this.switchTab("pengguna")},[(0,kt.default)("i",{class:"ri-user-settings-line mr-2"}),"Pengguna"]),(0,kt.default)("button",{class:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${this.activeTab==="pengawasLapangan"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:()=>this.switchTab("pengawasLapangan")},[(0,kt.default)("i",{class:"ri-shield-user-line mr-2"}),"Pengawas Lapangan"])])]),(0,kt.default)("div",{class:"p-6"},[(0,kt.default)("div",{id:"perangkat-daerah-tab-container",class:"w-full"})])])])},onupdate:function(e){let r=document.getElementById("perangkat-daerah-tab-container");r&&this._lastMountedTab!==this.activeTab&&this.mountActiveTab(r)},mountActiveTab:function(e){let r={state:this};this._lastMountedTab=this.activeTab,this.activeTab==="organisasi"?kt.default.mount(e,{view:()=>(0,kt.default)(ui,r)}):this.activeTab==="pejabat"?kt.default.mount(e,{view:()=>(0,kt.default)(ci,r)}):this.activeTab==="pengguna"?kt.default.mount(e,{view:()=>(0,kt.default)(di,r)}):this.activeTab==="pengawasLapangan"&&kt.default.mount(e,{view:()=>(0,kt.default)(fi,r)})}},pi=Io;var Ke=sr(lr(),1);var Eo={isLoading:!1,accounts:[],filteredAccounts:[],showModal:!1,modalMode:"create",isModalLoading:!1,formData:{code:"",name:"",fullCode:"",description:"",level:1,parent:null},availableParents:[],searchQuery:"",selectedLevel:"all",currentPage:1,itemsPerPage:20,errors:{},formatCurrency:function(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e||0)},getCleanFullCode:function(e){if(!e)return"";if(/^\d+(\.\d+)*\./.test(e))return e;let r=e.split(".");if(r.length>1){let a=r.slice(0,3);if(a.every(i=>/^\d+$/.test(i.trim())))return a.join(".")}let f=e.match(/^(\d+(?:\.\d+)*)/);return f?f[1]:e.length>20?e.substring(0,20)+"...":e},buildHierarchyTree:function(e){let r=new Map,f=[];return e.forEach(a=>{r.set(a._id,{...a,children:[],level:parseInt(a.level)})}),e.forEach(a=>{let i=r.get(a._id),t=a.fullCode,n=null;for(let[c,b]of r)if(b._id!==a._id&&t.startsWith(b.fullCode+".")&&t!==b.fullCode){let x=b.fullCode.split(".");if(t.split(".").length===x.length+1){n=b;break}}n?n.children.push(i):f.push(i)}),f},flattenHierarchy:function(e,r=0){let f=[];return e.forEach(a=>{f.push({...a,depth:r,hasChildren:a.children.length>0}),a.children.length>0&&f.push(...this.flattenHierarchy(a.children,r+1))}),f},getHierarchicalAccounts:function(){if(this.accounts.length===0)return[];let e=this.buildHierarchyTree(this.accounts);return this.flattenHierarchy(e)},getExpectedFormat:function(e){return{1:"X",2:"X.X",3:"X.X.X",4:"X.X.X.X",5:"X.X.X.X.X",6:"X.X.X.X.X.X"}[e]||"X.X.X"},getLevelName:function(e){return{1:"Level 1 (Akun)",2:"Level 2 (Kelompok)",3:"Level 3 (Jenis)",4:"Level 4 (Objek)",5:"Level 5 (Rincian Objek)",6:"Level 6 (Sub Rincian Objek)"}[e]||`Level ${e}`},oninit:function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),setTimeout(()=>{Ke.default.route.set("/login")},100);return}this.vnode&&this.vnode.attrs&&this.vnode.attrs.setTitle&&this.vnode.attrs.setTitle("Manajemen Kode Rekening"),this.loadData()},loadData:async function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),setTimeout(()=>{Ke.default.route.set("/login")},100);return}this.isLoading=!0,Ke.default.redraw();try{let e=await Ce.getAll("koderekening");this.accounts=e.data||[],this.availableParents=this.accounts.filter(r=>r.isLeaf===!1),this.applyFilters(),be.success("Data Kode Rekening berhasil dimuat")}catch(e){console.error("Error loading data:",e),e.code===401||e.response&&e.response.status===401?(be.warning("Sesi login telah berakhir. Silakan masuk kembali."),setTimeout(()=>Ke.default.route.set("/login"),2e3)):be.error("Gagal memuat data Kode Rekening: "+(e.message||"Kesalahan tidak diketahui")),this.accounts=[],this.availableParents=[],this.filteredAccounts=[]}finally{this.isLoading=!1,Ke.default.redraw()}},applyFilters:function(){let e=[...this.accounts];if(this.searchQuery.trim()){let r=this.searchQuery.toLowerCase();e=e.filter(f=>f.code.toLowerCase().includes(r)||f.name.toLowerCase().includes(r)||f.fullCode.toLowerCase().includes(r)||f.description&&f.description.toLowerCase().includes(r))}if(this.selectedLevel==="hierarchy"){let r=e,f=this.buildHierarchyTree(r);this.filteredAccounts=this.flattenHierarchy(f)}else if(this.selectedLevel!=="all"){let r=parseInt(this.selectedLevel);e=e.filter(f=>f.level===r),this.filteredAccounts=e}else this.filteredAccounts=e;this.currentPage=1},resetForm:function(){this.formData={code:"",name:"",fullCode:"",description:"",level:1,parent:null},this.errors={}},generateFullCode:function(e,r){if(!e||!r)return r||"";let f=this.accounts.find(a=>a._id===e);return f?`${f.fullCode}.${r}`:r},getNextLevel:function(e){if(!e)return 1;let r=this.accounts.find(f=>f._id===e);return r?r.level+1:1},validateForm:function(){if(this.errors={},this.formData.code.trim()||(this.errors.code="Kode harus diisi"),this.formData.name.trim()||(this.errors.name="Nama harus diisi"),this.modalMode==="edit")if(!this.formData.fullCode.trim())this.errors.fullCode="Kode Lengkap harus diisi";else{let e=this.validateFullCodeFormat();e.valid||(this.errors.fullCode=e.message)}return Object.keys(this.errors).length===0},validateFullCodeFormat:function(){let e=this.formData.fullCode.trim(),r=parseInt(this.formData.level);if(this.modalMode==="edit"&&e){let t=e.split(".");for(let n=0;n<t.length;n++)if(!/^\d+$/.test(t[n]))return{valid:!1,message:`Bagian ke-${n+1} dari Kode Lengkap harus berupa angka.`};return{valid:!0}}let a=(e.match(/\./g)||[]).length+1;if(a!==r)return{valid:!1,message:`Format Kode Lengkap tidak sesuai dengan ${{1:"Level 1 (Akun)",2:"Level 2 (Kelompok)",3:"Level 3 (Jenis)",4:"Level 4 (Objek)",5:"Level 5 (Rincian Objek)",6:"Level 6 (Sub Rincian Objek)"}[r]}. Seharusnya memiliki ${r} bagian angka, tetapi memiliki ${a} bagian.`};let i=e.split(".");for(let t=0;t<i.length;t++)if(!/^\d+$/.test(i[t]))return{valid:!1,message:`Bagian ke-${t+1} dari Kode Lengkap harus berupa angka.`};return{valid:!0}},openCreateModal:function(){this.modalMode="create",this.resetForm(),this.showModal=!0},openEditModal:function(e){this.modalMode="edit",this.formData={_id:e._id,code:e.code,name:e.name,fullCode:e.fullCode,description:e.description||"",level:e.level,parent:e.parent},this.errors={},this.showModal=!0},closeModal:function(){this.showModal=!1,this.resetForm()},saveItem:async function(){if(!this.validateForm()){be.warning("Harap lengkapi semua field yang wajib diisi");return}this.isModalLoading=!0,Ke.default.redraw();try{let e=this.modalMode==="edit"?"PUT":"POST",r=this.modalMode==="edit"?`koderekening/${this.formData._id}`:"koderekening";await Ce.request(`/api/${r}`,{method:e,body:this.formData});let f=await response.json();be.success(`Kode Rekening berhasil di${this.modalMode==="edit"?"perbarui":"simpan"}`),this.closeModal(),this.loadData()}catch(e){console.error("Error saving data:",e),be.error(`Gagal ${this.modalMode==="edit"?"memperbarui":"menyimpan"} Kode Rekening: `+(e.message||"Kesalahan tidak diketahui"))}finally{this.isModalLoading=!1,Ke.default.redraw()}},deleteItem:async function(e){try{let f=(await Ce.request(`/api/anggaran?kodeRekeningId=${e._id}`)).data||[];if(f.length>0){let t=f.map(n=>`\u2022 ${n.subKegiatanId?.nama} (${n.budgetYear}) - ${this.formatCurrency(n.allocations.find(c=>c.kodeRekeningId===e._id)?.amount||0)}`).join(`
`);be.confirm(`Kode Rekening "${e.name}" sedang digunakan dalam ${f.length} anggaran dan tidak dapat dihapus:

${t}

Hapus alokasi dari anggaran terlebih dahulu sebelum menghapus kode rekening ini.`,()=>{be.info("Hapus alokasi dari anggaran terlebih dahulu")},()=>{be.info("Penghapusan dibatalkan")});return}let i=(await Ce.request(`/api/koderekening?search=${encodeURIComponent(e.fullCode+".")}`)).data||[];if(i.length>0){let t=i.slice(0,5).map(b=>`\u2022 ${b.fullCode} - ${b.name}`).join(`
`),n=i.length-5,c=n>0?`
...dan ${n} lagi`:"";be.confirm(`Kode Rekening "${e.name}" memiliki ${i.length} anak dalam hierarki dan tidak dapat dihapus:

${t}${c}

Hapus semua anak terlebih dahulu sebelum menghapus kode rekening induk ini.`,()=>{be.info("Hapus anak dalam hierarki terlebih dahulu")},()=>{be.info("Penghapusan dibatalkan")});return}be.confirm(`Apakah Anda yakin ingin menghapus Kode Rekening "${e.name}" (${this.getCleanFullCode(e.fullCode)})?`,async()=>{this.isLoading=!0,Ke.default.redraw();try{await Ce.delete("koderekening",e._id,`Kode Rekening "${e.name}" (${this.getCleanFullCode(e.fullCode)})`),this.loadData()}catch(t){console.error("Error deleting data:",t),be.error("Gagal menghapus Kode Rekening: "+(t.message||"Kesalahan tidak diketahui"))}finally{this.isLoading=!1,Ke.default.redraw()}},()=>{be.info("Penghapusan dibatalkan")})}catch(r){console.error("Error checking Kode Rekening usage:",r),be.error("Gagal memeriksa penggunaan kode rekening")}},getTotalPages:function(){return Math.ceil(this.filteredAccounts.length/this.itemsPerPage)},getPaginatedAccounts:function(){let e=(this.currentPage-1)*this.itemsPerPage,r=e+this.itemsPerPage;return this.filteredAccounts.slice(e,r)},changePage:function(e){e>=1&&e<=this.getTotalPages()&&(this.currentPage=e,Ke.default.redraw())},view:function(){return(0,Ke.default)("div",{class:"space-y-6"},[(0,Ke.default)("div",{class:"flex justify-between items-center"},[(0,Ke.default)("div",[(0,Ke.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Kode Rekening"),(0,Ke.default)("p",{class:"text-gray-600 mt-1"},"Kelola struktur kode rekening untuk anggaran")]),(0,Ke.default)("button",{class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl",onclick:()=>this.openCreateModal()},[(0,Ke.default)("i",{class:"ri-add-line mr-2"}),"Tambah Kode Rekening"])]),(0,Ke.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,Ke.default)("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4"},[(0,Ke.default)("div",[(0,Ke.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pencarian"),(0,Ke.default)("div",{class:"relative"},[(0,Ke.default)("input",{type:"text",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Cari kode, nama, atau deskripsi...",value:this.searchQuery,oninput:e=>{this.searchQuery=e.target.value,this.applyFilters()}}),(0,Ke.default)("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[(0,Ke.default)("i",{class:"ri-search-line text-gray-400"})])])]),(0,Ke.default)("div",[(0,Ke.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Level"),(0,Ke.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:this.selectedLevel,onchange:e=>{this.selectedLevel=e.target.value,this.applyFilters()}},[(0,Ke.default)("option",{value:"all"},"Semua Level"),(0,Ke.default)("option",{value:"hierarchy"},"Hierarki"),(0,Ke.default)("option",{value:"1"},"Level 1 (Akun)"),(0,Ke.default)("option",{value:"2"},"Level 2 (Kelompok)"),(0,Ke.default)("option",{value:"3"},"Level 3 (Jenis)"),(0,Ke.default)("option",{value:"4"},"Level 4 (Objek)"),(0,Ke.default)("option",{value:"5"},"Level 5 (Rincian Objek)"),(0,Ke.default)("option",{value:"6"},"Level 6 (Sub Rincian Objek)")])]),(0,Ke.default)("div",{class:"flex items-end"},[(0,Ke.default)("div",{class:"text-sm text-gray-600"},[(0,Ke.default)("div",this.selectedLevel==="hierarchy"?`Menampilkan ${this.filteredAccounts.length} rekening (Tampilan Hierarki)`:`Menampilkan ${this.filteredAccounts.length} dari ${this.accounts.length} rekening`),this.searchQuery&&(0,Ke.default)("div",{class:"text-blue-600"},`Pencarian: "${this.searchQuery}"`)])])])]),this.isLoading?(0,Ke.default)("div",{class:"flex justify-center items-center h-64"},[(0,Ke.default)("div",{class:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):(0,Ke.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,Ke.default)("div",{class:"overflow-x-auto"},[(0,Ke.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,Ke.default)("thead",{class:"bg-gray-50"},[(0,Ke.default)("tr",[(0,Ke.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Kode"),(0,Ke.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nama"),(0,Ke.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Level"),(0,Ke.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Deskripsi"),(0,Ke.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,Ke.default)("tbody",{class:"bg-white divide-y divide-gray-200"},this.getPaginatedAccounts().map(e=>[(0,Ke.default)("tr",{class:"hover:bg-gray-50"},[(0,Ke.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,Ke.default)("div",{class:"text-sm font-mono font-medium text-gray-900 flex items-center",style:this.selectedLevel==="hierarchy"?`padding-left: ${e.depth*20}px;`:""},[this.selectedLevel==="hierarchy"&&e.depth>0?(0,Ke.default)("span",{class:"text-gray-400 mr-2 select-none",style:"font-family: monospace;"},"\u2514"+"\u2500".repeat(e.depth)):"",this.selectedLevel==="hierarchy"&&e.hasChildren?(0,Ke.default)("span",{class:"text-gray-500 mr-1 text-xs",title:"Memiliki anak rekening"},"\u25BC"):"",this.getCleanFullCode(e.fullCode)])]),(0,Ke.default)("td",{class:"px-6 py-4"},[(0,Ke.default)("div",{class:"text-sm font-medium text-gray-900 flex items-center",style:this.selectedLevel==="hierarchy"?`padding-left: ${e.depth*20}px;`:""},[this.selectedLevel==="hierarchy"&&e.depth>0?(0,Ke.default)("span",{class:"text-gray-400 mr-2 select-none",style:"font-family: monospace;"},"\u2514"+"\u2500".repeat(e.depth)):"",this.selectedLevel==="hierarchy"&&e.hasChildren?(0,Ke.default)("span",{class:"text-gray-500 mr-1 text-xs",title:"Memiliki anak rekening"},"\u25BC"):"",e.name])]),(0,Ke.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,Ke.default)("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${e.level<=4?"bg-blue-100 text-blue-800":e.level<=7?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"}`},`Level ${e.level}`)]),(0,Ke.default)("td",{class:"px-6 py-4"},[(0,Ke.default)("div",{class:"text-sm text-gray-500 max-w-xs truncate flex items-center",title:e.description,style:this.selectedLevel==="hierarchy"?`padding-left: ${e.depth*20}px;`:""},[this.selectedLevel==="hierarchy"&&e.depth>0?(0,Ke.default)("span",{class:"text-gray-400 mr-2 select-none",style:"font-family: monospace;"},"\u2514"+"\u2500".repeat(e.depth)):"",e.description||"-"])]),(0,Ke.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},[(0,Ke.default)("div",{class:"flex justify-end space-x-2"},[(0,Ke.default)("button",{class:"text-blue-600 hover:text-blue-900 p-1 rounded-full hover:bg-blue-50",onclick:()=>this.openEditModal(e),title:"Edit"},[(0,Ke.default)("i",{class:"ri-edit-line text-lg"})]),(0,Ke.default)("button",{class:"text-red-600 hover:text-red-900 p-1 rounded-full hover:bg-red-50",onclick:()=>this.deleteItem(e),title:"Hapus"},[(0,Ke.default)("i",{class:"ri-delete-bin-line text-lg"})])])])])]))])]),this.getTotalPages()>1&&(0,Ke.default)("div",{class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},[(0,Ke.default)("div",{class:"flex-1 flex justify-between sm:hidden"},[(0,Ke.default)("button",{class:`relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${this.currentPage===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage-1),disabled:this.currentPage===1},"Sebelumnya"),(0,Ke.default)("button",{class:`ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${this.currentPage===this.getTotalPages()?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage+1),disabled:this.currentPage===this.getTotalPages()},"Selanjutnya")]),(0,Ke.default)("div",{class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},[(0,Ke.default)("div",[(0,Ke.default)("p",{class:"text-sm text-gray-700"},["Menampilkan ",(0,Ke.default)("span",{class:"font-medium"},(this.currentPage-1)*this.itemsPerPage+1)," sampai ",(0,Ke.default)("span",{class:"font-medium"},Math.min(this.currentPage*this.itemsPerPage,this.filteredAccounts.length)),this.selectedLevel==="hierarchy"?" dari "+(0,Ke.default)("span",{class:"font-medium"},this.filteredAccounts.length)+" rekening (Hierarki)":" dari "+(0,Ke.default)("span",{class:"font-medium"},this.filteredAccounts.length)+" hasil"])]),(0,Ke.default)("div",[(0,Ke.default)("nav",{class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px"},[(0,Ke.default)("button",{class:`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium ${this.currentPage===1?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage-1),disabled:this.currentPage===1},[(0,Ke.default)("i",{class:"ri-arrow-left-s-line"})]),Array.from({length:Math.min(5,this.getTotalPages())},(e,r)=>{let f=Math.max(1,Math.min(this.getTotalPages()-4,this.currentPage-2))+r;return(0,Ke.default)("button",{class:`relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium ${f===this.currentPage?"z-10 bg-blue-50 border-blue-500 text-blue-600":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(f)},f)}),(0,Ke.default)("button",{class:`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium ${this.currentPage===this.getTotalPages()?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage+1),disabled:this.currentPage===this.getTotalPages()},[(0,Ke.default)("i",{class:"ri-arrow-right-s-line"})])])])])])]),this.showModal&&(0,Ke.default)("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onclick:e=>{e.target===e.currentTarget&&this.closeModal()}},[(0,Ke.default)("div",{class:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white"},[(0,Ke.default)("div",{class:"bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-t-md"},[(0,Ke.default)("div",{class:"flex items-center justify-between"},[(0,Ke.default)("div",{class:"flex items-center space-x-3"},[(0,Ke.default)("div",{class:"w-10 h-10 bg-white bg-opacity-75 rounded-full flex items-center justify-center"},[(0,Ke.default)("i",{class:`${this.modalMode==="create"?"ri-add-fill":"ri-edit-fill"} text-lg`})]),(0,Ke.default)("div",[(0,Ke.default)("h3",{class:"text-lg font-bold"},`${this.modalMode==="create"?"Tambah":"Edit"} Kode Rekening`),(0,Ke.default)("p",{class:"text-white text-opacity-80 text-sm"},"Kelola informasi kode rekening")])]),(0,Ke.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeModal()},[(0,Ke.default)("i",{class:"ri-close-fill"})])])]),(0,Ke.default)("div",{class:"p-6"},[(0,Ke.default)("div",{class:"space-y-4"},[this.modalMode==="create"&&(0,Ke.default)("div",[(0,Ke.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ke.default)("i",{class:"ri-node-tree mr-1 text-green-500"}),"Induk Kode Rekening"]),(0,Ke.default)("select",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.formData.parent||"",onchange:e=>{let r=e.target.value||null;this.formData.parent=r;let f=this.getNextLevel(r);this.formData.level=f,this.formData.code&&(this.formData.fullCode=this.generateFullCode(r,this.formData.code));let a=e.target.closest(".space-y-4").querySelector('input[placeholder*="Level"]');a&&(a.placeholder=`Level ${f}: ${this.getExpectedFormat(f)}`),this.errors.fullCode=null,Ke.default.redraw()},disabled:this.isModalLoading},[(0,Ke.default)("option",{value:""},"Tidak ada induk (Level 1)"),...this.availableParents.map(e=>(0,Ke.default)("option",{value:e._id},`${this.getCleanFullCode(e.fullCode)} - ${e.name}`))]),(0,Ke.default)("p",{class:"mt-2 text-xs text-gray-500"},[(0,Ke.default)("i",{class:"ri-information-line mr-1"}),"Pilih kode rekening induk untuk membuat anak rekening, atau biarkan kosong untuk level 1."])]),(0,Ke.default)("div",[(0,Ke.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ke.default)("i",{class:"ri-hashtag mr-1 text-blue-500"}),"Kode"]),(0,Ke.default)("input",{type:"text",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none transition-all duration-200 bg-gray-50 focus:bg-white ${this.errors.code?"border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}`,placeholder:"Contoh: 1, 1.1, 1.1.1",value:this.formData.code,oninput:e=>{this.formData.code=e.target.value,this.modalMode==="create"&&(this.formData.fullCode=this.generateFullCode(this.formData.parent,e.target.value))},disabled:this.isModalLoading}),this.errors.code&&(0,Ke.default)("p",{class:"mt-1 text-sm text-red-600"},[(0,Ke.default)("i",{class:"ri-error-warning-line mr-1"}),this.errors.code]),(0,Ke.default)("p",{class:"mt-2 text-xs text-gray-500"},[(0,Ke.default)("i",{class:"ri-information-line mr-1"}),"Kode ini akan digabungkan dengan kode lengkap secara otomatis."])]),(0,Ke.default)("div",[(0,Ke.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ke.default)("i",{class:"ri-edit-line mr-1 text-green-500"}),"Nama"]),(0,Ke.default)("input",{type:"text",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none transition-all duration-200 bg-gray-50 focus:bg-white ${this.errors.name?"border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-200"}`,placeholder:"Nama lengkap rekening",value:this.formData.name,oninput:e=>this.formData.name=e.target.value,disabled:this.isModalLoading}),this.errors.name&&(0,Ke.default)("p",{class:"mt-1 text-sm text-red-600"},[(0,Ke.default)("i",{class:"ri-error-warning-line mr-1"}),this.errors.name])]),(0,Ke.default)("div",[(0,Ke.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ke.default)("i",{class:"ri-key-line mr-1 text-purple-500"}),this.modalMode==="create"?"Kode Lengkap (Otomatis)":"Kode Lengkap"]),this.modalMode==="create"?(0,Ke.default)("div",{class:`w-full px-4 py-3 border-2 rounded-lg transition-all duration-200 text-gray-800 font-mono ${this.formData.fullCode&&this.formData.fullCode.trim()?"border-purple-200 bg-purple-50":"border-gray-200 bg-gray-50"}`},[this.formData.fullCode&&this.formData.fullCode.trim()?this.getCleanFullCode(this.formData.fullCode):"Akan dihasilkan secara otomatis"]):(0,Ke.default)("input",{type:"text",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none transition-all duration-200 bg-gray-50 focus:bg-white ${this.errors.fullCode?"border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:`Level ${this.formData.level}: ${this.getExpectedFormat(this.formData.level)}`,value:this.getCleanFullCode(this.formData.fullCode),oninput:e=>{if(this.formData.fullCode=e.target.value,e.target.value.trim()){let r=this.validateFullCodeFormat();this.errors.fullCode=r.valid?null:r.message}else this.errors.fullCode=null;Ke.default.redraw()},disabled:this.isModalLoading}),this.modalMode==="create"&&(0,Ke.default)("p",{class:"mt-2 text-xs text-gray-500"},[(0,Ke.default)("i",{class:"ri-information-line mr-1"}),"Kode lengkap dihasilkan otomatis dari induk + kode yang dimasukkan."]),this.modalMode==="edit"&&this.errors.fullCode&&(0,Ke.default)("p",{class:"mt-1 text-sm text-red-600"},[(0,Ke.default)("i",{class:"ri-error-warning-line mr-1"}),this.errors.fullCode]),this.modalMode==="edit"&&(0,Ke.default)("p",{class:"mt-2 text-xs text-gray-500"},[(0,Ke.default)("i",{class:"ri-information-line mr-1"}),`Format yang diharapkan untuk ${this.getLevelName(this.formData.level)}: ${this.getExpectedFormat(this.formData.level)}`])]),this.modalMode==="edit"&&(0,Ke.default)("div",[(0,Ke.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ke.default)("i",{class:"ri-layers-line mr-1 text-orange-500"}),"Level"]),(0,Ke.default)("select",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.formData.level,onchange:e=>{let r=parseInt(e.target.value);this.formData.level=r;let f=e.target.closest(".space-y-4").querySelector('input[placeholder*="Level"]');if(f&&(f.placeholder=`Level ${r}: ${this.getExpectedFormat(r)}`),this.formData.fullCode&&this.formData.fullCode.trim()){let a=this.validateFullCodeFormat();this.errors.fullCode=a.valid?null:a.message,Ke.default.redraw()}},disabled:this.isModalLoading},[(0,Ke.default)("option",{value:1},"Level 1 (Akun)"),(0,Ke.default)("option",{value:2},"Level 2 (Kelompok)"),(0,Ke.default)("option",{value:3},"Level 3 (Jenis)"),(0,Ke.default)("option",{value:4},"Level 4 (Objek)"),(0,Ke.default)("option",{value:5},"Level 5 (Rincian Objek)"),(0,Ke.default)("option",{value:6},"Level 6 (Sub Rincian Objek)")])]),this.modalMode==="create"&&this.formData.parent&&(0,Ke.default)("div",[(0,Ke.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ke.default)("i",{class:"ri-layers-line mr-1 text-orange-500"}),"Level (Otomatis)"]),(0,Ke.default)("div",{class:"w-full px-4 py-3 border-2 border-orange-200 rounded-lg bg-orange-50 text-orange-800 font-medium"},[`Level ${this.formData.level} (${this.getLevelName(this.formData.level)})`,(0,Ke.default)("span",{class:"ml-2 text-xs text-orange-600"},"ditentukan oleh induk")]),(0,Ke.default)("p",{class:"mt-2 text-xs text-gray-500"},[(0,Ke.default)("i",{class:"ri-information-line mr-1"}),"Level ditentukan secara otomatis berdasarkan kode rekening induk yang dipilih."])]),(0,Ke.default)("div",[(0,Ke.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ke.default)("i",{class:"ri-file-text-line mr-1 text-teal-500"}),"Deskripsi"]),(0,Ke.default)("textarea",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-teal-500 focus:ring-2 focus:ring-teal-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Deskripsi lengkap tentang kode rekening ini",value:this.formData.description,oninput:e=>this.formData.description=e.target.value,rows:3,disabled:this.isModalLoading})])])]),(0,Ke.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-md"},[(0,Ke.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.closeModal(),disabled:this.isModalLoading},[(0,Ke.default)("i",{class:"ri-close-fill"}),(0,Ke.default)("span","Batal")]),(0,Ke.default)("button",{class:`px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 ${this.isModalLoading?"cursor-not-allowed opacity-50":""}`,onclick:()=>this.saveItem(),disabled:this.isModalLoading},[this.isModalLoading?(0,Ke.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,Ke.default)("i",{class:"ri-save-line"}),(0,Ke.default)("span",this.isModalLoading?"Menyimpan...":"Simpan")])])])])])}},Ma=Eo;var Ur=sr(lr(),1);var Xe=sr(lr(),1);var To={isLoading:!1,sumberDanaList:[],filteredSumberDana:[],showModal:!1,modalMode:"create",isModalLoading:!1,formData:{kode:"",nama:"",isActive:!0},searchQuery:"",filterStatus:"all",currentPage:1,itemsPerPage:10,errors:{},oninit:function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),setTimeout(()=>{Xe.default.route.set("/login")},100);return}this.vnode&&this.vnode.attrs&&this.vnode.attrs.setTitle&&this.vnode.attrs.setTitle("Manajemen Sumber Dana"),this.loadData()},loadData:async function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),setTimeout(()=>{Xe.default.route.set("/login")},100);return}this.isLoading=!0,Xe.default.redraw();try{console.log("\u{1F50D} DEBUG [SumberDana] Authentication check:",{isAuthenticated:et.isAuthenticated(),userData:et.getUserData()}),console.log('\u{1F50D} DEBUG [SumberDana] About to call APIUtils.getAll("sumberdana")');let e=await Ce.getAll("sumberdana");console.log("\u{1F50D} DEBUG [SumberDana] API Response - result:",e),console.log("\u{1F50D} DEBUG [SumberDana] API Response - resultType:",typeof e),console.log("\u{1F50D} DEBUG [SumberDana] API Response - resultKeys:",Object.keys(e||{})),console.log("\u{1F50D} DEBUG [SumberDana] API Response - hasData:",e?.data?"YES":"NO"),console.log("\u{1F50D} DEBUG [SumberDana] API Response - result.data:",e?.data),console.log("\u{1F50D} DEBUG [SumberDana] API Response - result.data.length:",e?.data?.length),console.log("\u{1F50D} DEBUG [SumberDana] API Response - isResultDataArray:",Array.isArray(e?.data)),console.log("\u{1F50D} DEBUG [SumberDana] API Response - result.data?.data:",e?.data?.data),console.log("\u{1F50D} DEBUG [SumberDana] API Response - result.data?.data?.length:",e?.data?.data?.length),console.log("\u{1F50D} DEBUG [SumberDana] API Response - result.data?.pagination:",e?.data?.pagination);let r=e.data||[];console.log("\u{1F50D} DEBUG [SumberDana] Data to assign:",{source:"result.data (array from fixed APIUtils)",length:Array.isArray(r)?r.length:0,firstItem:Array.isArray(r)&&r[0]?r[0]:null,isArray:Array.isArray(r)}),this.sumberDanaList=Array.isArray(r)?r:[],console.log("\u{1F50D} DEBUG [SumberDana] After assignment:",{this_sumberDanaList_length:this.sumberDanaList.length,this_sumberDanaList_first:this.sumberDanaList[0]||null,this_sumberDanaList_type:typeof this.sumberDanaList,this_sumberDanaList_isArray:Array.isArray(this.sumberDanaList)}),this.applyFilters(),be.success("Data Sumber Dana berhasil dimuat")}catch(e){console.error("\u274C DEBUG [SumberDana] Error loading data:",e),e.code===401||e.response&&e.response.status===401?(be.warning("Sesi login telah berakhir. Silakan masuk kembali."),setTimeout(()=>Xe.default.route.set("/login"),2e3)):be.error("Gagal memuat data Sumber Dana: "+(e.message||"Kesalahan tidak diketahui")),this.sumberDanaList=[],this.filteredSumberDana=[]}finally{this.isLoading=!1,Xe.default.redraw()}},applyFilters:function(){let e=[...this.sumberDanaList];if(this.searchQuery.trim()){let r=this.searchQuery.toLowerCase();e=e.filter(f=>f.kode.toLowerCase().includes(r)||f.nama.toLowerCase().includes(r))}if(this.filterStatus!=="all"){let r=this.filterStatus==="active";e=e.filter(f=>f.isActive===r)}this.filteredSumberDana=e,this.currentPage=1},resetForm:function(){this.formData={kode:"",nama:"",isActive:!0},this.errors={}},validateForm:function(){return this.errors={},this.formData.kode.trim()||(this.errors.kode="Kode harus diisi"),this.formData.nama.trim()||(this.errors.nama="Nama harus diisi"),Object.keys(this.errors).length===0},openCreateModal:function(){this.modalMode="create",this.resetForm(),this.showModal=!0},openEditModal:e=>{(void 0).modalMode="edit",(void 0).formData={_id:e._id,kode:e.kode,nama:e.nama,isActive:e.isActive},(void 0).errors={},(void 0).showModal=!0},closeModal:function(){this.showModal=!1,this.resetForm()},saveItem:async function(){if(!this.validateForm()){be.warning("Harap lengkapi semua field yang wajib diisi");return}this.isModalLoading=!0,Xe.default.redraw();try{this.modalMode==="edit"?(await Ce.update("sumberdana",this.formData._id,this.formData),be.success("Sumber Dana berhasil diperbarui")):(await Ce.create("sumberdana",this.formData),be.success("Sumber Dana berhasil ditambahkan")),this.closeModal(),this.loadData()}catch(e){console.error("Error saving data:",e)}finally{this.isModalLoading=!1,Xe.default.redraw()}},deleteItem:async function(e){be.confirm(`Apakah Anda yakin ingin menghapus Sumber Dana "${e.nama}"?`,async()=>{this.isLoading=!0,Xe.default.redraw();try{await Ce.delete("sumberdana",e._id,`Sumber Dana "${e.nama}"`),this.loadData()}catch(r){console.error("Error deleting data:",r),be.error("Gagal menghapus Sumber Dana: "+(r.message||"Kesalahan tidak diketahui"))}finally{this.isLoading=!1,Xe.default.redraw()}},()=>{be.info("Penghapusan dibatalkan")})},getTotalPages:function(){return Math.ceil(this.filteredSumberDana.length/this.itemsPerPage)},getPaginatedItems:function(){let e=(this.currentPage-1)*this.itemsPerPage,r=e+this.itemsPerPage;return this.filteredSumberDana.slice(e,r)},changePage:function(e){e>=1&&e<=this.getTotalPages()&&(this.currentPage=e,Xe.default.redraw())},view:function(){return(0,Xe.default)("div",{class:"space-y-6"},[(0,Xe.default)("div",{class:"flex justify-between items-center"},[(0,Xe.default)("div",[(0,Xe.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Sumber Dana"),(0,Xe.default)("p",{class:"text-gray-600 mt-1"},"Kelola sumber dana untuk anggaran")]),(0,Xe.default)("button",{class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white font-medium rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl",onclick:()=>this.openCreateModal()},[(0,Xe.default)("i",{class:"ri-add-line mr-2"}),"Tambah Sumber Dana"])]),(0,Xe.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,Xe.default)("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4"},[(0,Xe.default)("div",[(0,Xe.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pencarian"),(0,Xe.default)("div",{class:"relative"},[(0,Xe.default)("input",{type:"text",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Cari kode atau nama...",value:this.searchQuery,oninput:e=>{this.searchQuery=e.target.value,this.applyFilters()}}),(0,Xe.default)("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[(0,Xe.default)("i",{class:"ri-search-line text-gray-400"})])])]),(0,Xe.default)("div",[(0,Xe.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Status"),(0,Xe.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",value:this.filterStatus,onchange:e=>{this.filterStatus=e.target.value,this.applyFilters()}},[(0,Xe.default)("option",{value:"all"},"Semua Status"),(0,Xe.default)("option",{value:"active"},"Aktif"),(0,Xe.default)("option",{value:"inactive"},"Non Aktif")])]),(0,Xe.default)("div",{class:"flex items-end"},[(0,Xe.default)("div",{class:"text-sm text-gray-600"},[(0,Xe.default)("div",`Menampilkan ${this.filteredSumberDana.length} dari ${this.sumberDanaList.length} sumber dana`),this.searchQuery&&(0,Xe.default)("div",{class:"text-green-600"},`Pencarian: "${this.searchQuery}"`)])])])]),this.isLoading?(0,Xe.default)("div",{class:"flex justify-center items-center h-64"},[(0,Xe.default)("div",{class:"w-12 h-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin"})]):(0,Xe.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,Xe.default)("div",{class:"overflow-x-auto"},[(0,Xe.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,Xe.default)("thead",{class:"bg-gray-50"},[(0,Xe.default)("tr",[(0,Xe.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Kode"),(0,Xe.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nama"),(0,Xe.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),(0,Xe.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,Xe.default)("tbody",{class:"bg-white divide-y divide-gray-200"},this.getPaginatedItems().map(e=>[(0,Xe.default)("tr",{class:"hover:bg-gray-50"},[(0,Xe.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,Xe.default)("div",{class:"text-sm font-mono font-medium text-gray-900"},e.kode)]),(0,Xe.default)("td",{class:"px-6 py-4"},[(0,Xe.default)("div",{class:"text-sm font-medium text-gray-900"},e.nama)]),(0,Xe.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,Xe.default)("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`},e.isActive?"Aktif":"Non Aktif")]),(0,Xe.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},[(0,Xe.default)("div",{class:"flex justify-end space-x-2"},[(0,Xe.default)("button",{class:"text-blue-600 hover:text-blue-900 p-1 rounded-full hover:bg-blue-50",onclick:()=>this.openEditModal(e),title:"Edit"},[(0,Xe.default)("i",{class:"ri-edit-line text-lg"})]),(0,Xe.default)("button",{class:"text-red-600 hover:text-red-900 p-1 rounded-full hover:bg-red-50",onclick:()=>this.deleteItem(e),title:"Hapus"},[(0,Xe.default)("i",{class:"ri-delete-bin-line text-lg"})])])])])]))])]),this.getTotalPages()>1&&(0,Xe.default)("div",{class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},[(0,Xe.default)("div",{class:"flex-1 flex justify-between sm:hidden"},[(0,Xe.default)("button",{class:`relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${this.currentPage===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage-1),disabled:this.currentPage===1},"Sebelumnya"),(0,Xe.default)("button",{class:`ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${this.currentPage===this.getTotalPages()?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage+1),disabled:this.currentPage===this.getTotalPages()},"Selanjutnya")]),(0,Xe.default)("div",{class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},[(0,Xe.default)("div",[(0,Xe.default)("p",{class:"text-sm text-gray-700"},["Menampilkan ",(0,Xe.default)("span",{class:"font-medium"},(this.currentPage-1)*this.itemsPerPage+1)," sampai ",(0,Xe.default)("span",{class:"font-medium"},Math.min(this.currentPage*this.itemsPerPage,this.filteredSumberDana.length))," dari ",(0,Xe.default)("span",{class:"font-medium"},this.filteredSumberDana.length)," hasil"])]),(0,Xe.default)("div",[(0,Xe.default)("nav",{class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px"},[(0,Xe.default)("button",{class:`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium ${this.currentPage===1?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage-1),disabled:this.currentPage===1},[(0,Xe.default)("i",{class:"ri-arrow-left-s-line"})]),Array.from({length:Math.min(5,this.getTotalPages())},(e,r)=>{let f=Math.max(1,Math.min(this.getTotalPages()-4,this.currentPage-2))+r;return(0,Xe.default)("button",{class:`relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium ${f===this.currentPage?"z-10 bg-green-50 border-green-500 text-green-600":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(f)},f)}),(0,Xe.default)("button",{class:`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium ${this.currentPage===this.getTotalPages()?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage+1),disabled:this.currentPage===this.getTotalPages()},[(0,Xe.default)("i",{class:"ri-arrow-right-s-line"})])])])])])]),this.showModal&&(0,Xe.default)("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onclick:e=>{e.target===e.currentTarget&&this.closeModal()}},[(0,Xe.default)("div",{class:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white"},[(0,Xe.default)("div",{class:"bg-gradient-to-r from-green-500 to-teal-600 text-white p-4 rounded-t-md"},[(0,Xe.default)("div",{class:"flex items-center justify-between"},[(0,Xe.default)("div",{class:"flex items-center space-x-3"},[(0,Xe.default)("div",{class:"w-10 h-10 bg-white bg-opacity-75 rounded-full flex items-center justify-center"},[(0,Xe.default)("i",{class:`${this.modalMode==="create"?"ri-add-fill":"ri-edit-fill"} text-lg`})]),(0,Xe.default)("div",[(0,Xe.default)("h3",{class:"text-lg font-bold"},`${this.modalMode==="create"?"Tambah":"Edit"} Sumber Dana`),(0,Xe.default)("p",{class:"text-white text-opacity-80 text-sm"},"Kelola informasi sumber dana")])]),(0,Xe.default)("button",{class:"w-8 h-8 bg-green-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeModal()},[(0,Xe.default)("i",{class:"ri-close-fill"})])])]),(0,Xe.default)("div",{class:"p-6"},[(0,Xe.default)("div",{class:"space-y-6"},[(0,Xe.default)("div",[(0,Xe.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Xe.default)("i",{class:"ri-hashtag mr-1 text-green-500"}),"Kode",(0,Xe.default)("span",{class:"text-red-500 ml-1"},"*")]),(0,Xe.default)("input",{type:"text",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none transition-all duration-200 bg-gray-50 focus:bg-white ${this.errors.kode?"border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-200 focus:border-green-500 focus:ring-2 focus:ring-green-200"}`,placeholder:"Contoh: 1, 2, 3",value:this.formData.kode,oninput:e=>this.formData.kode=e.target.value,disabled:this.isModalLoading}),this.errors.kode&&(0,Xe.default)("p",{class:"mt-1 text-sm text-red-600"},[(0,Xe.default)("i",{class:"ri-error-warning-line mr-1"}),this.errors.kode])]),(0,Xe.default)("div",[(0,Xe.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Xe.default)("i",{class:"ri-text mr-1 text-blue-500"}),"Nama Sumber Dana",(0,Xe.default)("span",{class:"text-red-500 ml-1"},"*")]),(0,Xe.default)("input",{type:"text",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none transition-all duration-200 bg-gray-50 focus:bg-white ${this.errors.nama?"border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}`,placeholder:"Nama lengkap sumber dana",value:this.formData.nama,oninput:e=>this.formData.nama=e.target.value,disabled:this.isModalLoading}),this.errors.nama&&(0,Xe.default)("p",{class:"mt-1 text-sm text-red-600"},[(0,Xe.default)("i",{class:"ri-error-warning-line mr-1"}),this.errors.nama])]),(0,Xe.default)("div",[(0,Xe.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Xe.default)("i",{class:"ri-toggle-line mr-1 text-purple-500"}),"Status"]),(0,Xe.default)("div",{class:"flex items-center space-x-4"},[(0,Xe.default)("label",{class:"flex items-center"},[(0,Xe.default)("input",{type:"radio",name:"isActive",value:"true",checked:this.formData.isActive===!0,onchange:()=>this.formData.isActive=!0,disabled:this.isModalLoading}),(0,Xe.default)("span",{class:"ml-2 text-sm text-gray-700"},"Aktif")]),(0,Xe.default)("label",{class:"flex items-center"},[(0,Xe.default)("input",{type:"radio",name:"isActive",value:"false",checked:this.formData.isActive===!1,onchange:()=>this.formData.isActive=!1,disabled:this.isModalLoading}),(0,Xe.default)("span",{class:"ml-2 text-sm text-gray-700"},"Non Aktif")])])])])]),(0,Xe.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-md"},[(0,Xe.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.closeModal(),disabled:this.isModalLoading},[(0,Xe.default)("i",{class:"ri-close-fill"}),(0,Xe.default)("span","Batal")]),(0,Xe.default)("button",{class:`px-6 py-3 bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 ${this.isModalLoading?"cursor-not-allowed opacity-50":""}`,onclick:()=>this.saveItem(),disabled:this.isModalLoading},[this.isModalLoading?(0,Xe.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,Xe.default)("i",{class:"ri-save-line"}),(0,Xe.default)("span",this.isModalLoading?"Menyimpan...":"Simpan")])])])])])}},gi=To;var Mo={activeTab:"kode-rekening",oninit:function(e){if(!et.isAuthenticated()){Promise.resolve().then(()=>(Wr(),ri)).then(({default:r})=>{r.warning("Silakan masuk terlebih dahulu")}),setTimeout(()=>{Ur.default.route.set("/login")},100);return}e.attrs&&e.attrs.setTitle&&e.attrs.setTitle("Kode Rekening dan Sumber Dana")},setActiveTab:function(e){this.activeTab=e,Ur.default.redraw()},view:function(e){return(0,Ur.default)("div",{class:"space-y-6"},[(0,Ur.default)("div",{class:"flex justify-between items-center"},[(0,Ur.default)("div",[(0,Ur.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Kode Rekening dan Sumber Dana"),(0,Ur.default)("p",{class:"text-gray-600 mt-1"},"Kelola kode rekening dan sumber dana untuk anggaran")])]),(0,Ur.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200"},[(0,Ur.default)("div",{class:"border-b border-gray-200"},[(0,Ur.default)("nav",{class:"-mb-px flex space-x-8 px-6"},[(0,Ur.default)("button",{class:`py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${this.activeTab==="kode-rekening"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:()=>this.setActiveTab("kode-rekening")},[(0,Ur.default)("i",{class:"ri-wallet-line mr-2"}),"Kode Rekening"]),(0,Ur.default)("button",{class:`py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${this.activeTab==="sumber-dana"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:()=>this.setActiveTab("sumber-dana")},[(0,Ur.default)("i",{class:"ri-money-dollar-circle-line mr-2"}),"Sumber Dana"])])]),(0,Ur.default)("div",{class:"p-6"},[this.activeTab==="kode-rekening"?(0,Ur.default)(Ma,{setTitle:e.attrs?.setTitle}):(0,Ur.default)(gi,{setTitle:e.attrs?.setTitle})])])])}},hi=Mo;var $e=sr(lr(),1);Wr();var Fo={isLoading:!1,anggaran:[],filteredAnggaran:[],showModal:!1,modalMode:"create",isModalLoading:!1,editingAllocationRow:null,editAllocationForm:{kodeRekeningId:"",amount:"",description:""},formData:{subKegiatanId:"",budgetYear:"",sumberDanaId:"",allocations:[],description:""},allocationForm:{kodeRekeningId:"",amount:"",description:""},subKegiatanList:[],sumberDanaList:[],kodeRekeningList:[],urusanList:[],bidangList:[],programList:[],kegiatanList:[],searchQuery:"",selectedStatus:"all",kodeRekeningSearch:"",subKegiatanSearch:"",currentPage:1,itemsPerPage:10,formatCurrency:function(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e||0)},parseCurrencyInput:function(e){if(!e)return 0;let r=e.toString().replace(/Rp\s?/g,"").replace(/[.,]/g,"").replace(/\s+/g,"");return parseInt(r)||0},formatNumberInput:function(e){return e?new Intl.NumberFormat("id-ID").format(e):""},parseNumberInput:function(e){if(!e)return 0;let r=e.toString().replace(/[.,]/g,"");return parseInt(r)||0},recoverKodeRekeningId:function(e,r){if(e.description){let f=e.description.toLowerCase(),a=[{pattern:/semen|cement|concrete/i,keywords:["semen","cement","concrete","beton","bahan","material"]},{pattern:/besi|steel|iron/i,keywords:["besi","steel","iron","logam"]},{pattern:/kayu|wood|timber/i,keywords:["kayu","wood","timber","lumber"]},{pattern:/cat|paint|coating/i,keywords:["cat","paint","coating","finishing"]},{pattern:/keramik|tile|ceramic/i,keywords:["keramik","tile","ceramic","ubin"]},{pattern:/piping|pipa|pipe/i,keywords:["pipa","piping","plumbing"]},{pattern:/electrical|listrik|electric/i,keywords:["listrik","electrical","wiring"]},{pattern:/equipment|alat|equipment/i,keywords:["alat","equipment","tool"]},{pattern:/material|materials|building/i,keywords:["material","materials","building"]},{pattern:/dll|etc|lainnya/i,keywords:["dll","etc","lainnya","others"]}];for(let{pattern:t,keywords:n}of a)if(t.test(f)){let c=this.kodeRekeningList.find(b=>{let x=b.name.toLowerCase(),w=b.code.toLowerCase(),g=b.fullCode.toLowerCase();return f.includes("semen")?x.includes("bahan baku")||x.includes("material")||g.includes("5.1.2.1")||g.includes("5.1.2.2"):n.some(o=>x.includes(o)||w.includes(o)||g.includes(o))});if(c)return c._id}let i=this.kodeRekeningList.find(t=>t.name.toLowerCase().includes(f)||f.includes(t.name.toLowerCase())||t.fullCode.toLowerCase().includes(f));if(i)return i._id}return be.warning(`Alokasi ${r+1}: Data kode rekening corrupted - silakan pilih manual`),null},getFilteredSubKegiatan:function(){let e=new Set((this.anggaran||[]).filter(f=>f.budgetYear===this.userData?.budgetYear).map(f=>{let a=f.subKegiatanId;return a?typeof a=="string"?a:typeof a=="object"&&(a._id||a.$oid)||null:null}).filter(Boolean));if(!this.subKegiatanSearch.trim())return this.subKegiatanList.filter(f=>!e.has(f._id));let r=this.subKegiatanSearch.toLowerCase();return this.subKegiatanList.filter(f=>{if(e.has(f._id))return!1;let a=(f.fullCode||f.kode||"").toLowerCase();return(f.kode||"").toLowerCase().includes(r)||(f.nama||"").toLowerCase().includes(r)||a.includes(r)})},getFilteredKodeRekening:function(){if(!this.kodeRekeningSearch.trim())return this.kodeRekeningList;let e=this.kodeRekeningSearch.toLowerCase();return this.kodeRekeningList.filter(r=>r.fullCode.toLowerCase().includes(e)||r.name.toLowerCase().includes(e)||r.code.toLowerCase().includes(e))},oninit:function(){if(!et.isAuthenticated()){ct.warning("Silakan masuk terlebih dahulu"),$e.default.route.set("/login");return}this.vnode&&this.vnode.attrs&&this.vnode.attrs.setTitle&&this.vnode.attrs.setTitle("Manajemen Anggaran"),this.userData=et.getUserData(),this.userData.budgetYear&&typeof this.userData.budgetYear=="object"&&(this.userData.budgetYear=`${this.userData.budgetYear.year}-${this.userData.budgetYear.status}`),this.loadData()},loadData:async function(){this.isLoading=!0,$e.default.redraw();try{let[e,r,f,a]=await Promise.all([Ce.getAll("anggaran"),Ce.getAll("subkegiatan"),Ce.getAll("koderekening"),Ce.getAll("sumberdana")]);this.anggaran=e.data||[],this.subKegiatanList=r.data||[],this.kodeRekeningList=f.data||[],this.sumberDanaList=a.data||[];let i=[],t=[],n=[],c=[];try{let[b]=await Promise.all([Ce.getAll("urusan")]);i=b.data||[]}catch(b){console.warn("Failed to load urusan data:",b)}try{let[b]=await Promise.all([Ce.getAll("bidang")]);t=b.data||[]}catch(b){console.warn("Failed to load bidang data:",b)}try{let[b]=await Promise.all([Ce.getAll("program")]);n=b.data||[]}catch(b){console.warn("Failed to load program data:",b)}try{let[b]=await Promise.all([Ce.getAll("kegiatan")]);c=b.data||[]}catch(b){console.warn("Failed to load kegiatan data:",b)}this.subKegiatanList=this.subKegiatanList.map(b=>{let x=c.find(h=>h._id===b.kegiatanId?.$oid||b.kegiatanId),w=n.find(h=>h._id===x?.programId?.$oid||x?.programId),g=t.find(h=>h._id===w?.bidangId?.$oid||w?.bidangId),o=i.find(h=>h._id===g?.urusanId?.$oid||g?.urusanId),u=[o?.kode,g?.kode,w?.kode,x?.kode,b.kode].filter(h=>h).join(".");return{...b,fullCode:u||b.kode,urusanKode:o?.kode||"",bidangKode:g?.kode||"",programKode:w?.kode||"",kegiatanKode:x?.kode||""}}),this.anggaran=this.anggaran.map(b=>{if(b.subKegiatanId){let x=this.subKegiatanList.find(w=>w._id===b.subKegiatanId._id||w._id===b.subKegiatanId||w._id?.$oid===b.subKegiatanId._id||w._id?.$oid===b.subKegiatanId);x&&(b.subKegiatanId={...b.subKegiatanId,fullCode:x.fullCode,urusanKode:x.urusanKode,bidangKode:x.bidangKode,programKode:x.programKode,kegiatanKode:x.kegiatanKode})}return b}),this.applyFilters()}catch(e){console.error("Error loading data:",e),this.anggaran=[],this.filteredAnggaran=[],this.subKegiatanList=[],this.kodeRekeningList=[],this.sumberDanaList=[],this.urusanList=[],this.bidangList=[],this.programList=[],this.kegiatanList=[]}finally{this.isLoading=!1,$e.default.redraw()}},applyFilters:function(){let e=[...this.anggaran];if(this.searchQuery.trim()){let r=this.searchQuery.toLowerCase();e=e.filter(f=>{let a=f.subKegiatanId?.fullCode||"";return f.subKegiatanId?.nama?.toLowerCase().includes(r)||f.subKegiatanId?.kode?.toLowerCase().includes(r)||a.toLowerCase().includes(r)||f.budgetYear?.toLowerCase().includes(r)?!0:f.allocations?.some(t=>{let n=t.kodeRekeningId;typeof n=="object"&&n!==null&&(n.$oid?n=n.$oid:n._id?n=n._id:n.fullCode?n=n.fullCode:n=n.toString());let c=this.kodeRekeningList.find(g=>g._id===n),b=c&&(c.fullCode.toLowerCase().includes(r)||c.name.toLowerCase().includes(r)||c.code.toLowerCase().includes(r)),x=t.description?.toLowerCase().includes(r),w=this.formatCurrency(t.amount).toLowerCase().includes(r);return b||x||w})})}this.filteredAnggaran=e,this.currentPage=1},resetForm:function(){this.formData={subKegiatanId:"",budgetYear:this.userData.budgetYear||"",sumberDanaId:"",allocations:[],description:""},this.allocationForm={kodeRekeningId:"",amount:"",description:""}},openCreateModal:function(){this.modalMode="create",this.resetForm(),this.showModal=!0},openEditModal:async function(e){this.modalMode="edit";let r=await Ce.getAll("koderekening");this.kodeRekeningList=r.data||[];let f=await Ce.getAll("sumberdana");this.sumberDanaList=f.data||[];let a=et.getUserData(),i=a?.id||a?.userId;console.log("=== EDIT MODAL DEBUG ==="),console.log("anggaran.sumberDanaId:",e.sumberDanaId),console.log("Type of anggaran.sumberDanaId:",typeof e.sumberDanaId);let t="";e.sumberDanaId&&(typeof e.sumberDanaId=="object"?e.sumberDanaId.$oid?t=e.sumberDanaId.$oid:e.sumberDanaId._id?t=e.sumberDanaId._id:t=String(e.sumberDanaId):t=e.sumberDanaId),console.log("Processed sumberDanaId:",t),console.log("sumberDanaList length:",this.sumberDanaList.length);let n=(e.allocations||[]).map((c,b)=>{console.log(`=== PROCESSING ALLOCATION ${b} ===`),console.log("Raw allocation object:",JSON.stringify(c,null,2)),console.log("Raw kodeRekeningId:",c.kodeRekeningId),console.log("Type of kodeRekeningId:",typeof c.kodeRekeningId);let x=c.kodeRekeningId;typeof x=="string"&&x==="[object Object]"?(console.log("Found corrupted kodeRekeningId string, attempting recovery..."),x=this.recoverKodeRekeningId(c,b)):typeof x=="object"&&x!==null&&(console.log("kodeRekeningId is an object, processing..."),x.$oid?(x=x.$oid,console.log("Using MongoDB $oid:",x)):x._id?(x=x._id,console.log("Using kodeRekeningId._id:",x)):x.fullCode?(x=x.fullCode,console.log("Using kodeRekeningId.fullCode:",x)):(x=String(x),console.log("Converting to string:",x))),c.kodeRekening&&typeof c.kodeRekening=="object"&&(console.log("Found nested kodeRekening object:",c.kodeRekening),c.kodeRekening._id?(x=c.kodeRekening._id,console.log("Using nested kodeRekening._id:",x)):c.kodeRekening.fullCode&&(x=c.kodeRekening.fullCode,console.log("Using nested kodeRekening.fullCode:",x))),console.log("Final processed kodeRekeningId:",x),x===null&&(console.warn(`Could not recover kode rekening ID for allocation ${b}, will need manual selection`),x="");let w={...c,kodeRekeningId:x,allocatedBy:c.allocatedBy||i,needsManualSelection:x===""};return console.log(`Final allocation ${b} result:`,w),w});this.formData={_id:e._id,subKegiatanId:e.subKegiatanId?._id||e.subKegiatanId,budgetYear:e.budgetYear,sumberDanaId:t,allocations:n,description:e.description||""},console.log("Final formData:",this.formData),this.showModal=!0},closeModal:function(){this.showModal=!1,this.resetForm()},addAllocation:function(){if(!this.allocationForm.kodeRekeningId||!this.allocationForm.amount){ct.warning("Pilih kode rekening dan masukkan jumlah");return}let e=this.allocationForm.kodeRekeningId;if(typeof e=="object"&&e!==null&&(e=e.$oid||e._id||e.toString()),this.formData.allocations.findIndex(i=>{let t=i.kodeRekeningId;return typeof t=="object"&&t!==null&&(t=t.$oid||t._id||t.toString()),t===e})>=0){ct.warning("Kode rekening sudah ditambahkan");return}let f=et.getUserData(),a=f?.id||f?.userId;this.formData.allocations.push({kodeRekeningId:e,amount:this.parseNumberInput(this.allocationForm.amount),description:this.allocationForm.description,allocatedBy:a}),this.allocationForm={kodeRekeningId:"",amount:"",description:""},$e.default.redraw()},removeAllocation:function(e){this.formData.allocations.splice(e,1),$e.default.redraw()},startEditingAllocation:function(e,r){this.editingAllocationRow=r,this.editAllocationForm={kodeRekeningId:e.kodeRekeningId||"",amount:this.formatNumberInput(e.amount),description:e.description||""},$e.default.redraw()},cancelEditingAllocation:function(){this.editingAllocationRow=null,this.editAllocationForm={kodeRekeningId:"",amount:"",description:""},$e.default.redraw()},saveAllocationEdit:function(e){if(!this.editAllocationForm.kodeRekeningId||!this.editAllocationForm.amount){ct.warning("Kode rekening dan jumlah harus diisi");return}let r=this.editAllocationForm.kodeRekeningId;typeof r=="object"&&r!==null?this.formData.allocations[e].kodeRekeningId=r.$oid||r._id||r.toString():this.formData.allocations[e].kodeRekeningId=r,this.formData.allocations[e].amount=this.parseNumberInput(this.editAllocationForm.amount),this.formData.allocations[e].description=this.editAllocationForm.description,this.editingAllocationRow=null,this.editAllocationForm={kodeRekeningId:"",amount:"",description:""},$e.default.redraw()},replaceCorruptedAllocation:function(e){let r=this.formData.allocations[e];r&&(this.allocationForm={kodeRekeningId:"",amount:this.formatNumberInput(r.amount),description:r.description||""},this.removeAllocation(e),setTimeout(()=>{let f=document.querySelector('select[value=""]');f&&f.focus()},100),ct.info("Alokasi dihapus. Silakan pilih kode rekening yang benar dan tambah alokasi baru."))},saveItem:async function(){if(!this.formData.subKegiatanId||!this.formData.budgetYear||!this.formData.sumberDanaId||this.formData.allocations.length===0){ct.warning("SubKegiatan, tahun anggaran, sumber dana, dan alokasi harus diisi");return}this.isModalLoading=!0,$e.default.redraw();try{console.log("Sending Anggaran data:",JSON.stringify(this.formData,null,2));let e;this.modalMode==="edit"?e=await Ce.update("anggaran",this.formData._id,this.formData):e=await Ce.create("anggaran",this.formData),this.closeModal(),this.loadData()}catch(e){console.error("Error saving data:",e)}finally{this.isModalLoading=!1,$e.default.redraw()}},deleteItem:async function(e){try{let f=(await Ce.request(`/api/kinerja?anggaranId=${e._id}`)).data?.length||0;if(f>0){be.confirm(`Anggaran ini sedang digunakan oleh ${f} target kinerja. Menghapus anggaran akan mempengaruhi data kinerja yang ada.

Apakah Anda yakin ingin menghapus anggaran untuk "${e.subKegiatanId?.nama}" (${e.budgetYear})?`,async()=>{await this.performDelete(e)},()=>{be.info("Penghapusan dibatalkan")});return}}catch(r){console.error("Error checking kinerja dependencies:",r)}be.confirm(`Apakah Anda yakin ingin menghapus anggaran untuk "${e.subKegiatanId?.nama}" (${e.budgetYear})?`,async()=>{await this.performDelete(e)},()=>{be.info("Penghapusan dibatalkan")})},performDelete:async function(e){this.isLoading=!0,$e.default.redraw();try{await Ce.delete("anggaran",e._id,`anggaran untuk "${e.subKegiatanId?.nama}" (${e.budgetYear})`)&&this.loadData()}catch(r){if(console.error("Error deleting data:",r),r.message&&r.message.includes("sudah ada"))try{let a=(await Ce.request(`/api/anggaran?subKegiatanId=${this.formData.subKegiatanId}&budgetYear=${encodeURIComponent(this.formData.budgetYear)}`)).data?.[0];if(a){be.confirm(`Anggaran untuk SubKegiatan ini dengan tahun "${this.formData.budgetYear}" sudah ada. Apakah Anda ingin mengedit anggaran yang sudah ada?`,()=>{this.openEditModal(a)},()=>{ct.info("Pilih SubKegiatan atau tahun anggaran yang berbeda")});return}}catch(f){console.error("Error checking existing anggaran:",f)}}finally{this.isLoading=!1,$e.default.redraw()}},getTotalPages:function(){return Math.ceil(this.filteredAnggaran.length/this.itemsPerPage)},getPaginatedAnggaran:function(){let e=(this.currentPage-1)*this.itemsPerPage,r=e+this.itemsPerPage;return this.filteredAnggaran.slice(e,r)},getAllAllocations:function(){let e=[];return this.filteredAnggaran.forEach(r=>{r.allocations&&r.allocations.length>0&&r.allocations.forEach((f,a)=>{e.push({...f,anggaranId:r._id,subKegiatanNama:r.subKegiatanId?.nama||"Tidak ditemukan",subKegiatanKode:r.subKegiatanId?.fullCode||r.subKegiatanId?.kode||"",budgetYear:r.budgetYear,allocationIndex:a,needsManualSelection:f.kodeRekeningId===""||f.needsManualSelection})})}),e},getPaginatedAllocations:function(){let e=this.getAllAllocations(),r=(this.currentPage-1)*this.itemsPerPage,f=r+this.itemsPerPage;return e.slice(r,f)},saveAnggaran:async function(e){try{await Ce.update("anggaran",e._id,e),this.loadData()}catch(r){console.error("Error saving anggaran:",r),this.loadData()}},changePage:function(e){e>=1&&e<=this.getTotalPages()&&(this.currentPage=e,$e.default.redraw())},renderAllocationRow:function(e,r){let f=this.editingAllocationRow===r;return(0,$e.default)("tr",{class:"hover:bg-gray-50",key:`${e.kodeRekeningId}-${r}`},[(0,$e.default)("td",{class:"px-4 py-3 whitespace-nowrap"},[f?(0,$e.default)("select",{class:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",value:this.editAllocationForm.kodeRekeningId||"",oninput:a=>{this.editAllocationForm.kodeRekeningId=a.target.value}},[(0,$e.default)("option",{value:""},"Pilih Kode Rekening"),this.kodeRekeningList.map(a=>(0,$e.default)("option",{value:a._id,key:a._id},`${a.fullCode} - ${a.name}`))]):this.renderKodeRekeningDisplay(e)]),(0,$e.default)("td",{class:"px-4 py-3"},[f?(0,$e.default)("input",{type:"text",class:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",value:this.editAllocationForm.description,oninput:a=>{this.editAllocationForm.description=a.target.value},placeholder:"Keterangan alokasi"}):(0,$e.default)("div",{class:"text-sm text-gray-600"},e.description||"-")]),(0,$e.default)("td",{class:"px-4 py-3 whitespace-nowrap text-right"},[f?(0,$e.default)("input",{type:"text",class:"w-full px-2 py-1 text-sm border border-gray-300 rounded text-right focus:outline-none focus:ring-2 focus:ring-green-500 bg-white",value:this.editAllocationForm.amount,oninput:a=>{this.editAllocationForm.amount=a.target.value},placeholder:"0"}):(0,$e.default)("span",{class:"text-sm font-semibold text-green-600"},this.formatCurrency(e.amount))]),(0,$e.default)("td",{class:"px-4 py-3 whitespace-nowrap text-center"},[(0,$e.default)("div",{class:"flex justify-center space-x-2"},[(0,$e.default)("button",{class:"text-blue-600 hover:text-blue-900 p-1 rounded-full hover:bg-blue-50",onclick:()=>this.startEditingAllocation(e,r),disabled:this.isModalLoading,title:"Edit alokasi"},[(0,$e.default)("i",{class:"ri-edit-line text-sm"})]),f&&(0,$e.default)("button",{class:"text-green-600 hover:text-green-900 p-1 rounded-full hover:bg-green-50",onclick:()=>this.saveAllocationEdit(r),title:"Simpan"},[(0,$e.default)("i",{class:"ri-check-line text-sm"})]),f&&(0,$e.default)("button",{class:"text-gray-600 hover:text-gray-900 p-1 rounded-full hover:bg-gray-50",onclick:()=>this.cancelEditingAllocation(),title:"Batal"},[(0,$e.default)("i",{class:"ri-close-fill text-sm"})]),!f&&(0,$e.default)("button",{class:"text-red-600 hover:text-red-900 p-1 rounded-full hover:bg-red-50",onclick:a=>{a.stopPropagation(),this.removeAllocation(r)},disabled:this.isModalLoading,title:"Hapus alokasi"},[(0,$e.default)("i",{class:"ri-delete-bin-line text-sm"})])])])])},renderKodeRekeningDisplay:function(e){let r=e.kodeRekeningId;typeof r=="object"&&r!==null&&(r.$oid?r=r.$oid:r._id?r=r._id:r.fullCode?r=r.fullCode:r=r.toString());let f=this.kodeRekeningList.find(a=>a._id===r);return f?(0,$e.default)("div",{class:"text-sm font-medium text-gray-900"},`${f.fullCode} - ${f.name}`):r===""?(0,$e.default)("div",[(0,$e.default)("span",{class:"text-amber-600 font-medium"},[(0,$e.default)("i",{class:"ri-error-warning-line mr-1"}),"Perlu pemilihan manual"])]):(0,$e.default)("div",{class:"text-sm font-medium text-gray-900"},`Kode: ${r||"Tidak tersedia"}`)},renderForm:function(){if(!this.showModal)return null;let e=this.formData.allocations.reduce((r,f)=>r+f.amount,0);return(0,$e.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onclick:r=>r.target===r.currentTarget&&this.closeModal()},[(0,$e.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-6xl w-full mx-4 transform transition-all max-h-[95vh] overflow-y-auto",onclick:r=>r.stopPropagation()},[(0,$e.default)("div",{class:`bg-gradient-to-r ${this.modalMode==="delete"?"from-red-500 to-red-600":"from-blue-500 to-purple-600"} text-white p-6 rounded-t-xl`},[(0,$e.default)("div",{class:"flex items-center justify-between"},[(0,$e.default)("div",{class:"flex items-center space-x-3"},[(0,$e.default)("div",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center"},[(0,$e.default)("i",{class:`ri-${this.modalMode==="delete"?"delete-bin":this.modalMode==="create"?"add":"edit"}-line text-xl text-white`})]),(0,$e.default)("div",[(0,$e.default)("h3",{class:"text-xl font-bold"},[`${this.modalMode==="create"?"Tambah":this.modalMode==="edit"?"Edit":"Hapus"} Anggaran`]),(0,$e.default)("p",{class:"text-white text-opacity-80 text-sm"},[this.modalMode==="delete"?"Konfirmasi penghapusan data":"Formulir input anggaran dengan alokasi kode rekening"])])]),(0,$e.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeModal()},[(0,$e.default)("i",{class:"ri-close-fill"})])])]),(0,$e.default)("div",{class:"p-8"},[(0,$e.default)("div",{class:"mb-8"},[(0,$e.default)("h4",{class:"text-xl font-semibold text-gray-800 mb-6 flex items-center"},[(0,$e.default)("i",{class:"ri-information-line mr-3 text-blue-500"}),"Informasi Anggaran"]),(0,$e.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},[(0,$e.default)("div",{class:"md:col-span-2"},[(0,$e.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,$e.default)("i",{class:"ri-node-tree mr-2 text-blue-500"}),"SubKegiatan"]),this.formData.subKegiatanId&&(()=>{let r=this.subKegiatanList.find(f=>f._id===this.formData.subKegiatanId);return r?(0,$e.default)("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4"},[(0,$e.default)("div",{class:"flex items-center justify-between"},[(0,$e.default)("div",[(0,$e.default)("div",{class:"font-semibold text-blue-900 text-lg"},r.nama),(0,$e.default)("div",{class:"text-sm text-blue-700 font-mono mt-1"},r.fullCode||r.kode)]),(0,$e.default)("button",{type:"button",class:"text-blue-600 hover:text-blue-800 p-2 rounded-full hover:bg-blue-100",onclick:()=>{this.formData.subKegiatanId="",this.subKegiatanSearch=""},disabled:this.isModalLoading},[(0,$e.default)("i",{class:"ri-close-fill"})])])]):null})(),(0,$e.default)("div",{class:"space-y-3"},[(0,$e.default)("div",{class:"relative"},[(0,$e.default)("input",{type:"text",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 focus:bg-white text-sm",placeholder:this.formData.subKegiatanId?"Ganti subkegiatan...":"Cari subkegiatan...",value:this.subKegiatanSearch,oninput:r=>{this.subKegiatanSearch=r.target.value,$e.default.redraw()},disabled:this.isModalLoading}),(0,$e.default)("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[(0,$e.default)("i",{class:"ri-search-line text-gray-400"})])]),(0,$e.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",value:this.formData.subKegiatanId,onchange:r=>{this.formData.subKegiatanId=r.target.value,r.target.value&&(this.subKegiatanSearch="")},disabled:this.isModalLoading},[(0,$e.default)("option",{value:""},this.subKegiatanSearch?`Pilih dari ${this.getFilteredSubKegiatan().length} hasil`:"Pilih SubKegiatan"),this.getFilteredSubKegiatan().map(r=>(0,$e.default)("option",{value:r._id,key:r._id},`${r.fullCode||r.kode} - ${r.nama}`))])])]),(0,$e.default)("div",[(0,$e.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,$e.default)("i",{class:"ri-calendar-line mr-2 text-green-500"}),"Tahun Anggaran"]),(0,$e.default)("input",{type:"text",class:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 font-medium",value:this.formData.budgetYear,disabled:!0}),(0,$e.default)("p",{class:"mt-1 text-xs text-gray-500"},"Otomatis dari login pengguna")]),(0,$e.default)("div",[(0,$e.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,$e.default)("i",{class:"ri-wallet-3-line mr-2 text-green-500"}),"Sumber Dana"]),(0,$e.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white",value:this.formData.sumberDanaId,onchange:r=>{this.formData.sumberDanaId=r.target.value},disabled:this.isModalLoading},[(0,$e.default)("option",{value:""},"Pilih Sumber Dana"),this.sumberDanaList.map(r=>(0,$e.default)("option",{value:r._id,key:r._id},`${r.kode} - ${r.nama}`))]),(0,$e.default)("p",{class:"mt-1 text-xs text-gray-500"},"Pilih sumber dana untuk anggaran ini")])]),(0,$e.default)("div",{class:"mt-6"},[(0,$e.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,$e.default)("i",{class:"ri-file-text-line mr-2 text-teal-500"}),"Deskripsi"]),(0,$e.default)("textarea",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-white resize-vertical",placeholder:"Deskripsi tambahan untuk anggaran ini",value:this.formData.description,oninput:r=>this.formData.description=r.target.value,rows:4,disabled:this.isModalLoading})])]),(0,$e.default)("div",{class:"border-t border-gray-200 pt-8"},[(0,$e.default)("div",{class:"flex items-center justify-between mb-6"},[(0,$e.default)("h4",{class:"text-xl font-semibold text-gray-800 flex items-center"},[(0,$e.default)("i",{class:"ri-wallet-line mr-3 text-green-500"}),"Alokasi Kode Rekening"]),(0,$e.default)("div",{class:"text-right"},[(0,$e.default)("div",{class:"text-sm text-gray-600"},"Total Alokasi"),(0,$e.default)("div",{class:"text-2xl font-bold text-green-600"},this.formatCurrency(e))])]),(0,$e.default)("div",{class:"bg-gray-50 rounded-lg p-6 mb-6 border border-gray-200"},[(0,$e.default)("h5",{class:"text-lg font-medium text-gray-700 mb-4"},"Tambah Alokasi Baru"),(0,$e.default)("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4"},[(0,$e.default)("div",[(0,$e.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Kode Rekening"),(0,$e.default)("div",{class:"space-y-2"},[(0,$e.default)("div",{class:"relative"},[(0,$e.default)("input",{type:"text",class:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Cari kode rekening...",value:this.kodeRekeningSearch,oninput:r=>{this.kodeRekeningSearch=r.target.value,$e.default.redraw()},disabled:this.isModalLoading}),(0,$e.default)("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[(0,$e.default)("i",{class:"ri-search-line text-gray-400"})])]),(0,$e.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",value:this.allocationForm.kodeRekeningId||"",onchange:r=>{let f=r.target.value;this.allocationForm.kodeRekeningId=f,f&&(this.kodeRekeningSearch="")},disabled:this.isModalLoading},[(0,$e.default)("option",{value:""},this.kodeRekeningSearch?`Pilih dari ${this.getFilteredKodeRekening().length} hasil`:"Pilih Kode Rekening"),this.getFilteredKodeRekening().map(r=>(0,$e.default)("option",{value:r._id,key:r._id},`${r.fullCode} - ${r.name}`))])])]),(0,$e.default)("div",[(0,$e.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Jumlah (Rp)"),(0,$e.default)("input",{type:"text",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white text-right text-lg",placeholder:"0",value:this.formatNumberInput(this.allocationForm.amount),oninput:r=>{this.allocationForm.amount=this.parseNumberInput(r.target.value)},disabled:this.isModalLoading})]),(0,$e.default)("div",{class:"flex flex-col justify-between"},[(0,$e.default)("div",[(0,$e.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Keterangan"),(0,$e.default)("input",{type:"text",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Keterangan alokasi",value:this.allocationForm.description,oninput:r=>this.allocationForm.description=r.target.value,disabled:this.isModalLoading})]),(0,$e.default)("button",{class:"mt-4 w-full px-6 py-3 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white rounded-lg font-medium transition-colors",onclick:()=>this.addAllocation(),disabled:this.isModalLoading||!this.allocationForm.kodeRekeningId||!this.allocationForm.amount},[(0,$e.default)("i",{class:"ri-add-line mr-2"}),"Tambah Alokasi"])])])]),this.formData.allocations.length>0&&(0,$e.default)("div",[(0,$e.default)("h5",{class:"text-lg font-medium text-gray-700 mb-4"},`Alokasi yang Ditambahkan (${this.formData.allocations.length})`),(0,$e.default)("div",{class:"bg-white border border-gray-200 rounded-lg overflow-hidden"},[(0,$e.default)("div",{class:"overflow-x-auto"},[(0,$e.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,$e.default)("thead",{class:"bg-gray-50"},[(0,$e.default)("tr",[(0,$e.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Kode Rekening"),(0,$e.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Keterangan"),(0,$e.default)("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Jumlah"),(0,$e.default)("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-20"},"Aksi")])]),(0,$e.default)("tbody",{class:"bg-white divide-y divide-gray-200"},this.formData.allocations.map((r,f)=>this.renderAllocationRow(r,f)))])])])])])]),(0,$e.default)("div",{class:"flex justify-end gap-4 pt-6 border-t border-gray-200 bg-gray-50 px-8 py-6 rounded-b-xl"},[(0,$e.default)("button",{class:"px-8 py-3 bg-white hover:bg-gray-50 border border-gray-300 rounded-lg text-gray-700 font-medium transition-colors",onclick:()=>this.closeModal(),disabled:this.isModalLoading},[(0,$e.default)("i",{class:"ri-close-fill mr-2"}),"Batal"]),(0,$e.default)("button",{class:`px-8 py-3 ${this.isModalLoading?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700"} text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl`,disabled:this.isModalLoading,onclick:()=>this.saveItem()},[this.isModalLoading?(0,$e.default)("i",{class:"ri-loader-4-line animate-spin mr-2"}):(0,$e.default)("i",{class:"ri-save-line mr-2"}),this.isModalLoading?"Menyimpan...":"Simpan Anggaran"])])])])},view:function(){return(0,$e.default)("div",{class:"space-y-6"},[(0,$e.default)("div",{class:"flex justify-between items-center"},[(0,$e.default)("div",[(0,$e.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Manajemen Anggaran"),(0,$e.default)("p",{class:"text-gray-600 mt-1"},"Kelola alokasi anggaran untuk setiap subkegiatan")]),(0,$e.default)("button",{class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl",onclick:()=>this.openCreateModal()},[(0,$e.default)("i",{class:"ri-add-line mr-2"}),"Tambah Anggaran"])]),(0,$e.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,$e.default)("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4"},[(0,$e.default)("div",[(0,$e.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pencarian"),(0,$e.default)("div",{class:"relative"},[(0,$e.default)("input",{type:"text",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Cari subkegiatan atau tahun anggaran...",value:this.searchQuery,oninput:e=>{this.searchQuery=e.target.value,this.applyFilters()}}),(0,$e.default)("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[(0,$e.default)("i",{class:"ri-search-line text-gray-400"})])])]),(0,$e.default)("div",{class:"flex items-end"},[(0,$e.default)("div",{class:"text-sm text-gray-600"},[(0,$e.default)("div",`Menampilkan ${this.filteredAnggaran.length} anggaran`),this.searchQuery&&(0,$e.default)("div",{class:"text-blue-600"},`Pencarian: "${this.searchQuery}"`)])])])]),this.isLoading?(0,$e.default)("div",{class:"flex justify-center items-center h-64"},[(0,$e.default)("div",{class:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):(0,$e.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,$e.default)("div",{class:"overflow-x-auto"},[(0,$e.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,$e.default)("thead",{class:"bg-gray-50"},[(0,$e.default)("tr",[(0,$e.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"SubKegiatan"),(0,$e.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tahun Anggaran"),(0,$e.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total Alokasi"),(0,$e.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Jumlah Akun"),(0,$e.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,$e.default)("tbody",{class:"bg-white divide-y divide-gray-200"},this.getPaginatedAnggaran().map(e=>[(0,$e.default)("tr",{class:"hover:bg-gray-50"},[(0,$e.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,$e.default)("div",{class:"text-sm font-medium text-gray-900"},[e.subKegiatanId?.kode&&(0,$e.default)("span",{class:"font-mono text-xs text-gray-500 mr-2"},e.subKegiatanId.fullCode||e.subKegiatanId.kode||""),e.subKegiatanId?.nama||"SubKegiatan tidak ditemukan"])]),(0,$e.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,$e.default)("span",{class:"text-sm text-gray-900 font-medium"},e.budgetYear)]),(0,$e.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,$e.default)("span",{class:"text-sm font-semibold text-green-600"},this.formatCurrency(e.totalAmount))]),(0,$e.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,$e.default)("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},e.allocations?e.allocations.length:0)]),(0,$e.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},[(0,$e.default)("div",{class:"flex justify-end space-x-2"},[(0,$e.default)("button",{class:"text-blue-600 hover:text-blue-900 p-1 rounded-full hover:bg-blue-50",onclick:async()=>{this.isEditLoading=!0,$e.default.redraw();try{await this.openEditModal(e)}finally{this.isEditLoading=!1,$e.default.redraw()}},disabled:this.isEditLoading,title:"Edit Anggaran dan Alokasi"},[this.isEditLoading?(0,$e.default)("i",{class:"ri-loader-4-line animate-spin text-lg"}):(0,$e.default)("i",{class:"ri-edit-line text-lg"})]),(0,$e.default)("button",{class:"text-red-600 hover:text-red-900 p-1 rounded-full hover:bg-red-50",onclick:()=>this.deleteItem(e),title:"Hapus"},[(0,$e.default)("i",{class:"ri-delete-bin-line text-lg"})])])])])]))])]),this.getTotalPages()>1&&(0,$e.default)("div",{class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},[(0,$e.default)("div",{class:"flex-1 flex justify-between sm:hidden"},[(0,$e.default)("button",{class:`relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${this.currentPage===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage-1),disabled:this.currentPage===1},"Sebelumnya"),(0,$e.default)("button",{class:`ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${this.getTotalPages()===this.currentPage?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage+1),disabled:this.getTotalPages()===this.currentPage},"Selanjutnya")]),(0,$e.default)("div",{class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},[(0,$e.default)("div",[(0,$e.default)("p",{class:"text-sm text-gray-700"},["Menampilkan ",(0,$e.default)("span",{class:"font-medium"},(this.currentPage-1)*this.itemsPerPage+1)," sampai ",(0,$e.default)("span",{class:"font-medium"},Math.min(this.currentPage*this.itemsPerPage,this.filteredAnggaran.length))," dari ",(0,$e.default)("span",{class:"font-medium"},this.filteredAnggaran.length)," anggaran"])]),(0,$e.default)("div",[(0,$e.default)("nav",{class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px"},[(0,$e.default)("button",{class:`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium ${this.currentPage===1?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage-1),disabled:this.currentPage===1},[(0,$e.default)("i",{class:"ri-arrow-left-s-line"})]),Array.from({length:Math.min(5,this.getTotalPages())},(e,r)=>{let f=Math.max(1,Math.min(this.getTotalPages()-4,this.currentPage-2))+r;return(0,$e.default)("button",{class:`relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium ${f===this.currentPage?"z-10 bg-blue-50 border-blue-500 text-blue-600":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(f)},f)}),(0,$e.default)("button",{class:`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium ${this.getTotalPages()===this.currentPage?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage+1),disabled:this.getTotalPages()===this.currentPage},[(0,$e.default)("i",{class:"ri-arrow-right-s-line"})])])])])])]),this.renderForm()])}},mi=Fo;var we=sr(lr(),1);var Lo={isLoading:!1,kinerjaList:[],filteredKinerja:[],selectedSubPerangkatDaerah:null,selectedAnggaran:null,availableAnggaran:[],availableSubKegiatan:[],showModal:!1,modalMode:"create",isModalLoading:!1,formData:{subPerangkatDaerahId:"",anggaranId:"",budgetYear:"",targetValue:"",targetDate:"",description:"",priority:"medium"},searchQuery:"",selectedStatus:"all",selectedPriority:"all",currentPage:1,itemsPerPage:10,formatDate:function(e){return e?new Intl.DateTimeFormat("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(e)):"-"},formatPercentage:function(e){return new Intl.NumberFormat("id-ID",{style:"percent",minimumFractionDigits:1,maximumFractionDigits:1}).format((e||0)/100)},getStatusBadgeClass:function(e){switch(e){case"completed":return"bg-green-100 text-green-800";case"in_progress":return"bg-blue-100 text-blue-800";case"planning":return"bg-gray-100 text-gray-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},getStatusText:function(e){switch(e){case"completed":return"Selesai";case"in_progress":return"Dalam Proses";case"planning":return"Perencanaan";case"cancelled":return"Dibatalkan";default:return e}},getPriorityBadgeClass:function(e){switch(e){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},getPriorityText:function(e){switch(e){case"critical":return"Kritis";case"high":return"Tinggi";case"medium":return"Sedang";case"low":return"Rendah";default:return e}},loadSubPerangkatDaerah:async function(){try{let e=await Ce.getAll("subperangkatdaerah");this.availableSubPerangkatDaerah=e.data||[]}catch(e){console.error("Error loading sub perangkat daerah:",e),this.availableSubPerangkatDaerah=[]}},loadAnggaranForSubPerangkatDaerah:async function(e){if(!e){this.availableAnggaran=[],this.selectedAnggaran=null;return}try{let r=await Ce.getAll("anggaran");this.availableAnggaran=r.data||[],console.log("Loaded anggaran:",this.availableAnggaran.length,"items")}catch(r){console.error("Error loading anggaran:",r),this.availableAnggaran=[]}},loadSubKegiatanForAnggaran:function(e){if(!e){this.selectedSubKegiatan=null;return}let r=(this.availableAnggaran||[]).find(_=>_._id===e);if(!r||!r.subKegiatanId){this.selectedSubKegiatan=null;return}let f=r.subKegiatanId,a=typeof f=="object"?f:{_id:f},i=a.kegiatanId&&(a.kegiatanId._id||a.kegiatanId.$oid||a.kegiatanId)||a.kegiatanId,t=this._urusanDataForKinerja||[],n=this._bidangDataForKinerja||[],c=this._programDataForKinerja||[],x=(this._kegiatanDataForKinerja||[]).find(_=>_._id===i||_._id?.$oid===i||_._id?.toString()===i),w=x&&(x.programId&&(x.programId._id||x.programId.$oid||x.programId)||x.programId),g=c.find(_=>_._id===w||_._id?.$oid===w||_._id?.toString()===w),o=g&&(g.bidangId&&(g.bidangId._id||g.bidangId.$oid||g.bidangId)||g.bidangId),u=n.find(_=>_._id===o||_._id?.$oid===o||_._id?.toString()===o),h=u&&(u.urusanId&&(u.urusanId._id||u.urusanId.$oid||u.urusanId)||u.urusanId),l=t.find(_=>_._id===h||_._id?.$oid===h||_._id?.toString()===h),d=[l?.kode,u?.kode,g?.kode,x?.kode,a.kode].filter(_=>_).join(".");if(!d){console.error("Failed to build fullCode for SubKegiatan from anggaran linkage",{subKeg:a,kegiatan:x,program:g,bidang:u,urusan:l}),this.selectedSubKegiatan=null;return}this.selectedSubKegiatan={...a,fullCode:d,_id:a._id||a.$oid,nama:a.nama},this.formData.subKegiatanId=this.selectedSubKegiatan._id,this.formData.anggaranId=e,we.default.redraw()},loadKinerja:async function(e,r){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),we.default.route.set("/login");return}this.isLoading=!0,we.default.redraw();try{let f={};e&&(f.subPerangkatDaerahId=e),r&&(f.budgetYear=r);let a=new URLSearchParams(f).toString(),i=`/api/kinerja${a?`?${a}`:""}`;console.log("Loading kinerja with URL:",i);let t=await Ce.request(i);this.kinerjaList=t.data||[];let n=[],c=[],b=[],x=[];try{n=(await Ce.getAll("urusan")).data||[]}catch(w){console.warn("Failed to load urusan data:",w)}try{c=(await Ce.getAll("bidang")).data||[]}catch(w){console.warn("Failed to load bidang data:",w)}try{b=(await Ce.getAll("program")).data||[]}catch(w){console.warn("Failed to load program data:",w)}try{x=(await Ce.getAll("kegiatan")).data||[]}catch(w){console.warn("Failed to load kegiatan data:",w)}this.kinerjaList=this.kinerjaList.map(w=>{if(w.subKegiatanId&&w.subKegiatanId.kode){let g=x.find(d=>d._id===(w.subKegiatanId.kegiatanId?.$oid||w.subKegiatanId.kegiatanId)),o=b.find(d=>d._id===(g?.programId?.$oid||g?.programId)),u=c.find(d=>d._id===(o?.bidangId?.$oid||o?.bidangId)),h=n.find(d=>d._id===(u?.urusanId?.$oid||u?.urusanId)),l=[h?.kode,u?.kode,o?.kode,g?.kode,w.subKegiatanId.kode].filter(Boolean).join(".");w.subKegiatanId={...w.subKegiatanId,fullCode:l,urusanKode:h?.kode||"",bidangKode:u?.kode||"",programKode:o?.kode||"",kegiatanKode:g?.kode||""}}return w}),this._urusanDataForKinerja=n,this._bidangDataForKinerja=c,this._programDataForKinerja=b,this._kegiatanDataForKinerja=x,this.applyFilters(),console.log("Loaded kinerja data:",this.kinerjaList.length,"items"),this.kinerjaList.length===0&&e&&r&&be.warning("Tidak ada data kinerja untuk unit dan tahun yang dipilih")}catch(f){console.error("Error loading kinerja:",f),this.kinerjaList=[],this.filteredKinerja=[]}finally{this.isLoading=!1,we.default.redraw()}},applyFilters:function(){let e=[...this.kinerjaList];if(this.searchQuery.trim()){let r=this.searchQuery.toLowerCase();e=e.filter(f=>(f.subKegiatanId?.nama||f.subKegiatanId)?.toLowerCase().includes(r)||(f.subKegiatanId?.fullCode||f.subKegiatanId?.kode||"").toLowerCase().includes(r)||(f.subPerangkatDaerahId?.nama||"").toLowerCase().includes(r)||f.description?.toLowerCase().includes(r))}this.selectedStatus!=="all"&&(e=e.filter(r=>r.status===this.selectedStatus)),this.selectedPriority!=="all"&&(e=e.filter(r=>r.priority===this.selectedPriority)),this.filteredKinerja=e,this.currentPage=1},resetForm:function(){this.formData={subPerangkatDaerahId:this.selectedSubPerangkatDaerah?._id||"",anggaranId:"",budgetYear:this.userData?.budgetYear||"",targetValue:"",targetDate:"",description:"",priority:"medium"}},getAvailableAnggaranOptions:function(){if(!this.selectedSubPerangkatDaerah||!Array.isArray(this.availableAnggaran))return this.availableAnggaran||[];let e=this.selectedSubPerangkatDaerah._id,r=this.userData?.budgetYear,f=new Set((this.kinerjaList||[]).filter(a=>(a.subPerangkatDaerahId===e||a.subPerangkatDaerahId?._id===e)&&(!r||!a.budgetYear||a.budgetYear===r)).map(a=>typeof a.anggaranId=="object"?a.anggaranId?._id:a.anggaranId).filter(Boolean));return this.availableAnggaran.filter(a=>!f.has(a._id))},openCreateModal:function(){if(!this.selectedSubPerangkatDaerah){toast.warning("Pilih unit kerja terlebih dahulu");return}this.modalMode="create",this.resetForm(),this.selectedAnggaran&&this.loadSubKegiatanForAnggaran(this.selectedAnggaran._id),this.showModal=!0},openEditModal:async function(e){this.modalMode="edit",e.anggaranId&&!this.selectedSubKegiatan&&this.loadSubKegiatanForAnggaran(e.anggaranId);let r=function(f){if(!f)return"";let a=new Date(f);return isNaN(a.getTime())?"":a.toISOString().split("T")[0]};this.formData={_id:e._id,subPerangkatDaerahId:e.subPerangkatDaerahId?._id||e.subPerangkatDaerahId,anggaranId:e.anggaranId?._id||e.anggaranId,budgetYear:e.budgetYear,targetValue:e.targetValue,targetDate:r(e.targetDate),description:e.description||"",priority:e.priority||"medium"},this.selectedSubPerangkatDaerah=this.availableSubPerangkatDaerah.find(f=>f._id===e.subPerangkatDaerahId?._id||f._id===e.subPerangkatDaerahId),this.selectedAnggaran=this.availableAnggaran.find(f=>f._id===e.anggaranId?._id||f._id===e.anggaranId),this.showModal=!0},closeModal:function(){this.showModal=!1,this.resetForm()},saveItem:async function(){if(!this.formData.targetValue||!this.formData.targetDate){be.warning("Target nilai dan tanggal target harus diisi");return}let e=new Date(this.formData.targetDate);if(isNaN(e.getTime())){be.warning("Format tanggal target tidak valid");return}if(this.modalMode==="create"){if(!this.formData.subPerangkatDaerahId){be.warning("Pilih unit kerja");return}if(!this.formData.anggaranId){be.warning("Pilih anggaran untuk menentukan SubKegiatan");return}if(!this.formData.subKegiatanId){be.warning("Pilih SubKegiatan");return}}this.isModalLoading=!0,we.default.redraw();try{this.modalMode==="edit"?await Ce.update("kinerja",this.formData._id,{targetValue:this.formData.targetValue,targetDate:e.toISOString(),description:this.formData.description,priority:this.formData.priority}):await Ce.create("kinerja",{subKegiatanId:this.formData.subKegiatanId,subPerangkatDaerahId:this.formData.subPerangkatDaerahId,anggaranId:this.formData.anggaranId,budgetYear:this.formData.budgetYear,targetValue:this.formData.targetValue,targetDate:e.toISOString(),description:this.formData.description,priority:this.formData.priority}),this.closeModal(),this.loadKinerja(this.selectedSubPerangkatDaerah?._id||this.formData.subPerangkatDaerahId,this.userData?.budgetYear)}catch(r){console.error("Error saving kinerja:",r)}finally{this.isModalLoading=!1,we.default.redraw()}},deleteItem:async function(e){try{await Ce.delete("kinerja",e._id,e.subKegiatanId?.nama||"kinerja"),this.loadKinerja(this.selectedSubPerangkatDaerah?._id,this.userData?.budgetYear)}catch(r){console.error("Error deleting kinerja:",r)}},getTotalPages:function(){return Math.ceil(this.filteredKinerja.length/this.itemsPerPage)},getPaginatedKinerja:function(){let e=(this.currentPage-1)*this.itemsPerPage,r=e+this.itemsPerPage;return this.filteredKinerja.slice(e,r)},changePage:function(e){e>=1&&e<=this.getTotalPages()&&(this.currentPage=e,we.default.redraw())},oninit:function(){if(!et.isAuthenticated()){toast.warning("Silakan masuk terlebih dahulu"),we.default.route.set("/login");return}this.vnode&&this.vnode.attrs&&this.vnode.attrs.setTitle&&this.vnode.attrs.setTitle("Manajemen Kinerja"),this.userData=et.getUserData(),this.userData.budgetYear&&typeof this.userData.budgetYear=="object"&&(this.userData.budgetYear=`${this.userData.budgetYear.year}-${this.userData.budgetYear.status}`),this.loadSubPerangkatDaerah()},view:function(){return(0,we.default)("div",{class:"space-y-6"},[(0,we.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,we.default)("div",{class:"flex justify-between items-center mb-6"},[(0,we.default)("div",[(0,we.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Manajemen Kinerja"),(0,we.default)("p",{class:"text-gray-600 mt-1"},"Lihat dan kelola semua target kinerja yang telah ditetapkan untuk unit kerja")]),(0,we.default)("button",{class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl",onclick:()=>this.openCreateModal(),disabled:!this.selectedSubPerangkatDaerah,title:this.selectedSubPerangkatDaerah?"Tambah target kinerja baru":"Pilih unit kerja terlebih dahulu"},[(0,we.default)("i",{class:"ri-add-line mr-2"}),"Tambah Target Kinerja"])]),(0,we.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[(0,we.default)("div",[(0,we.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,we.default)("i",{class:"ri-building-line mr-2 text-blue-500"}),"Unit Kerja"]),this.selectedSubPerangkatDaerah&&(0,we.default)("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4"},[(0,we.default)("div",{class:"flex items-center justify-between"},[(0,we.default)("div",[(0,we.default)("div",{class:"font-semibold text-blue-900 text-lg"},this.selectedSubPerangkatDaerah.nama),(0,we.default)("div",{class:"text-sm text-blue-700 mt-1"},`Pimpinan: ${this.selectedSubPerangkatDaerah.pimpinan}`)]),(0,we.default)("button",{type:"button",class:"text-blue-600 hover:text-blue-800 p-2 rounded-full hover:bg-blue-100",onclick:()=>{this.selectedSubPerangkatDaerah=null,this.selectedAnggaran=null,this.availableAnggaran=[],this.availableSubKegiatan=[]}},[(0,we.default)("i",{class:"ri-close-fill"})])])]),(0,we.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",value:this.selectedSubPerangkatDaerah?._id||"",onchange:e=>{let r=e.target.value;this.selectedSubPerangkatDaerah=(this.availableSubPerangkatDaerah||[]).find(f=>f._id===r)||null,this.loadAnggaranForSubPerangkatDaerah(r),this.selectedAnggaran=null,this.availableSubKegiatan=[],r?this.loadKinerja(r,null):(this.kinerjaList=[],this.filteredKinerja=[],we.default.redraw())}},[(0,we.default)("option",{value:""},"Pilih Unit Kerja"),(this.availableSubPerangkatDaerah||[]).map(e=>(0,we.default)("option",{value:e._id,key:e._id},e.nama))])]),(0,we.default)("div",[(0,we.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,we.default)("i",{class:"ri-wallet-line mr-2 text-green-500"}),"Anggaran"]),(0,we.default)("p",{class:"text-sm text-gray-500"},'Pilih anggaran dan subkegiatan langsung di form setelah klik "Tambah Target Kinerja".')])])]),this.selectedSubPerangkatDaerah&&(0,we.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,we.default)("div",{class:"grid grid-cols-1 md:grid-cols-4 gap-4"},[(0,we.default)("div",[(0,we.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pencarian"),(0,we.default)("div",{class:"relative"},[(0,we.default)("input",{type:"text",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Cari subkegiatan atau deskripsi...",value:this.searchQuery,oninput:e=>{this.searchQuery=e.target.value,this.applyFilters()}}),(0,we.default)("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[(0,we.default)("i",{class:"ri-search-line text-gray-400"})])])]),(0,we.default)("div",[(0,we.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Status"),(0,we.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:this.selectedStatus,onchange:e=>{this.selectedStatus=e.target.value,this.applyFilters()}},[(0,we.default)("option",{value:"all"},"Semua Status"),(0,we.default)("option",{value:"planning"},"Perencanaan"),(0,we.default)("option",{value:"in_progress"},"Dalam Proses"),(0,we.default)("option",{value:"completed"},"Selesai"),(0,we.default)("option",{value:"cancelled"},"Dibatalkan")])]),(0,we.default)("div",[(0,we.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Prioritas"),(0,we.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:this.selectedPriority,onchange:e=>{this.selectedPriority=e.target.value,this.applyFilters()}},[(0,we.default)("option",{value:"all"},"Semua Prioritas"),(0,we.default)("option",{value:"low"},"Rendah"),(0,we.default)("option",{value:"medium"},"Sedang"),(0,we.default)("option",{value:"high"},"Tinggi"),(0,we.default)("option",{value:"critical"},"Kritis")])]),(0,we.default)("div",{class:"flex items-end"},[(0,we.default)("div",{class:"text-sm text-gray-600"},[(0,we.default)("div",`Menampilkan ${this.filteredKinerja.length} dari ${this.kinerjaList.length} kinerja`),this.searchQuery&&(0,we.default)("div",{class:"text-blue-600"},`Pencarian: "${this.searchQuery}"`)])])])]),this.isLoading?(0,we.default)("div",{class:"flex justify-center items-center h-64"},[(0,we.default)("div",{class:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):this.selectedSubPerangkatDaerah?this.filteredKinerja.length===0?(0,we.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,we.default)("div",{class:"text-center py-12"},[(0,we.default)("div",{class:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-gray-100 mb-4"},[(0,we.default)("i",{class:"ri-target-fill text-blue-500"})]),(0,we.default)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Belum ada data kinerja"),(0,we.default)("p",{class:"text-gray-500 mb-6 max-w-sm mx-auto"},"Klik tombol di bawah untuk mulai menambahkan target kinerja. Anda dapat memilih anggaran dan subkegiatan dalam form."),(0,we.default)("button",{class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl",onclick:()=>this.openCreateModal(),disabled:!this.selectedSubPerangkatDaerah,title:this.selectedSubPerangkatDaerah?"Tambah target kinerja pertama":"Pilih unit kerja terlebih dahulu"},[(0,we.default)("i",{class:"ri-add-line mr-2"}),"Tambah Target Kinerja Pertama"])])]):(0,we.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,we.default)("div",{class:"overflow-x-auto"},[(0,we.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,we.default)("thead",{class:"bg-gray-50"},[(0,we.default)("tr",[(0,we.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"SubKegiatan"),(0,we.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Target"),(0,we.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aktual"),(0,we.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Capaian"),(0,we.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),(0,we.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Prioritas"),(0,we.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,we.default)("tbody",{class:"bg-white divide-y divide-gray-200"},(this.getPaginatedKinerja()||[]).map(e=>[(0,we.default)("tr",{class:"hover:bg-gray-50"},[(0,we.default)("td",{class:"px-6 py-4"},[(0,we.default)("div",{class:"text-sm font-medium text-gray-900"},[(e.subKegiatanId?.fullCode||e.subKegiatanId?.kode||e.subKegiatanId)&&(0,we.default)("span",{class:"font-mono text-xs text-gray-500 mr-2"},e.subKegiatanId?.fullCode||e.subKegiatanId?.kode||e.subKegiatanId),e.subKegiatanId?.nama||e.subKegiatanId||"SubKegiatan tidak ditemukan"]),(0,we.default)("div",{class:"text-sm text-gray-500 mt-1"},[(0,we.default)("span",{class:"font-medium"},e.subKegiatanId?.kinerja||"Kinerja"),(0,we.default)("span",{class:"mx-2"},"\u2022"),(0,we.default)("span",e.subKegiatanId?.satuan||"Satuan")])]),(0,we.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,we.default)("div",{class:"text-sm text-gray-900"},[(0,we.default)("span",{class:"font-semibold"},e.targetValue?.toLocaleString("id-ID")),(0,we.default)("div",{class:"text-xs text-gray-500 mt-1"},this.formatDate(e.targetDate))])]),(0,we.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,we.default)("span",{class:"text-sm font-semibold text-blue-600"},e.actualValue?.toLocaleString("id-ID"))]),(0,we.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,we.default)("div",{class:"text-sm text-center"},[(0,we.default)("div",{class:"font-bold text-lg"},[(0,we.default)("span",{class:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${e.achievementPercentage>=100?"bg-green-100 text-green-800":e.achievementPercentage>=75?"bg-blue-100 text-blue-800":e.achievementPercentage>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`},this.formatPercentage(e.achievementPercentage))]),(0,we.default)("div",{class:"text-xs text-gray-500 mt-1"},`${e.achievementPercentage?.toFixed(1)}%`)])]),(0,we.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,we.default)("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${this.getStatusBadgeClass(e.status)}`},this.getStatusText(e.status))]),(0,we.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,we.default)("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${this.getPriorityBadgeClass(e.priority)}`},this.getPriorityText(e.priority))]),(0,we.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},[(0,we.default)("div",{class:"flex justify-end space-x-2"},[(0,we.default)("button",{class:"text-blue-600 hover:text-blue-900 p-1 rounded-full hover:bg-blue-50",onclick:()=>this.openEditModal(e),title:"Edit"},[(0,we.default)("i",{class:"ri-edit-line text-lg"})]),(0,we.default)("button",{class:"text-red-600 hover:text-red-900 p-1 rounded-full hover:bg-red-50",onclick:()=>this.deleteItem(e),title:"Hapus"},[(0,we.default)("i",{class:"ri-delete-bin-line text-lg"})])])])])]))])]),this.getTotalPages()>1&&(0,we.default)("div",{class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},[(0,we.default)("div",{class:"flex-1 flex justify-between sm:hidden"},[(0,we.default)("button",{class:`relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${this.currentPage===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage-1),disabled:this.currentPage===1},"Sebelumnya"),(0,we.default)("button",{class:`ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${this.currentPage===this.getTotalPages()?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage+1),disabled:this.currentPage===this.getTotalPages()},"Selanjutnya")]),(0,we.default)("div",{class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},[(0,we.default)("div",[(0,we.default)("p",{class:"text-sm text-gray-700"},["Menampilkan ",(0,we.default)("span",{class:"font-medium"},(this.currentPage-1)*this.itemsPerPage+1)," sampai ",(0,we.default)("span",{class:"font-medium"},Math.min(this.currentPage*this.itemsPerPage,this.filteredKinerja.length))," dari ",(0,we.default)("span",{class:"font-medium"},this.filteredKinerja.length)," hasil"])]),(0,we.default)("div",[(0,we.default)("nav",{class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px"},[(0,we.default)("button",{class:`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium ${this.currentPage===1?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage-1),disabled:this.currentPage===1},[(0,we.default)("i",{class:"ri-arrow-left-s-line"})]),Array.from({length:Math.min(5,this.getTotalPages()||0)},(e,r)=>{let f=Math.max(1,Math.min(this.getTotalPages()-4,this.currentPage-2))+r;return(0,we.default)("button",{class:`relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium ${f===this.currentPage?"z-10 bg-blue-50 border-blue-500 text-blue-600":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(f)},f)}),(0,we.default)("button",{class:`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium ${this.currentPage===this.getTotalPages()?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage+1),disabled:this.currentPage===this.getTotalPages()},[(0,we.default)("i",{class:"ri-arrow-right-s-line"})])])])])])]):(0,we.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,we.default)("div",{class:"text-center py-12"},[(0,we.default)("div",{class:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4"},[(0,we.default)("i",{class:"ri-information-line text-blue-400 text-2xl"})]),(0,we.default)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Pilih Unit Kerja"),(0,we.default)("p",{class:"text-gray-500 max-w-md mx-auto"},'Pilih unit kerja untuk melihat semua target kinerja yang telah ditetapkan. Klik "Tambah Target Kinerja" untuk memulai, kemudian pilih anggaran dan subkegiatan dalam form.')])]),this.showModal&&(0,we.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onclick:e=>e.target===e.currentTarget&&this.closeModal()},[(0,we.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 transform transition-all max-h-[95vh] overflow-y-auto",onclick:e=>e.stopPropagation()},[(0,we.default)("div",{class:`bg-gradient-to-r ${this.modalMode==="create"?"from-blue-500 to-purple-600":"from-green-500 to-blue-600"} text-white p-6 rounded-t-xl`},[(0,we.default)("div",{class:"flex items-center justify-between"},[(0,we.default)("div",{class:"flex items-center space-x-3"},[(0,we.default)("div",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center"},[(0,we.default)("i",{class:`ri-${this.modalMode==="create"?"add":"edit"}-line text-xl text-white`})]),(0,we.default)("div",[(0,we.default)("h3",{class:"text-xl font-bold"},[`${this.modalMode==="create"?"Tambah":"Edit"} Target Kinerja`]),(0,we.default)("p",{class:"text-white text-opacity-80 text-sm"},[this.modalMode==="create"?"Tentukan target kinerja untuk subkegiatan":"Perbarui target dan informasi kinerja"])])]),(0,we.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeModal()},[(0,we.default)("i",{class:"ri-close-fill"})])])]),this.selectedSubKegiatan&&(0,we.default)("div",{class:"px-8 pb-6"},[(0,we.default)("div",{class:"bg-gradient-to-br from-indigo-50 via-purple-50 to-blue-50 rounded-xl p-6 border border-indigo-100 shadow-sm"},[(0,we.default)("div",{class:"flex items-center justify-between mb-6"},[(0,we.default)("h4",{class:"text-lg font-bold text-gray-800 flex items-center"},[(0,we.default)("div",{class:"w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mr-3"},[(0,we.default)("i",{class:"ri-information-line text-indigo-600 text-sm"})]),"Informasi SubKegiatan"]),(0,we.default)("div",{class:"w-6 h-6 bg-indigo-100 rounded-full flex items-center justify-center"},[(0,we.default)("i",{class:"ri-node-tree text-indigo-600 text-xs"})])]),(0,we.default)("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},[(0,we.default)("div",{class:"bg-white rounded-lg border border-indigo-100 shadow-sm overflow-hidden"},[(0,we.default)("div",{class:"bg-indigo-50 px-4 py-2 border-b border-indigo-100"},[(0,we.default)("div",{class:"text-xs font-bold text-indigo-600 uppercase tracking-wider text-center"},"Kode")]),(0,we.default)("div",{class:"p-4 text-center"},[(0,we.default)("div",{class:"text-2xl font-mono font-bold text-indigo-600 break-all"},this.selectedSubKegiatan?.fullCode||"")])]),(0,we.default)("div",{class:"bg-white rounded-lg border border-purple-100 shadow-sm overflow-hidden"},[(0,we.default)("div",{class:"bg-purple-50 px-4 py-2 border-b border-purple-100"},[(0,we.default)("div",{class:"text-xs font-bold text-purple-600 uppercase tracking-wider text-center"},"Nama SubKegiatan")]),(0,we.default)("div",{class:"p-4 text-center"},[(0,we.default)("div",{class:"text-sm font-semibold text-gray-900 leading-tight"},this.selectedSubKegiatan.nama||"Rehabilitasi Sumur Air Tanah untuk Air Baku")])]),(0,we.default)("div",{class:"bg-white rounded-lg border border-blue-100 shadow-sm overflow-hidden"},[(0,we.default)("div",{class:"bg-blue-50 px-4 py-2 border-b border-blue-100"},[(0,we.default)("div",{class:"text-xs font-bold text-blue-600 uppercase tracking-wider text-center"},"Kinerja")]),(0,we.default)("div",{class:"p-4 text-center"},[(0,we.default)("div",{class:"text-sm font-semibold text-blue-600 leading-tight"},this.selectedSubKegiatan.kinerja||"Terehabilitasinya Sumur Air Tanah untuk Air Baku")])])]),(0,we.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,we.default)("div",{class:"bg-white rounded-lg border border-emerald-100 shadow-sm overflow-hidden"},[(0,we.default)("div",{class:"bg-emerald-50 px-4 py-2 border-b border-emerald-100"},[(0,we.default)("div",{class:"text-xs font-bold text-emerald-600 uppercase tracking-wider text-center"},"Indikator")]),(0,we.default)("div",{class:"p-4"},[(0,we.default)("div",{class:"text-sm font-medium text-gray-900 leading-relaxed"},this.selectedSubKegiatan.indikator||"Jumlah Sumur Air Tanah untuk Air Baku yang Direhabilitasi")])]),(0,we.default)("div",{class:"bg-white rounded-lg border border-violet-100 shadow-sm overflow-hidden"},[(0,we.default)("div",{class:"bg-violet-50 px-4 py-2 border-b border-violet-100"},[(0,we.default)("div",{class:"text-xs font-bold text-violet-600 uppercase tracking-wider text-center"},"Satuan")]),(0,we.default)("div",{class:"p-4 text-center"},[(0,we.default)("div",{class:"text-lg font-semibold text-violet-600"},this.selectedSubKegiatan.satuan||"Titik")])])])])]),(0,we.default)("div",{class:"p-8"},[(0,we.default)("div",{class:"mb-8"},[(0,we.default)("h4",{class:"text-xl font-semibold text-gray-800 mb-6 flex items-center"},[(0,we.default)("i",{class:"ri-organization-chart mr-3 text-blue-500"}),"Pemilihan Unit dan Anggaran"]),(0,we.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[(0,we.default)("div",[(0,we.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,we.default)("i",{class:"ri-building-line mr-2 text-blue-500"}),"Unit Kerja"]),this.modalMode==="edit"?[(0,we.default)("div",{class:"w-full px-4 py-3 border border-gray-200 rounded-lg bg-gray-50 text-gray-700"},this.selectedSubPerangkatDaerah?this.selectedSubPerangkatDaerah.nama:"Unit kerja tidak ditemukan")]:[(0,we.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100 text-gray-700 cursor-not-allowed",value:this.selectedSubPerangkatDaerah?._id||this.formData.subPerangkatDaerahId||"",disabled:!0},[(0,we.default)("option",{value:this.selectedSubPerangkatDaerah?._id||this.formData.subPerangkatDaerahId||""},this.selectedSubPerangkatDaerah?.nama||"Unit Kerja belum dipilih"),(this.availableSubPerangkatDaerah||[]).map(e=>(0,we.default)("option",{value:e._id,key:e._id},e.nama))])]]),(0,we.default)("div",[(0,we.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,we.default)("i",{class:"ri-wallet-line mr-2 text-green-500"}),"Anggaran"]),this.modalMode==="edit"?[(0,we.default)("div",{class:"w-full px-4 py-3 border border-gray-200 rounded-lg bg-gray-50 text-gray-700"},this.selectedAnggaran?`${this.selectedAnggaran.budgetYear} - ${this.selectedSubKegiatan?.nama||"SubKegiatan tidak ditemukan"}`:"Anggaran tidak ditemukan")]:[(0,we.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white",value:this.formData.anggaranId,onchange:e=>{this.formData.anggaranId=e.target.value,this.selectedAnggaran=(this.availableAnggaran||[]).find(r=>r._id===e.target.value)||null,this.loadSubKegiatanForAnggaran(e.target.value)},disabled:this.isModalLoading||!this.formData.subPerangkatDaerahId},[(0,we.default)("option",{value:""},"Pilih Anggaran yang belum memiliki target"),this.getAvailableAnggaranOptions().map(e=>(0,we.default)("option",{value:e._id,key:e._id},`${e.budgetYear} - ${e.subKegiatanId?.nama}`))])]])])]),this.availableSubKegiatan.length>0&&(0,we.default)("div",{class:"mb-8"},[(0,we.default)("h4",{class:"text-xl font-semibold text-gray-800 mb-6 flex items-center"},[(0,we.default)("i",{class:"ri-node-tree mr-3 text-purple-500"}),"Pemilihan SubKegiatan"]),(0,we.default)("div",{class:"bg-gray-50 rounded-lg p-6 border border-gray-200"},[(0,we.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},[(this.availableSubKegiatan||[]).map(e=>(0,we.default)("div",{class:`border-2 rounded-lg p-4 cursor-pointer transition-all ${this.formData.subKegiatanId===e._id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"}`,onclick:()=>{this.formData.subKegiatanId=e._id},key:e._id},[(0,we.default)("div",{class:"font-mono text-sm font-bold text-gray-800 mb-1"},this.selectedSubKegiatan?.kode||"Kode"),(0,we.default)("div",{class:"font-medium text-gray-900 mb-2"},this.selectedSubKegiatan?.nama||"Nama SubKegiatan"),(0,we.default)("div",{class:"space-y-1 text-sm"},[(0,we.default)("div",{class:"flex justify-between"},[(0,we.default)("span",{class:"text-gray-600"},"Kinerja:"),(0,we.default)("span",{class:"font-medium text-blue-600"},this.selectedSubKegiatan?.kinerja||"Kinerja")]),(0,we.default)("div",{class:"flex justify-between"},[(0,we.default)("span",{class:"text-gray-600"},"Indikator:"),(0,we.default)("span",{class:"font-medium text-green-600"},this.selectedSubKegiatan?.indikator||"Indikator")]),(0,we.default)("div",{class:"flex justify-between"},[(0,we.default)("span",{class:"text-gray-600"},"Satuan:"),(0,we.default)("span",{class:"font-medium text-purple-600"},this.selectedSubKegiatan?.satuan||"Satuan")])])]))])])]),(this.selectedSubKegiatan||this.modalMode==="edit")&&(0,we.default)("div",{class:"mb-8"},[(0,we.default)("h4",{class:"text-xl font-semibold text-gray-800 mb-6 flex items-center"},[(0,we.default)("i",{class:"ri-target-line mr-3 text-orange-500"}),"Informasi Target"]),(0,we.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},[(0,we.default)("div",[(0,we.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,we.default)("i",{class:"ri-number-1 mr-2 text-blue-500"}),"Nilai Target"]),(0,we.default)("input",{type:"number",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Masukkan nilai target",value:this.formData.targetValue,oninput:e=>{this.formData.targetValue=e.target.value},min:"0",step:"0.01",disabled:this.isModalLoading})]),(0,we.default)("div",[(0,we.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,we.default)("i",{class:"ri-calendar-line mr-2 text-green-500"}),"Tanggal Target"]),(0,we.default)("input",{type:"date",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white",value:this.formData.targetDate,oninput:e=>{this.formData.targetDate=e.target.value},disabled:this.isModalLoading})]),(0,we.default)("div",[(0,we.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,we.default)("i",{class:"ri-flag-line mr-2 text-red-500"}),"Prioritas"]),(0,we.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 bg-white",value:this.formData.priority,onchange:e=>this.formData.priority=e.target.value,disabled:this.isModalLoading},[(0,we.default)("option",{value:"low"},"Rendah"),(0,we.default)("option",{value:"medium"},"Sedang"),(0,we.default)("option",{value:"high"},"Tinggi"),(0,we.default)("option",{value:"critical"},"Kritis")])])]),(0,we.default)("div",{class:"mt-6"},[(0,we.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,we.default)("i",{class:"ri-file-text-line mr-2 text-gray-500"}),"Deskripsi"]),(0,we.default)("textarea",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white resize-vertical",placeholder:"Deskripsi tambahan untuk target kinerja ini",value:this.formData.description,oninput:e=>this.formData.description=e.target.value,rows:3,disabled:this.isModalLoading})])])]),(0,we.default)("div",{class:"flex justify-end gap-4 pt-6 border-t border-gray-200 bg-gray-50 px-8 py-6 rounded-b-xl"},[(0,we.default)("button",{class:"px-8 py-3 bg-white hover:bg-gray-50 border border-gray-300 rounded-lg text-gray-700 font-medium transition-colors",onclick:()=>this.closeModal(),disabled:this.isModalLoading},[(0,we.default)("i",{class:"ri-close-fill mr-2"}),"Batal"]),(0,we.default)("button",{class:`px-8 py-3 ${this.isModalLoading?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700"} text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl`,disabled:this.isModalLoading,onclick:()=>this.saveItem()},[this.isModalLoading?(0,we.default)("i",{class:"ri-loader-4-line animate-spin mr-2"}):(0,we.default)("i",{class:"ri-save-line mr-2"}),this.isModalLoading?"Menyimpan...":"Simpan Kinerja"])])])])])}},bi=Lo;var He=sr(lr(),1);var Ro={isLoading:!1,loadingRealisasi:!1,loadingKinerja:!1,subPerangkatDaerahList:[],kinerjaList:[],anggaranList:[],subKegiatanList:[],kodeRekeningList:[],realisasiList:[],selectedSubPerangkatDaerahId:"",selectedSubKegiatanId:"",selectedBudgetYear:"",currentSubKegiatanId:"",showModal:!1,modalMode:"create",isModalLoading:!1,realisasiForm:{kodeRekeningId:"",budgetAmount:0,realizationAmount:"",description:"",month:new Date().getMonth()+1,year:new Date().getFullYear()},searchQuery:"",selectedMonth:new Date().getMonth()+1,selectedYear:new Date().getFullYear(),formatCurrency:function(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e||0)},parseCurrencyInput:function(e){if(!e)return 0;let r=e.toString().replace(/Rp\s?/g,"").replace(/[.,]/g,"").replace(/\s+/g,"");return parseInt(r)||0},formatNumberInput:function(e){return e?new Intl.NumberFormat("id-ID").format(e):""},parseNumberInput:function(e){if(!e)return 0;let r=e.toString().replace(/[.,]/g,"");return parseInt(r)||0},oninit:function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),He.default.route.set("/login");return}this.vnode&&this.vnode.attrs&&this.vnode.attrs.setTitle&&this.vnode.attrs.setTitle("Realisasi Anggaran"),this.userData=et.getUserData(),this.userData.budgetYear&&typeof this.userData.budgetYear=="object"&&(this.userData.budgetYear=`${this.userData.budgetYear.year}-${this.userData.budgetYear.status}`),this.selectedBudgetYear=this.userData.budgetYear||"",this.loadInitialData()},onbeforeupdate:function(){},oncreate:function(){console.log("Realisasi component created and ready")},loadInitialData:async function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),He.default.route.set("/login");return}this.isLoading=!0,He.default.redraw();try{if(!Ft.getToken())throw new Error("No authentication token found");let r=await Ce.getAll("subperangkatdaerah");this.subPerangkatDaerahList=r.data||[],be.success("Data berhasil dimuat")}catch(e){console.error("Error loading initial data:",e),e.message&&e.message.includes("401")?(be.warning("Sesi login telah berakhir. Silakan masuk kembali."),setTimeout(()=>He.default.route.set("/login"),2e3)):be.error("Gagal memuat data: "+(e.message||"Kesalahan tidak diketahui")),this.subPerangkatDaerahList=[],this.kodeRekeningList=[]}finally{this.isLoading=!1,He.default.redraw()}},loadKinerjaData:async function(){if(!this.selectedSubPerangkatDaerahId){this.kinerjaList=[],this.anggaranList=[],this.subKegiatanList=[],this.kodeRekeningList=[];return}this.loadingKinerja=!0,He.default.redraw();try{let e=Ft.getToken();if(!e)throw new Error("No authentication token found");let r=await fetch(`/api/kinerja?subPerangkatDaerahId=${this.selectedSubPerangkatDaerahId}&budgetYear=${encodeURIComponent(this.selectedBudgetYear)}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(r.ok){let f=await r.json();this.kinerjaList=f.data||[],console.log("Received kinerja data:",this.kinerjaList),this.kinerjaList.length>0&&console.log("First kinerja item structure:",{anggaranId:this.kinerjaList[0].anggaranId,anggaranIdType:typeof this.kinerjaList[0].anggaranId,subKegiatanId:this.kinerjaList[0].subKegiatanId,subKegiatanIdType:typeof this.kinerjaList[0].subKegiatanId});let a=new Map,i=new Map;this.kinerjaList.forEach(t=>{t.anggaranId&&(console.log("Processing populated anggaran:",t.anggaranId),a.set(t.anggaranId._id.toString(),t.anggaranId)),t.subKegiatanId&&(console.log("Processing populated subkegiatan:",t.subKegiatanId),i.set(t.subKegiatanId._id.toString(),t.subKegiatanId))}),this.anggaranList=Array.from(a.values()),this.subKegiatanList=Array.from(i.values()),console.log("Processed data:",{anggaranCount:this.anggaranList.length,subKegiatanCount:this.subKegiatanList.length}),this.anggaranList.length>0?(be.success(`Data berhasil dimuat: ${this.anggaranList.length} anggaran, ${this.subKegiatanList.length} subkegiatan`),this.selectedSubKegiatanId&&(console.log("Loading realisasi data for selected subkegiatan:",this.selectedSubKegiatanId),this.loadRealisasiData())):be.warning("Tidak ada data anggaran ditemukan untuk unit kerja ini")}else be.warning("Tidak ada data kinerja ditemukan untuk unit kerja ini")}catch(e){console.error("Error loading kinerja data:",e),e.message&&e.message.includes("401")?(be.warning("Sesi login telah berakhir. Silakan masuk kembali."),setTimeout(()=>He.default.route.set("/login"),2e3)):be.error("Gagal memuat data kinerja"),this.kinerjaList=[],this.anggaranList=[],this.subKegiatanList=[]}finally{this.loadingKinerja=!1,He.default.redraw()}},loadRealisasiData:async function(){if(!this.selectedSubKegiatanId){this.realisasiList=[];return}this.loadingRealisasi=!0,He.default.redraw();try{let e=Ft.getToken();if(!e)throw new Error("No authentication token found");console.log("Loading realisasi with params:",{subKegiatanId:this.selectedSubKegiatanId,month:this.selectedMonth,year:this.selectedYear});let r=await fetch(`/api/realisasi?subKegiatanId=${this.selectedSubKegiatanId}&month=${this.selectedMonth}&year=${this.selectedYear}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(r.ok){let f=await r.json();this.realisasiList=f.data||[],console.log("=== REALISASI DEBUG INFO ==="),console.log("Loaded realisasi data:",this.realisasiList),console.log("Realisasi count:",this.realisasiList.length),this.realisasiList.length>0&&(this.realisasiList.forEach((a,i)=>{console.log(`Realisasi ${i+1}:`,{kodeRekeningId:a.kodeRekeningId,realizationAmount:a.realizationAmount,month:a.month,year:a.year,subKegiatanId:a.subKegiatanId})}),await this.loadKodeRekeningForSubKegiatan(this.selectedSubKegiatanId)),He.default.redraw(),console.log("Selected subkegiatan ID:",this.selectedSubKegiatanId),console.log("Selected period:",`${this.selectedMonth}/${this.selectedYear}`),console.log("========================")}else throw console.error("Failed to load realisasi data, status:",r.status),new Error(`HTTP ${r.status}: ${r.statusText}`)}catch(e){console.error("Error loading realisasi data:",e),be.error("Gagal memuat data realisasi"),this.realisasiList=[]}finally{this.loadingRealisasi=!1,He.default.redraw()}},loadKodeRekeningForSubKegiatan:async function(e){if(!e||this.currentSubKegiatanId===e)return[];let r=this.anggaranList.find(a=>a.subKegiatanId===e);if(!r||!r.allocations)return[];let f=r.allocations.map(a=>a.kodeRekeningId);console.log("Loading kode rekening data for subkegiatan:",e),console.log("Kode rekening IDs from allocations:",f);try{let a=Ft.getToken();if(!a)throw new Error("No authentication token found");let i=await fetch(`/api/koderekening?ids=${f.join(",")}`,{method:"GET",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(i.ok){let t=await i.json();this.kodeRekeningList=t.data||[],this.currentSubKegiatanId=e,console.log(`Loaded ${this.kodeRekeningList.length} kode rekening records`),He.default.redraw()}else console.error("Failed to load kode rekening data, status:",i.status),this.kodeRekeningList=[]}catch(a){console.error("Error loading kode rekening:",a),this.kodeRekeningList=[]}return this.kodeRekeningList},getAvailableKodeRekening:function(){if(!this.selectedSubKegiatanId)return[];let e=this.anggaranList.find(a=>a.subKegiatanId===this.selectedSubKegiatanId);if(!e||!e.allocations)return[];let r=e.allocations.map(a=>a.kodeRekeningId);return this.kodeRekeningList.filter(a=>r.includes(a._id))},getBudgetAmount:function(e){if(!this.selectedSubKegiatanId)return 0;let r=this.anggaranList.find(a=>a.subKegiatanId===this.selectedSubKegiatanId);if(!r||!r.allocations)return 0;let f=r.allocations.find(a=>a.kodeRekeningId===e);return f?f.amount:0},getRealizationAmount:function(e){let r=this.realisasiList.find(f=>{let a=f.kodeRekeningId;return typeof a=="object"&&a!==null&&a._id?a=a._id:typeof a=="object"&&a!==null&&a.$oid?a=a.$oid:typeof a=="object"&&a!==null&&(a=a.toString()),a===e});return r?r.realizationAmount:0},resetForm:function(){this.realisasiForm={kodeRekeningId:"",budgetAmount:0,realizationAmount:"",description:"",month:this.selectedMonth||new Date().getMonth()+1,year:this.selectedYear||new Date().getFullYear()}},openCreateModal:function(e){this.modalMode="create",this.realisasiForm={kodeRekeningId:e._id,budgetAmount:this.getBudgetAmount(e._id),realizationAmount:this.getRealizationAmount(e._id)||"",description:"",month:this.selectedMonth||new Date().getMonth()+1,year:this.selectedYear||new Date().getFullYear()},this.showModal=!0},openEditModal:function(e){this.modalMode="edit",this.realisasiForm={_id:e._id,kodeRekeningId:e.kodeRekeningId,budgetAmount:e.budgetAmount||0,realizationAmount:e.realizationAmount||0,description:e.description||"",month:e.month,year:e.year},this.showModal=!0},openViewModal:function(e){this.modalMode="view",this.realisasiForm={_id:e._id,kodeRekeningId:e.kodeRekeningId,budgetAmount:e.budgetAmount||0,realizationAmount:e.realizationAmount||0,description:e.description||"",month:e.month,year:e.year},this.showModal=!0},closeModal:function(){this.showModal=!1,this.resetForm()},saveRealisasi:async function(){if(!this.realisasiForm.kodeRekeningId||!this.realisasiForm.realizationAmount){be.warning("Kode rekening dan jumlah realisasi harus diisi");return}this.isModalLoading=!0,He.default.redraw();try{let e=Ft.getToken();if(!e)throw new Error("No authentication token found");let r=this.modalMode==="edit"?"PUT":"POST",f=this.modalMode==="edit"?`/api/realisasi/${this.realisasiForm._id}`:"/api/realisasi",a={kodeRekeningId:this.realisasiForm.kodeRekeningId,budgetAmount:this.realisasiForm.budgetAmount,realizationAmount:this.parseNumberInput(this.realisasiForm.realizationAmount),description:this.realisasiForm.description,subKegiatanId:this.selectedSubKegiatanId,month:this.realisasiForm.month,year:this.realisasiForm.year},i=await fetch(f,{method:r,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok){let n=await i.json();throw new Error(n.message||`HTTP error! status: ${i.status}`)}let t=await i.json();be.success(`Realisasi berhasil di${this.modalMode==="edit"?"perbarui":"simpan"}`),this.closeModal(),this.loadRealisasiData()}catch(e){console.error("Error saving realisasi:",e),be.error(`Gagal ${this.modalMode==="edit"?"memperbarui":"menyimpan"} realisasi: `+(e.message||"Kesalahan tidak diketahui"))}finally{this.isModalLoading=!1,He.default.redraw()}},deleteRealisasi:async function(e){showConfirmation("Apakah Anda yakin ingin menghapus realisasi untuk kode rekening ini?",async()=>{try{let r=Ft.getToken();if(!r)throw new Error("No authentication token found");let f=await fetch(`/api/realisasi/${e._id}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(!f.ok){let a=await f.json();throw new Error(a.message||`HTTP error! status: ${f.status}`)}be.success("Realisasi berhasil dihapus"),this.loadRealisasiData()}catch(r){console.error("Error deleting realisasi:",r),be.error("Gagal menghapus realisasi: "+(r.message||"Kesalahan tidak diketahui"))}},()=>{be.info("Penghapusan dibatalkan")})},getMonthName:function(e){return["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][e-1]||"Tidak Valid"},view:function(){return(0,He.default)("div",{class:"space-y-6"},[(0,He.default)("div",{class:"flex justify-between items-center"},[(0,He.default)("div",[(0,He.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Realisasi Anggaran"),(0,He.default)("p",{class:"text-gray-600 mt-1"},"Kelola realisasi anggaran berdasarkan unit kerja dan subkegiatan")])]),(0,He.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,He.default)("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Pilih Unit Kerja dan Subkegiatan"),(0,He.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},[(0,He.default)("div",[(0,He.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,He.default)("i",{class:"ri-building-line mr-2 text-blue-500"}),"Unit Kerja"]),(0,He.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",value:this.selectedSubPerangkatDaerahId,onchange:e=>{this.selectedSubPerangkatDaerahId=e.target.value,this.selectedSubKegiatanId="",this.loadKinerjaData()},disabled:this.isLoading},[(0,He.default)("option",{value:""},this.isLoading?"Memuat...":"Pilih Unit Kerja"),this.subPerangkatDaerahList.map(e=>(0,He.default)("option",{value:e._id,key:e._id},`${e.nama} (${e.pimpinan})`))])]),(0,He.default)("div",[(0,He.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,He.default)("i",{class:"ri-node-tree mr-2 text-green-500"}),"Subkegiatan"]),(0,He.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white",value:this.selectedSubKegiatanId,onchange:e=>{this.selectedSubKegiatanId=e.target.value,this.loadRealisasiData()},disabled:this.isLoading||!this.selectedSubPerangkatDaerahId||this.loadingKinerja},[(0,He.default)("option",{value:""},this.loadingKinerja?"Memuat...":"Pilih Subkegiatan"),this.subKegiatanList.map(e=>(0,He.default)("option",{value:e._id,key:e._id},`${e.kode} - ${e.nama}`))])]),(0,He.default)("div",[(0,He.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,He.default)("i",{class:"ri-calendar-line mr-2 text-purple-500"}),"Periode"]),(0,He.default)("div",{class:"flex space-x-2"},[(0,He.default)("select",{class:"flex-1 px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white",value:this.selectedMonth,onchange:e=>{this.selectedMonth=parseInt(e.target.value),this.selectedSubKegiatanId&&this.loadRealisasiData(),He.default.redraw()}},[Array.from({length:12},(e,r)=>r+1).map(e=>(0,He.default)("option",{value:e,key:e},this.getMonthName(e)))]),(0,He.default)("select",{class:"flex-1 px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white",value:this.selectedYear,onchange:e=>{this.selectedYear=parseInt(e.target.value),this.selectedSubKegiatanId&&this.loadRealisasiData(),He.default.redraw()}},[Array.from({length:5},(e,r)=>new Date().getFullYear()+r).map(e=>(0,He.default)("option",{value:e,key:e},e))])])])])]),this.selectedSubKegiatanId&&(0,He.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,He.default)("div",{class:"px-6 py-4 border-b border-gray-200"},[(0,He.default)("h3",{class:"text-lg font-semibold text-gray-800"},"Tabel Realisasi"),(0,He.default)("p",{class:"text-sm text-gray-600 mt-1"},["Periode: ",(0,He.default)("span",{class:"font-medium"},`${this.getMonthName(this.selectedMonth)} ${this.selectedYear}`)])]),this.isLoading?(0,He.default)("div",{class:"flex justify-center items-center h-32"},[(0,He.default)("div",{class:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):this.loadingRealisasi&&this.selectedSubKegiatanId?(0,He.default)("div",{class:"flex justify-center items-center h-32"},[(0,He.default)("div",{class:"flex items-center space-x-3"},[(0,He.default)("div",{class:"w-6 h-6 border-4 border-green-500 border-t-transparent rounded-full animate-spin"}),(0,He.default)("span",{class:"text-gray-600"},"Memuat data realisasi...")])]):(0,He.default)("div",{class:"overflow-x-auto"},[(0,He.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,He.default)("thead",{class:"bg-gray-50"},[(0,He.default)("tr",[(0,He.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Kode Rekening"),(0,He.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nama Rekening"),(0,He.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Anggaran"),(0,He.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Realisasi"),(0,He.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Sisa"),(0,He.default)("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,He.default)("tbody",{class:"bg-white divide-y divide-gray-200"},this.getAvailableKodeRekening().map(e=>{let r=this.getBudgetAmount(e._id),f=this.getRealizationAmount(e._id),a=r-f;return(0,He.default)("tr",{class:"hover:bg-gray-50"},[(0,He.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,He.default)("span",{class:"font-mono text-sm font-medium text-gray-900"},e.fullCode)]),(0,He.default)("td",{class:"px-6 py-4"},[(0,He.default)("span",{class:"text-sm text-gray-900"},e.name)]),(0,He.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right"},[(0,He.default)("span",{class:"text-sm font-semibold text-green-600"},this.formatCurrency(r))]),(0,He.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right"},[(0,He.default)("span",{class:"text-sm font-semibold text-blue-600"},this.formatCurrency(f))]),(0,He.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right"},[(0,He.default)("span",{class:`text-sm font-semibold ${a<0?"text-red-600":"text-gray-600"}`},this.formatCurrency(a))]),(0,He.default)("td",{class:"px-6 py-4 whitespace-nowrap text-center"},[(0,He.default)("div",{class:"flex justify-center space-x-2"},[f===0?(0,He.default)("button",{class:"text-blue-600 hover:text-blue-900 p-1 rounded-full hover:bg-blue-50",onclick:()=>this.openCreateModal(e),title:"Input Realisasi"},[(0,He.default)("i",{class:"ri-add-line text-sm"})]):(0,He.default)("button",{class:"text-purple-600 hover:text-purple-900 p-1 rounded-full hover:bg-purple-50",onclick:()=>{let i=this.realisasiList.find(t=>{let n=t.kodeRekeningId;return typeof n=="object"&&n!==null&&n._id&&(n=n._id),n===e._id});i&&this.openViewModal(i)},title:"Lihat Detail Realisasi"},[(0,He.default)("i",{class:"ri-eye-line text-sm"})]),f>0&&(0,He.default)("button",{class:"text-green-600 hover:text-green-900 p-1 rounded-full hover:bg-green-50",onclick:()=>{let i=this.realisasiList.find(t=>{let n=t.kodeRekeningId;return typeof n=="object"&&n!==null&&n._id&&(n=n._id),n===e._id});i&&this.openEditModal(i)},title:"Edit Realisasi"},[(0,He.default)("i",{class:"ri-edit-line text-sm"})]),f>0&&(0,He.default)("button",{class:"text-red-600 hover:text-red-900 p-1 rounded-full hover:bg-red-50",onclick:()=>{let i=this.realisasiList.find(t=>{let n=t.kodeRekeningId;return typeof n=="object"&&n!==null&&n._id&&(n=n._id),n===e._id});i&&this.deleteRealisasi(i)},title:"Hapus Realisasi"},[(0,He.default)("i",{class:"ri-delete-bin-line text-sm"})])])])])}))])])]),this.renderForm()])},renderForm:function(){return this.showModal?(0,He.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onclick:e=>e.target===e.currentTarget&&this.closeModal()},[(0,He.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 transform transition-all",onclick:e=>e.stopPropagation()},[(0,He.default)("div",{class:"bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-t-xl"},[(0,He.default)("div",{class:"flex items-center justify-between"},[(0,He.default)("div",{class:"flex items-center space-x-3"},[(0,He.default)("div",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center"},[(0,He.default)("i",{class:`ri-${this.modalMode==="edit"?"edit":this.modalMode==="view"?"eye":"add"}-line text-xl text-white`})]),(0,He.default)("div",[(0,He.default)("h3",{class:"text-xl font-bold"},[`${this.modalMode==="edit"?"Edit":this.modalMode==="view"?"Lihat":"Input"} Realisasi`]),(0,He.default)("p",{class:"text-white text-opacity-80 text-sm"},"Formulir realisasi anggaran")])]),(0,He.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeModal()},[(0,He.default)("i",{class:"ri-close-fill"})])])]),(0,He.default)("div",{class:"p-6"},[(0,He.default)("div",{class:"space-y-6"},[(0,He.default)("div",[(0,He.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,He.default)("i",{class:"ri-hashtag mr-1 text-blue-500"}),"Kode Rekening"]),(0,He.default)("div",{class:"relative"},[(()=>{let e=this.realisasiForm.kodeRekeningId;typeof e=="object"&&e!==null&&e._id&&(e=e._id);let r=this.kodeRekeningList.find(f=>f._id===e);return(0,He.default)("input",{type:"text",class:"w-full pl-4 pr-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-50 text-gray-700 font-medium",value:r?`${r.fullCode} - ${r.name}`:"Tidak ditemukan",disabled:!0})})(),(0,He.default)("div",{class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm"},this.formatCurrency(this.realisasiForm.budgetAmount||0))])]),(0,He.default)("div",[(0,He.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,He.default)("i",{class:"ri-money-dollar-circle-line mr-1 text-green-500"}),"Jumlah Realisasi"]),(0,He.default)("div",{class:"relative"},[(0,He.default)("input",{type:"text",class:`w-full pl-4 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-200 text-right text-lg ${this.modalMode==="view"?"bg-gray-100 text-gray-600":"bg-gray-50 focus:bg-white"}`,placeholder:"0",value:this.formatNumberInput(this.realisasiForm.realizationAmount||0),oninput:e=>{this.modalMode!=="view"&&(this.realisasiForm.realizationAmount=this.parseNumberInput(e.target.value))},disabled:this.isModalLoading||this.modalMode==="view",readonly:this.modalMode==="view"}),(0,He.default)("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm"},"Rp")])]),(0,He.default)("div",[(0,He.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,He.default)("i",{class:"ri-file-text-line mr-1 text-purple-500"}),"Keterangan"]),(0,He.default)("textarea",{class:`w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200 resize-none ${this.modalMode==="view"?"bg-gray-100 text-gray-600":"bg-gray-50 focus:bg-white"}`,placeholder:"Keterangan realisasi (opsional)",value:this.realisasiForm.description||"",oninput:e=>{this.modalMode!=="view"&&(this.realisasiForm.description=e.target.value)},rows:3,disabled:this.isModalLoading||this.modalMode==="view",readonly:this.modalMode==="view"})]),(0,He.default)("div",[(0,He.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,He.default)("i",{class:"ri-calendar-line mr-1 text-orange-500"}),"Periode"]),(0,He.default)("input",{type:"text",class:"w-full pl-4 pr-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-50 text-gray-700 font-medium",value:`${this.getMonthName(this.realisasiForm.month||1)} ${this.realisasiForm.year||new Date().getFullYear()}`,disabled:!0})])])]),(0,He.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-xl"},[(0,He.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.closeModal(),disabled:this.isModalLoading},[(0,He.default)("i",{class:"ri-close-fill"}),(0,He.default)("span","Batal")]),this.modalMode!=="view"&&(0,He.default)("button",{class:`px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 ${this.isModalLoading?"opacity-50 cursor-not-allowed":""}`,onclick:()=>this.saveRealisasi(),disabled:this.isModalLoading},[this.isModalLoading?(0,He.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,He.default)("i",{class:"ri-save-line"}),(0,He.default)("span",this.isModalLoading?"Menyimpan...":"Simpan")])])])]):null}},yi=Ro;var le=sr(lr(),1);var Ko={isLoading:!1,pencapaianList:[],filteredPencapaian:[],selectedSubPerangkatDaerah:null,availableSubPerangkatDaerah:[],availableKinerja:[],isLoadingSubPerangkatDaerah:!1,showModal:!1,modalMode:"create",isModalLoading:!1,formData:{kinerjaId:"",subPerangkatDaerahId:"",anggaranId:"",budgetYear:"",periodMonth:new Date().getMonth()+1,periodYear:new Date().getFullYear(),achievementValue:"",achievementType:"numeric",description:""},uploadedFiles:[],isUploadingFile:!1,tempUploadedFiles:[],pdfPreviewUrl:null,pdfPreviewFile:null,isPdfLoading:!1,fileInputRef:null,searchQuery:"",selectedPeriodYear:"all",selectedPeriodMonth:"all",currentPage:1,itemsPerPage:10,formatDate:function(e){return e?new Intl.DateTimeFormat("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(e)):"-"},formatPercentage:function(e){return new Intl.NumberFormat("id-ID",{style:"percent",minimumFractionDigits:1,maximumFractionDigits:1}).format((e||0)/100)},formatMonth:function(e){return["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][e-1]||e},getAchievementTypeBadgeClass:function(e){switch(e){case"numeric":return"bg-blue-100 text-blue-800";case"descriptive":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},getAchievementTypeText:function(e){switch(e){case"numeric":return"Numerik";case"descriptive":return"Deskriptif";default:return e}},loadSubPerangkatDaerah:async function(){try{this.isLoadingSubPerangkatDaerah=!0,le.default.redraw();let e=await Ce.getAll("subperangkatdaerah");this.availableSubPerangkatDaerah=e.data||[]}catch(e){console.error("Error loading sub perangkat daerah:",e)}finally{this.isLoadingSubPerangkatDaerah=!1,le.default.redraw()}},loadKinerjaForSubPerangkatDaerah:async function(e){if(!e){this.availableKinerja=[],le.default.redraw();return}try{let r=await Ce.request(`/api/pencapaian/kinerja?subPerangkatDaerahId=${e}`);this.availableKinerja=r.data||[],console.log(`Loaded ${this.availableKinerja.length} kinerja for unit ${e}`)}catch(r){console.error("Error loading kinerja:",r),this.availableKinerja=[]}finally{le.default.redraw()}},loadPencapaian:async function(e,r,f){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),le.default.route.set("/login");return}this.isLoading=!0,le.default.redraw();try{let a=new URLSearchParams;e&&a.append("subPerangkatDaerahId",e),r&&r!=="all"&&a.append("periodYear",r),f&&f!=="all"&&a.append("periodMonth",f);let i=`/api/pencapaian${a.toString()?"?"+a.toString():""}`;console.log("Loading pencapaian with URL:",i);let n=(await Ce.request(i)).data||[];e&&n.length>0&&(n=n.filter(c=>(c.subPerangkatDaerahId?._id||c.subPerangkatDaerahId)===e),console.log(`Filtered pencapaian data: ${n.length} items for unit ${e}`)),this.pencapaianList=n,this.applyFilters(),console.log("Loaded pencapaian data:",this.pencapaianList.length,"items"),this.pencapaianList.length>0&&(this.pencapaianList.some(b=>!b.kinerjaId?.subKegiatanId?.nama)&&console.warn("Some pencapaian items are missing subKegiatan information"),be.success("Data pencapaian berhasil dimuat"))}catch(a){console.error("Error loading pencapaian:",a),toast.error("Gagal memuat data: "+(a.message||"Kesalahan tidak diketahui")),this.pencapaianList=[],this.filteredPencapaian=[]}finally{this.isLoading=!1,le.default.redraw()}},applyFilters:function(){let e=[...this.pencapaianList];if(this.selectedSubPerangkatDaerah){let r=this.selectedSubPerangkatDaerah._id;e=e.filter(f=>(f.subPerangkatDaerahId?._id||f.subPerangkatDaerahId)===r)}if(this.searchQuery.trim()){let r=this.searchQuery.toLowerCase();e=e.filter(f=>(f.kinerjaId?.subKegiatanId?.nama||"").toLowerCase().includes(r)||(f.kinerjaId?.subKegiatanId?.kode||"").toLowerCase().includes(r)||(f.description||"").toLowerCase().includes(r)||(f.subPerangkatDaerahId?.nama||"").toLowerCase().includes(r))}this.selectedPeriodYear!=="all"&&(e=e.filter(r=>r.periodYear===parseInt(this.selectedPeriodYear))),this.selectedPeriodMonth!=="all"&&(e=e.filter(r=>r.periodMonth===parseInt(this.selectedPeriodMonth))),this.filteredPencapaian=e,this.currentPage=1},resetForm:function(){this.formData={kinerjaId:"",subPerangkatDaerahId:this.selectedSubPerangkatDaerah?._id||"",anggaranId:"",budgetYear:this.userData?.budgetYear||"",periodMonth:new Date().getMonth()+1,periodYear:new Date().getFullYear(),achievementValue:"",achievementType:"numeric",description:""},this.uploadedFiles=[],this.tempUploadedFiles=[],this.clearPdfPreview()},openCreateModal:function(){if(!this.selectedSubPerangkatDaerah){toast.warning("Pilih unit kerja terlebih dahulu");return}if(this.availableKinerja.length===0){toast.warning("Tidak ada target kinerja untuk unit kerja ini");return}this.modalMode="create",this.resetForm(),this.showModal=!0},openEditModal:async function(e){this.modalMode="edit";try{let r=JWTUtils.getToken();if(r&&e.kinerjaId){let f=await fetch(`/api/kinerja/${e.kinerjaId._id||e.kinerjaId}`,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(f.ok){let i=(await f.json()).data;this.formData={_id:e._id,kinerjaId:i,subPerangkatDaerahId:e.subPerangkatDaerahId?._id||e.subPerangkatDaerahId,anggaranId:e.anggaranId?._id||e.anggaranId,budgetYear:e.budgetYear,periodMonth:e.periodMonth,periodYear:e.periodYear,achievementValue:e.achievementValue,achievementType:e.achievementType,description:e.description||""}}else this.formData={_id:e._id,kinerjaId:e.kinerjaId,subPerangkatDaerahId:e.subPerangkatDaerahId?._id||e.subPerangkatDaerahId,anggaranId:e.anggaranId?._id||e.anggaranId,budgetYear:e.budgetYear,periodMonth:e.periodMonth,periodYear:e.periodYear,achievementValue:e.achievementValue,achievementType:e.achievementType,description:e.description||""}}else this.formData={_id:e._id,kinerjaId:e.kinerjaId,subPerangkatDaerahId:e.subPerangkatDaerahId?._id||e.subPerangkatDaerahId,anggaranId:e.anggaranId?._id||e.anggaranId,budgetYear:e.budgetYear,periodMonth:e.periodMonth,periodYear:e.periodYear,achievementValue:e.achievementValue,achievementType:e.achievementType,description:e.description||""}}catch(r){console.error("Error loading kinerja for edit modal:",r),this.formData={_id:e._id,kinerjaId:e.kinerjaId,subPerangkatDaerahId:e.subPerangkatDaerahId?._id||e.subPerangkatDaerahId,anggaranId:e.anggaranId?._id||e.anggaranId,budgetYear:e.budgetYear,periodMonth:e.periodMonth,periodYear:e.periodYear,achievementValue:e.achievementValue,achievementType:e.achievementType,description:e.description||""}}this.selectedSubPerangkatDaerah||(this.selectedSubPerangkatDaerah=this.availableSubPerangkatDaerah.find(r=>r._id===e.subPerangkatDaerahId?._id||r._id===e.subPerangkatDaerahId)),this.loadUploadedFiles(),this.showModal=!0},closeModal:function(){this.showModal=!1,this.resetForm(),this.clearPdfPreview()},handleFileUpload:async function(e){if(e){if(e.type!=="application/pdf"){toast.error("Hanya file PDF yang diperbolehkan");return}if(e.size>1024*1024){toast.error("Ukuran file tidak boleh melebihi 1 MB");return}await this.renderPdfPreview(e),this.isUploadingFile=!0,le.default.redraw();try{let r=JWTUtils.getToken();if(!r)throw new Error("No authentication token found");let f=new FormData;if(f.append("file",e),console.log("Frontend - File being uploaded:",{name:e.name,type:e.type,size:e.size,firstBytes:e.slice(0,10)}),!this.formData._id&&this.modalMode==="create"){let n={file:e,name:e.name,size:e.size,uploadDate:new Date};this.tempUploadedFiles.push(n),toast.success("File akan diunggah otomatis setelah pencapaian disimpan"),this.clearPdfPreview(),this.isUploadingFile=!1,le.default.redraw();return}let a=`/api/pencapaian/${this.formData._id}/files`;console.log("Uploading file to URL:",a),console.log("Current formData._id:",this.formData._id);let i=await fetch(a,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:f});if(!i.ok){let n=await i.json();throw new Error(n.message||`HTTP error! status: ${i.status}`)}let t=await i.json();if(console.log("File upload result:",t),t.success){if(toast.success("File berhasil diunggah"),await this.loadUploadedFiles(),this.clearPdfPreview(),this.formData._id)try{let n=JWTUtils.getToken();if(n){let c=await fetch(`/api/pencapaian/${this.formData._id}`,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(c.ok){let b=await c.json();this.uploadedFiles=b.data.evidenceFiles||[],le.default.redraw()}}}catch(n){console.error("Error refreshing pencapaian data after file upload:",n)}}else throw new Error(t.message||"Upload gagal")}catch(r){console.error("Error uploading file:",r),toast.error("Gagal mengunggah file: "+r.message),this.clearPdfPreview()}finally{this.isUploadingFile=!1,le.default.redraw()}}},downloadFile:async function(e){try{let r=JWTUtils.getToken();if(!r)throw new Error("No authentication token found");let f=await fetch(`/api/pencapaian/${this.formData._id}/files/${e}`,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(!f.ok)throw new Error("Failed to download file");let a=await f.blob(),i=window.URL.createObjectURL(a),t=document.createElement("a");t.href=i;let n=this.uploadedFiles.find(c=>c.filename===e);t.download=n?n.originalName:e,document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(i),document.body.removeChild(t),toast.success("File berhasil diunduh")}catch(r){console.error("Error downloading file:",r),toast.error("Gagal mengunduh file")}},deleteFile:async function(e){showConfirmation("Apakah Anda yakin ingin menghapus file ini?",async()=>{try{let r=JWTUtils.getToken();if(!r)throw new Error("No authentication token found");let f=await fetch(`/api/pencapaian/${this.formData._id}/files/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(!f.ok){let a=await f.json();throw new Error(a.message||"Failed to delete file")}this.uploadedFiles=this.uploadedFiles.filter(a=>a.filename!==e),toast.success("File berhasil dihapus"),le.default.redraw()}catch(r){console.error("Error deleting file:",r),toast.error("Gagal menghapus file")}},()=>{toast.info("Penghapusan dibatalkan")})},loadUploadedFiles:async function(){if(!this.formData._id){this.uploadedFiles=[];return}try{let e=JWTUtils.getToken();if(!e)return;let r=await fetch(`/api/pencapaian/${this.formData._id}`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(r.ok){let f=await r.json();if(this.uploadedFiles=f.data.evidenceFiles||[],this.modalMode==="edit"&&this.uploadedFiles.length>0){let a=this.uploadedFiles.filter(i=>i.originalName.toLowerCase().endsWith(".pdf")||i.filename.toLowerCase().endsWith(".pdf"));if(a.length>0){let i=a[0];await this.createPdfPreviewForExistingFile(i)}}}else this.uploadedFiles=[]}catch(e){console.error("Error loading uploaded files:",e),this.uploadedFiles=[]}},createPdfPreviewForExistingFile:async function(e){try{this.isPdfLoading=!0,this.clearPdfPreview(),le.default.redraw();let r=JWTUtils.getToken();if(!r)return;let f=await fetch(`/api/pencapaian/${this.formData._id}/files/${e.filename}`,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(f.ok){let a=await f.blob();this.pdfPreviewUrl=URL.createObjectURL(a),this.pdfPreviewFile={name:e.originalName,size:e.fileSize},toast.success("PDF berhasil dimuat untuk pratinjau")}else throw new Error("Failed to fetch PDF file")}catch(r){console.error("Error creating PDF preview for existing file:",r),toast.error("Gagal memuat pratinjau PDF"),this.clearPdfPreview()}finally{this.isPdfLoading=!1,le.default.redraw()}},formatFileSize:function(e){if(e===0)return"0 Bytes";let r=1024,f=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(r));return parseFloat((e/Math.pow(r,a)).toFixed(2))+" "+f[a]},clearPdfPreview:function(){this.pdfPreviewUrl&&(URL.revokeObjectURL(this.pdfPreviewUrl),this.pdfPreviewUrl=null),this.pdfPreviewFile=null,this.isPdfLoading=!1},previewExistingPdfFile:async function(e){await this.createPdfPreviewForExistingFile(e)},renderPdfPreview:async function(e){try{this.isPdfLoading=!0,this.clearPdfPreview(),le.default.redraw(),this.pdfPreviewUrl=URL.createObjectURL(e),this.pdfPreviewFile=e,await new Promise(r=>setTimeout(r,500)),toast.success("PDF berhasil dimuat untuk pratinjau")}catch(r){console.error("Error rendering PDF preview:",r),toast.error("Gagal memuat pratinjau PDF"),this.clearPdfPreview()}finally{this.isPdfLoading=!1,le.default.redraw()}},openPdfInNewTab:function(){this.pdfPreviewUrl&&window.open(this.pdfPreviewUrl,"_blank")},uploadTempFiles:async function(){if(!(this.tempUploadedFiles.length===0||!this.formData._id))try{let e=JWTUtils.getToken();if(!e)return;let r=0,f=0;for(let a of this.tempUploadedFiles)try{let i=new FormData;i.append("file",a.file),(await fetch(`/api/pencapaian/${this.formData._id}/files`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:i})).ok?r++:f++}catch(i){console.error("Error uploading temp file:",i),f++}this.tempUploadedFiles=[],await this.loadUploadedFiles(),r>0&&toast.success(`${r} file berhasil diunggah otomatis`),f>0&&toast.warning(`${f} file gagal diunggah`)}catch(e){console.error("Error in uploadTempFiles:",e),toast.error("Gagal mengunggah beberapa file")}},saveItem:async function(){if(!this.formData.kinerjaId||!this.formData.achievementValue){toast.warning("Target kinerja dan nilai pencapaian harus diisi");return}this.isModalLoading=!0,le.default.redraw();try{let e=JWTUtils.getToken();if(!e)throw new Error("No authentication token found");let r=this.modalMode==="edit"?"PUT":"POST",f=this.modalMode==="edit"?`/api/pencapaian/${this.formData._id}`:"/api/pencapaian",a;this.modalMode==="edit"?(a={achievementValue:this.formData.achievementValue,periodMonth:this.formData.periodMonth,periodYear:this.formData.periodYear,description:this.formData.description},console.log("=== EDIT REQUEST DEBUG ==="),console.log("Form data values:",{achievementValue:this.formData.achievementValue,periodMonth:this.formData.periodMonth,periodYear:this.formData.periodYear,description:this.formData.description}),console.log("Request body being sent:",a),console.log("========================")):a={kinerjaId:this.formData.kinerjaId,subPerangkatDaerahId:this.formData.subPerangkatDaerahId,anggaranId:this.formData.anggaranId,budgetYear:this.formData.budgetYear,periodMonth:this.formData.periodMonth,periodYear:this.formData.periodYear,achievementValue:this.formData.achievementValue,achievementType:this.formData.achievementType,description:this.formData.description};let i=await fetch(f,{method:r,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok){let n=await i.json();throw new Error(n.message||`HTTP error! status: ${i.status}`)}let t=await i.json();toast.success(`Pencapaian berhasil di${this.modalMode==="edit"?"perbarui":"simpan"}`),this.modalMode==="create"&&t.data&&t.data._id&&(this.formData._id=t.data._id,this.tempUploadedFiles.length>0&&(toast.info("Mengunggah file pendukung..."),await this.uploadTempFiles())),this.closeModal(),this.loadPencapaian()}catch(e){console.error("Error saving pencapaian:",e),toast.error(`Gagal ${this.modalMode==="edit"?"memperbarui":"menyimpan"} pencapaian`)}finally{this.isModalLoading=!1,le.default.redraw()}},deleteItem:async function(e){showConfirmation(`Apakah Anda yakin ingin menghapus pencapaian untuk periode ${this.formatMonth(e.periodMonth)} ${e.periodYear}?`,async()=>{this.isLoading=!0,le.default.redraw();try{let r=JWTUtils.getToken();if(!r)throw new Error("No authentication token found");let f=await fetch(`/api/pencapaian/${e._id}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(!f.ok){let a=await f.json();throw new Error(a.message||`HTTP error! status: ${f.status}`)}toast.success("Pencapaian berhasil dihapus"),this.loadPencapaian()}catch(r){console.error("Error deleting pencapaian:",r),toast.error("Gagal menghapus pencapaian")}finally{this.isLoading=!1,le.default.redraw()}},()=>{toast.info("Penghapusan dibatalkan")})},getTotalPages:function(){return Math.ceil(this.filteredPencapaian.length/this.itemsPerPage)},getPaginatedPencapaian:function(){let e=(this.currentPage-1)*this.itemsPerPage,r=e+this.itemsPerPage;return this.filteredPencapaian.slice(e,r)},changePage:function(e){e>=1&&e<=this.getTotalPages()&&(this.currentPage=e,le.default.redraw())},oninit:function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),le.default.route.set("/login");return}this.vnode&&this.vnode.attrs&&this.vnode.attrs.setTitle&&this.vnode.attrs.setTitle("Manajemen Pencapaian"),this.userData=et.getUserData(),this.userData.budgetYear&&typeof this.userData.budgetYear=="object"&&(this.userData.budgetYear=`${this.userData.budgetYear.year}-${this.userData.budgetYear.status}`),this.loadSubPerangkatDaerah()},view:function(){return(0,le.default)("div",{class:"space-y-6"},[(0,le.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,le.default)("div",{class:"flex justify-between items-center mb-6"},[(0,le.default)("div",[(0,le.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Manajemen Pencapaian"),(0,le.default)("p",{class:"text-gray-600 mt-1"},"Lihat dan kelola semua laporan pencapaian kinerja untuk unit kerja")]),(0,le.default)("button",{class:`inline-flex items-center px-4 py-2 font-medium rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl ${!this.selectedSubPerangkatDaerah||this.availableKinerja.length===0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white"}`,onclick:()=>this.openCreateModal(),disabled:!this.selectedSubPerangkatDaerah||this.availableKinerja.length===0},[(0,le.default)("i",{class:"ri-add-line mr-2"}),"Tambah Pencapaian"])]),(0,le.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[(0,le.default)("div",[(0,le.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,le.default)("i",{class:"ri-building-line mr-2 text-blue-500"}),"Unit Kerja"]),this.selectedSubPerangkatDaerah&&(0,le.default)("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4"},[(0,le.default)("div",{class:"flex items-center justify-between"},[(0,le.default)("div",[(0,le.default)("div",{class:"font-semibold text-blue-900 text-lg"},this.selectedSubPerangkatDaerah.nama),(0,le.default)("div",{class:"text-sm text-blue-700 mt-1"},`Pimpinan: ${this.selectedSubPerangkatDaerah.pimpinan}`)]),(0,le.default)("button",{type:"button",class:"text-blue-600 hover:text-blue-800 p-2 rounded-full hover:bg-blue-100",onclick:()=>{this.selectedSubPerangkatDaerah=null,this.availableKinerja=[],this.pencapaianList=[],this.filteredPencapaian=[]}},[(0,le.default)("i",{class:"ri-close-fill"})])])]),(0,le.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",value:this.selectedSubPerangkatDaerah?._id||"",disabled:this.isLoadingSubPerangkatDaerah,onchange:e=>{let r=e.target.value;this.pencapaianList=[],this.filteredPencapaian=[],this.selectedSubPerangkatDaerah=null,this.availableKinerja=[],r&&(this.selectedSubPerangkatDaerah=this.availableSubPerangkatDaerah.find(f=>f._id===r),this.loadKinerjaForSubPerangkatDaerah(r),this.loadPencapaian(r,this.selectedPeriodYear!=="all"?this.selectedPeriodYear:null,this.selectedPeriodMonth!=="all"?this.selectedPeriodMonth:null)),le.default.redraw()}},[(0,le.default)("option",{value:""},this.isLoadingSubPerangkatDaerah?"Memuat...":"Pilih Unit Kerja"),(this.availableSubPerangkatDaerah||[]).map(e=>(0,le.default)("option",{value:e._id,key:e._id},e.nama))])]),(0,le.default)("div",[(0,le.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,le.default)("i",{class:"ri-target-line mr-2 text-green-500"}),"Target Kinerja"]),(0,le.default)("div",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700"},[(0,le.default)("div",{class:"flex items-center justify-between"},[(0,le.default)("span",`Jumlah Target Kinerja: ${this.availableKinerja.length}`),this.selectedSubPerangkatDaerah&&(0,le.default)("div",{class:"flex items-center space-x-2"},[(0,le.default)("i",{class:"ri-information-line text-blue-500"}),(0,le.default)("span",{class:"text-sm text-blue-600"},"Target kinerja tersedia")])])])])])]),this.selectedSubPerangkatDaerah&&(0,le.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,le.default)("div",{class:"grid grid-cols-1 md:grid-cols-4 gap-4"},[(0,le.default)("div",[(0,le.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pencarian"),(0,le.default)("div",{class:"relative"},[(0,le.default)("input",{type:"text",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Cari subkegiatan atau deskripsi...",value:this.searchQuery,oninput:e=>{this.searchQuery=e.target.value,this.applyFilters()}}),(0,le.default)("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[(0,le.default)("i",{class:"ri-search-line text-gray-400"})])])]),(0,le.default)("div",[(0,le.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tahun"),(0,le.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:this.selectedPeriodYear,onchange:e=>{this.selectedPeriodYear=e.target.value,this.applyFilters()}},[(0,le.default)("option",{value:"all"},"Semua Tahun"),(0,le.default)("option",{value:"2024"},"2024"),(0,le.default)("option",{value:"2025"},"2025"),(0,le.default)("option",{value:"2026"},"2026")])]),(0,le.default)("div",[(0,le.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Bulan"),(0,le.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:this.selectedPeriodMonth,onchange:e=>{this.selectedPeriodMonth=e.target.value,this.applyFilters()}},[(0,le.default)("option",{value:"all"},"Semua Bulan"),(0,le.default)("option",{value:"1"},"Januari"),(0,le.default)("option",{value:"2"},"Februari"),(0,le.default)("option",{value:"3"},"Maret"),(0,le.default)("option",{value:"4"},"April"),(0,le.default)("option",{value:"5"},"Mei"),(0,le.default)("option",{value:"6"},"Juni"),(0,le.default)("option",{value:"7"},"Juli"),(0,le.default)("option",{value:"8"},"Agustus"),(0,le.default)("option",{value:"9"},"September"),(0,le.default)("option",{value:"10"},"Oktober"),(0,le.default)("option",{value:"11"},"November"),(0,le.default)("option",{value:"12"},"Desember")])]),(0,le.default)("div",{class:"flex items-end"},[(0,le.default)("div",{class:"text-sm text-gray-600"},[(0,le.default)("div",`Menampilkan ${this.filteredPencapaian.length} dari ${this.pencapaianList.length} pencapaian`),this.searchQuery&&(0,le.default)("div",{class:"text-blue-600"},`Pencarian: "${this.searchQuery}"`)])])])]),this.isLoading?(0,le.default)("div",{class:"flex justify-center items-center h-64"},[(0,le.default)("div",{class:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):this.selectedSubPerangkatDaerah?this.filteredPencapaian.length===0?(0,le.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,le.default)("div",{class:"text-center py-12"},[(0,le.default)("div",{class:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-gray-100 mb-4"},[(0,le.default)("i",{class:"ri-trophy-fill text-blue-500"})]),(0,le.default)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Belum ada data pencapaian"),(0,le.default)("p",{class:"text-gray-500 mb-6 max-w-sm mx-auto"},"Mulai tambahkan laporan pencapaian untuk target kinerja yang telah ditetapkan"),this.availableKinerja.length>0&&(0,le.default)("button",{class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl",onclick:()=>this.openCreateModal()},[(0,le.default)("i",{class:"ri-add-line mr-2"}),"Tambah Pencapaian Pertama"])])]):(0,le.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,le.default)("div",{class:"overflow-x-auto"},[(0,le.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,le.default)("thead",{class:"bg-gray-50"},[(0,le.default)("tr",[(0,le.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"SubKegiatan"),(0,le.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Periode"),(0,le.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nilai Pencapaian"),(0,le.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tipe"),(0,le.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Capaian %"),(0,le.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,le.default)("tbody",{class:"bg-white divide-y divide-gray-200"},(this.getPaginatedPencapaian()||[]).map(e=>[(0,le.default)("tr",{class:"hover:bg-gray-50"},[(0,le.default)("td",{class:"px-6 py-4"},[(0,le.default)("div",{class:"text-sm font-medium text-gray-900"},[(e.kinerjaId?.subKegiatanId?.kode||e.kinerjaId?.kode)&&(0,le.default)("span",{class:"font-mono text-xs text-gray-500 mr-2"},e.kinerjaId?.subKegiatanId?.kode||e.kinerjaId?.kode),e.kinerjaId?.subKegiatanId?.nama||e.kinerjaId?.nama||"SubKegiatan tidak ditemukan"]),(0,le.default)("div",{class:"text-sm text-gray-500 mt-1"},[(0,le.default)("span",{class:"font-medium"},"Target: "),e.kinerjaId?.targetValue?.toLocaleString("id-ID")||"N/A"])]),(0,le.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,le.default)("div",{class:"text-sm text-gray-900"},[(0,le.default)("div",{class:"font-semibold"},`${this.formatMonth(e.periodMonth)} ${e.periodYear}`)])]),(0,le.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,le.default)("div",{class:"text-sm font-semibold text-blue-600"},[e.achievementType==="numeric"?(e.achievementValue||0).toLocaleString("id-ID"):e.achievementValue||"-"])]),(0,le.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,le.default)("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${this.getAchievementTypeBadgeClass(e.achievementType)}`},this.getAchievementTypeText(e.achievementType))]),(0,le.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[e.achievementType==="numeric"?(0,le.default)("div",{class:"text-sm text-center"},[(0,le.default)("div",{class:"font-bold text-lg"},[(0,le.default)("span",{class:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${e.achievementPercentage>=100?"bg-green-100 text-green-800":e.achievementPercentage>=75?"bg-blue-100 text-blue-800":e.achievementPercentage>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`},this.formatPercentage(e.achievementPercentage))]),(0,le.default)("div",{class:"text-xs text-gray-500 mt-1"},`${e.achievementPercentage?.toFixed(1)}%`)]):(0,le.default)("div",{class:"text-sm text-gray-500 text-center"},"-")]),(0,le.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},[(0,le.default)("div",{class:"flex justify-end space-x-2"},[(0,le.default)("button",{class:"text-blue-600 hover:text-blue-900 p-1 rounded-full hover:bg-blue-50",onclick:()=>this.openEditModal(e),title:"Edit"},[(0,le.default)("i",{class:"ri-edit-line text-lg"})]),(0,le.default)("button",{class:"text-red-600 hover:text-red-900 p-1 rounded-full hover:bg-red-50",onclick:()=>this.deleteItem(e),title:"Hapus"},[(0,le.default)("i",{class:"ri-delete-bin-line text-lg"})])])])])]))])]),this.getTotalPages()>1&&(0,le.default)("div",{class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},[(0,le.default)("div",{class:"flex-1 flex justify-between sm:hidden"},[(0,le.default)("button",{class:`relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${this.currentPage===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage-1),disabled:this.currentPage===1},"Sebelumnya"),(0,le.default)("button",{class:`ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${this.currentPage===this.getTotalPages()?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage+1),disabled:this.currentPage===this.getTotalPages()},"Selanjutnya")]),(0,le.default)("div",{class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},[(0,le.default)("div",[(0,le.default)("p",{class:"text-sm text-gray-700"},["Menampilkan ",(0,le.default)("span",{class:"font-medium"},(this.currentPage-1)*this.itemsPerPage+1)," sampai ",(0,le.default)("span",{class:"font-medium"},Math.min(this.currentPage*this.itemsPerPage,this.filteredPencapaian.length))," dari ",(0,le.default)("span",{class:"font-medium"},this.filteredPencapaian.length)," hasil"])]),(0,le.default)("div",[(0,le.default)("nav",{class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px"},[(0,le.default)("button",{class:`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium ${this.currentPage===1?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage-1),disabled:this.currentPage===1},[(0,le.default)("i",{class:"ri-arrow-left-s-line"})]),Array.from({length:Math.min(5,this.getTotalPages()||0)},(e,r)=>{let f=Math.max(1,Math.min(this.getTotalPages()-4,this.currentPage-2))+r;return(0,le.default)("button",{class:`relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium ${f===this.currentPage?"z-10 bg-blue-50 border-blue-500 text-blue-600":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(f)},f)}),(0,le.default)("button",{class:`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium ${this.currentPage===this.getTotalPages()?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage+1),disabled:this.currentPage===this.getTotalPages()},[(0,le.default)("i",{class:"ri-arrow-right-s-line"})])])])])])]):(0,le.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,le.default)("div",{class:"text-center py-12"},[(0,le.default)("div",{class:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4"},[(0,le.default)("i",{class:"ri-information-line text-blue-400 text-2xl"})]),(0,le.default)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Pilih Unit Kerja"),(0,le.default)("p",{class:"text-gray-500 max-w-md mx-auto"},"Pilih unit kerja untuk melihat semua laporan pencapaian kinerja yang telah dibuat. Untuk menambah pencapaian baru, unit kerja harus memiliki target kinerja yang telah ditetapkan.")])]),this.showModal&&(0,le.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onclick:e=>e.target===e.currentTarget&&this.closeModal()},[(0,le.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 transform transition-all max-h-[95vh] overflow-y-auto",onclick:e=>e.stopPropagation()},[(0,le.default)("div",{class:`bg-gradient-to-r ${this.modalMode==="create"?"from-blue-500 to-purple-600":"from-green-500 to-blue-600"} text-white p-6 rounded-t-xl`},[(0,le.default)("div",{class:"flex items-center justify-between"},[(0,le.default)("div",{class:"flex items-center space-x-3"},[(0,le.default)("div",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center"},[(0,le.default)("i",{class:`ri-${this.modalMode==="create"?"add":"edit"}-line text-xl text-white`})]),(0,le.default)("div",[(0,le.default)("h3",{class:"text-xl font-bold"},[`${this.modalMode==="create"?"Tambah":"Edit"} Pencapaian`]),(0,le.default)("p",{class:"text-white text-opacity-80 text-sm"},[this.modalMode==="create"?"Laporkan pencapaian untuk target kinerja":"Perbarui laporan pencapaian"])])]),(0,le.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeModal()},[(0,le.default)("i",{class:"ri-close-fill"})])])]),(0,le.default)("div",{class:"p-8"},[(0,le.default)("div",{class:"mb-8"},[(0,le.default)("h4",{class:"text-xl font-semibold text-gray-800 mb-6 flex items-center"},[(0,le.default)("i",{class:"ri-building-line mr-3 text-blue-500"}),"Unit Kerja"]),this.modalMode==="edit"?[(0,le.default)("div",{class:"w-full px-4 py-3 border border-gray-200 rounded-lg bg-gray-50 text-gray-700"},this.selectedSubPerangkatDaerah?this.selectedSubPerangkatDaerah.nama:"Unit kerja tidak ditemukan")]:[(0,le.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",value:this.formData.subPerangkatDaerahId,onchange:e=>{this.formData.subPerangkatDaerahId=e.target.value,this.selectedSubPerangkatDaerah=this.availableSubPerangkatDaerah.find(r=>r._id===e.target.value),this.loadKinerjaForSubPerangkatDaerah(e.target.value),this.formData.kinerjaId=""},disabled:this.isModalLoading||this.isLoadingSubPerangkatDaerah},[(0,le.default)("option",{value:""},this.isLoadingSubPerangkatDaerah?"Memuat...":"Pilih Unit Kerja"),(this.availableSubPerangkatDaerah||[]).map(e=>(0,le.default)("option",{value:e._id,key:e._id},e.nama))])]]),(this.availableKinerja.length>0||this.modalMode==="edit")&&(0,le.default)("div",{class:"mb-8"},[(0,le.default)("h4",{class:"text-xl font-semibold text-gray-800 mb-6 flex items-center"},[(0,le.default)("i",{class:"ri-target-line mr-3 text-green-500"}),"Target Kinerja"]),this.modalMode==="edit"?[(0,le.default)("div",{class:"bg-green-50 border border-green-200 rounded-lg p-6"},[(0,le.default)("div",{class:"flex items-center justify-between mb-4"},[(0,le.default)("div",[(0,le.default)("div",{class:"font-semibold text-green-900 text-lg"},"Target Kinerja"),(0,le.default)("div",{class:"text-sm text-green-700 mt-1"},"Target yang akan dicapai")])]),(0,le.default)("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"},[(0,le.default)("div",{class:"flex justify-between"},[(0,le.default)("span",{class:"text-gray-600"},"SubKegiatan:"),(0,le.default)("span",{class:"font-medium text-green-600"},this.formData.kinerjaId?.subKegiatanId?.nama||"Nama SubKegiatan")]),(0,le.default)("div",{class:"flex justify-between"},[(0,le.default)("span",{class:"text-gray-600"},"Kinerja:"),(0,le.default)("span",{class:"font-medium text-green-600"},this.formData.kinerjaId?.subKegiatanId?.kinerja||"Kinerja")]),(0,le.default)("div",{class:"flex justify-between"},[(0,le.default)("span",{class:"text-gray-600"},"Indikator:"),(0,le.default)("span",{class:"font-medium text-green-600"},this.formData.kinerjaId?.subKegiatanId?.indikator||"Indikator")]),(0,le.default)("div",{class:"flex justify-between"},[(0,le.default)("span",{class:"text-gray-600"},"Satuan:"),(0,le.default)("span",{class:"font-medium text-green-600"},this.formData.kinerjaId?.subKegiatanId?.satuan||"Satuan")]),(0,le.default)("div",{class:"flex justify-between"},[(0,le.default)("span",{class:"text-gray-600"},"Target Nilai:"),(0,le.default)("span",{class:"font-medium text-green-600"},this.formData.kinerjaId?.targetValue?.toLocaleString("id-ID")||"Target Value")]),(0,le.default)("div",{class:"flex justify-between"},[(0,le.default)("span",{class:"text-gray-600"},"Target Date:"),(0,le.default)("span",{class:"font-medium text-green-600"},this.formatDate(this.formData.kinerjaId?.targetDate)||"Tanggal Target")])])])]:[(0,le.default)("div",{class:"space-y-4"},[(this.availableKinerja||[]).map(e=>(0,le.default)("div",{class:`border-2 rounded-lg p-4 transition-all ${this.formData.kinerjaId===e._id?"border-blue-500 bg-blue-50 cursor-pointer":"border-gray-200 hover:border-gray-300 bg-white cursor-pointer"}`,onclick:()=>{this.formData.kinerjaId=e._id,this.formData.anggaranId=e.anggaranId?._id||e.anggaranId,this.formData.budgetYear=e.budgetYear,le.default.redraw()},key:e._id},[(0,le.default)("div",{class:"flex items-center justify-between mb-2"},[(0,le.default)("div",{class:"font-mono text-sm font-bold text-gray-800"},e.subKegiatanId?.kode||"Kode")]),(0,le.default)("div",{class:"font-medium text-gray-900 mb-2"},e.subKegiatanId?.nama||"Nama SubKegiatan"),(0,le.default)("div",{class:"grid grid-cols-2 gap-4 text-sm"},[(0,le.default)("div",{class:"flex justify-between"},[(0,le.default)("span",{class:"text-gray-600"},"Target:"),(0,le.default)("span",{class:"font-medium text-blue-600"},e.targetValue?.toLocaleString("id-ID"))]),(0,le.default)("div",{class:"flex justify-between"},[(0,le.default)("span",{class:"text-gray-600"},"Aktual:"),(0,le.default)("span",{class:"font-medium text-green-600"},e.actualValue?.toLocaleString("id-ID")||"0")]),(0,le.default)("div",{class:"flex justify-between"},[(0,le.default)("span",{class:"text-gray-600"},"Capaian:"),(0,le.default)("span",{class:"font-medium text-purple-600"},this.formatPercentage(e.achievementPercentage))]),(0,le.default)("div",{class:"flex justify-between"},[(0,le.default)("span",{class:"text-gray-600"},"Target Date:"),(0,le.default)("span",{class:"font-medium text-orange-600"},this.formatDate(e.targetDate))])])]))])]]),this.formData.kinerjaId&&(0,le.default)("div",{class:"mb-8"},[(0,le.default)("h4",{class:"text-xl font-semibold text-gray-800 mb-6 flex items-center"},[(0,le.default)("i",{class:"ri-trophy-line mr-3 text-orange-500"}),"Informasi Pencapaian"]),(0,le.default)("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-6"},[(0,le.default)("div",[(0,le.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,le.default)("i",{class:"ri-calendar-line mr-2 text-blue-500"}),"Bulan Periode"]),(0,le.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",value:this.formData.periodMonth,onchange:e=>this.formData.periodMonth=parseInt(e.target.value),disabled:this.isModalLoading},[(0,le.default)("option",{value:"1"},"Januari"),(0,le.default)("option",{value:"2"},"Februari"),(0,le.default)("option",{value:"3"},"Maret"),(0,le.default)("option",{value:"4"},"April"),(0,le.default)("option",{value:"5"},"Mei"),(0,le.default)("option",{value:"6"},"Juni"),(0,le.default)("option",{value:"7"},"Juli"),(0,le.default)("option",{value:"8"},"Agustus"),(0,le.default)("option",{value:"9"},"September"),(0,le.default)("option",{value:"10"},"Oktober"),(0,le.default)("option",{value:"11"},"November"),(0,le.default)("option",{value:"12"},"Desember")])]),(0,le.default)("div",[(0,le.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,le.default)("i",{class:"ri-calendar-2-line mr-2 text-green-500"}),"Tahun Periode"]),(0,le.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white",value:this.formData.periodYear,onchange:e=>this.formData.periodYear=parseInt(e.target.value),disabled:this.isModalLoading},[(0,le.default)("option",{value:"2024"},"2024"),(0,le.default)("option",{value:"2025"},"2025"),(0,le.default)("option",{value:"2026"},"2026")])]),(0,le.default)("div",[(0,le.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,le.default)("i",{class:"ri-hashtag mr-2 text-purple-500"}),"Tipe Pencapaian"]),(0,le.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white",value:this.formData.achievementType,onchange:e=>this.formData.achievementType=e.target.value,disabled:this.isModalLoading},[(0,le.default)("option",{value:"numeric"},"Numerik (Angka)"),(0,le.default)("option",{value:"descriptive"},"Deskriptif (Narasi)")])])]),(0,le.default)("div",{class:"mt-6"},[(0,le.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,le.default)("i",{class:`ri-${this.formData.achievementType==="numeric"?"number":"file-text"}-line mr-2 text-orange-500`}),`Nilai Pencapaian ${this.formData.achievementType==="numeric"?"(Angka)":"(Deskripsi)"}`]),this.formData.achievementType==="numeric"?(0,le.default)("input",{type:"number",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 bg-white",placeholder:"Masukkan nilai pencapaian",value:this.formData.achievementValue,oninput:e=>this.formData.achievementValue=e.target.value,min:"0",step:"0.01",disabled:this.isModalLoading}):(0,le.default)("textarea",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 bg-white resize-vertical",placeholder:"Deskripsikan pencapaian yang telah dicapai",value:this.formData.achievementValue,oninput:e=>this.formData.achievementValue=e.target.value,rows:3,disabled:this.isModalLoading})]),(0,le.default)("div",{class:"mt-6"},[(0,le.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,le.default)("i",{class:"ri-file-text-line mr-2 text-gray-500"}),"Deskripsi Tambahan"]),(0,le.default)("textarea",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white resize-vertical",placeholder:"Deskripsi tambahan atau catatan untuk pencapaian ini",value:this.formData.description,oninput:e=>this.formData.description=e.target.value,rows:3,disabled:this.isModalLoading})]),(0,le.default)("div",{class:"mt-6"},[(0,le.default)("div",{class:"border-t border-gray-200 pt-6"},[(0,le.default)("h4",{class:"text-lg font-semibold text-gray-800 mb-4 flex items-center"},[(0,le.default)("i",{class:"ri-file-upload-line mr-2 text-blue-500"}),"Dokumen Bukti (PDF)"]),(0,le.default)("p",{class:"text-sm text-gray-600 mb-4"},["Upload dokumen bukti pencapaian (format PDF, maksimal 1 MB)",...this.modalMode==="create"&&!this.formData._id?[" - ",(0,le.default)("span",{class:"text-blue-600 font-medium"},"File akan diunggah otomatis setelah disimpan")]:[]]),(0,le.default)("div",{class:"mb-4"},[(0,le.default)("input",{type:"file",id:"pencapaian-file-input",accept:".pdf,application/pdf",class:"hidden",onchange:e=>{let r=e.target.files[0];r&&this.handleFileUpload(r)},disabled:this.isUploadingFile}),(0,le.default)("label",{for:"pencapaian-file-input",class:`block w-full border-2 border-dashed rounded-lg p-6 text-center transition-colors ${this.isUploadingFile?"border-gray-300 bg-gray-50 cursor-not-allowed":"border-blue-200 hover:border-blue-400 bg-blue-50 hover:bg-blue-100 cursor-pointer"}`},[this.isUploadingFile?[(0,le.default)("i",{class:"ri-loader-4-line text-2xl text-blue-500 animate-spin mb-2"}),(0,le.default)("span",{class:"text-sm text-gray-600"},"Mengunggah...")]:[(0,le.default)("i",{class:"ri-file-upload-line text-2xl text-blue-400 mb-2"}),(0,le.default)("span",{class:"text-sm text-blue-600 mb-1"},"Pilih file PDF"),(0,le.default)("span",{class:"text-xs text-blue-500"},"File akan diunggah otomatis setelah disimpan")]])]),this.modalMode==="create"&&this.tempUploadedFiles.length>0&&(0,le.default)("div",{class:"mb-4"},[(0,le.default)("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},[(0,le.default)("h5",{class:"text-sm font-medium text-blue-800 mb-2 flex items-center"},[(0,le.default)("i",{class:"ri-time-line mr-2"}),"File akan diunggah setelah disimpan:"]),(0,le.default)("div",{class:"space-y-2"},[this.tempUploadedFiles.map((e,r)=>(0,le.default)("div",{class:"flex items-center justify-between bg-white rounded p-2 border border-blue-100",key:r},[(0,le.default)("div",{class:"flex items-center space-x-2"},[(0,le.default)("i",{class:"ri-file-pdf-line text-red-500"}),(0,le.default)("div",[(0,le.default)("div",{class:"text-sm font-medium text-gray-900"},e.name),(0,le.default)("div",{class:"text-xs text-gray-500"},this.formatFileSize(e.size))])]),(0,le.default)("button",{class:"text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-50",onclick:()=>{this.tempUploadedFiles=this.tempUploadedFiles.filter((f,a)=>a!==r),this.clearPdfPreview()},title:"Hapus file"},[(0,le.default)("i",{class:"ri-close-fill text-sm"})])]))])])]),this.pdfPreviewFile&&(0,le.default)("div",{class:"mb-4"},[(0,le.default)("div",{class:"bg-gray-50 rounded-lg p-4 border border-gray-200"},[(0,le.default)("div",{class:"flex items-center justify-between mb-3"},[(0,le.default)("h5",{class:"text-sm font-medium text-gray-700 flex items-center"},[(0,le.default)("i",{class:"ri-file-pdf-line text-red-500 mr-2"}),"Pratinjau PDF"]),(0,le.default)("div",{class:"flex space-x-2"},[(0,le.default)("button",{class:"text-blue-600 hover:text-blue-800 p-1 rounded-full hover:bg-blue-100",onclick:()=>this.openPdfInNewTab(),title:"Buka di tab baru"},[(0,le.default)("i",{class:"ri-external-link-line text-sm"})]),(0,le.default)("button",{class:"text-gray-600 hover:text-gray-800 p-1 rounded-full hover:bg-gray-100",onclick:()=>this.clearPdfPreview(),title:"Hapus pratinjau"},[(0,le.default)("i",{class:"ri-close-fill text-sm"})])])]),(0,le.default)("div",{class:"text-xs text-gray-600 mb-2"},[(0,le.default)("span",{class:"font-medium"},"File: "),this.pdfPreviewFile.name,(0,le.default)("br"),(0,le.default)("span",{class:"font-medium"},"Ukuran: "),this.formatFileSize(this.pdfPreviewFile.size)]),this.isPdfLoading?(0,le.default)("div",{class:"flex items-center justify-center py-8"},[(0,le.default)("i",{class:"ri-loader-4-line text-2xl text-blue-500 animate-spin mr-2"}),(0,le.default)("span",{class:"text-sm text-gray-600"},"Memuat pratinjau...")]):(0,le.default)("div",{class:"bg-white border rounded-lg p-4 text-center"},[(0,le.default)("iframe",{src:this.pdfPreviewUrl,class:"w-full h-64 border-0 rounded",title:"PDF Preview"},""),(0,le.default)("p",{class:"text-xs text-gray-500 mt-2"},"Pratinjau PDF - Klik tombol external link untuk melihat dalam ukuran penuh")])])]),this.uploadedFiles.length>0&&(0,le.default)("div",{class:"space-y-3"},[(0,le.default)("h5",{class:"text-sm font-medium text-gray-700"},"File yang telah diunggah:"),this.uploadedFiles.map(e=>(0,le.default)("div",{class:"flex items-center justify-between bg-gray-50 rounded-lg p-3 border border-gray-200",key:e.filename},[(0,le.default)("div",{class:"flex items-center space-x-3"},[(0,le.default)("i",{class:"ri-file-pdf-line text-red-500 text-lg"}),(0,le.default)("div",[(0,le.default)("div",{class:"text-sm font-medium text-gray-900"},e.originalName),(0,le.default)("div",{class:"text-xs text-gray-500"},[this.formatFileSize(e.fileSize)," \u2022 ","Diunggah: ",new Intl.DateTimeFormat("id-ID",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e.uploadedAt))])])]),(0,le.default)("div",{class:"flex space-x-2"},[(e.originalName.toLowerCase().endsWith(".pdf")||e.filename.toLowerCase().endsWith(".pdf"))&&(0,le.default)("button",{class:"text-green-600 hover:text-green-800 p-1 rounded-full hover:bg-green-100",onclick:()=>this.previewExistingPdfFile(e),title:"Pratinjau PDF"},[(0,le.default)("i",{class:"ri-eye-line text-sm"})]),(0,le.default)("button",{class:"text-blue-600 hover:text-blue-800 p-1 rounded-full hover:bg-blue-100",onclick:()=>this.downloadFile(e.filename),title:"Unduh"},[(0,le.default)("i",{class:"ri-download-line text-sm"})]),(0,le.default)("button",{class:"text-red-600 hover:text-red-800 p-1 rounded-full hover:bg-red-100",onclick:()=>this.deleteFile(e.filename),title:"Hapus"},[(0,le.default)("i",{class:"ri-delete-bin-line text-sm"})])])]))])])])])]),(0,le.default)("div",{class:"flex justify-end gap-4 pt-6 border-t border-gray-200 bg-gray-50 px-8 py-6 rounded-b-xl"},[(0,le.default)("button",{class:"px-8 py-3 bg-white hover:bg-gray-50 border border-gray-300 rounded-lg text-gray-700 font-medium transition-colors",onclick:()=>this.closeModal(),disabled:this.isModalLoading},[(0,le.default)("i",{class:"ri-close-fill mr-2"}),"Batal"]),(0,le.default)("button",{class:`px-8 py-3 font-medium rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl ${this.isModalLoading||!this.formData.kinerjaId||!this.formData.achievementValue?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white"}`,disabled:this.isModalLoading||!this.formData.kinerjaId||!this.formData.achievementValue,onclick:()=>this.saveItem()},[this.isModalLoading?(0,le.default)("i",{class:"ri-loader-4-line animate-spin mr-2"}):(0,le.default)("i",{class:"ri-save-line mr-2"}),this.isModalLoading?"Menyimpan...":"Simpan Pencapaian"])])])])])}},vi=Ko;var se=sr(lr(),1);var No={isLoading:!1,evaluasiList:[],filteredEvaluasi:[],selectedSubPerangkatDaerah:null,availableSubPerangkatDaerah:[],availablePencapaian:[],showModal:!1,modalMode:"create",isModalLoading:!1,formData:{pencapaianId:"",kinerjaId:"",subPerangkatDaerahId:"",periodMonth:new Date().getMonth()+1,periodYear:new Date().getFullYear(),budgetYear:"",achievementScore:"",documentationScore:"",overallScore:"",evaluationNotes:"",strengths:[""],improvements:[""],recommendations:[""],criteriaChecklist:[{criterion:"Pencapaian target sesuai dengan yang ditetapkan",isMet:!1,notes:""},{criterion:"Dokumentasi lengkap dan valid",isMet:!1,notes:""},{criterion:"Laporan sesuai dengan format yang ditentukan",isMet:!1,notes:""},{criterion:"Data akurat dan dapat dipertanggungjawabkan",isMet:!1,notes:""},{criterion:"Tepat waktu dalam pelaporan",isMet:!1,notes:""}]},searchQuery:"",selectedStatus:"pending",selectedPeriodYear:"all",selectedPeriodMonth:"all",currentPage:1,itemsPerPage:10,pdfPreviewUrl:null,pdfPreviewFile:null,isPdfLoading:!1,selectedPencapaianFiles:[],formatDate:function(e){return e?new Intl.DateTimeFormat("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(e)):"-"},formatPercentage:function(e){return new Intl.NumberFormat("id-ID",{style:"percent",minimumFractionDigits:1,maximumFractionDigits:1}).format((e||0)/100)},formatMonth:function(e){return["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][e-1]||e},getStatusBadgeClass:function(e){switch(e){case"approved":return"bg-green-100 text-green-800";case"in_review":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":return"bg-red-100 text-red-800";case"revision_required":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},getStatusText:function(e){switch(e){case"approved":return"Disetujui";case"in_review":return"Sedang Ditinjau";case"pending":return"Menunggu Evaluasi";case"rejected":return"Ditolak";case"revision_required":return"Perlu Revisi";default:return e}},getGradeBadgeClass:function(e){switch(e){case"A":return"bg-green-100 text-green-800";case"B":return"bg-blue-100 text-blue-800";case"C":return"bg-yellow-100 text-yellow-800";case"D":return"bg-orange-100 text-orange-800";case"E":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},getGradeText:function(e){switch(e){case"A":return"Sangat Baik";case"B":return"Baik";case"C":return"Cukup";case"D":return"Kurang";case"E":return"Sangat Kurang";default:return e}},loadSubPerangkatDaerah:async function(){try{let e=await Ce.getAll("subperangkatdaerah");this.availableSubPerangkatDaerah=e.data||[]}catch(e){console.error("Error loading sub perangkat daerah:",e),this.availableSubPerangkatDaerah=[]}},loadPencapaianForEvaluation:async function(e){if(!e){this.availablePencapaian=[];return}try{let r=await Ce.request(`/api/pencapaian?subPerangkatDaerahId=${e}&status=submitted`);this.availablePencapaian=r.data||[],se.default.redraw()}catch(r){console.error("Error loading pencapaian for evaluation:",r),this.availablePencapaian=[],se.default.redraw()}},loadEvaluasi:async function(e,r,f){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),se.default.route.set("/login");return}this.isLoading=!0,se.default.redraw();try{let a=new URLSearchParams;e&&a.append("subPerangkatDaerahId",e),r&&r!=="all"&&a.append("periodYear",r),f&&f!=="all"&&a.append("periodMonth",f),this.selectedStatus!=="all"&&a.append("evaluationStatus",this.selectedStatus);let i=`/api/evaluasi-kinerja${a.toString()?"?"+a.toString():""}`;console.log("Loading evaluasi with URL:",i);let t=await Ce.request(i);if(response.ok){let n=await response.json();this.evaluasiList=n.data||[],this.applyFilters(),console.log("Loaded evaluasi data:",this.evaluasiList.length,"items"),this.evaluasiList.length>0&&be.success("Data evaluasi berhasil dimuat")}else this.evaluasiList=[],this.filteredEvaluasi=[],e?be.warning("Tidak ada data evaluasi untuk unit yang dipilih"):be.info("Pilih unit kerja untuk melihat data evaluasi")}catch(a){console.error("Error loading evaluasi:",a),be.error("Gagal memuat data: "+(a.message||"Kesalahan tidak diketahui")),this.evaluasiList=[],this.filteredEvaluasi=[]}finally{this.isLoading=!1,se.default.redraw()}},applyFilters:function(){let e=[...this.evaluasiList];if(this.searchQuery.trim()){let r=this.searchQuery.toLowerCase();e=e.filter(f=>(f.pencapaianId?.kinerjaId?.subKegiatanId?.nama||"").toLowerCase().includes(r)||(f.pencapaianId?.kinerjaId?.subKegiatanId?.kode||"").toLowerCase().includes(r)||(f.evaluationNotes||"").toLowerCase().includes(r)||(f.subPerangkatDaerahId?.nama||"").toLowerCase().includes(r))}this.selectedStatus!=="all"&&(e=e.filter(r=>r.evaluationStatus===this.selectedStatus)),this.selectedPeriodYear!=="all"&&(e=e.filter(r=>r.periodYear===parseInt(this.selectedPeriodYear))),this.selectedPeriodMonth!=="all"&&(e=e.filter(r=>r.periodMonth===parseInt(this.selectedPeriodMonth))),this.filteredEvaluasi=e,this.currentPage=1},resetForm:function(){this.formData={pencapaianId:"",kinerjaId:"",subPerangkatDaerahId:this.selectedSubPerangkatDaerah?._id||"",periodMonth:new Date().getMonth()+1,periodYear:new Date().getFullYear(),budgetYear:this.userData?.budgetYear||"",achievementScore:"",documentationScore:"",overallScore:"",evaluationNotes:"",strengths:[""],improvements:[""],recommendations:[""],criteriaChecklist:[{criterion:"Pencapaian target sesuai dengan yang ditetapkan",isMet:!1,notes:""},{criterion:"Dokumentasi lengkap dan valid",isMet:!1,notes:""},{criterion:"Laporan sesuai dengan format yang ditentukan",isMet:!1,notes:""},{criterion:"Data akurat dan dapat dipertanggungjawabkan",isMet:!1,notes:""},{criterion:"Tepat waktu dalam pelaporan",isMet:!1,notes:""}]},this.selectedPencapaianFiles=[],this.clearPencapaianPdfPreview()},openCreateModal:function(){if(!this.selectedSubPerangkatDaerah){be.warning("Pilih unit kerja terlebih dahulu");return}this.modalMode="create",this.resetForm(),this.showModal=!0},openEditModal:async function(e){this.modalMode="edit",this.formData={_id:e._id,pencapaianId:e.pencapaianId?._id||e.pencapaianId,kinerjaId:e.kinerjaId?._id||e.kinerjaId,subPerangkatDaerahId:e.subPerangkatDaerahId?._id||e.subPerangkatDaerahId,periodMonth:e.periodMonth,periodYear:e.periodYear,budgetYear:e.budgetYear,achievementScore:e.achievementScore,documentationScore:e.documentationScore,overallScore:e.overallScore,evaluationNotes:e.evaluationNotes||"",strengths:e.strengths?.length>0?e.strengths:[""],improvements:e.improvements?.length>0?e.improvements:[""],recommendations:e.recommendations?.length>0?e.recommendations:[""],criteriaChecklist:e.criteriaChecklist?.length>0?e.criteriaChecklist:[{criterion:"Pencapaian target sesuai dengan yang ditetapkan",isMet:!1,notes:""},{criterion:"Dokumentasi lengkap dan valid",isMet:!1,notes:""},{criterion:"Laporan sesuai dengan format yang ditentukan",isMet:!1,notes:""},{criterion:"Data akurat dan dapat dipertanggungjawabkan",isMet:!1,notes:""},{criterion:"Tepat waktu dalam pelaporan",isMet:!1,notes:""}]},this.selectedSubPerangkatDaerah=this.availableSubPerangkatDaerah.find(r=>r._id===e.subPerangkatDaerahId?._id||r._id===e.subPerangkatDaerahId),e.pencapaianId&&this.loadPencapaianFiles(e.pencapaianId._id||e.pencapaianId),this.showModal=!0},closeModal:function(){this.showModal=!1,this.resetForm(),this.clearPencapaianPdfPreview()},loadPencapaianFiles:async function(e){if(!e){this.selectedPencapaianFiles=[];return}try{let r=JWTUtils.getToken();if(!r)return;let f=await fetch(`/api/pencapaian/${e}`,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(f.ok){let a=await f.json();this.selectedPencapaianFiles=a.data.evidenceFiles||[],se.default.redraw()}else this.selectedPencapaianFiles=[],se.default.redraw()}catch(r){console.error("Error loading pencapaian files:",r),this.selectedPencapaianFiles=[]}},clearPencapaianPdfPreview:function(){this.pdfPreviewUrl&&(URL.revokeObjectURL(this.pdfPreviewUrl),this.pdfPreviewUrl=null),this.pdfPreviewFile=null,this.isPdfLoading=!1},previewPencapaianPdfFile:async function(e){try{this.isPdfLoading=!0,this.clearPencapaianPdfPreview(),se.default.redraw();let r=this.availablePencapaian.find(i=>i._id===this.formData.pencapaianId);if(!r)return;let f=JWTUtils.getToken();if(!f)return;let a=await fetch(`/api/pencapaian/${r._id}/files/${e.filename}`,{headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"}});if(a.ok){let i=await a.blob();this.pdfPreviewUrl=URL.createObjectURL(i),this.pdfPreviewFile={name:e.originalName,size:e.fileSize},be.success("PDF berhasil dimuat untuk pratinjau")}else throw new Error("Failed to fetch PDF file")}catch(r){console.error("Error creating PDF preview for pencapaian file:",r),be.error("Gagal memuat pratinjau PDF"),this.clearPencapaianPdfPreview()}finally{this.isPdfLoading=!1,se.default.redraw()}},openPencapaianPdfInNewTab:function(){this.pdfPreviewUrl&&window.open(this.pdfPreviewUrl,"_blank")},formatPencapaianFileSize:function(e){if(e===0)return"0 Bytes";let r=1024,f=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(r));return parseFloat((e/Math.pow(r,a)).toFixed(2))+" "+f[a]},saveItem:async function(){if(!this.formData.pencapaianId){be.warning("Pilih laporan pencapaian yang akan dievaluasi");return}if(!this.formData.achievementScore||!this.formData.documentationScore){be.warning("Nilai pencapaian dan dokumentasi harus diisi");return}this.isModalLoading=!0,se.default.redraw();try{if(!JWTUtils.getToken())throw new Error("No authentication token found");let r=this.modalMode==="edit"?"PUT":"POST",f=this.modalMode==="edit"?`/api/evaluasi-kinerja/${this.formData._id}`:"/api/evaluasi-kinerja",a;this.modalMode==="edit"?a={evaluationNotes:this.formData.evaluationNotes,achievementScore:parseFloat(this.formData.achievementScore),documentationScore:parseFloat(this.formData.documentationScore),strengths:this.formData.strengths.filter(t=>t.trim()!==""),improvements:this.formData.improvements.filter(t=>t.trim()!==""),recommendations:this.formData.recommendations.filter(t=>t.trim()!==""),criteriaChecklist:this.formData.criteriaChecklist}:a={pencapaianId:this.formData.pencapaianId,evaluationNotes:this.formData.evaluationNotes,achievementScore:parseFloat(this.formData.achievementScore),documentationScore:parseFloat(this.formData.documentationScore),strengths:this.formData.strengths.filter(t=>t.trim()!==""),improvements:this.formData.improvements.filter(t=>t.trim()!==""),recommendations:this.formData.recommendations.filter(t=>t.trim()!=="")};let i=await Ce.request(f,{method:r,body:a});be.success(`Evaluasi berhasil di${this.modalMode==="edit"?"perbarui":"simpan"}`),this.closeModal(),this.loadEvaluasi()}catch(e){console.error("Error saving evaluasi:",e),be.error(`Gagal ${this.modalMode==="edit"?"memperbarui":"menyimpan"} evaluasi`)}finally{this.isModalLoading=!1,se.default.redraw()}},approveEvaluation:async function(e){be.confirm("Apakah Anda yakin ingin menyetujui evaluasi ini?",async()=>{this.isLoading=!0,se.default.redraw();try{await Ce.request(`/api/evaluasi-kinerja/${e._id}/approve`,{method:"PUT",body:{notes:"Evaluasi disetujui oleh supervisor"}}),be.success("Evaluasi berhasil disetujui"),this.loadEvaluasi()}catch(r){console.error("Error approving evaluation:",r),be.error("Gagal menyetujui evaluasi")}finally{this.isLoading=!1,se.default.redraw()}},()=>{be.info("Persetujuan dibatalkan")})},rejectEvaluation:async function(e){let r=prompt("Masukkan alasan penolakan:");if(!r||!r.trim()){be.warning("Alasan penolakan harus diisi");return}this.isLoading=!0,se.default.redraw();try{await Ce.request(`/api/evaluasi-kinerja/${e._id}/reject`,{method:"PUT",body:{reason:r}}),be.success("Evaluasi berhasil ditolak"),this.loadEvaluasi()}catch(f){console.error("Error rejecting evaluation:",f),be.error("Gagal menolak evaluasi")}finally{this.isLoading=!1,se.default.redraw()}},requestRevision:async function(e){let r=prompt("Masukkan persyaratan revisi (pisahkan dengan koma):");if(!r||!r.trim()){be.warning("Persyaratan revisi harus diisi");return}let f=prompt("Catatan tambahan (opsional):");this.isLoading=!0,se.default.redraw();try{let a=await fetch(`/api/evaluasi-kinerja/${e._id}/revision`,{method:"PUT",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"},body:JSON.stringify({requirements:r.split(",").map(i=>i.trim()),notes:f})});if(!a.ok){let i=await a.json();throw new Error(i.message||`HTTP error! status: ${a.status}`)}be.success("Permintaan revisi berhasil dikirim"),this.loadEvaluasi()}catch(a){console.error("Error requesting revision:",a),be.error("Gagal meminta revisi")}finally{this.isLoading=!1,se.default.redraw()}},addArrayItem:function(e){this.formData[e].push(""),se.default.redraw()},removeArrayItem:function(e,r){this.formData[e].length>1&&(this.formData[e].splice(r,1),se.default.redraw())},updateArrayItem:function(e,r,f){this.formData[e][r]=f},getTotalPages:function(){return Math.ceil(this.filteredEvaluasi.length/this.itemsPerPage)},getPaginatedEvaluasi:function(){let e=(this.currentPage-1)*this.itemsPerPage,r=e+this.itemsPerPage;return this.filteredEvaluasi.slice(e,r)},changePage:function(e){e>=1&&e<=this.getTotalPages()&&(this.currentPage=e,se.default.redraw())},oninit:function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),se.default.route.set("/login");return}this.vnode&&this.vnode.attrs&&this.vnode.attrs.setTitle&&this.vnode.attrs.setTitle("Evaluasi Kinerja"),this.userData=et.getUserData(),this.userData.budgetYear&&typeof this.userData.budgetYear=="object"&&(this.userData.budgetYear=`${this.userData.budgetYear.year}-${this.userData.budgetYear.status}`),this.loadSubPerangkatDaerah()},view:function(){return(0,se.default)("div",{class:"space-y-6"},[(0,se.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,se.default)("div",{class:"flex justify-between items-center mb-6"},[(0,se.default)("div",[(0,se.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Evaluasi Kinerja"),(0,se.default)("p",{class:"text-gray-600 mt-1"},"Evaluasi dan berikan penilaian terhadap laporan pencapaian kinerja")]),(0,se.default)("button",{class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl",onclick:()=>this.openCreateModal(),disabled:!this.selectedSubPerangkatDaerah},[(0,se.default)("i",{class:"ri-add-line mr-2"}),"Buat Evaluasi"])]),(0,se.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,se.default)("i",{class:"ri-building-line mr-2 text-blue-500"}),"Unit Kerja"]),this.selectedSubPerangkatDaerah&&(0,se.default)("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4"},[(0,se.default)("div",{class:"flex items-center justify-between"},[(0,se.default)("div",[(0,se.default)("div",{class:"font-semibold text-blue-900 text-lg"},this.selectedSubPerangkatDaerah.nama),(0,se.default)("div",{class:"text-sm text-blue-700 mt-1"},`Pimpinan: ${this.selectedSubPerangkatDaerah.pimpinan}`)]),(0,se.default)("button",{type:"button",class:"text-blue-600 hover:text-blue-800 p-2 rounded-full hover:bg-blue-100",onclick:()=>{this.selectedSubPerangkatDaerah=null,this.availablePencapaian=[],this.evaluasiList=[],this.filteredEvaluasi=[]}},[(0,se.default)("i",{class:"ri-close-fill"})])])]),(0,se.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",value:this.selectedSubPerangkatDaerah?._id||"",onchange:e=>{let r=e.target.value;this.selectedSubPerangkatDaerah=this.availableSubPerangkatDaerah.find(f=>f._id===r),this.loadPencapaianForEvaluation(r),this.availablePencapaian=[],r?this.loadEvaluasi(r,this.selectedPeriodYear!=="all"?this.selectedPeriodYear:null,this.selectedPeriodMonth!=="all"?this.selectedPeriodMonth:null):(this.evaluasiList=[],this.filteredEvaluasi=[]),se.default.redraw()}},[(0,se.default)("option",{value:""},"Pilih Unit Kerja"),(this.availableSubPerangkatDaerah||[]).map(e=>(0,se.default)("option",{value:e._id,key:e._id},e.nama))])]),(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,se.default)("i",{class:"ri-trophy-line mr-2 text-green-500"}),"Laporan Pencapaian"]),(0,se.default)("div",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700"},[(0,se.default)("div",{class:"flex items-center justify-between"},[(0,se.default)("span",`Jumlah Laporan: ${this.availablePencapaian.length}`),this.selectedSubPerangkatDaerah&&(0,se.default)("div",{class:"flex items-center space-x-2"},[(0,se.default)("i",{class:"ri-information-line text-blue-500"}),(0,se.default)("span",{class:"text-sm text-blue-600"},"Laporan siap dievaluasi")])])])])])]),this.selectedSubPerangkatDaerah&&(0,se.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,se.default)("div",{class:"grid grid-cols-1 md:grid-cols-5 gap-4"},[(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pencarian"),(0,se.default)("div",{class:"relative"},[(0,se.default)("input",{type:"text",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Cari subkegiatan atau catatan...",value:this.searchQuery,oninput:e=>{this.searchQuery=e.target.value,this.applyFilters()}}),(0,se.default)("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[(0,se.default)("i",{class:"ri-search-line text-gray-400"})])])]),(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Status"),(0,se.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:this.selectedStatus,onchange:e=>{this.selectedStatus=e.target.value,this.applyFilters()}},[(0,se.default)("option",{value:"all"},"Semua Status"),(0,se.default)("option",{value:"pending"},"Menunggu Evaluasi"),(0,se.default)("option",{value:"in_review"},"Sedang Ditinjau"),(0,se.default)("option",{value:"approved"},"Disetujui"),(0,se.default)("option",{value:"rejected"},"Ditolak"),(0,se.default)("option",{value:"revision_required"},"Perlu Revisi")])]),(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tahun"),(0,se.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:this.selectedPeriodYear,onchange:e=>{this.selectedPeriodYear=e.target.value,this.applyFilters()}},[(0,se.default)("option",{value:"all"},"Semua Tahun"),(0,se.default)("option",{value:"2024"},"2024"),(0,se.default)("option",{value:"2025"},"2025"),(0,se.default)("option",{value:"2026"},"2026")])]),(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Bulan"),(0,se.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:this.selectedPeriodMonth,onchange:e=>{this.selectedPeriodMonth=e.target.value,this.applyFilters()}},[(0,se.default)("option",{value:"all"},"Semua Bulan"),(0,se.default)("option",{value:"1"},"Januari"),(0,se.default)("option",{value:"2"},"Februari"),(0,se.default)("option",{value:"3"},"Maret"),(0,se.default)("option",{value:"4"},"April"),(0,se.default)("option",{value:"5"},"Mei"),(0,se.default)("option",{value:"6"},"Juni"),(0,se.default)("option",{value:"7"},"Juli"),(0,se.default)("option",{value:"8"},"Agustus"),(0,se.default)("option",{value:"9"},"September"),(0,se.default)("option",{value:"10"},"Oktober"),(0,se.default)("option",{value:"11"},"November"),(0,se.default)("option",{value:"12"},"Desember")])]),(0,se.default)("div",{class:"flex items-end"},[(0,se.default)("div",{class:"text-sm text-gray-600"},[(0,se.default)("div",`Menampilkan ${this.filteredEvaluasi.length} dari ${this.evaluasiList.length} evaluasi`),this.searchQuery&&(0,se.default)("div",{class:"text-blue-600"},`Pencarian: "${this.searchQuery}"`)])])])]),this.isLoading?(0,se.default)("div",{class:"flex justify-center items-center h-64"},[(0,se.default)("div",{class:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):this.selectedSubPerangkatDaerah?this.filteredEvaluasi.length===0?(0,se.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,se.default)("div",{class:"text-center py-12"},[(0,se.default)("div",{class:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-gray-100 mb-4"},[(0,se.default)("i",{class:"ri-clipboard-fill text-blue-500"})]),(0,se.default)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Belum ada data evaluasi"),(0,se.default)("p",{class:"text-gray-500 mb-6 max-w-sm mx-auto"},"Evaluasi kinerja tersedia setelah ada laporan pencapaian yang diajukan"),this.selectedSubPerangkatDaerah&&(0,se.default)("div",{class:"space-y-3"},[(0,se.default)("button",{class:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl",onclick:()=>this.openCreateModal()},[(0,se.default)("i",{class:"ri-add-line mr-2"}),"Buat Evaluasi"]),(0,se.default)("p",{class:"text-xs text-gray-500"},"Buat evaluasi baru untuk laporan pencapaian yang tersedia")])])]):(0,se.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,se.default)("div",{class:"overflow-x-auto"},[(0,se.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,se.default)("thead",{class:"bg-gray-50"},[(0,se.default)("tr",[(0,se.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"SubKegiatan"),(0,se.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Periode"),(0,se.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nilai"),(0,se.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Grade"),(0,se.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),(0,se.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,se.default)("tbody",{class:"bg-white divide-y divide-gray-200"},(this.getPaginatedEvaluasi()||[]).map(e=>[(0,se.default)("tr",{class:"hover:bg-gray-50"},[(0,se.default)("td",{class:"px-6 py-4"},[(0,se.default)("div",{class:"text-sm font-medium text-gray-900"},[(e.pencapaianId?.kinerjaId?.subKegiatanId?.kode||e.kinerjaId?.subKegiatanId?.kode)&&(0,se.default)("span",{class:"font-mono text-xs text-gray-500 mr-2"},e.pencapaianId?.kinerjaId?.subKegiatanId?.kode||e.kinerjaId?.subKegiatanId?.kode),e.pencapaianId?.kinerjaId?.subKegiatanId?.nama||e.kinerjaId?.subKegiatanId?.nama||"SubKegiatan tidak ditemukan"]),(0,se.default)("div",{class:"text-sm text-gray-500 mt-1"},[(0,se.default)("span",{class:"font-medium"},"Pencapaian: "),e.pencapaianId?.achievementValue?.toLocaleString("id-ID")||"N/A"])]),(0,se.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,se.default)("div",{class:"text-sm text-gray-900"},[(0,se.default)("div",{class:"font-semibold"},`${this.formatMonth(e.periodMonth)} ${e.periodYear}`)])]),(0,se.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,se.default)("div",{class:"text-sm text-center"},[(0,se.default)("div",{class:"grid grid-cols-3 gap-2 text-xs"},[(0,se.default)("div",[(0,se.default)("div",{class:"font-medium text-blue-600"},e.achievementScore||"-"),(0,se.default)("div",{class:"text-gray-500"},"Capaian")]),(0,se.default)("div",[(0,se.default)("div",{class:"font-medium text-green-600"},e.documentationScore||"-"),(0,se.default)("div",{class:"text-gray-500"},"Dokumen")]),(0,se.default)("div",[(0,se.default)("div",{class:"font-bold text-lg text-purple-600"},e.overallScore||"-"),(0,se.default)("div",{class:"text-gray-500"},"Total")])])])]),(0,se.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,se.default)("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${this.getGradeBadgeClass(e.performanceGrade)}`},this.getGradeText(e.performanceGrade))]),(0,se.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,se.default)("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${this.getStatusBadgeClass(e.evaluationStatus)}`},this.getStatusText(e.evaluationStatus))]),(0,se.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},[(0,se.default)("div",{class:"flex justify-end space-x-2"},[(0,se.default)("button",{class:"text-blue-600 hover:text-blue-900 p-1 rounded-full hover:bg-blue-50",onclick:()=>this.openEditModal(e),title:"Edit"},[(0,se.default)("i",{class:"ri-edit-line text-lg"})]),e.evaluationStatus==="in_review"&&(0,se.default)("button",{class:"text-green-600 hover:text-green-900 p-1 rounded-full hover:bg-green-50",onclick:()=>this.approveEvaluation(e),title:"Setujui"},[(0,se.default)("i",{class:"ri-check-line text-lg"})]),(e.evaluationStatus==="in_review"||e.evaluationStatus==="pending")&&(0,se.default)("button",{class:"text-red-600 hover:text-red-900 p-1 rounded-full hover:bg-red-50",onclick:()=>this.rejectEvaluation(e),title:"Tolak"},[(0,se.default)("i",{class:"ri-close-fill"})]),e.evaluationStatus==="in_review"&&(0,se.default)("button",{class:"text-orange-600 hover:text-orange-900 p-1 rounded-full hover:bg-orange-50",onclick:()=>this.requestRevision(e),title:"Minta Revisi"},[(0,se.default)("i",{class:"ri-refresh-line text-lg"})])])])])]))])]),this.getTotalPages()>1&&(0,se.default)("div",{class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},[(0,se.default)("div",{class:"flex-1 flex justify-between sm:hidden"},[(0,se.default)("button",{class:`relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${this.currentPage===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage-1),disabled:this.currentPage===1},"Sebelumnya"),(0,se.default)("button",{class:`ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ${this.currentPage===this.getTotalPages()?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage+1),disabled:this.currentPage===this.getTotalPages()},"Selanjutnya")]),(0,se.default)("div",{class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},[(0,se.default)("div",[(0,se.default)("p",{class:"text-sm text-gray-700"},["Menampilkan ",(0,se.default)("span",{class:"font-medium"},(this.currentPage-1)*this.itemsPerPage+1)," sampai ",(0,se.default)("span",{class:"font-medium"},Math.min(this.currentPage*this.itemsPerPage,this.filteredEvaluasi.length))," dari ",(0,se.default)("span",{class:"font-medium"},this.filteredEvaluasi.length)," hasil"])]),(0,se.default)("div",[(0,se.default)("nav",{class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px"},[(0,se.default)("button",{class:`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium ${this.currentPage===1?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage-1),disabled:this.currentPage===1},[(0,se.default)("i",{class:"ri-arrow-left-s-line"})]),Array.from({length:Math.min(5,this.getTotalPages()||0)},(e,r)=>{let f=Math.max(1,Math.min(this.getTotalPages()-4,this.currentPage-2))+r;return(0,se.default)("button",{class:`relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium ${f===this.currentPage?"z-10 bg-blue-50 border-blue-500 text-blue-600":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(f)},f)}),(0,se.default)("button",{class:`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium ${this.currentPage===this.getTotalPages()?"text-gray-300 cursor-not-allowed":"text-gray-500 hover:bg-gray-50"}`,onclick:()=>this.changePage(this.currentPage+1),disabled:this.currentPage===this.getTotalPages()},[(0,se.default)("i",{class:"ri-arrow-right-s-line"})])])])])])]):(0,se.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,se.default)("div",{class:"text-center py-12"},[(0,se.default)("div",{class:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4"},[(0,se.default)("i",{class:"ri-information-line text-blue-400 text-2xl"})]),(0,se.default)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Pilih Unit Kerja"),(0,se.default)("p",{class:"text-gray-500 max-w-md mx-auto"},"Pilih unit kerja untuk melihat semua evaluasi kinerja yang telah dibuat. Untuk membuat evaluasi baru, unit kerja harus memiliki laporan pencapaian yang telah diajukan.")])]),this.showModal&&(0,se.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onclick:e=>e.target===e.currentTarget&&this.closeModal()},[(0,se.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-6xl w-full mx-4 transform transition-all max-h-[95vh] overflow-y-auto",onclick:e=>e.stopPropagation()},[(0,se.default)("div",{class:`bg-gradient-to-r ${this.modalMode==="create"?"from-blue-500 to-purple-600":"from-green-500 to-blue-600"} text-white p-6 rounded-t-xl`},[(0,se.default)("div",{class:"flex items-center justify-between"},[(0,se.default)("div",{class:"flex items-center space-x-3"},[(0,se.default)("div",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center"},[(0,se.default)("i",{class:`ri-${this.modalMode==="create"?"add":"edit"}-line text-xl text-white`})]),(0,se.default)("div",[(0,se.default)("h3",{class:"text-xl font-bold"},[`${this.modalMode==="create"?"Buat":"Edit"} Evaluasi Kinerja`]),(0,se.default)("p",{class:"text-white text-opacity-80 text-sm"},[this.modalMode==="create"?"Evaluasi laporan pencapaian kinerja":"Perbarui evaluasi kinerja"])])]),(0,se.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeModal()},[(0,se.default)("i",{class:"ri-close-fill"})])])]),(0,se.default)("div",{class:"p-8"},[(0,se.default)("div",{class:"mb-8"},[(0,se.default)("h4",{class:"text-xl font-semibold text-gray-800 mb-6 flex items-center"},[(0,se.default)("i",{class:"ri-building-line mr-3 text-blue-500"}),"Pemilihan Unit dan Laporan"]),(0,se.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,se.default)("i",{class:"ri-building-line mr-2 text-blue-500"}),"Unit Kerja"]),this.modalMode==="edit"?[(0,se.default)("div",{class:"w-full px-4 py-3 border border-gray-200 rounded-lg bg-gray-50 text-gray-700"},this.selectedSubPerangkatDaerah?this.selectedSubPerangkatDaerah.nama:"Unit kerja tidak ditemukan")]:[(0,se.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",value:this.formData.subPerangkatDaerahId,onchange:e=>{this.formData.subPerangkatDaerahId=e.target.value,this.selectedSubPerangkatDaerah=this.availableSubPerangkatDaerah.find(r=>r._id===e.target.value),this.loadPencapaianForEvaluation(e.target.value),this.formData.pencapaianId=""},disabled:this.isModalLoading},[(0,se.default)("option",{value:""},"Pilih Unit Kerja"),(this.availableSubPerangkatDaerah||[]).map(e=>(0,se.default)("option",{value:e._id,key:e._id},e.nama))])]]),(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,se.default)("i",{class:"ri-trophy-line mr-2 text-green-500"}),"Laporan Pencapaian"]),this.modalMode==="edit"?[(0,se.default)("div",{class:"w-full px-4 py-3 border border-gray-200 rounded-lg bg-gray-50 text-gray-700"},"Laporan pencapaian yang dievaluasi")]:[(0,se.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white",value:this.formData.pencapaianId,onchange:e=>{this.formData.pencapaianId=e.target.value,e.target.value?this.loadPencapaianFiles(e.target.value):(this.selectedPencapaianFiles=[],this.clearPencapaianPdfPreview())},disabled:this.isModalLoading||!this.formData.subPerangkatDaerahId},[(0,se.default)("option",{value:""},"Pilih Laporan Pencapaian"),(this.availablePencapaian||[]).map(e=>(0,se.default)("option",{value:e._id,key:e._id},`${e.kinerjaId?.subKegiatanId?.nama} - ${this.formatMonth(e.periodMonth)} ${e.periodYear}`))])]])])]),this.formData.pencapaianId&&(0,se.default)("div",{class:"mb-8"},[(0,se.default)("h4",{class:"text-xl font-semibold text-gray-800 mb-6 flex items-center"},[(0,se.default)("i",{class:"ri-information-line mr-3 text-purple-500"}),"Detail Pencapaian"]),(0,se.default)("div",{class:"bg-purple-50 border border-purple-200 rounded-lg p-6"},[(0,se.default)("div",{class:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm"},[(0,se.default)("div",{class:"text-center"},[(0,se.default)("div",{class:"text-lg font-bold text-purple-600"},"Target"),(0,se.default)("div",{class:"text-gray-600"},"Nilai yang harus dicapai")]),(0,se.default)("div",{class:"text-center"},[(0,se.default)("div",{class:"text-lg font-bold text-blue-600"},"Aktual"),(0,se.default)("div",{class:"text-gray-600"},"Nilai yang dicapai")]),(0,se.default)("div",{class:"text-center"},[(0,se.default)("div",{class:"text-lg font-bold text-green-600"},"Capaian %"),(0,se.default)("div",{class:"text-gray-600"},"Persentase pencapaian")]),(0,se.default)("div",{class:"text-center"},[(0,se.default)("div",{class:"text-lg font-bold text-orange-600"},"Status"),(0,se.default)("div",{class:"text-gray-600"},"Status laporan")])])]),this.selectedPencapaianFiles.length>0&&(0,se.default)("div",{class:"mt-6"},[(0,se.default)("div",{class:"border-t border-purple-200 pt-6"},[(0,se.default)("h5",{class:"text-lg font-semibold text-gray-800 mb-4 flex items-center"},[(0,se.default)("i",{class:"ri-file-pdf-line mr-2 text-red-500"}),"Dokumen Bukti Pencapaian"]),this.pdfPreviewFile&&(0,se.default)("div",{class:"mb-4"},[(0,se.default)("div",{class:"bg-gray-50 rounded-lg p-4 border border-gray-200"},[(0,se.default)("div",{class:"flex items-center justify-between mb-3"},[(0,se.default)("h6",{class:"text-sm font-medium text-gray-700 flex items-center"},[(0,se.default)("i",{class:"ri-file-pdf-line text-red-500 mr-2"}),"Pratinjau PDF"]),(0,se.default)("div",{class:"flex space-x-2"},[(0,se.default)("button",{class:"text-blue-600 hover:text-blue-800 p-1 rounded-full hover:bg-blue-100",onclick:()=>this.openPencapaianPdfInNewTab(),title:"Buka di tab baru"},[(0,se.default)("i",{class:"ri-external-link-line text-sm"})]),(0,se.default)("button",{class:"text-gray-600 hover:text-gray-800 p-1 rounded-full hover:bg-gray-100",onclick:()=>this.clearPencapaianPdfPreview(),title:"Tutup pratinjau"},[(0,se.default)("i",{class:"ri-close-fill text-sm"})])])]),(0,se.default)("div",{class:"text-xs text-gray-600 mb-2"},[(0,se.default)("span",{class:"font-medium"},"File: "),this.pdfPreviewFile.name,(0,se.default)("br"),(0,se.default)("span",{class:"font-medium"},"Ukuran: "),this.formatPencapaianFileSize(this.pdfPreviewFile.size)]),this.isPdfLoading?(0,se.default)("div",{class:"flex items-center justify-center py-8"},[(0,se.default)("i",{class:"ri-loader-4-line text-2xl text-blue-500 animate-spin mr-2"}),(0,se.default)("span",{class:"text-sm text-gray-600"},"Memuat pratinjau...")]):(0,se.default)("div",{class:"bg-white border rounded-lg p-4 text-center"},[(0,se.default)("iframe",{src:this.pdfPreviewUrl,class:"w-full h-64 border-0 rounded",title:"PDF Preview"},""),(0,se.default)("p",{class:"text-xs text-gray-500 mt-2"},"Pratinjau dokumen bukti pencapaian")])])]),(0,se.default)("div",{class:"space-y-3"},[(0,se.default)("h6",{class:"text-sm font-medium text-gray-700"},"File yang tersedia:"),this.selectedPencapaianFiles.map(e=>(0,se.default)("div",{class:"flex items-center justify-between bg-gray-50 rounded-lg p-3 border border-gray-200",key:e.filename},[(0,se.default)("div",{class:"flex items-center space-x-3"},[(0,se.default)("i",{class:"ri-file-pdf-line text-red-500 text-lg"}),(0,se.default)("div",[(0,se.default)("div",{class:"text-sm font-medium text-gray-900"},e.originalName),(0,se.default)("div",{class:"text-xs text-gray-500"},[this.formatPencapaianFileSize(e.fileSize)," \u2022 ","Diunggah: ",new Intl.DateTimeFormat("id-ID",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e.uploadedAt))])])]),(0,se.default)("div",{class:"flex space-x-2"},[(e.originalName.toLowerCase().endsWith(".pdf")||e.filename.toLowerCase().endsWith(".pdf"))&&(0,se.default)("button",{class:"text-green-600 hover:text-green-800 p-1 rounded-full hover:bg-green-100",onclick:()=>this.previewPencapaianPdfFile(e),title:"Pratinjau PDF"},[(0,se.default)("i",{class:"ri-eye-line text-sm"})]),(0,se.default)("button",{class:"text-blue-600 hover:text-blue-800 p-1 rounded-full hover:bg-blue-100",onclick:()=>{let r=this.availablePencapaian.find(f=>f._id===this.formData.pencapaianId);r&&window.open(`/api/pencapaian/${r._id}/files/${e.filename}`,"_blank")},title:"Unduh"},[(0,se.default)("i",{class:"ri-download-line text-sm"})])])]))])])])]),(0,se.default)("div",{class:"mb-8"},[(0,se.default)("h4",{class:"text-xl font-semibold text-gray-800 mb-6 flex items-center"},[(0,se.default)("i",{class:"ri-star-line mr-3 text-orange-500"}),"Penilaian Evaluasi"]),(0,se.default)("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-6"},[(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,se.default)("i",{class:"ri-trophy-line mr-2 text-blue-500"}),"Nilai Pencapaian (0-100)"]),(0,se.default)("input",{type:"number",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Masukkan nilai pencapaian",value:this.formData.achievementScore,oninput:e=>{this.formData.achievementScore=e.target.value,this.formData.achievementScore&&this.formData.documentationScore&&(this.formData.overallScore=Math.round((parseFloat(this.formData.achievementScore)+parseFloat(this.formData.documentationScore))/2))},min:"0",max:"100",step:"0.1",disabled:this.isModalLoading})]),(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,se.default)("i",{class:"ri-file-text-line mr-2 text-green-500"}),"Nilai Dokumentasi (0-100)"]),(0,se.default)("input",{type:"number",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white",placeholder:"Masukkan nilai dokumentasi",value:this.formData.documentationScore,oninput:e=>{this.formData.documentationScore=e.target.value,this.formData.achievementScore&&this.formData.documentationScore&&(this.formData.overallScore=Math.round((parseFloat(this.formData.achievementScore)+parseFloat(this.formData.documentationScore))/2))},min:"0",max:"100",step:"0.1",disabled:this.isModalLoading})]),(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,se.default)("i",{class:"ri-calculator-line mr-2 text-purple-500"}),"Nilai Keseluruhan"]),(0,se.default)("input",{type:"number",class:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700",value:this.formData.overallScore,disabled:!0})])])]),(0,se.default)("div",{class:"mb-8"},[(0,se.default)("h4",{class:"text-xl font-semibold text-gray-800 mb-6 flex items-center"},[(0,se.default)("i",{class:"ri-file-text-line mr-3 text-gray-500"}),"Catatan Evaluasi"]),(0,se.default)("div",{class:"mb-6"},[(0,se.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},"Catatan Evaluator"),(0,se.default)("textarea",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 bg-white resize-vertical",placeholder:"Catatan dan feedback dari evaluator",value:this.formData.evaluationNotes,oninput:e=>this.formData.evaluationNotes=e.target.value,rows:4,disabled:this.isModalLoading})])]),(0,se.default)("div",{class:"mb-8"},[(0,se.default)("h4",{class:"text-xl font-semibold text-gray-800 mb-6 flex items-center"},[(0,se.default)("i",{class:"ri-feedback-line mr-3 text-blue-500"}),"Analisis dan Rekomendasi"]),(0,se.default)("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-6"},[(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,se.default)("i",{class:"ri-thumb-up-line mr-2 text-green-500"}),"Kekuatan"]),(0,se.default)("div",{class:"space-y-2"},[this.formData.strengths.map((e,r)=>(0,se.default)("div",{class:"flex items-center space-x-2",key:r},[(0,se.default)("input",{type:"text",class:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white",placeholder:"Kekuatan yang ditemukan",value:e,oninput:f=>this.updateArrayItem("strengths",r,f.target.value),disabled:this.isModalLoading}),this.formData.strengths.length>1&&(0,se.default)("button",{class:"text-red-500 hover:text-red-700 p-1",onclick:()=>this.removeArrayItem("strengths",r),disabled:this.isModalLoading},[(0,se.default)("i",{class:"ri-subtract-line"})])])),(0,se.default)("button",{class:"w-full px-3 py-2 border border-dashed border-gray-300 rounded-lg text-gray-500 hover:text-gray-700 hover:border-gray-400 transition-colors",onclick:()=>this.addArrayItem("strengths"),disabled:this.isModalLoading},[(0,se.default)("i",{class:"ri-add-line mr-2"}),"Tambah Kekuatan"])])]),(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,se.default)("i",{class:"ri-arrow-up-line mr-2 text-blue-500"}),"Area Perbaikan"]),(0,se.default)("div",{class:"space-y-2"},[this.formData.improvements.map((e,r)=>(0,se.default)("div",{class:"flex items-center space-x-2",key:r},[(0,se.default)("input",{type:"text",class:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",placeholder:"Area yang perlu diperbaiki",value:e,oninput:f=>this.updateArrayItem("improvements",r,f.target.value),disabled:this.isModalLoading}),this.formData.improvements.length>1&&(0,se.default)("button",{class:"text-red-500 hover:text-red-700 p-1",onclick:()=>this.removeArrayItem("improvements",r),disabled:this.isModalLoading},[(0,se.default)("i",{class:"ri-subtract-line"})])])),(0,se.default)("button",{class:"w-full px-3 py-2 border border-dashed border-gray-300 rounded-lg text-gray-500 hover:text-gray-700 hover:border-gray-400 transition-colors",onclick:()=>this.addArrayItem("improvements"),disabled:this.isModalLoading},[(0,se.default)("i",{class:"ri-add-line mr-2"}),"Tambah Area Perbaikan"])])]),(0,se.default)("div",[(0,se.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-3"},[(0,se.default)("i",{class:"ri-lightbulb-line mr-2 text-yellow-500"}),"Rekomendasi"]),(0,se.default)("div",{class:"space-y-2"},[this.formData.recommendations.map((e,r)=>(0,se.default)("div",{class:"flex items-center space-x-2",key:r},[(0,se.default)("input",{type:"text",class:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 bg-white",placeholder:"Rekomendasi untuk perbaikan",value:e,oninput:f=>this.updateArrayItem("recommendations",r,f.target.value),disabled:this.isModalLoading}),this.formData.recommendations.length>1&&(0,se.default)("button",{class:"text-red-500 hover:text-red-700 p-1",onclick:()=>this.removeArrayItem("recommendations",r),disabled:this.isModalLoading},[(0,se.default)("i",{class:"ri-subtract-line"})])])),(0,se.default)("button",{class:"w-full px-3 py-2 border border-dashed border-gray-300 rounded-lg text-gray-500 hover:text-gray-700 hover:border-gray-400 transition-colors",onclick:()=>this.addArrayItem("recommendations"),disabled:this.isModalLoading},[(0,se.default)("i",{class:"ri-add-line mr-2"}),"Tambah Rekomendasi"])])])])]),(0,se.default)("div",{class:"mb-8"},[(0,se.default)("h4",{class:"text-xl font-semibold text-gray-800 mb-6 flex items-center"},[(0,se.default)("i",{class:"ri-checkbox-line mr-3 text-green-500"}),"Checklist Kriteria"]),(0,se.default)("div",{class:"bg-gray-50 rounded-lg p-6 border border-gray-200"},[(0,se.default)("div",{class:"space-y-4"},[this.formData.criteriaChecklist.map((e,r)=>(0,se.default)("div",{class:"flex items-start space-x-3 p-3 bg-white rounded-lg border border-gray-200",key:r},[(0,se.default)("input",{type:"checkbox",class:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:e.isMet,onchange:f=>{this.formData.criteriaChecklist[r].isMet=f.target.checked},disabled:this.isModalLoading}),(0,se.default)("div",{class:"flex-1"},[(0,se.default)("div",{class:"font-medium text-gray-900"},e.criterion),(0,se.default)("textarea",{class:"w-full mt-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white resize-none",placeholder:"Catatan untuk kriteria ini",value:e.notes,oninput:f=>{this.formData.criteriaChecklist[r].notes=f.target.value},rows:2,disabled:this.isModalLoading})])]))])])])]),(0,se.default)("div",{class:"flex justify-end gap-4 pt-6 border-t border-gray-200 bg-gray-50 px-8 py-6 rounded-b-xl"},[(0,se.default)("button",{class:"px-8 py-3 bg-white hover:bg-gray-50 border border-gray-300 rounded-lg text-gray-700 font-medium transition-colors",onclick:()=>this.closeModal(),disabled:this.isModalLoading},[(0,se.default)("i",{class:"ri-close-fill mr-2"}),"Batal"]),(0,se.default)("button",{class:`px-8 py-3 ${this.isModalLoading?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700"} text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl`,disabled:this.isModalLoading,onclick:()=>this.saveItem()},[this.isModalLoading?(0,se.default)("i",{class:"ri-loader-4-line animate-spin mr-2"}):(0,se.default)("i",{class:"ri-save-line mr-2"}),this.isModalLoading?"Menyimpan...":"Simpan Evaluasi"])])])])])}},xi=No;var De=sr(lr(),1);var Bo={isLoading:!1,loadingEvaluations:!1,subPerangkatDaerahList:[],kinerjaList:[],anggaranList:[],subKegiatanList:[],kodeRekeningList:[],realisasiList:[],evaluasiList:[],selectedSubPerangkatDaerahId:"",selectedSubKegiatanId:"",selectedBudgetYear:"",currentSubKegiatanId:"",searchQuery:"",selectedMonth:new Date().getMonth()+1,selectedYear:new Date().getFullYear(),selectedEvaluationStatus:"",showModal:!1,modalMode:"create",isModalLoading:!1,evaluasiForm:{realisasiId:"",kodeRekeningId:"",budgetAmount:0,realizationAmount:0,absorptionRate:0,evaluationStatus:"",constraints:[],problems:[],solutions:[],recommendations:[],speedOfExecution:"",fundAbsorptionEfficiency:"",procurementCapability:"",generalNotes:""},formatCurrency:function(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e||0)},parseCurrencyInput:function(e){if(!e)return 0;let r=e.toString().replace(/Rp\s?/g,"").replace(/[.,]/g,"").replace(/\s+/g,"");return parseInt(r)||0},formatNumberInput:function(e){return e?new Intl.NumberFormat("id-ID").format(e):""},parseNumberInput:function(e){if(!e)return 0;let r=e.toString().replace(/[.,]/g,"");return parseInt(r)||0},oninit:function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),De.default.route.set("/login");return}this.vnode&&this.vnode.attrs&&this.vnode.attrs.setTitle&&this.vnode.attrs.setTitle("Evaluasi Realisasi Anggaran"),this.userData=et.getUserData(),this.userData.budgetYear&&typeof this.userData.budgetYear=="object"&&(this.userData.budgetYear=`${this.userData.budgetYear.year}-${this.userData.budgetYear.status}`),this.selectedBudgetYear=this.userData.budgetYear||"",this.loadInitialData()},loadInitialData:async function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),De.default.route.set("/login");return}this.isLoading=!0,De.default.redraw();try{let e=Ft.getToken();if(!e)throw new Error("No authentication token found");let r=await fetch("/api/subperangkatdaerah",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(r.ok){let f=await r.json();this.subPerangkatDaerahList=f.data||[]}be.success("Data berhasil dimuat")}catch(e){console.error("Error loading initial data:",e),e.message&&e.message.includes("401")?(be.warning("Sesi login telah berakhir. Silakan masuk kembali."),setTimeout(()=>De.default.route.set("/login"),2e3)):be.error("Gagal memuat data: "+(e.message||"Kesalahan tidak diketahui")),this.subPerangkatDaerahList=[]}finally{this.isLoading=!1,De.default.redraw()}},loadKinerjaData:async function(){if(!this.selectedSubPerangkatDaerahId){this.kinerjaList=[],this.anggaranList=[],this.subKegiatanList=[],this.kodeRekeningList=[],this.realisasiList=[],this.evaluasiList=[];return}this.loadingKinerja=!0,De.default.redraw();try{let e=Ft.getToken();if(!e)throw new Error("No authentication token found");let r=await fetch(`/api/kinerja?subPerangkatDaerahId=${this.selectedSubPerangkatDaerahId}&budgetYear=${encodeURIComponent(this.selectedBudgetYear)}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(r.ok){let f=await r.json();this.kinerjaList=f.data||[];let a=new Map,i=new Map;this.kinerjaList.forEach(t=>{t.anggaranId&&a.set(t.anggaranId._id.toString(),t.anggaranId),t.subKegiatanId&&i.set(t.subKegiatanId._id.toString(),t.subKegiatanId)}),this.anggaranList=Array.from(a.values()),this.subKegiatanList=Array.from(i.values()),this.anggaranList.length>0?be.success(`Data berhasil dimuat: ${this.anggaranList.length} anggaran, ${this.subKegiatanList.length} subkegiatan`):be.warning("Tidak ada data anggaran ditemukan untuk unit kerja ini")}else be.warning("Tidak ada data kinerja ditemukan untuk unit kerja ini")}catch(e){console.error("Error loading kinerja data:",e),be.error("Gagal memuat data kinerja"),this.kinerjaList=[],this.anggaranList=[],this.subKegiatanList=[]}finally{this.loadingKinerja=!1,De.default.redraw()}},loadEvaluasiData:async function(){if(!this.selectedSubKegiatanId){this.evaluasiList=[];return}this.loadingEvaluations=!0,De.default.redraw();try{let e=Ft.getToken();if(!e)throw new Error("No authentication token found");let r=await fetch(`/api/evaluasi-realisasi/subkegiatan/${this.selectedSubKegiatanId}?month=${this.selectedMonth}&year=${this.selectedYear}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(r.ok){let f=await r.json();this.evaluasiList=f.data||[],await this.loadRealisasiData(),be.success(`Data evaluasi berhasil dimuat: ${this.evaluasiList.length} evaluasi`)}else console.error("Failed to load evaluasi data, status:",r.status),this.evaluasiList=[]}catch(e){console.error("Error loading evaluasi data:",e),be.error("Gagal memuat data evaluasi"),this.evaluasiList=[]}finally{this.loadingEvaluations=!1,De.default.redraw()}},loadRealisasiData:async function(){if(!this.selectedSubKegiatanId){this.realisasiList=[];return}try{let e=Ft.getToken();if(!e)throw new Error("No authentication token found");let r=await fetch(`/api/realisasi?subKegiatanId=${this.selectedSubKegiatanId}&month=${this.selectedMonth}&year=${this.selectedYear}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(r.ok){let f=await r.json();this.realisasiList=f.data||[]}else this.realisasiList=[]}catch(e){console.error("Error loading realisasi data:",e),this.realisasiList=[]}},getEvaluationStatusLabel:function(e){return{excellent:{text:"Sangat Baik",color:"green"},good:{text:"Baik",color:"blue"},satisfactory:{text:"Cukup",color:"yellow"},poor:{text:"Kurang",color:"orange"},very_poor:{text:"Sangat Kurang",color:"red"}}[e]||{text:"Tidak Diketahui",color:"gray"}},getEvaluationStatusBadge:function(e){let r=this.getEvaluationStatusLabel(e);return(0,De.default)("span",{class:`px-2 py-1 text-xs font-medium rounded-full ${e==="excellent"?"bg-green-100 text-green-800":e==="good"?"bg-blue-100 text-blue-800":e==="satisfactory"?"bg-yellow-100 text-yellow-800":e==="poor"?"bg-orange-100 text-orange-800":e==="very_poor"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`},r.text)},getPerformanceLabel:function(e){return{very_fast:"Sangat Cepat",fast:"Cepat",moderate:"Sedang",slow:"Lambat",very_slow:"Sangat Lambat"}[e]||e},resetForm:function(){this.evaluasiForm={realisasiId:"",kodeRekeningId:"",budgetAmount:0,realizationAmount:0,absorptionRate:0,evaluationStatus:"",constraints:[],problems:[],solutions:[],recommendations:[],speedOfExecution:"",fundAbsorptionEfficiency:"",procurementCapability:"",generalNotes:""}},openCreateModal:function(e){this.modalMode="create",this.evaluasiForm={realisasiId:e._id,kodeRekeningId:e.kodeRekeningId,budgetAmount:e.budgetAmount||0,realizationAmount:e.realizationAmount||0,absorptionRate:e.budgetAmount>0?e.realizationAmount/e.budgetAmount*100:0,evaluationStatus:"",constraints:[],problems:[],solutions:[],recommendations:[],speedOfExecution:"",fundAbsorptionEfficiency:"",procurementCapability:"",generalNotes:""},this.showModal=!0},openEditModal:function(e){this.modalMode="edit",this.evaluasiForm={_id:e._id,realisasiId:e.realisasiId,kodeRekeningId:e.kodeRekeningId,budgetAmount:e.budgetAmount||0,realizationAmount:e.realizationAmount||0,absorptionRate:e.absorptionRate||0,evaluationStatus:e.evaluationStatus||"",constraints:e.constraints||[],problems:e.problems||[],solutions:e.solutions||[],recommendations:e.recommendations||[],speedOfExecution:e.speedOfExecution||"",fundAbsorptionEfficiency:e.fundAbsorptionEfficiency||"",procurementCapability:e.procurementCapability||"",generalNotes:e.generalNotes||""},this.showModal=!0},openViewModal:function(e){this.modalMode="view",this.evaluasiForm={_id:e._id,realisasiId:e.realisasiId,kodeRekeningId:e.kodeRekeningId,budgetAmount:e.budgetAmount||0,realizationAmount:e.realizationAmount||0,absorptionRate:e.absorptionRate||0,evaluationStatus:e.evaluationStatus||"",constraints:e.constraints||[],problems:e.problems||[],solutions:e.solutions||[],recommendations:e.recommendations||[],speedOfExecution:e.speedOfExecution||"",fundAbsorptionEfficiency:e.fundAbsorptionEfficiency||"",procurementCapability:e.procurementCapability||"",generalNotes:e.generalNotes||""},this.showModal=!0},closeModal:function(){this.showModal=!1,this.resetForm()},saveEvaluasi:async function(){if(!this.evaluasiForm.evaluationStatus||!this.evaluasiForm.speedOfExecution||!this.evaluasiForm.fundAbsorptionEfficiency||!this.evaluasiForm.procurementCapability){be.warning("Status evaluasi, kecepatan eksekusi, efisiensi absorpsi dana, dan kemampuan pengadaan harus diisi");return}this.isModalLoading=!0,De.default.redraw();try{let e=Ft.getToken();if(!e)throw new Error("No authentication token found");let r=this.modalMode==="edit"?"PUT":"POST",f=this.modalMode==="edit"?`/api/evaluasi-realisasi/${this.evaluasiForm._id}`:"/api/evaluasi-realisasi",a={realisasiId:this.evaluasiForm.realisasiId,kodeRekeningId:this.evaluasiForm.kodeRekeningId,subKegiatanId:this.selectedSubKegiatanId,subPerangkatDaerahId:this.selectedSubPerangkatDaerahId,month:this.selectedMonth,year:this.selectedYear,budgetAmount:this.evaluasiForm.budgetAmount,realizationAmount:this.evaluasiForm.realizationAmount,evaluationStatus:this.evaluasiForm.evaluationStatus,constraints:this.evaluasiForm.constraints.filter(n=>n.trim()!==""),problems:this.evaluasiForm.problems.filter(n=>n.trim()!==""),solutions:this.evaluasiForm.solutions.filter(n=>n.trim()!==""),recommendations:this.evaluasiForm.recommendations.filter(n=>n.trim()!==""),speedOfExecution:this.evaluasiForm.speedOfExecution,fundAbsorptionEfficiency:this.evaluasiForm.fundAbsorptionEfficiency,procurementCapability:this.evaluasiForm.procurementCapability,generalNotes:this.evaluasiForm.generalNotes},i=await fetch(f,{method:r,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok){let n=await i.json();throw new Error(n.message||`HTTP error! status: ${i.status}`)}let t=await i.json();be.success(`Evaluasi berhasil di${this.modalMode==="edit"?"perbarui":"simpan"}`),this.closeModal(),this.loadEvaluasiData()}catch(e){console.error("Error saving evaluasi:",e),be.error(`Gagal ${this.modalMode==="edit"?"memperbarui":"menyimpan"} evaluasi: `+(e.message||"Kesalahan tidak diketahui"))}finally{this.isModalLoading=!1,De.default.redraw()}},deleteEvaluasi:async function(e){showConfirmation("Apakah Anda yakin ingin menghapus evaluasi realisasi ini?",async()=>{try{let r=Ft.getToken();if(!r)throw new Error("No authentication token found");let f=await fetch(`/api/evaluasi-realisasi/${e._id}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(!f.ok){let a=await f.json();throw new Error(a.message||`HTTP error! status: ${f.status}`)}be.success("Evaluasi berhasil dihapus"),this.loadEvaluasiData()}catch(r){console.error("Error deleting evaluasi:",r),be.error("Gagal menghapus evaluasi: "+(r.message||"Kesalahan tidak diketahui"))}},()=>{be.info("Penghapusan dibatalkan")})},getMonthName:function(e){return["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][e-1]||"Tidak Valid"},view:function(){return(0,De.default)("div",{class:"space-y-6"},[(0,De.default)("div",{class:"flex justify-between items-center"},[(0,De.default)("div",[(0,De.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Evaluasi Realisasi Anggaran"),(0,De.default)("p",{class:"text-gray-600 mt-1"},"Evaluasi realisasi anggaran berdasarkan unit kerja dan subkegiatan")])]),(0,De.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[(0,De.default)("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Pilih Unit Kerja dan Subkegiatan"),(0,De.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},[(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,De.default)("i",{class:"ri-building-line mr-2 text-blue-500"}),"Unit Kerja"]),(0,De.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",value:this.selectedSubPerangkatDaerahId,onchange:e=>{this.selectedSubPerangkatDaerahId=e.target.value,this.selectedSubKegiatanId="",this.loadKinerjaData()},disabled:this.isLoading},[(0,De.default)("option",{value:""},this.isLoading?"Memuat...":"Pilih Unit Kerja"),this.subPerangkatDaerahList.map(e=>(0,De.default)("option",{value:e._id,key:e._id},`${e.nama} (${e.pimpinan})`))])]),(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,De.default)("i",{class:"ri-node-tree mr-2 text-green-500"}),"Subkegiatan"]),(0,De.default)("select",{class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white",value:this.selectedSubKegiatanId,onchange:e=>{this.selectedSubKegiatanId=e.target.value,this.loadEvaluasiData()},disabled:this.isLoading||!this.selectedSubPerangkatDaerahId||this.loadingKinerja},[(0,De.default)("option",{value:""},this.loadingKinerja?"Memuat...":"Pilih Subkegiatan"),this.subKegiatanList.map(e=>(0,De.default)("option",{value:e._id,key:e._id},`${e.kode} - ${e.nama}`))])]),(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,De.default)("i",{class:"ri-calendar-line mr-2 text-purple-500"}),"Periode"]),(0,De.default)("div",{class:"flex space-x-2"},[(0,De.default)("select",{class:"flex-1 px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white",value:this.selectedMonth,onchange:e=>{this.selectedMonth=parseInt(e.target.value),this.selectedSubKegiatanId&&this.loadEvaluasiData(),De.default.redraw()}},[Array.from({length:12},(e,r)=>r+1).map(e=>(0,De.default)("option",{value:e,key:e},this.getMonthName(e)))]),(0,De.default)("select",{class:"flex-1 px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white",value:this.selectedYear,onchange:e=>{this.selectedYear=parseInt(e.target.value),this.selectedSubKegiatanId&&this.loadEvaluasiData(),De.default.redraw()}},[Array.from({length:5},(e,r)=>new Date().getFullYear()+r).map(e=>(0,De.default)("option",{value:e,key:e},e))])])])])]),this.selectedSubKegiatanId&&(0,De.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,De.default)("div",{class:"px-6 py-4 border-b border-gray-200"},[(0,De.default)("div",{class:"flex justify-between items-center"},[(0,De.default)("div",[(0,De.default)("h3",{class:"text-lg font-semibold text-gray-800"},"Tabel Evaluasi Realisasi"),(0,De.default)("p",{class:"text-sm text-gray-600 mt-1"},["Periode: ",(0,De.default)("span",{class:"font-medium"},`${this.getMonthName(this.selectedMonth)} ${this.selectedYear}`)])]),(0,De.default)("button",{class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors flex items-center space-x-2",onclick:()=>{let e=this.realisasiList.filter(r=>!this.evaluasiList.some(f=>f.realisasiId===r._id));e.length>0?this.openCreateModal(e[0]):be.info("Semua realisasi sudah dievaluasi")}},[(0,De.default)("i",{class:"ri-add-line"}),(0,De.default)("span","Tambah Evaluasi")])])]),this.isLoading?(0,De.default)("div",{class:"flex justify-center items-center h-32"},[(0,De.default)("div",{class:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):this.loadingEvaluations&&this.selectedSubKegiatanId?(0,De.default)("div",{class:"flex justify-center items-center h-32"},[(0,De.default)("div",{class:"flex items-center space-x-3"},[(0,De.default)("div",{class:"w-6 h-6 border-4 border-green-500 border-t-transparent rounded-full animate-spin"}),(0,De.default)("span",{class:"text-gray-600"},"Memuat data evaluasi...")])]):(0,De.default)("div",{class:"overflow-x-auto"},[(0,De.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,De.default)("thead",{class:"bg-gray-50"},[(0,De.default)("tr",[(0,De.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Kode Rekening"),(0,De.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nama Rekening"),(0,De.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Anggaran"),(0,De.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Realisasi"),(0,De.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Absorpsi"),(0,De.default)("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),(0,De.default)("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,De.default)("tbody",{class:"bg-white divide-y divide-gray-200"},this.evaluasiList.length===0?(0,De.default)("tr",[(0,De.default)("td",{class:"px-6 py-12 text-center text-gray-500",colspan:"7"},[(0,De.default)("div",{class:"flex flex-col items-center space-y-2"},[(0,De.default)("i",{class:"ri-inbox-line text-4xl text-gray-300"}),(0,De.default)("p",{class:"text-sm"},"Belum ada evaluasi untuk periode ini"),(0,De.default)("p",{class:"text-xs text-gray-400"},"Pilih realisasi yang akan dievaluasi untuk menambah evaluasi baru")])])]):this.evaluasiList.map(e=>{let r=e.budgetAmount||0,f=e.realizationAmount||0,a=e.absorptionRate||0;return(0,De.default)("tr",{class:"hover:bg-gray-50"},[(0,De.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,De.default)("span",{class:"font-mono text-sm font-medium text-gray-900"},e.kodeRekeningId?.fullCode||"N/A")]),(0,De.default)("td",{class:"px-6 py-4"},[(0,De.default)("span",{class:"text-sm text-gray-900"},e.kodeRekeningId?.name||"N/A")]),(0,De.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right"},[(0,De.default)("span",{class:"text-sm font-semibold text-green-600"},this.formatCurrency(r))]),(0,De.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right"},[(0,De.default)("span",{class:"text-sm font-semibold text-blue-600"},this.formatCurrency(f))]),(0,De.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right"},[(0,De.default)("div",{class:"flex flex-col items-end"},[(0,De.default)("span",{class:`text-sm font-semibold ${a<80?"text-red-600":a<100?"text-yellow-600":"text-green-600"}`},`${a.toFixed(1)}%`),(0,De.default)("div",{class:"w-16 h-2 bg-gray-200 rounded-full mt-1"},[(0,De.default)("div",{class:`h-full rounded-full transition-all duration-300 ${a<80?"bg-red-500":a<100?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(100,a)}%`}})])])]),(0,De.default)("td",{class:"px-6 py-4 whitespace-nowrap text-center"},[this.getEvaluationStatusBadge(e.evaluationStatus)]),(0,De.default)("td",{class:"px-6 py-4 whitespace-nowrap text-center"},[(0,De.default)("div",{class:"flex justify-center space-x-2"},[(0,De.default)("button",{class:"text-purple-600 hover:text-purple-900 p-1 rounded-full hover:bg-purple-50",onclick:()=>this.openViewModal(e),title:"Lihat Detail Evaluasi"},[(0,De.default)("i",{class:"ri-eye-line text-sm"})]),(0,De.default)("button",{class:"text-green-600 hover:text-green-900 p-1 rounded-full hover:bg-green-50",onclick:()=>this.openEditModal(e),title:"Edit Evaluasi"},[(0,De.default)("i",{class:"ri-edit-line text-sm"})]),(0,De.default)("button",{class:"text-red-600 hover:text-red-900 p-1 rounded-full hover:bg-red-50",onclick:()=>this.deleteEvaluasi(e),title:"Hapus Evaluasi"},[(0,De.default)("i",{class:"ri-delete-bin-line text-sm"})])])])])}))])])]),this.renderForm()])},renderForm:function(){return this.showModal?(0,De.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onclick:e=>e.target===e.currentTarget&&this.closeModal()},[(0,De.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-screen overflow-y-auto",onclick:e=>e.stopPropagation()},[(0,De.default)("div",{class:"bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-t-xl"},[(0,De.default)("div",{class:"flex items-center justify-between"},[(0,De.default)("div",{class:"flex items-center space-x-3"},[(0,De.default)("div",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center"},[(0,De.default)("i",{class:`ri-${this.modalMode==="edit"?"edit":this.modalMode==="view"?"eye":"add"}-line text-xl text-white`})]),(0,De.default)("div",[(0,De.default)("h3",{class:"text-xl font-bold"},[`${this.modalMode==="edit"?"Edit":this.modalMode==="view"?"Lihat":"Input"} Evaluasi Realisasi`]),(0,De.default)("p",{class:"text-white text-opacity-80 text-sm"},"Formulir evaluasi realisasi anggaran")])]),(0,De.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeModal()},[(0,De.default)("i",{class:"ri-close-fill"})])])]),(0,De.default)("div",{class:"p-6"},[(0,De.default)("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},[(0,De.default)("div",{class:"space-y-6"},[(0,De.default)("h4",{class:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2"},"Informasi Dasar"),(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,De.default)("i",{class:"ri-hashtag mr-1 text-blue-500"}),"Kode Rekening"]),(0,De.default)("div",{class:"relative"},[(()=>{let e=this.evaluasiForm.kodeRekeningId;typeof e=="object"&&e!==null&&e._id&&(e=e._id);let r=this.kodeRekeningList.find(f=>f._id===e);return(0,De.default)("input",{type:"text",class:"w-full pl-4 pr-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-50 text-gray-700 font-medium",value:r?`${r.fullCode} - ${r.name}`:"Tidak ditemukan",disabled:!0})})(),(0,De.default)("div",{class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm"},this.formatCurrency(this.evaluasiForm.budgetAmount||0))])]),(0,De.default)("div",{class:"grid grid-cols-2 gap-4"},[(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Anggaran"),(0,De.default)("input",{type:"text",class:"w-full pl-4 pr-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-100 text-gray-700 font-medium text-right",value:this.formatCurrency(this.evaluasiForm.budgetAmount||0),disabled:!0})]),(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Realisasi"),(0,De.default)("input",{type:"text",class:"w-full pl-4 pr-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-100 text-gray-700 font-medium text-right",value:this.formatCurrency(this.evaluasiForm.realizationAmount||0),disabled:!0})])]),(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Tingkat Absorpsi Dana"),(0,De.default)("div",{class:"relative"},[(0,De.default)("input",{type:"text",class:"w-full pl-4 pr-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-100 text-gray-700 font-medium text-right",value:`${(this.evaluasiForm.absorptionRate||0).toFixed(1)}%`,disabled:!0}),(0,De.default)("div",{class:"absolute right-3 top-1/2 transform -translate-y-1/2 w-16 h-2 bg-gray-200 rounded-full"},[(0,De.default)("div",{class:`h-full rounded-full transition-all duration-300 ${(this.evaluasiForm.absorptionRate||0)<80?"bg-red-500":(this.evaluasiForm.absorptionRate||0)<100?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(100,this.evaluasiForm.absorptionRate||0)}%`}})])])]),(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,De.default)("i",{class:"ri-star-line mr-1 text-yellow-500"}),"Status Evaluasi"]),(0,De.default)("select",{class:`w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 ${this.modalMode==="view"?"bg-gray-100 text-gray-600":"bg-gray-50 focus:bg-white"}`,value:this.evaluasiForm.evaluationStatus||"",onchange:e=>{this.modalMode!=="view"&&(this.evaluasiForm.evaluationStatus=e.target.value)},disabled:this.isModalLoading||this.modalMode==="view"},[(0,De.default)("option",{value:""},"Pilih Status Evaluasi"),(0,De.default)("option",{value:"excellent"},"Sangat Baik"),(0,De.default)("option",{value:"good"},"Baik"),(0,De.default)("option",{value:"satisfactory"},"Cukup"),(0,De.default)("option",{value:"poor"},"Kurang"),(0,De.default)("option",{value:"very_poor"},"Sangat Kurang")])])]),(0,De.default)("div",{class:"space-y-6"},[(0,De.default)("h4",{class:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2"},"Indikator Kinerja"),(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,De.default)("i",{class:"ri-time-line mr-1 text-blue-500"}),"Kecepatan Eksekusi"]),(0,De.default)("select",{class:`w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 ${this.modalMode==="view"?"bg-gray-100 text-gray-600":"bg-gray-50 focus:bg-white"}`,value:this.evaluasiForm.speedOfExecution||"",onchange:e=>{this.modalMode!=="view"&&(this.evaluasiForm.speedOfExecution=e.target.value)},disabled:this.isModalLoading||this.modalMode==="view"},[(0,De.default)("option",{value:""},"Pilih Kecepatan Eksekusi"),(0,De.default)("option",{value:"very_fast"},"Sangat Cepat"),(0,De.default)("option",{value:"fast"},"Cepat"),(0,De.default)("option",{value:"moderate"},"Sedang"),(0,De.default)("option",{value:"slow"},"Lambat"),(0,De.default)("option",{value:"very_slow"},"Sangat Lambat")])]),(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,De.default)("i",{class:"ri-money-dollar-circle-line mr-1 text-green-500"}),"Efisiensi Absorpsi Dana"]),(0,De.default)("select",{class:`w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-200 ${this.modalMode==="view"?"bg-gray-100 text-gray-600":"bg-gray-50 focus:bg-white"}`,value:this.evaluasiForm.fundAbsorptionEfficiency||"",onchange:e=>{this.modalMode!=="view"&&(this.evaluasiForm.fundAbsorptionEfficiency=e.target.value)},disabled:this.isModalLoading||this.modalMode==="view"},[(0,De.default)("option",{value:""},"Pilih Efisiensi Absorpsi"),(0,De.default)("option",{value:"excellent"},"Sangat Efisien"),(0,De.default)("option",{value:"good"},"Efisien"),(0,De.default)("option",{value:"fair"},"Cukup Efisien"),(0,De.default)("option",{value:"poor"},"Kurang Efisien")])]),(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,De.default)("i",{class:"ri-shopping-cart-line mr-1 text-purple-500"}),"Kemampuan Pengadaan"]),(0,De.default)("select",{class:`w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200 ${this.modalMode==="view"?"bg-gray-100 text-gray-600":"bg-gray-50 focus:bg-white"}`,value:this.evaluasiForm.procurementCapability||"",onchange:e=>{this.modalMode!=="view"&&(this.evaluasiForm.procurementCapability=e.target.value)},disabled:this.isModalLoading||this.modalMode==="view"},[(0,De.default)("option",{value:""},"Pilih Kemampuan Pengadaan"),(0,De.default)("option",{value:"excellent"},"Sangat Baik"),(0,De.default)("option",{value:"good"},"Baik"),(0,De.default)("option",{value:"needs_improvement"},"Perlu Peningkatan"),(0,De.default)("option",{value:"poor"},"Kurang")])])])]),(0,De.default)("div",{class:"col-span-1 lg:col-span-2 space-y-6"},[(0,De.default)("h4",{class:"text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2"},"Analisis dan Rekomendasi"),(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,De.default)("i",{class:"ri-road-map-line mr-1 text-red-500"}),"Kendala yang Dihadapi (Non Teknis/Administratif)"]),(0,De.default)("div",{class:"space-y-2"},[(this.evaluasiForm.constraints||[]).map((e,r)=>(0,De.default)("div",{class:"flex items-center space-x-2"},[(0,De.default)("input",{type:"text",class:`flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-200 focus:border-red-500 ${this.modalMode==="view"?"bg-gray-100 text-gray-600":"bg-gray-50 focus:bg-white"}`,value:e,placeholder:"Masukkan kendala...",oninput:f=>{this.modalMode!=="view"&&(this.evaluasiForm.constraints[r]=f.target.value)},disabled:this.isModalLoading||this.modalMode==="view"}),this.modalMode!=="view"&&(0,De.default)("button",{class:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg",onclick:()=>{this.modalMode!=="view"&&(this.evaluasiForm.constraints.splice(r,1),De.default.redraw())}},[(0,De.default)("i",{class:"ri-delete-bin-line"})])])),this.modalMode!=="view"&&(0,De.default)("button",{class:"w-full px-4 py-2 border-2 border-dashed border-gray-300 text-gray-600 hover:text-gray-800 hover:border-gray-400 rounded-lg transition-colors flex items-center justify-center space-x-2",onclick:()=>{this.modalMode!=="view"&&(this.evaluasiForm.constraints||(this.evaluasiForm.constraints=[]),this.evaluasiForm.constraints.push(""),De.default.redraw())}},[(0,De.default)("i",{class:"ri-add-line"}),(0,De.default)("span","Tambah Kendala")])])]),(0,De.default)("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},[(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,De.default)("i",{class:"ri-error-warning-line mr-1 text-orange-500"}),"Masalah yang Ditemukan"]),(0,De.default)("div",{class:"space-y-2"},[(this.evaluasiForm.problems||[]).map((e,r)=>(0,De.default)("div",{class:"flex items-center space-x-2"},[(0,De.default)("input",{type:"text",class:`flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-200 focus:border-orange-500 ${this.modalMode==="view"?"bg-gray-100 text-gray-600":"bg-gray-50 focus:bg-white"}`,value:e,placeholder:"Masukkan masalah...",oninput:f=>{this.modalMode!=="view"&&(this.evaluasiForm.problems[r]=f.target.value)},disabled:this.isModalLoading||this.modalMode==="view"}),this.modalMode!=="view"&&(0,De.default)("button",{class:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg",onclick:()=>{this.modalMode!=="view"&&(this.evaluasiForm.problems.splice(r,1),De.default.redraw())}},[(0,De.default)("i",{class:"ri-delete-bin-line"})])])),this.modalMode!=="view"&&(0,De.default)("button",{class:"w-full px-4 py-2 border-2 border-dashed border-gray-300 text-gray-600 hover:text-gray-800 hover:border-gray-400 rounded-lg transition-colors flex items-center justify-center space-x-2",onclick:()=>{this.modalMode!=="view"&&(this.evaluasiForm.problems||(this.evaluasiForm.problems=[]),this.evaluasiForm.problems.push(""),De.default.redraw())}},[(0,De.default)("i",{class:"ri-add-line"}),(0,De.default)("span","Tambah Masalah")])])]),(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,De.default)("i",{class:"ri-lightbulb-line mr-1 text-green-500"}),"Solusi yang Diterapkan"]),(0,De.default)("div",{class:"space-y-2"},[(this.evaluasiForm.solutions||[]).map((e,r)=>(0,De.default)("div",{class:"flex items-center space-x-2"},[(0,De.default)("input",{type:"text",class:`flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-200 focus:border-green-500 ${this.modalMode==="view"?"bg-gray-100 text-gray-600":"bg-gray-50 focus:bg-white"}`,value:e,placeholder:"Masukkan solusi...",oninput:f=>{this.modalMode!=="view"&&(this.evaluasiForm.solutions[r]=f.target.value)},disabled:this.isModalLoading||this.modalMode==="view"}),this.modalMode!=="view"&&(0,De.default)("button",{class:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg",onclick:()=>{this.modalMode!=="view"&&(this.evaluasiForm.solutions.splice(r,1),De.default.redraw())}},[(0,De.default)("i",{class:"ri-delete-bin-line"})])])),this.modalMode!=="view"&&(0,De.default)("button",{class:"w-full px-4 py-2 border-2 border-dashed border-gray-300 text-gray-600 hover:text-gray-800 hover:border-gray-400 rounded-lg transition-colors flex items-center justify-center space-x-2",onclick:()=>{this.modalMode!=="view"&&(this.evaluasiForm.solutions||(this.evaluasiForm.solutions=[]),this.evaluasiForm.solutions.push(""),De.default.redraw())}},[(0,De.default)("i",{class:"ri-add-line"}),(0,De.default)("span","Tambah Solusi")])])])]),(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,De.default)("i",{class:"ri-feedback-line mr-1 text-blue-500"}),"Rekomendasi untuk Perbaikan"]),(0,De.default)("div",{class:"space-y-2"},[(this.evaluasiForm.recommendations||[]).map((e,r)=>(0,De.default)("div",{class:"flex items-center space-x-2"},[(0,De.default)("input",{type:"text",class:`flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200 focus:border-blue-500 ${this.modalMode==="view"?"bg-gray-100 text-gray-600":"bg-gray-50 focus:bg-white"}`,value:e,placeholder:"Masukkan rekomendasi...",oninput:f=>{this.modalMode!=="view"&&(this.evaluasiForm.recommendations[r]=f.target.value)},disabled:this.isModalLoading||this.modalMode==="view"}),this.modalMode!=="view"&&(0,De.default)("button",{class:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg",onclick:()=>{this.modalMode!=="view"&&(this.evaluasiForm.recommendations.splice(r,1),De.default.redraw())}},[(0,De.default)("i",{class:"ri-delete-bin-line"})])])),this.modalMode!=="view"&&(0,De.default)("button",{class:"w-full px-4 py-2 border-2 border-dashed border-gray-300 text-gray-600 hover:text-gray-800 hover:border-gray-400 rounded-lg transition-colors flex items-center justify-center space-x-2",onclick:()=>{this.modalMode!=="view"&&(this.evaluasiForm.recommendations||(this.evaluasiForm.recommendations=[]),this.evaluasiForm.recommendations.push(""),De.default.redraw())}},[(0,De.default)("i",{class:"ri-add-line"}),(0,De.default)("span","Tambah Rekomendasi")])])]),(0,De.default)("div",[(0,De.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,De.default)("i",{class:"ri-file-text-line mr-1 text-gray-500"}),"Catatan Tambahan"]),(0,De.default)("textarea",{class:`w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-gray-500 focus:ring-2 focus:ring-gray-200 transition-all duration-200 resize-none ${this.modalMode==="view"?"bg-gray-100 text-gray-600":"bg-gray-50 focus:bg-white"}`,placeholder:"Catatan tambahan mengenai evaluasi...",value:this.evaluasiForm.generalNotes||"",oninput:e=>{this.modalMode!=="view"&&(this.evaluasiForm.generalNotes=e.target.value)},rows:4,disabled:this.isModalLoading||this.modalMode==="view"})])])]),(0,De.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-xl"},[(0,De.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.closeModal(),disabled:this.isModalLoading},[(0,De.default)("i",{class:"ri-close-fill"}),(0,De.default)("span","Batal")]),this.modalMode!=="view"&&(0,De.default)("button",{class:`px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 ${this.isModalLoading?"opacity-50 cursor-not-allowed":""}`,onclick:()=>this.saveEvaluasi(),disabled:this.isModalLoading},[this.isModalLoading?(0,De.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,De.default)("i",{class:"ri-save-line"}),(0,De.default)("span",this.isModalLoading?"Menyimpan...":"Simpan")])])])]):null}},wi=Bo;var gt=sr(lr(),1);Wr();var Uo={oninit:function(){if(!et.isAuthenticated()){ct.warning("Silakan masuk terlebih dahulu"),gt.default.route.set("/login");return}this.userData=et.getUserData(),this.isLoading=!1,this.anggaranData=[],this.subKegiatanList=[],this.budgetYear="2026-Murni",console.log("\u{1F4C5} Using budget year that matches database:",this.budgetYear),this.selectedSubKegiatan="",this.loadSubKegiatanOptions(),this.loadData()},getSubKegiatanPlaceholder:function(){return this.noAnggaranData?"Tidak ada data anggaran - buat anggaran terlebih dahulu":this.apiFailed?"Gagal memuat data - periksa koneksi":this.subKegiatanList.length===0?"Memuat SubKegiatan...":"Semua SubKegiatan"},loadSubKegiatanOptions:async function(){try{let e=Ft.getToken();if(!e){console.log("\u274C No token available"),this.subKegiatanList=[],gt.default.redraw();return}console.log("\u{1F50D} STEP 1: Starting to load SubKegiatan options for budget year:",this.budgetYear),console.log("\u{1F4E1} STEP 2: Fetching Anggaran data from /api/anggaran?budgetYear="+this.budgetYear),console.log("\u{1F50D} Debug: Current budgetYear value:",this.budgetYear,"Type:",typeof this.budgetYear);let r=this.budgetYear;/^\d{4}$/.test(this.budgetYear)&&(r=`${this.budgetYear}-Murni`,console.log("\u{1F504} Converted budget year to:",r));let f=`/api/anggaran?budgetYear=${encodeURIComponent(r)}`;console.log("\u{1F4E1} Making request to:",f);let a=await fetch(f,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(console.log("\u{1F4CA} STEP 3: Anggaran API Response status:",a.status),a.ok){let i=await a.json(),t=i.data||[];if(console.log("\u{1F4CB} STEP 4: Found Anggaran documents:",t.length),console.log("\u{1F4C4} Full API response:",i),console.log("\u{1F4DD} Sample Anggaran document:",t[0]?{id:t[0]._id,budgetYear:t[0].budgetYear,subKegiatanId:t[0].subKegiatanId,status:t[0].status}:"No documents"),t.length>0){console.log("\u{1F50D} STEP 5: Extracting subKegiatanId from Anggaran documents...");let n=t.map(b=>{let x=b.subKegiatanId;return console.log("   - Anggaran ID:",b._id,"subKegiatanId:",x),typeof x=="object"&&x._id?(console.log("   - Extracting _id from populated object:",x._id),x._id):typeof x=="string"?(console.log("   - Using string ID:",x),x):(console.log("   - Unknown format:",typeof x,x),null)}).filter(b=>b);console.log("\u{1F3AF} STEP 6: Raw subKegiatanIds found:",n.length),console.log("\u{1F4DD} STEP 7: Unique subKegiatanIds:",[...new Set(n)].length),console.log("\u{1F50D} STEP 7.1: Actual IDs being matched:",n);let c=[...new Set(n)];if(c.length>0){console.log("\u{1F4E1} STEP 8: Fetching SubKegiatan from /api/subkegiatan");let b=await fetch("/api/subkegiatan",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(b.ok){let w=(await b.json()).data||[];console.log("\u{1F4CB} STEP 9: Loaded all SubKegiatan documents:",w.length);let g=w.filter(o=>{let u=c.includes(o._id);return u&&console.log("   \u2705 Matched SubKegiatan:",o.kode,o.nama),u});console.log("\u2705 STEP 10: Final filtered SubKegiatan count:",g.length),this.subKegiatanList=g}else console.error("\u274C STEP 11: Failed to load SubKegiatan, status:",b.status),this.subKegiatanList=[]}else console.log("\u26A0\uFE0F STEP 12: No valid subKegiatanIds found in Anggaran data"),console.log("\u{1F6AB} STEP 12.1: CORRECT BEHAVIOR - No SubKegiatan shown because no Anggaran exists"),console.log("\u{1F4A1} STEP 12.2: User should create Anggaran data first"),this.subKegiatanList=[],this.noAnggaranData=!0}else console.log("\u26A0\uFE0F STEP 13: No Anggaran data found for budget year:",this.budgetYear),console.log("\u{1F6AB} STEP 13.1: CORRECT BEHAVIOR - No SubKegiatan shown because no Anggaran exists"),console.log("\u{1F4A1} STEP 13.2: User should create Anggaran data first before viewing reports"),this.subKegiatanList=[],this.noAnggaranData=!0}else{console.error("\u274C STEP 14: Anggaran API failed with status:",a.status);let i=await a.text();console.error("\u274C Error response body:",i),console.log("\u{1F6AB} STEP 15: Anggaran API failed - cannot load SubKegiatan options"),this.subKegiatanList=[],this.apiFailed=!0}}catch(e){console.error("\u274C STEP 18: Error in loadSubKegiatanOptions:",e),this.subKegiatanList=[]}console.log("\u{1F3AF} FINAL RESULT: SubKegiatan list length:",this.subKegiatanList.length),console.log("\u{1F4CB} Sample of matched SubKegiatan:",this.subKegiatanList.slice(0,5).map(e=>({id:e._id,kode:e.kode,nama:e.nama}))),gt.default.redraw()},loadData:async function(){this.isLoading=!0,gt.default.redraw();try{let e=Ft.getToken();if(console.log("Token retrieved:",e?"Token exists":"No token",e?"Length: "+e.length:""),!e){ct.error("Token autentikasi tidak ditemukan");return}let r=new URLSearchParams,f=this.budgetYear;/^\d{4}$/.test(this.budgetYear)&&(f=`${this.budgetYear}-Murni`),r.append("budgetYear",f),this.selectedSubKegiatan&&r.append("subKegiatanId",this.selectedSubKegiatan),console.log("Making API request to:",`/api/anggaran?${r}`),console.log("Debug: Original budgetYear:",this.budgetYear,"Query budgetYear:",f);let a=await fetch(`/api/anggaran?${r}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(console.log("API Response status:",a.status,a.statusText),a.ok){let i=await a.json();console.log("API Response data length:",i.data?i.data.length:"No data"),this.anggaranData=i.data||[]}else{let i=await a.text();console.error("API Error response:",i),a.status===401?(ct.error("Sesi login telah berakhir. Silakan masuk kembali."),Ft.clearAuthData(),gt.default.route.set("/login")):ct.error(`Gagal memuat data anggaran: ${a.status}`)}}catch(e){console.error("Error loading anggaran data:",e),ct.error("Terjadi kesalahan saat memuat data")}this.isLoading=!1,gt.default.redraw()},formatCurrency:function(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},exportToCSV:function(){if(this.anggaranData.length===0){ct.warning("Tidak ada data untuk diekspor");return}let r=[["Kode SubKegiatan","Nama SubKegiatan","Kode Rekening","Nama Rekening","Jumlah","Status"].join(","),...this.anggaranData.map(t=>[t.subKegiatanId?.kode||"",t.subKegiatanId?.nama||"",t.allocations?.map(n=>n.kodeRekeningId?.kode||"").join("; ")||"",t.allocations?.map(n=>n.kodeRekeningId?.nama||"").join("; ")||"",t.totalAmount||0,t.status||""].join(","))].join(`
`),f=new Blob([r],{type:"text/csv"}),a=window.URL.createObjectURL(f),i=document.createElement("a");i.href=a,i.download=`laporan-anggaran-${this.budgetYear}.csv`,i.click(),window.URL.revokeObjectURL(a),ct.success("Laporan berhasil diekspor")},view:function(){return(0,gt.default)("div",{class:"space-y-6"},[(0,gt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6"},[(0,gt.default)("div",{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6"},[(0,gt.default)("div",[(0,gt.default)("h1",{class:"text-2xl font-bold text-gray-900 mb-2"},"Laporan Anggaran"),(0,gt.default)("p",{class:"text-gray-600"},"Laporan alokasi anggaran berdasarkan subkegiatan dan kode rekening")]),(0,gt.default)("div",{class:"flex items-center space-x-3 mt-4 sm:mt-0"},[(0,gt.default)("button",{class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2",onclick:()=>this.exportToCSV()},[(0,gt.default)("i",{class:"ri-download-line"}),(0,gt.default)("span","Ekspor CSV")])])]),(0,gt.default)("div",{class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[(0,gt.default)("div",[(0,gt.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tahun Anggaran"),(0,gt.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:this.budgetYear,onchange:e=>{this.budgetYear=e.target.value,this.selectedSubKegiatan="",this.loadSubKegiatanOptions(),this.loadData()}},[(0,gt.default)("option",{value:"2026"},"2026"),(0,gt.default)("option",{value:"2025"},"2025"),(0,gt.default)("option",{value:"2024"},"2024")])]),(0,gt.default)("div",[(0,gt.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},["SubKegiatan",this.subKegiatanList.length>0&&(0,gt.default)("span",{class:"text-xs text-green-600 ml-1"},`(${this.subKegiatanList.length} pilihan)`)]),(0,gt.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:this.selectedSubKegiatan,disabled:this.noAnggaranData||this.apiFailed,onchange:e=>{this.selectedSubKegiatan=e.target.value,this.loadData()}},[(0,gt.default)("option",{value:""},this.getSubKegiatanPlaceholder()),this.subKegiatanList.map(e=>(0,gt.default)("option",{value:e._id},`${e.kode} - ${e.nama}`))])])])]),(0,gt.default)("div",{class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6"},[(0,gt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-blue-500"},[(0,gt.default)("div",{class:"flex items-center"},[(0,gt.default)("div",{class:"p-2 bg-blue-100 rounded-lg"},[(0,gt.default)("i",{class:"ri-wallet-line text-xl text-blue-600"})]),(0,gt.default)("div",{class:"ml-4"},[(0,gt.default)("p",{class:"text-sm font-medium text-gray-600"},"Total Anggaran"),(0,gt.default)("p",{class:"text-2xl font-bold text-gray-900"},this.formatCurrency(this.anggaranData.reduce((e,r)=>e+r.totalAmount,0)))])])]),(0,gt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-green-500"},[(0,gt.default)("div",{class:"flex items-center"},[(0,gt.default)("div",{class:"p-2 bg-green-100 rounded-lg"},[(0,gt.default)("i",{class:"ri-file-list-line text-xl text-green-600"})]),(0,gt.default)("div",{class:"ml-4"},[(0,gt.default)("p",{class:"text-sm font-medium text-gray-600"},"Jumlah SubKegiatan"),(0,gt.default)("p",{class:"text-2xl font-bold text-gray-900"},this.anggaranData.length)])])]),(0,gt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-yellow-500"},[(0,gt.default)("div",{class:"flex items-center"},[(0,gt.default)("div",{class:"p-2 bg-yellow-100 rounded-lg"},[(0,gt.default)("i",{class:"ri-time-line text-xl text-yellow-600"})]),(0,gt.default)("div",{class:"ml-4"},[(0,gt.default)("p",{class:"text-sm font-medium text-gray-600"},"Status Draft"),(0,gt.default)("p",{class:"text-2xl font-bold text-gray-900"},this.anggaranData.filter(e=>e.status==="draft").length)])])]),(0,gt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-purple-500"},[(0,gt.default)("div",{class:"flex items-center"},[(0,gt.default)("div",{class:"p-2 bg-purple-100 rounded-lg"},[(0,gt.default)("i",{class:"ri-check-line text-xl text-purple-600"})]),(0,gt.default)("div",{class:"ml-4"},[(0,gt.default)("p",{class:"text-sm font-medium text-gray-600"},"Status Approved"),(0,gt.default)("p",{class:"text-2xl font-bold text-gray-900"},this.anggaranData.filter(e=>e.status==="approved").length)])])])]),(0,gt.default)("div",{class:"bg-white rounded-lg shadow-sm overflow-hidden"},[(0,gt.default)("div",{class:"px-6 py-4 border-b border-gray-200"},[(0,gt.default)("h3",{class:"text-lg font-medium text-gray-900"},"Detail Anggaran")]),(0,gt.default)("div",{class:"overflow-x-auto"},[this.isLoading?(0,gt.default)("div",{class:"p-8 text-center"},[(0,gt.default)("i",{class:"ri-loader-4-line animate-spin text-2xl text-gray-400 mb-2"}),(0,gt.default)("p",{class:"text-gray-500"},"Memuat data...")]):this.anggaranData.length===0?(0,gt.default)("div",{class:"p-8 text-center"},[(0,gt.default)("i",{class:"ri-inbox-line text-4xl text-gray-300 mb-2"}),(0,gt.default)("p",{class:"text-gray-500"},"Tidak ada data anggaran")]):(0,gt.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,gt.default)("thead",{class:"bg-gray-50"},[(0,gt.default)("tr",[(0,gt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"SubKegiatan"),(0,gt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Kode Rekening"),(0,gt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Jumlah"),(0,gt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),(0,gt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,gt.default)("tbody",{class:"bg-white divide-y divide-gray-200"},this.anggaranData.map(e=>[(0,gt.default)("tr",{class:"hover:bg-gray-50"},[(0,gt.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,gt.default)("div",{class:"text-sm font-medium text-gray-900"},e.subKegiatanId?.nama||""),(0,gt.default)("div",{class:"text-sm text-gray-500"},e.subKegiatanId?.kode||"")]),(0,gt.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,gt.default)("div",{class:"text-sm text-gray-900"},e.allocations?.map(r=>r.kodeRekeningId?.kode||"").join(", ")||"")]),(0,gt.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},this.formatCurrency(e.totalAmount||0)),(0,gt.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,gt.default)("span",{class:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${e.status==="approved"?"bg-green-100 text-green-800":e.status==="draft"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`},e.status||"draft")]),(0,gt.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},[(0,gt.default)("button",{class:"text-blue-600 hover:text-blue-900 mr-3",onclick:()=>gt.default.route.set(`/anggaran/${e._id}`)},[(0,gt.default)("i",{class:"ri-eye-line"})])])])]))])])])])}},ki=Uo;var tt=sr(lr(),1);var Co={oninit:function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),tt.default.route.set("/login");return}this.userData=et.getUserData(),this.isLoading=!1,this.realisasiData=[],this.subKegiatanList=[],this.budgetYear=new Date().getFullYear().toString(),this.selectedMonth=(new Date().getMonth()+1).toString(),this.selectedSubKegiatan="",this.loadSubKegiatanOptions(),this.loadData()},loadSubKegiatanOptions:async function(){try{let r=(await Ce.request(`/api/realisasi?year=${this.budgetYear}`)).data||[],f=[...new Set(r.map(a=>a.subKegiatanId?._id||a.subKegiatanId))];if(f.length>0){let a=subKegiatanResult.data||[];this.subKegiatanList=a.filter(i=>f.includes(i._id)),console.log(`Filtered SubKegiatan options (used in Realisasi ${this.budgetYear}):`,this.subKegiatanList.length)}else console.log("No Realisasi data found for year:",this.budgetYear),this.subKegiatanList=[]}catch(e){console.error("Error loading filtered SubKegiatan options for Realisasi:",e),this.subKegiatanList=[]}tt.default.redraw()},loadData:async function(){this.isLoading=!0,tt.default.redraw();try{let e=new URLSearchParams;e.append("year",this.budgetYear),e.append("month",this.selectedMonth),this.selectedSubKegiatan&&e.append("subKegiatanId",this.selectedSubKegiatan);let r=await Ce.request(`/api/realisasi?${e}`);this.realisasiData=r.data||[]}catch(e){console.error("Error loading realisasi data:",e),be.error("Terjadi kesalahan saat memuat data")}this.isLoading=!1,tt.default.redraw()},formatCurrency:function(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},formatPercentage:function(e){return`${Math.round(e)}%`},getPercentageColor:function(e){return e>=90?"text-green-600 bg-green-100":e>=70?"text-blue-600 bg-blue-100":e>=50?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100"},exportToCSV:function(){if(this.realisasiData.length===0){be.warning("Tidak ada data untuk diekspor");return}let r=[["SubKegiatan","Kode Rekening","Nama Rekening","Anggaran","Realisasi","Sisa","Persentase"].join(","),...this.realisasiData.map(t=>[t.subKegiatanId?.nama||"",t.kodeRekeningId?.kode||"",t.kodeRekeningId?.nama||"",t.budgetAmount||0,t.realizationAmount||0,t.remainingAmount||0,t.realizationPercentage||0].join(","))].join(`
`),f=new Blob([r],{type:"text/csv"}),a=window.URL.createObjectURL(f),i=document.createElement("a");i.href=a,i.download=`laporan-realisasi-${this.budgetYear}-${this.selectedMonth}.csv`,i.click(),window.URL.revokeObjectURL(a),be.success("Laporan berhasil diekspor")},view:function(){let e=this.realisasiData.reduce((a,i)=>a+i.budgetAmount,0),r=this.realisasiData.reduce((a,i)=>a+i.realizationAmount,0),f=e>0?r/e*100:0;return(0,tt.default)("div",{class:"space-y-6"},[(0,tt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6"},[(0,tt.default)("div",{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6"},[(0,tt.default)("div",[(0,tt.default)("h1",{class:"text-2xl font-bold text-gray-900 mb-2"},"Laporan Realisasi"),(0,tt.default)("p",{class:"text-gray-600"},"Laporan realisasi anggaran vs pencapaian aktual")]),(0,tt.default)("div",{class:"flex items-center space-x-3 mt-4 sm:mt-0"},[(0,tt.default)("button",{class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2",onclick:()=>this.exportToCSV()},[(0,tt.default)("i",{class:"ri-download-line"}),(0,tt.default)("span","Ekspor CSV")])])]),(0,tt.default)("div",{class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},[(0,tt.default)("div",[(0,tt.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tahun"),(0,tt.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:this.budgetYear,onchange:a=>{this.budgetYear=a.target.value,this.selectedSubKegiatan="",this.loadSubKegiatanOptions(),this.loadData()}},[(0,tt.default)("option",{value:"2026"},"2026"),(0,tt.default)("option",{value:"2025"},"2025"),(0,tt.default)("option",{value:"2024"},"2024")])]),(0,tt.default)("div",[(0,tt.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Bulan"),(0,tt.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:this.selectedMonth,onchange:a=>{this.selectedMonth=a.target.value,this.loadData()}},[(0,tt.default)("option",{value:"1"},"Januari"),(0,tt.default)("option",{value:"2"},"Februari"),(0,tt.default)("option",{value:"3"},"Maret"),(0,tt.default)("option",{value:"4"},"April"),(0,tt.default)("option",{value:"5"},"Mei"),(0,tt.default)("option",{value:"6"},"Juni"),(0,tt.default)("option",{value:"7"},"Juli"),(0,tt.default)("option",{value:"8"},"Agustus"),(0,tt.default)("option",{value:"9"},"September"),(0,tt.default)("option",{value:"10"},"Oktober"),(0,tt.default)("option",{value:"11"},"November"),(0,tt.default)("option",{value:"12"},"Desember")])]),(0,tt.default)("div",[(0,tt.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"SubKegiatan"),(0,tt.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:this.selectedSubKegiatan,onchange:a=>{this.selectedSubKegiatan=a.target.value,this.loadData()}},[(0,tt.default)("option",{value:""},"Semua SubKegiatan"),this.subKegiatanList.map(a=>(0,tt.default)("option",{value:a._id},`${a.kode} - ${a.nama}`))])])])]),(0,tt.default)("div",{class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6"},[(0,tt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-green-500"},[(0,tt.default)("div",{class:"flex items-center"},[(0,tt.default)("div",{class:"p-2 bg-green-100 rounded-lg"},[(0,tt.default)("i",{class:"ri-money-dollar-circle-line text-xl text-green-600"})]),(0,tt.default)("div",{class:"ml-4"},[(0,tt.default)("p",{class:"text-sm font-medium text-gray-600"},"Total Anggaran"),(0,tt.default)("p",{class:"text-2xl font-bold text-gray-900"},this.formatCurrency(e))])])]),(0,tt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-blue-500"},[(0,tt.default)("div",{class:"flex items-center"},[(0,tt.default)("div",{class:"p-2 bg-blue-100 rounded-lg"},[(0,tt.default)("i",{class:"ri-check-circle-line text-xl text-blue-600"})]),(0,tt.default)("div",{class:"ml-4"},[(0,tt.default)("p",{class:"text-sm font-medium text-gray-600"},"Total Realisasi"),(0,tt.default)("p",{class:"text-2xl font-bold text-gray-900"},this.formatCurrency(r))])])]),(0,tt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-yellow-500"},[(0,tt.default)("div",{class:"flex items-center"},[(0,tt.default)("div",{class:"p-2 bg-yellow-100 rounded-lg"},[(0,tt.default)("i",{class:"ri-wallet-line text-xl text-yellow-600"})]),(0,tt.default)("div",{class:"ml-4"},[(0,tt.default)("p",{class:"text-sm font-medium text-gray-600"},"Sisa Anggaran"),(0,tt.default)("p",{class:"text-2xl font-bold text-gray-900"},this.formatCurrency(e-r))])])]),(0,tt.default)("div",{class:`bg-white rounded-lg shadow-sm p-6 border-l-4 ${f>=90?"border-green-500":f>=70?"border-blue-500":f>=50?"border-yellow-500":"border-red-500"}`},[(0,tt.default)("div",{class:"flex items-center"},[(0,tt.default)("div",{class:`p-2 rounded-lg ${this.getPercentageColor(f).split(" ")[1]}`},[(0,tt.default)("i",{class:`ri-bar-chart-line text-xl ${this.getPercentageColor(f).split(" ")[0]}`})]),(0,tt.default)("div",{class:"ml-4"},[(0,tt.default)("p",{class:"text-sm font-medium text-gray-600"},"Rata-rata Pencapaian"),(0,tt.default)("p",{class:"text-2xl font-bold text-gray-900"},this.formatPercentage(f))])])])]),(0,tt.default)("div",{class:"bg-white rounded-lg shadow-sm overflow-hidden"},[(0,tt.default)("div",{class:"px-6 py-4 border-b border-gray-200"},[(0,tt.default)("h3",{class:"text-lg font-medium text-gray-900"},"Detail Realisasi")]),(0,tt.default)("div",{class:"overflow-x-auto"},[this.isLoading?(0,tt.default)("div",{class:"p-8 text-center"},[(0,tt.default)("i",{class:"ri-loader-4-line animate-spin text-2xl text-gray-400 mb-2"}),(0,tt.default)("p",{class:"text-gray-500"},"Memuat data...")]):this.realisasiData.length===0?(0,tt.default)("div",{class:"p-8 text-center"},[(0,tt.default)("i",{class:"ri-inbox-line text-4xl text-gray-300 mb-2"}),(0,tt.default)("p",{class:"text-gray-500"},"Tidak ada data realisasi")]):(0,tt.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,tt.default)("thead",{class:"bg-gray-50"},[(0,tt.default)("tr",[(0,tt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"SubKegiatan"),(0,tt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Kode Rekening"),(0,tt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Anggaran"),(0,tt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Realisasi"),(0,tt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Sisa"),(0,tt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Pencapaian"),(0,tt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,tt.default)("tbody",{class:"bg-white divide-y divide-gray-200"},this.realisasiData.map(a=>[(0,tt.default)("tr",{class:"hover:bg-gray-50"},[(0,tt.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,tt.default)("div",{class:"text-sm font-medium text-gray-900"},a.subKegiatanId?.nama||""),(0,tt.default)("div",{class:"text-sm text-gray-500"},a.subKegiatanId?.kode||"")]),(0,tt.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,tt.default)("div",{class:"text-sm font-medium text-gray-900"},a.kodeRekeningId?.kode||""),(0,tt.default)("div",{class:"text-sm text-gray-500"},a.kodeRekeningId?.nama||"")]),(0,tt.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},this.formatCurrency(a.budgetAmount||0)),(0,tt.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},this.formatCurrency(a.realizationAmount||0)),(0,tt.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},this.formatCurrency(a.remainingAmount||0)),(0,tt.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,tt.default)("div",{class:"flex items-center"},[(0,tt.default)("div",{class:"flex-1 bg-gray-200 rounded-full h-2 mr-3"},[(0,tt.default)("div",{class:"h-2 rounded-full",style:`width: ${Math.min(100,a.realizationPercentage||0)}%; background-color: ${a.realizationPercentage>=90?"#10b981":a.realizationPercentage>=70?"#3b82f6":a.realizationPercentage>=50?"#f59e0b":"#ef4444"};`})]),(0,tt.default)("span",{class:`text-sm font-medium ${this.getPercentageColor(a.realizationPercentage||0).split(" ")[0]}`},this.formatPercentage(a.realizationPercentage||0))])]),(0,tt.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},[(0,tt.default)("button",{class:"text-blue-600 hover:text-blue-900",onclick:()=>tt.default.route.set(`/realisasi/${a._id}`)},[(0,tt.default)("i",{class:"ri-eye-line"})])])])]))])])])])}},Si=Co;var nt=sr(lr(),1);Wr();var Vo={oninit:function(){if(!et.isAuthenticated()){ct.warning("Silakan masuk terlebih dahulu"),nt.default.route.set("/login");return}this.userData=et.getUserData(),this.isLoading=!1,this.kinerjaData=[],this.subPerangkatDaerahList=[],this.budgetYear=new Date().getFullYear().toString(),this.selectedSubPerangkatDaerah="",this.selectedStatus="",this.loadSubPerangkatDaerahOptions(),this.loadData()},loadSubPerangkatDaerahOptions:async function(){try{let e=Ft.getToken();if(!e)return;let r=await fetch(`/api/kinerja?budgetYear=${this.budgetYear}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(r.ok){let a=(await r.json()).data||[],i=[...new Set(a.map(t=>t.subPerangkatDaerahId?._id||t.subPerangkatDaerahId))];if(i.length>0){let t=await fetch("/api/subperangkatdaerah",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(t.ok){let c=(await t.json()).data||[];this.subPerangkatDaerahList=c.filter(b=>i.includes(b._id)),console.log(`Filtered SubPerangkatDaerah options (used in Kinerja ${this.budgetYear}):`,this.subPerangkatDaerahList.length)}else console.error("Failed to load all SubPerangkatDaerah for Kinerja:",t.status)}else console.log("No Kinerja data found for budget year:",this.budgetYear),this.subPerangkatDaerahList=[]}else console.error("Failed to load Kinerja data for filtering:",r.status),this.subPerangkatDaerahList=[]}catch(e){console.error("Error loading filtered SubPerangkatDaerah options for Kinerja:",e),this.subPerangkatDaerahList=[]}nt.default.redraw()},loadData:async function(){this.isLoading=!0,nt.default.redraw();try{let e=Ft.getToken();if(!e){ct.error("Token autentikasi tidak ditemukan");return}let r=new URLSearchParams;r.append("budgetYear",this.budgetYear),this.selectedSubPerangkatDaerah&&r.append("subPerangkatDaerahId",this.selectedSubPerangkatDaerah),this.selectedStatus&&r.append("status",this.selectedStatus);let f=await fetch(`/api/kinerja?${r}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(f.ok){let a=await f.json();this.kinerjaData=a.data||[]}else ct.error("Gagal memuat data kinerja")}catch(e){console.error("Error loading kinerja data:",e),ct.error("Terjadi kesalahan saat memuat data")}this.isLoading=!1,nt.default.redraw()},formatCurrency:function(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},formatPercentage:function(e){return`${Math.round(e)}%`},getPercentageColor:function(e){return e>=90?"text-green-600 bg-green-100":e>=70?"text-blue-600 bg-blue-100":e>=50?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100"},getStatusColor:function(e){switch(e){case"completed":return"bg-green-100 text-green-800";case"in_progress":return"bg-blue-100 text-blue-800";case"planning":return"bg-gray-100 text-gray-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},getPriorityColor:function(e){switch(e){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},exportToCSV:function(){if(this.kinerjaData.length===0){ct.warning("Tidak ada data untuk diekspor");return}let r=[["SubKegiatan","Unit Kerja","Target","Aktual","Pencapaian","Status","Prioritas","Target Date"].join(","),...this.kinerjaData.map(t=>[t.subKegiatanId?.nama||"",t.subPerangkatDaerahId?.nama||"",t.targetValue||0,t.actualValue||0,t.achievementPercentage||0,t.status||"",t.priority||"",t.targetDate?new Date(t.targetDate).toLocaleDateString("id-ID"):""].join(","))].join(`
`),f=new Blob([r],{type:"text/csv"}),a=window.URL.createObjectURL(f),i=document.createElement("a");i.href=a,i.download=`laporan-kinerja-${this.budgetYear}.csv`,i.click(),window.URL.revokeObjectURL(a),ct.success("Laporan berhasil diekspor")},view:function(){let e=this.kinerjaData.reduce((t,n)=>t+(n.targetValue||0),0),r=this.kinerjaData.reduce((t,n)=>t+(n.actualValue||0),0),f=e>0?r/e*100:0,a=this.kinerjaData.filter(t=>t.status==="completed").length,i=this.kinerjaData.filter(t=>t.status!=="completed"&&t.targetDate&&new Date(t.targetDate)<new Date).length;return(0,nt.default)("div",{class:"space-y-6"},[(0,nt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6"},[(0,nt.default)("div",{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6"},[(0,nt.default)("div",[(0,nt.default)("h1",{class:"text-2xl font-bold text-gray-900 mb-2"},"Laporan Kinerja"),(0,nt.default)("p",{class:"text-gray-600"},"Laporan pencapaian target kinerja per subkegiatan")]),(0,nt.default)("div",{class:"flex items-center space-x-3 mt-4 sm:mt-0"},[(0,nt.default)("button",{class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2",onclick:()=>this.exportToCSV()},[(0,nt.default)("i",{class:"ri-download-line"}),(0,nt.default)("span","Ekspor CSV")])])]),(0,nt.default)("div",{class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},[(0,nt.default)("div",[(0,nt.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tahun Anggaran"),(0,nt.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:this.budgetYear,onchange:t=>{this.budgetYear=t.target.value,this.selectedSubPerangkatDaerah="",this.loadSubPerangkatDaerahOptions(),this.loadData()}},[(0,nt.default)("option",{value:"2026"},"2026"),(0,nt.default)("option",{value:"2025"},"2025"),(0,nt.default)("option",{value:"2024"},"2024")])]),(0,nt.default)("div",[(0,nt.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Unit Kerja"),(0,nt.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:this.selectedSubPerangkatDaerah,onchange:t=>{this.selectedSubPerangkatDaerah=t.target.value,this.loadData()}},[(0,nt.default)("option",{value:""},"Semua Unit Kerja"),this.subPerangkatDaerahList.map(t=>(0,nt.default)("option",{value:t._id},`${t.kode} - ${t.nama}`))])]),(0,nt.default)("div",[(0,nt.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Status"),(0,nt.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:this.selectedStatus,onchange:t=>{this.selectedStatus=t.target.value,this.loadData()}},[(0,nt.default)("option",{value:""},"Semua Status"),(0,nt.default)("option",{value:"planning"},"Planning"),(0,nt.default)("option",{value:"in_progress"},"In Progress"),(0,nt.default)("option",{value:"completed"},"Completed"),(0,nt.default)("option",{value:"cancelled"},"Cancelled")])])])]),(0,nt.default)("div",{class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6"},[(0,nt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-blue-500"},[(0,nt.default)("div",{class:"flex items-center"},[(0,nt.default)("div",{class:"p-2 bg-blue-100 rounded-lg"},[(0,nt.default)("i",{class:"ri-line-chart-line text-xl text-blue-600"})]),(0,nt.default)("div",{class:"ml-4"},[(0,nt.default)("p",{class:"text-sm font-medium text-gray-600"},"Total Kegiatan"),(0,nt.default)("p",{class:"text-2xl font-bold text-gray-900"},this.kinerjaData.length)])])]),(0,nt.default)("div",{class:`bg-white rounded-lg shadow-sm p-6 border-l-4 ${f>=90?"border-green-500":f>=70?"border-blue-500":"border-yellow-500"}`},[(0,nt.default)("div",{class:"flex items-center"},[(0,nt.default)("div",{class:`p-2 rounded-lg ${this.getPercentageColor(f).split(" ")[1]}`},[(0,nt.default)("i",{class:`ri-bar-chart-line text-xl ${this.getPercentageColor(f).split(" ")[0]}`})]),(0,nt.default)("div",{class:"ml-4"},[(0,nt.default)("p",{class:"text-sm font-medium text-gray-600"},"Rata-rata Pencapaian"),(0,nt.default)("p",{class:"text-2xl font-bold text-gray-900"},this.formatPercentage(f))])])]),(0,nt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-green-500"},[(0,nt.default)("div",{class:"flex items-center"},[(0,nt.default)("div",{class:"p-2 bg-green-100 rounded-lg"},[(0,nt.default)("i",{class:"ri-check-circle-line text-xl text-green-600"})]),(0,nt.default)("div",{class:"ml-4"},[(0,nt.default)("p",{class:"text-sm font-medium text-gray-600"},"Selesai"),(0,nt.default)("p",{class:"text-2xl font-bold text-gray-900"},a)])])]),(0,nt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-red-500"},[(0,nt.default)("div",{class:"flex items-center"},[(0,nt.default)("div",{class:"p-2 bg-red-100 rounded-lg"},[(0,nt.default)("i",{class:"ri-time-line text-xl text-red-600"})]),(0,nt.default)("div",{class:"ml-4"},[(0,nt.default)("p",{class:"text-sm font-medium text-gray-600"},"Terlambat"),(0,nt.default)("p",{class:"text-2xl font-bold text-gray-900"},i)])])])]),(0,nt.default)("div",{class:"bg-white rounded-lg shadow-sm overflow-hidden"},[(0,nt.default)("div",{class:"px-6 py-4 border-b border-gray-200"},[(0,nt.default)("h3",{class:"text-lg font-medium text-gray-900"},"Detail Kinerja")]),(0,nt.default)("div",{class:"overflow-x-auto"},[this.isLoading?(0,nt.default)("div",{class:"p-8 text-center"},[(0,nt.default)("i",{class:"ri-loader-4-line animate-spin text-2xl text-gray-400 mb-2"}),(0,nt.default)("p",{class:"text-gray-500"},"Memuat data...")]):this.kinerjaData.length===0?(0,nt.default)("div",{class:"p-8 text-center"},[(0,nt.default)("i",{class:"ri-inbox-line text-4xl text-gray-300 mb-2"}),(0,nt.default)("p",{class:"text-gray-500"},"Tidak ada data kinerja")]):(0,nt.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,nt.default)("thead",{class:"bg-gray-50"},[(0,nt.default)("tr",[(0,nt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"SubKegiatan"),(0,nt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Unit Kerja"),(0,nt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Target"),(0,nt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aktual"),(0,nt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Pencapaian"),(0,nt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),(0,nt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Prioritas"),(0,nt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Target Date"),(0,nt.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,nt.default)("tbody",{class:"bg-white divide-y divide-gray-200"},this.kinerjaData.map(t=>[(0,nt.default)("tr",{class:"hover:bg-gray-50"},[(0,nt.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,nt.default)("div",{class:"text-sm font-medium text-gray-900"},t.subKegiatanId?.nama||""),(0,nt.default)("div",{class:"text-sm text-gray-500"},t.subKegiatanId?.kode||"")]),(0,nt.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},t.subPerangkatDaerahId?.nama||""),(0,nt.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},t.targetValue?.toLocaleString("id-ID")||"0"),(0,nt.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},t.actualValue?.toLocaleString("id-ID")||"0"),(0,nt.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,nt.default)("div",{class:"flex items-center"},[(0,nt.default)("div",{class:"flex-1 bg-gray-200 rounded-full h-2 mr-3"},[(0,nt.default)("div",{class:"h-2 rounded-full",style:`width: ${Math.min(100,t.achievementPercentage||0)}%; background-color: ${t.achievementPercentage>=90?"#10b981":t.achievementPercentage>=70?"#3b82f6":t.achievementPercentage>=50?"#f59e0b":"#ef4444"};`})]),(0,nt.default)("span",{class:`text-sm font-medium ${this.getPercentageColor(t.achievementPercentage||0).split(" ")[0]}`},this.formatPercentage(t.achievementPercentage||0))])]),(0,nt.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,nt.default)("span",{class:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${this.getStatusColor(t.status)}`},t.status||"planning")]),(0,nt.default)("td",{class:"px-6 py-4 whitespace-nowrap"},[(0,nt.default)("span",{class:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${this.getPriorityColor(t.priority)}`},t.priority||"medium")]),(0,nt.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},[t.targetDate?new Date(t.targetDate).toLocaleDateString("id-ID"):"-"]),(0,nt.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},[(0,nt.default)("button",{class:"text-blue-600 hover:text-blue-900",onclick:()=>nt.default.route.set(`/kinerja/${t._id}`)},[(0,nt.default)("i",{class:"ri-eye-line"})])])])]))])])])])}},Pi=Vo;var rt=sr(lr(),1);Wr();var qo={oninit:function(){if(!et.isAuthenticated()){ct.warning("Silakan masuk terlebih dahulu"),rt.default.route.set("/login");return}this.userData=et.getUserData(),this.isLoading=!1,this.consolidatedData={anggaran:[],realisasi:[],kinerja:[]},this.budgetYear=new Date().getFullYear().toString(),this.selectedQuarter="",this.reportType="summary",this.loadData()},loadData:async function(){this.isLoading=!0,rt.default.redraw();try{let e=Ft.getToken();if(!e){ct.error("Token autentikasi tidak ditemukan");return}let[r,f,a]=await Promise.all([fetch(`/api/anggaran?budgetYear=${this.budgetYear}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),fetch(`/api/realisasi?year=${this.budgetYear}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),fetch(`/api/kinerja?budgetYear=${this.budgetYear}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})]);if(r.ok){let i=await r.json();this.consolidatedData.anggaran=i.data||[]}if(f.ok){let i=await f.json();this.consolidatedData.realisasi=i.data||[]}if(a.ok){let i=await a.json();this.consolidatedData.kinerja=i.data||[]}}catch(e){console.error("Error loading consolidated data:",e),ct.error("Terjadi kesalahan saat memuat data")}this.isLoading=!1,rt.default.redraw()},formatCurrency:function(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},formatPercentage:function(e){return`${Math.round(e)}%`},getBudgetSummary:function(){let e=this.consolidatedData.anggaran.reduce((a,i)=>a+i.totalAmount,0),r=this.consolidatedData.anggaran.filter(a=>a.status==="approved").reduce((a,i)=>a+i.totalAmount,0),f=this.consolidatedData.anggaran.filter(a=>a.status==="draft").reduce((a,i)=>a+i.totalAmount,0);return{totalBudget:e,approvedBudget:r,draftBudget:f}},getRealizationSummary:function(){let e=this.consolidatedData.realisasi.reduce((a,i)=>a+i.budgetAmount,0),r=this.consolidatedData.realisasi.reduce((a,i)=>a+i.realizationAmount,0),f=e>0?r/e*100:0;return{totalBudget:e,totalRealization:r,avgPercentage:f}},getKinerjaSummary:function(){let e=this.consolidatedData.kinerja.reduce((t,n)=>t+(n.targetValue||0),0),r=this.consolidatedData.kinerja.reduce((t,n)=>t+(n.actualValue||0),0),f=e>0?r/e*100:0,a=this.consolidatedData.kinerja.filter(t=>t.status==="completed").length,i=this.consolidatedData.kinerja.filter(t=>t.status==="in_progress").length;return{totalTarget:e,totalActual:r,avgPercentage:f,completedCount:a,inProgressCount:i}},exportToCSV:function(){let e=this.getBudgetSummary(),r=this.getRealizationSummary(),f=this.getKinerjaSummary(),i=[["Kategori","Total Budget","Realisasi/Pencapaian","Persentase","Status"].join(","),["ANGGARAN TOTAL",e.totalBudget,e.totalBudget,"100%","Total"],["ANGGARAN APPROVED",e.approvedBudget,e.approvedBudget,this.formatPercentage(e.approvedBudget/e.totalBudget*100),"Approved"],["ANGGARAN DRAFT",e.draftBudget,e.draftBudget,this.formatPercentage(e.draftBudget/e.totalBudget*100),"Draft"],["REALISASI",r.totalBudget,r.totalRealization,this.formatPercentage(r.avgPercentage),"Average"],["KINERJA TARGET",f.totalTarget,f.totalActual,this.formatPercentage(f.avgPercentage),"Average"],["KINERJA COMPLETED","",f.completedCount,this.formatPercentage(f.completedCount/this.consolidatedData.kinerja.length*100),"Completed"]].join(`
`),t=new Blob([i],{type:"text/csv"}),n=window.URL.createObjectURL(t),c=document.createElement("a");c.href=n,c.download=`laporan-konsolidasi-${this.budgetYear}.csv`,c.click(),window.URL.revokeObjectURL(n),ct.success("Laporan konsolidasi berhasil diekspor")},view:function(){let e=this.getBudgetSummary(),r=this.getRealizationSummary(),f=this.getKinerjaSummary();return(0,rt.default)("div",{class:"space-y-6"},[(0,rt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6"},[(0,rt.default)("div",{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6"},[(0,rt.default)("div",[(0,rt.default)("h1",{class:"text-2xl font-bold text-gray-900 mb-2"},"Laporan Konsolidasi"),(0,rt.default)("p",{class:"text-gray-600"},"Laporan gabungan anggaran, realisasi, dan kinerja")]),(0,rt.default)("div",{class:"flex items-center space-x-3 mt-4 sm:mt-0"},[(0,rt.default)("select",{class:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:this.reportType,onchange:a=>{this.reportType=a.target.value,rt.default.redraw()}},[(0,rt.default)("option",{value:"summary"},"Ringkasan"),(0,rt.default)("option",{value:"detailed"},"Detail"),(0,rt.default)("option",{value:"comparison"},"Perbandingan")]),(0,rt.default)("button",{class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2",onclick:()=>this.exportToCSV()},[(0,rt.default)("i",{class:"ri-download-line"}),(0,rt.default)("span","Ekspor CSV")])])]),(0,rt.default)("div",{class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[(0,rt.default)("div",[(0,rt.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tahun Anggaran"),(0,rt.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:this.budgetYear,onchange:a=>{this.budgetYear=a.target.value,this.loadData()}},[(0,rt.default)("option",{value:"2026"},"2026"),(0,rt.default)("option",{value:"2025"},"2025"),(0,rt.default)("option",{value:"2024"},"2024")])]),(0,rt.default)("div",[(0,rt.default)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Triwulan"),(0,rt.default)("select",{class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:this.selectedQuarter,onchange:a=>{this.selectedQuarter=a.target.value,rt.default.redraw()}},[(0,rt.default)("option",{value:""},"Semua Periode"),(0,rt.default)("option",{value:"Q1"},"Triwulan 1"),(0,rt.default)("option",{value:"Q2"},"Triwulan 2"),(0,rt.default)("option",{value:"Q3"},"Triwulan 3"),(0,rt.default)("option",{value:"Q4"},"Triwulan 4")])])])]),(0,rt.default)("div",{class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6"},[(0,rt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-blue-500"},[(0,rt.default)("div",{class:"flex items-center"},[(0,rt.default)("div",{class:"p-2 bg-blue-100 rounded-lg"},[(0,rt.default)("i",{class:"ri-wallet-line text-xl text-blue-600"})]),(0,rt.default)("div",{class:"ml-4"},[(0,rt.default)("p",{class:"text-sm font-medium text-gray-600"},"Total Anggaran"),(0,rt.default)("p",{class:"text-2xl font-bold text-gray-900"},this.formatCurrency(e.totalBudget))])])]),(0,rt.default)("div",{class:`bg-white rounded-lg shadow-sm p-6 border-l-4 ${r.avgPercentage>=90?"border-green-500":r.avgPercentage>=70?"border-blue-500":"border-yellow-500"}`},[(0,rt.default)("div",{class:"flex items-center"},[(0,rt.default)("div",{class:"p-2 bg-green-100 rounded-lg"},[(0,rt.default)("i",{class:"ri-money-dollar-circle-line text-xl text-green-600"})]),(0,rt.default)("div",{class:"ml-4"},[(0,rt.default)("p",{class:"text-sm font-medium text-gray-600"},"Realisasi Anggaran"),(0,rt.default)("p",{class:"text-2xl font-bold text-gray-900"},this.formatPercentage(r.avgPercentage))])])]),(0,rt.default)("div",{class:`bg-white rounded-lg shadow-sm p-6 border-l-4 ${f.avgPercentage>=90?"border-green-500":f.avgPercentage>=70?"border-blue-500":"border-yellow-500"}`},[(0,rt.default)("div",{class:"flex items-center"},[(0,rt.default)("div",{class:"p-2 bg-purple-100 rounded-lg"},[(0,rt.default)("i",{class:"ri-line-chart-line text-xl text-purple-600"})]),(0,rt.default)("div",{class:"ml-4"},[(0,rt.default)("p",{class:"text-sm font-medium text-gray-600"},"Pencapaian Kinerja"),(0,rt.default)("p",{class:"text-2xl font-bold text-gray-900"},this.formatPercentage(f.avgPercentage))])])]),(0,rt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-green-500"},[(0,rt.default)("div",{class:"flex items-center"},[(0,rt.default)("div",{class:"p-2 bg-green-100 rounded-lg"},[(0,rt.default)("i",{class:"ri-check-circle-line text-xl text-green-600"})]),(0,rt.default)("div",{class:"ml-4"},[(0,rt.default)("p",{class:"text-sm font-medium text-gray-600"},"Kinerja Selesai"),(0,rt.default)("p",{class:"text-2xl font-bold text-gray-900"},`${f.completedCount}/${this.consolidatedData.kinerja.length}`)])])])]),this.reportType==="summary"&&(0,rt.default)("div",{class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},[(0,rt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6"},[(0,rt.default)("h3",{class:"text-lg font-medium text-gray-900 mb-4 flex items-center"},[(0,rt.default)("i",{class:"ri-wallet-line mr-2 text-blue-500"}),"Breakdown Anggaran"]),(0,rt.default)("div",{class:"space-y-4"},[(0,rt.default)("div",{class:"flex justify-between items-center"},[(0,rt.default)("span",{class:"text-sm text-gray-600"},"Total Anggaran"),(0,rt.default)("span",{class:"text-sm font-medium"},this.formatCurrency(e.totalBudget))]),(0,rt.default)("div",{class:"flex justify-between items-center"},[(0,rt.default)("span",{class:"text-sm text-gray-600"},"Approved"),(0,rt.default)("span",{class:"text-sm font-medium text-green-600"},this.formatCurrency(e.approvedBudget))]),(0,rt.default)("div",{class:"flex justify-between items-center"},[(0,rt.default)("span",{class:"text-sm text-gray-600"},"Draft"),(0,rt.default)("span",{class:"text-sm font-medium text-yellow-600"},this.formatCurrency(e.draftBudget))])])]),(0,rt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6"},[(0,rt.default)("h3",{class:"text-lg font-medium text-gray-900 mb-4 flex items-center"},[(0,rt.default)("i",{class:"ri-money-dollar-circle-line mr-2 text-green-500"}),"Breakdown Realisasi"]),(0,rt.default)("div",{class:"space-y-4"},[(0,rt.default)("div",{class:"flex justify-between items-center"},[(0,rt.default)("span",{class:"text-sm text-gray-600"},"Total Budget"),(0,rt.default)("span",{class:"text-sm font-medium"},this.formatCurrency(r.totalBudget))]),(0,rt.default)("div",{class:"flex justify-between items-center"},[(0,rt.default)("span",{class:"text-sm text-gray-600"},"Total Realisasi"),(0,rt.default)("span",{class:"text-sm font-medium"},this.formatCurrency(r.totalRealization))]),(0,rt.default)("div",{class:"flex justify-between items-center"},[(0,rt.default)("span",{class:"text-sm text-gray-600"},"Rata-rata Pencapaian"),(0,rt.default)("span",{class:`text-sm font-medium ${r.avgPercentage>=90?"text-green-600":r.avgPercentage>=70?"text-blue-600":"text-yellow-600"}`},this.formatPercentage(r.avgPercentage))])])]),(0,rt.default)("div",{class:"bg-white rounded-lg shadow-sm p-6"},[(0,rt.default)("h3",{class:"text-lg font-medium text-gray-900 mb-4 flex items-center"},[(0,rt.default)("i",{class:"ri-line-chart-line mr-2 text-purple-500"}),"Breakdown Kinerja"]),(0,rt.default)("div",{class:"space-y-4"},[(0,rt.default)("div",{class:"flex justify-between items-center"},[(0,rt.default)("span",{class:"text-sm text-gray-600"},"Total Target"),(0,rt.default)("span",{class:"text-sm font-medium"},f.totalTarget.toLocaleString("id-ID"))]),(0,rt.default)("div",{class:"flex justify-between items-center"},[(0,rt.default)("span",{class:"text-sm text-gray-600"},"Total Aktual"),(0,rt.default)("span",{class:"text-sm font-medium"},f.totalActual.toLocaleString("id-ID"))]),(0,rt.default)("div",{class:"flex justify-between items-center"},[(0,rt.default)("span",{class:"text-sm text-gray-600"},"Rata-rata Pencapaian"),(0,rt.default)("span",{class:`text-sm font-medium ${f.avgPercentage>=90?"text-green-600":f.avgPercentage>=70?"text-blue-600":"text-yellow-600"}`},this.formatPercentage(f.avgPercentage))]),(0,rt.default)("div",{class:"flex justify-between items-center"},[(0,rt.default)("span",{class:"text-sm text-gray-600"},"Selesai"),(0,rt.default)("span",{class:"text-sm font-medium text-green-600"},`${f.completedCount}/${this.consolidatedData.kinerja.length}`)])])])]),this.isLoading&&(0,rt.default)("div",{class:"bg-white rounded-lg shadow-sm p-8 text-center"},[(0,rt.default)("i",{class:"ri-loader-4-line animate-spin text-2xl text-gray-400 mb-2"}),(0,rt.default)("p",{class:"text-gray-500"},"Memuat data konsolidasi...")])])}},_i=qo;var Ue=sr(lr(),1);Wr();var zo={isLoading:!1,penyediaList:[],filteredPenyedia:[],showModal:!1,modalMode:"create",isModalLoading:!1,showVendorUserModal:!1,isEditingVendorUser:!1,vendorUserFormData:{namaLengkap:"",username:"",password:"",passwordDisplay:""},editingVendorUserIndex:null,currentPenyediaId:null,showPassword:!1,formData:{_id:null,NamaVendor:"",NamaPimpinan:"",Alamat:"",Email:"",Telepon:"",Website:"",operators:[]},searchQuery:"",errors:{},oninit:function(){this.loadPenyedia(),this.showVendorUserModal=!1,this.isEditingVendorUser=!1,this.vendorUserFormData={namaLengkap:"",username:"",password:"",passwordDisplay:""},this.editingVendorUserIndex=null,this.currentPenyediaId=null,this.showPassword=!1},loadPenyedia:async function(){this.isLoading=!0;try{let e=await Ce.getAll("penyedia");this.penyediaList=e.data,this.filteredPenyedia=e.data,this.searchQuery=""}catch(e){console.error("Error loading penyedia:",e),ct.error("Gagal memuat data penyedia")}finally{this.isLoading=!1,Ue.default.redraw()}},handleSearch:function(){if(!this.searchQuery){this.filteredPenyedia=this.penyediaList;return}let e=this.searchQuery.toLowerCase();this.filteredPenyedia=this.penyediaList.filter(r=>r.NamaVendor.toLowerCase().includes(e)||r.NamaPimpinan.toLowerCase().includes(e)||r.Alamat.toLowerCase().includes(e)||r.Email.toLowerCase().includes(e)||r.Telepon.toLowerCase().includes(e))},openCreateModal:function(){this.modalMode="create",this.formData={_id:null,NamaVendor:"",NamaPimpinan:"",Alamat:"",Email:"",Telepon:"",Website:"",operators:[]},this.errors={},this.showModal=!0},openEditModal:function(e){this.modalMode="edit",this.formData={...e,operators:e.operators||[]},this.errors={},this.showModal=!0},closeModal:function(){this.showModal=!1,this.errors={},this.closeVendorUserModal()},openVendorUserModal:function(e,r=null){if(this.currentPenyediaId=e,r!==null){this.isEditingVendorUser=!0;let f=this.penyediaList.find(a=>a._id===e);if(f&&f.operators&&f.operators[r]){let a=f.operators[r],i=a.passwordDisplay&&a.passwordDisplay.startsWith("$2a$");this.vendorUserFormData={_id:a._id,namaLengkap:a.namaLengkap,username:a.username,password:i?"":a.passwordDisplay||a.password,passwordDisplay:a.passwordDisplay||a.password},this.editingVendorUserIndex=r}}else this.isEditingVendorUser=!1,this.vendorUserFormData={namaLengkap:"",username:"",password:"",passwordDisplay:""},this.editingVendorUserIndex=null;this.showVendorUserModal=!0,Ue.default.redraw()},closeVendorUserModal:function(){this.showVendorUserModal=!1,this.vendorUserFormData={namaLengkap:"",username:"",password:"",passwordDisplay:""},this.editingVendorUserIndex=null,this.isEditingVendorUser=!1,this.currentPenyediaId=null},validateVendorUserForm:function(){let e={};return(!this.vendorUserFormData.namaLengkap||!this.vendorUserFormData.namaLengkap.trim())&&(e.namaLengkap="Nama lengkap harus diisi"),(!this.vendorUserFormData.username||!this.vendorUserFormData.username.trim())&&(e.username="Username harus diisi"),!this.isEditingVendorUser&&(!this.vendorUserFormData.password||!this.vendorUserFormData.password.trim())?e.password="Password harus diisi":this.isEditingVendorUser&&(!this.vendorUserFormData.password||!this.vendorUserFormData.password.trim())&&this.vendorUserFormData.passwordDisplay&&this.vendorUserFormData.passwordDisplay.startsWith("$2a$")?e.password="Password harus diisi karena data password saat ini tidak valid":this.vendorUserFormData.password&&this.vendorUserFormData.password.length<6&&(e.password="Password minimal 6 karakter"),e},saveVendorUser:async function(){console.log("Saving vendor user with data:",this.vendorUserFormData);let e=this.validateVendorUserForm();if(console.log("Validation errors:",e),Object.keys(e).length>0){let r=Object.values(e)[0];ct.error(r),Ue.default.redraw();return}try{let r=this.penyediaList.find(i=>i._id===this.currentPenyediaId);if(!r){ct.error("Penyedia tidak ditemukan");return}console.log("Found penyedia:",r);let f=[...r.operators||[]];if(this.isEditingVendorUser&&this.editingVendorUserIndex!==null){console.log("Updating existing vendor user at index:",this.editingVendorUserIndex);let i={_id:this.vendorUserFormData._id,namaLengkap:this.vendorUserFormData.namaLengkap,username:this.vendorUserFormData.username,passwordDisplay:this.vendorUserFormData.passwordDisplay||this.vendorUserFormData.password};this.vendorUserFormData.password&&this.vendorUserFormData.password.trim()&&(i.password=this.vendorUserFormData.password),f[this.editingVendorUserIndex]=i}else console.log("Adding new vendor user"),f.push({namaLengkap:this.vendorUserFormData.namaLengkap,username:this.vendorUserFormData.username,password:this.vendorUserFormData.password,passwordDisplay:this.vendorUserFormData.passwordDisplay||this.vendorUserFormData.password});console.log("Updated vendor users array:",f);let a={NamaVendor:r.NamaVendor,NamaPimpinan:r.NamaPimpinan,Alamat:r.Alamat,Email:r.Email,Telepon:r.Telepon,Website:r.Website||"",operators:f};if(console.log("Sending penyedia data:",a),console.log("Updating penyedia with new vendor user:",this.currentPenyediaId),await Ce.update("penyedia",this.currentPenyediaId,a),ct.success(this.isEditingVendorUser?"Vendor user berhasil diperbarui":"Vendor user berhasil ditambahkan"),this.closeVendorUserModal(),await this.loadPenyedia(),this.showModal&&this.modalMode==="edit"){let i=this.penyediaList.find(t=>t._id===this.currentPenyediaId);i&&(this.formData={...i,operators:[...i.operators]}),Ue.default.redraw()}}catch(r){console.error("Error saving vendor user:",r),ct.error(`Gagal menyimpan vendor user: ${r.message}`)}},deleteVendorUser:async function(e,r){ct.confirm("Apakah Anda yakin ingin menghapus vendor user ini?",async()=>{try{let f=this.penyediaList.find(t=>t._id===e);if(!f){ct.error("Penyedia tidak ditemukan");return}let a=(f.operators||[]).filter((t,n)=>n!==r),i={NamaVendor:f.NamaVendor,NamaPimpinan:f.NamaPimpinan,Alamat:f.Alamat,Email:f.Email,Telepon:f.Telepon,Website:f.Website||"",operators:a};if(await Ce.update("penyedia",e,i),ct.success("Vendor user berhasil dihapus"),await this.loadPenyedia(),this.showModal&&this.modalMode==="edit"){let t=this.penyediaList.find(n=>n._id===e);t&&(this.formData={...t,operators:[...t.operators]}),Ue.default.redraw()}}catch(f){console.error("Error deleting vendor user:",f),ct.error("Gagal menghapus vendor user")}})},validateForm:function(){return this.errors={},this.formData.NamaVendor||(this.errors.NamaVendor="Nama vendor harus diisi"),this.formData.NamaPimpinan||(this.errors.NamaPimpinan="Nama pimpinan harus diisi"),this.formData.Alamat||(this.errors.Alamat="Alamat harus diisi"),this.formData.Email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.formData.Email)||(this.errors.Email="Format email tidak valid"):this.errors.Email="Email harus diisi",this.formData.Telepon||(this.errors.Telepon="Telepon harus diisi"),Object.keys(this.errors).length===0},savePenyedia:async function(){if(!this.validateForm()){ct.error("Periksa kembali data yang diisi");return}this.isModalLoading=!0;try{this.modalMode==="create"?(await Ce.create("penyedia",this.formData),this.closeModal(),this.loadPenyedia()):(await Ce.update("penyedia",this.formData._id,this.formData),this.closeModal(),this.loadPenyedia())}catch(e){console.error("Error saving penyedia:",e)}finally{this.isModalLoading=!1,Ue.default.redraw()}},deletePenyedia:async function(e){try{await Ce.delete("penyedia",e._id,e.NamaVendor),this.loadPenyedia()}catch(r){console.error("Error deleting penyedia:",r),this.isLoading=!1,Ue.default.redraw()}},view:function(){return(0,Ue.default)("div",{class:"max-w-7xl mx-auto"},[(0,Ue.default)("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4"},[(0,Ue.default)("div",[(0,Ue.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Penyedia Barang/Jasa"),(0,Ue.default)("p",{class:"text-gray-600 mt-1"},"Kelola data penyedia barang/jasa")]),(0,Ue.default)("button",{class:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg flex items-center gap-2 transition-colors",onclick:()=>this.openCreateModal()},[(0,Ue.default)("i",{class:"ri-add-line"}),"Tambah Penyedia"])]),(0,Ue.default)("div",{class:"mb-6"},[(0,Ue.default)("div",{class:"relative"},[(0,Ue.default)("input",{type:"text",placeholder:"Cari penyedia...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:this.searchQuery,oninput:e=>{this.searchQuery=e.target.value,this.handleSearch()}}),(0,Ue.default)("i",{class:"ri-search-line absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"})])]),this.isLoading&&!this.showModal?(0,Ue.default)("div",{class:"flex justify-center items-center py-12"},[(0,Ue.default)("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})]):(0,Ue.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,Ue.default)("div",{class:"overflow-x-auto"},[(0,Ue.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,Ue.default)("thead",{class:"bg-gray-50"},[(0,Ue.default)("tr",[(0,Ue.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nama Vendor"),(0,Ue.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nama Pimpinan"),(0,Ue.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Alamat"),(0,Ue.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Email"),(0,Ue.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Telepon"),(0,Ue.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Vendor Users"),(0,Ue.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,Ue.default)("tbody",{class:"bg-white divide-y divide-gray-200"},[this.filteredPenyedia.length===0?(0,Ue.default)("tr",[(0,Ue.default)("td",{class:"px-6 py-4 text-center text-gray-500",colspan:7},"Tidak ada data penyedia")]):this.filteredPenyedia.map(e=>(0,Ue.default)("tr",{class:"hover:bg-gray-50"},[(0,Ue.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},e.NamaVendor),(0,Ue.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},e.NamaPimpinan),(0,Ue.default)("td",{class:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate"},e.Alamat),(0,Ue.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},e.Email),(0,Ue.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},e.Telepon),(0,Ue.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},[e.operators&&e.operators.length>0&&(0,Ue.default)("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 mr-2"},`${e.operators.length} users`),(0,Ue.default)("button",{class:"text-purple-600 hover:text-purple-900 text-sm",onclick:()=>this.openVendorUserModal(e._id),title:"Kelola Vendor User"},[(0,Ue.default)("i",{class:"ri-user-settings-line mr-1"}),"Kelola"])]),(0,Ue.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},[(0,Ue.default)("button",{class:"text-blue-600 hover:text-blue-900 mr-3",onclick:()=>this.openEditModal(e)},[(0,Ue.default)("i",{class:"ri-edit-line"})]),(0,Ue.default)("button",{class:"text-red-600 hover:text-red-900",onclick:()=>this.deletePenyedia(e)},[(0,Ue.default)("i",{class:"ri-delete-bin-line"})])])]))])])])]),this.showModal&&(0,Ue.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},[(0,Ue.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto"},[(0,Ue.default)("div",{class:"bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-t-xl"},[(0,Ue.default)("div",{class:"flex items-center justify-between"},[(0,Ue.default)("div",{class:"flex items-center space-x-3"},[(0,Ue.default)("div",{class:"w-10 h-10 bg-white bg-opacity-75 rounded-full flex items-center justify-center"},[(0,Ue.default)("i",{class:this.modalMode==="create"?"ri-add-line text-xl text-blue-600":"ri-edit-line text-xl text-blue-600"})]),(0,Ue.default)("div",[(0,Ue.default)("h3",{class:"text-xl font-bold"},this.modalMode==="create"?"Tambah Penyedia":"Edit Penyedia"),(0,Ue.default)("p",{class:"text-white text-opacity-80 text-sm"},this.modalMode==="create"?"Tambah data penyedia baru":"Edit data penyedia")])]),(0,Ue.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeModal()},[(0,Ue.default)("i",{class:"ri-close-fill"})])])]),(0,Ue.default)("div",{class:"p-6"},[(0,Ue.default)("div",{class:"space-y-4"},[(0,Ue.default)("div",[(0,Ue.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ue.default)("i",{class:"ri-building-line mr-1 text-blue-500"}),"Nama Vendor"]),(0,Ue.default)("input",{type:"text",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 transition-all duration-200 ${this.errors.NamaVendor?"border-red-300 focus:border-red-500 focus:ring-red-200 bg-red-50":"border-gray-200 focus:border-blue-500 focus:ring-blue-200 bg-gray-50 focus:bg-white"}`,placeholder:"Masukkan nama vendor",value:this.formData.NamaVendor,oninput:e=>{this.formData.NamaVendor=e.target.value,this.errors.NamaVendor&&delete this.errors.NamaVendor}}),this.errors.NamaVendor&&(0,Ue.default)("p",{class:"mt-2 text-sm text-red-600"},this.errors.NamaVendor)]),(0,Ue.default)("div",[(0,Ue.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ue.default)("i",{class:"ri-user-line mr-1 text-green-500"}),"Nama Pimpinan"]),(0,Ue.default)("input",{type:"text",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 transition-all duration-200 ${this.errors.NamaPimpinan?"border-red-300 focus:border-red-500 focus:ring-red-200 bg-red-50":"border-gray-200 focus:border-blue-500 focus:ring-blue-200 bg-gray-50 focus:bg-white"}`,placeholder:"Masukkan nama pimpinan",value:this.formData.NamaPimpinan,oninput:e=>{this.formData.NamaPimpinan=e.target.value,this.errors.NamaPimpinan&&delete this.errors.NamaPimpinan}}),this.errors.NamaPimpinan&&(0,Ue.default)("p",{class:"mt-2 text-sm text-red-600"},this.errors.NamaPimpinan)]),(0,Ue.default)("div",[(0,Ue.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ue.default)("i",{class:"ri-map-pin-line mr-1 text-amber-500"}),"Alamat"]),(0,Ue.default)("textarea",{class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 transition-all duration-200 ${this.errors.Alamat?"border-red-300 focus:border-red-500 focus:ring-red-200 bg-red-50":"border-gray-200 focus:border-blue-500 focus:ring-blue-200 bg-gray-50 focus:bg-white"}`,placeholder:"Masukkan alamat",rows:3,value:this.formData.Alamat,oninput:e=>{this.formData.Alamat=e.target.value,this.errors.Alamat&&delete this.errors.Alamat}}),this.errors.Alamat&&(0,Ue.default)("p",{class:"mt-2 text-sm text-red-600"},this.errors.Alamat)]),(0,Ue.default)("div",[(0,Ue.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ue.default)("i",{class:"ri-mail-line mr-1 text-blue-500"}),"Email"]),(0,Ue.default)("input",{type:"email",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 transition-all duration-200 ${this.errors.Email?"border-red-300 focus:border-red-500 focus:ring-red-200 bg-red-50":"border-gray-200 focus:border-blue-500 focus:ring-blue-200 bg-gray-50 focus:bg-white"}`,placeholder:"Masukkan email",value:this.formData.Email,oninput:e=>{this.formData.Email=e.target.value,this.errors.Email&&delete this.errors.Email}}),this.errors.Email&&(0,Ue.default)("p",{class:"mt-2 text-sm text-red-600"},this.errors.Email)]),(0,Ue.default)("div",[(0,Ue.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ue.default)("i",{class:"ri-phone-line mr-1 text-green-500"}),"Telepon"]),(0,Ue.default)("input",{type:"text",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 transition-all duration-200 ${this.errors.Telepon?"border-red-300 focus:border-red-500 focus:ring-red-200 bg-red-50":"border-gray-200 focus:border-blue-500 focus:ring-blue-200 bg-gray-50 focus:bg-white"}`,placeholder:"Masukkan nomor telepon",value:this.formData.Telepon,oninput:e=>{this.formData.Telepon=e.target.value,this.errors.Telepon&&delete this.errors.Telepon}}),this.errors.Telepon&&(0,Ue.default)("p",{class:"mt-2 text-sm text-red-600"},this.errors.Telepon)]),(0,Ue.default)("div",[(0,Ue.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ue.default)("i",{class:"ri-global-line mr-1 text-teal-500"}),"Website"]),(0,Ue.default)("input",{type:"text",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 transition-all duration-200 ${this.errors.Website?"border-red-300 focus:border-red-500 focus:ring-red-200 bg-red-50":"border-gray-200 focus:border-blue-500 focus:ring-blue-200 bg-gray-50 focus:bg-white"}`,placeholder:"https://www.contoh.com",value:this.formData.Website||"",oninput:e=>{this.formData.Website=e.target.value,this.errors.Website&&delete this.errors.Website}}),this.errors.Website&&(0,Ue.default)("p",{class:"mt-2 text-sm text-red-600"},this.errors.Website)]),this.modalMode==="edit"&&(0,Ue.default)("div",{class:"border-t border-gray-200 pt-6"},[(0,Ue.default)("div",{class:"flex justify-between items-center mb-4"},[(0,Ue.default)("div",[(0,Ue.default)("h4",{class:"text-lg font-semibold text-gray-800 flex items-center"},[(0,Ue.default)("i",{class:"ri-user-settings-line mr-2 text-purple-500"}),"Vendor Users"]),(0,Ue.default)("p",{class:"text-sm text-gray-600 mt-1"},"Kelola akun vendor users untuk penyedia")]),(0,Ue.default)("button",{class:"inline-flex items-center px-3 py-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white text-sm font-medium rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-200 shadow-lg hover:shadow-xl",onclick:()=>{this.openVendorUserModal(this.formData._id)}},[(0,Ue.default)("i",{class:"ri-add-line mr-2"}),"Tambah Vendor User"])]),this.formData.operators&&this.formData.operators.length>0?(0,Ue.default)("div",{class:"space-y-2 mb-4"},[(0,Ue.default)("p",{class:"text-sm font-medium text-gray-700 mb-2"},"Vendor Users saat ini:"),this.formData.operators.map((e,r)=>(0,Ue.default)("div",{class:"bg-purple-50 rounded-lg p-3 border border-purple-200 flex justify-between items-center"},[(0,Ue.default)("div",{class:"flex-1"},[(0,Ue.default)("p",{class:"font-medium text-gray-900"},e.namaLengkap),(0,Ue.default)("p",{class:"text-sm text-gray-600"},`Username: ${e.username}`)]),(0,Ue.default)("div",{class:"flex space-x-2"},[(0,Ue.default)("button",{class:"p-1.5 text-purple-600 hover:bg-purple-100 rounded transition-colors duration-200",onclick:()=>this.openVendorUserModal(this.formData._id,r),title:"Edit Vendor User"},[(0,Ue.default)("i",{class:"ri-edit-line text-sm"})]),(0,Ue.default)("button",{class:"p-1.5 text-red-600 hover:bg-red-100 rounded transition-colors duration-200",onclick:()=>this.deleteVendorUser(this.formData._id,r),title:"Hapus Vendor User"},[(0,Ue.default)("i",{class:"ri-delete-bin-line text-sm"})])])]))]):(0,Ue.default)("div",{class:"text-center py-4 text-gray-500 text-sm"},[(0,Ue.default)("i",{class:"ri-user-line text-lg mb-1 block"}),"Belum ada vendor user"])])])]),(0,Ue.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-xl"},[(0,Ue.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.closeModal()},[(0,Ue.default)("i",{class:"ri-close-fill"}),(0,Ue.default)("span","Batal")]),(0,Ue.default)("button",{class:`px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 ${this.isModalLoading?"opacity-75 cursor-not-allowed":"hover:from-blue-600 hover:to-purple-700"}`,onclick:()=>this.savePenyedia(),disabled:this.isModalLoading},[this.isModalLoading?(0,Ue.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,Ue.default)("i",{class:this.modalMode==="create"?"ri-save-line":"ri-edit-line"}),(0,Ue.default)("span",this.isModalLoading?"Menyimpan...":this.modalMode==="create"?"Simpan":"Update")])])])]),this.showVendorUserModal&&(0,Ue.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onclick:e=>{e.target===e.currentTarget&&this.closeVendorUserModal()}},[(0,Ue.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 transform transition-all"},[(0,Ue.default)("div",{class:"bg-gradient-to-r from-purple-500 to-pink-600 text-white p-6 rounded-t-xl"},[(0,Ue.default)("div",{class:"flex items-center justify-between"},[(0,Ue.default)("div",{class:"flex items-center space-x-3"},[(0,Ue.default)("div",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center"},[(0,Ue.default)("i",{class:`ri-${this.isEditingVendorUser?"edit":"add"}-line text-xl text-white`})]),(0,Ue.default)("div",[(0,Ue.default)("h3",{class:"text-xl font-bold"},this.isEditingVendorUser?"Edit Vendor User":"Tambah Vendor User"),(0,Ue.default)("p",{class:"text-white text-opacity-80 text-sm"},"Kelola akun vendor user")])]),(0,Ue.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeVendorUserModal()},[(0,Ue.default)("i",{class:"ri-close-fill"})])])]),(0,Ue.default)("div",{class:"p-6"},[(0,Ue.default)("div",{class:"space-y-6"},[(0,Ue.default)("div",[(0,Ue.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ue.default)("i",{class:"ri-user-line mr-1 text-blue-500"}),"Nama Lengkap"]),(0,Ue.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Nama lengkap vendor user",value:this.vendorUserFormData.namaLengkap,oninput:e=>{this.vendorUserFormData.namaLengkap=e.target.value}})]),(0,Ue.default)("div",[(0,Ue.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ue.default)("i",{class:"ri-user-settings-line mr-1 text-green-500"}),"Username"]),(0,Ue.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Username untuk login",value:this.vendorUserFormData.username,oninput:e=>{this.vendorUserFormData.username=e.target.value}})]),(0,Ue.default)("div",[(0,Ue.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,Ue.default)("i",{class:"ri-lock-line mr-1 text-red-500"}),"Password"]),(0,Ue.default)("div",{class:"relative"},[(0,Ue.default)("input",{type:this.showPassword?"text":"password",class:"w-full px-4 py-3 pr-12 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Password minimal 6 karakter",value:this.vendorUserFormData.password,oninput:e=>{this.vendorUserFormData.password=e.target.value,this.vendorUserFormData.passwordDisplay=e.target.value}}),(0,Ue.default)("button",{type:"button",class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",onclick:()=>this.showPassword=!this.showPassword},[(0,Ue.default)("i",{class:`ri-${this.showPassword?"eye-off":"eye"}-line`})])])])])]),(0,Ue.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-xl"},[(0,Ue.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.closeVendorUserModal()},[(0,Ue.default)("i",{class:"ri-close-fill"}),(0,Ue.default)("span","Batal")]),(0,Ue.default)("button",{class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2",onclick:()=>this.saveVendorUser()},[(0,Ue.default)("i",{class:"ri-save-line"}),(0,Ue.default)("span","Simpan")])])])])])}},Di=zo;var Je=sr(lr(),1);Wr();var Jo={isLoading:!1,jenisPengadaanList:[],filteredJenisPengadaan:[],metodePengadaanList:[],filteredMetodePengadaan:[],showJenisModal:!1,showMetodeModal:!1,formData:{_id:null,kode:"",nama:"",deskripsi:""},metodeFormData:{_id:null,jenisPengadaanId:"",kode:"",nama:"",deskripsi:""},searchQuery:"",metodeSearchQuery:"",errors:{},metodeErrors:{},isLoadingJenis:!1,isLoadingMetode:!1,oninit:function(){this.loadData()},loadData:async function(){this.isLoading=!0;try{let[e,r]=await Promise.all([Ce.getAll("jenis-pengadaan"),Ce.getAll("metode-pengadaan")]);this.jenisPengadaanList=Array.isArray(e.data)?e.data:[],this.filteredJenisPengadaan=this.jenisPengadaanList,this.metodePengadaanList=Array.isArray(r.data)?r.data:[],this.filteredMetodePengadaan=this.metodePengadaanList,this.searchQuery="",this.metodeSearchQuery="",this.jenisPengadaanList.length===0&&this.metodePengadaanList.length===0&&ct.success("Data masih kosong")}catch(e){console.error("Error loading data:",e);let r=e?.response?.status;if(r&&r!==404){let f=e.response?.data?.message||"Gagal memuat data";ct.error(f)}this.jenisPengadaanList=[],this.filteredJenisPengadaan=[],this.metodePengadaanList=[],this.filteredMetodePengadaan=[]}finally{this.isLoading=!1,Je.default.redraw()}},handleSearch:function(){this.applyJenisFilters()},handleMetodeSearch:function(){this.applyMetodeFilters()},applyJenisFilters:function(){let e=this.jenisPengadaanList;if(this.searchQuery){let r=this.searchQuery.toLowerCase();e=e.filter(f=>f.kode.toLowerCase().includes(r)||f.nama.toLowerCase().includes(r)||f.deskripsi&&f.deskripsi.toLowerCase().includes(r))}this.filteredJenisPengadaan=e},applyMetodeFilters:function(){let e=this.metodePengadaanList;if(this.metodeSearchQuery){let r=this.metodeSearchQuery.toLowerCase();e=e.filter(f=>f.kode.toLowerCase().includes(r)||f.nama.toLowerCase().includes(r)||f.deskripsi&&f.deskripsi.toLowerCase().includes(r)||f.jenisPengadaanId.nama.toLowerCase().includes(r))}this.filteredMetodePengadaan=e},getJenisPengadaanName:function(e){let r=this.jenisPengadaanList.find(f=>f._id===e);return r?r.nama:"Tidak ditemukan"},openCreateModal:function(){this.showJenisModal=!0,this.formData={_id:null,kode:"",nama:"",deskripsi:""},this.errors={}},openEditModal:function(e){this.showJenisModal=!0,this.formData={...e},this.errors={}},openCreateMetodeModal:function(e){this.showMetodeModal=!0,this.metodeFormData={_id:null,jenisPengadaanId:e._id,kode:"",nama:"",deskripsi:""},this.metodeErrors={}},openEditMetodeModal:function(e){this.showMetodeModal=!0,this.metodeFormData={...e,jenisPengadaanId:e.jenisPengadaanId._id},this.metodeErrors={}},manageMetode:function(e){this.openCreateMetodeModal(e)},saveJenisPengadaan:async function(){if(!this.formData.kode||!this.formData.nama){ct.error("Kode dan nama harus diisi");return}this.isLoadingJenis=!0;try{this.formData._id?await Ce.update("jenis-pengadaan",this.formData._id,this.formData):await Ce.create("jenis-pengadaan",this.formData),this.loadData(),this.showJenisModal=!1}catch(e){console.error("Error saving jenis pengadaan:",e)}finally{this.isLoadingJenis=!1,Je.default.redraw()}},saveMetodePengadaan:async function(){if(!this.metodeFormData.jenisPengadaanId||!this.metodeFormData.kode||!this.metodeFormData.nama){ct.error("Jenis pengadaan, kode dan nama harus diisi");return}this.isLoadingMetode=!0;try{this.metodeFormData._id?await Ce.update("metode-pengadaan",this.metodeFormData._id,this.metodeFormData):await Ce.create("metode-pengadaan",this.metodeFormData),this.loadData(),this.showMetodeModal=!1}catch(e){console.error("Error saving metode pengadaan:",e)}finally{this.isLoadingMetode=!1,Je.default.redraw()}},deleteJenisPengadaan:async function(e){try{await Ce.delete("jenis-pengadaan",e._id,e.nama),this.loadData()}catch(r){console.error("Error deleting jenis pengadaan:",r)}},deleteMetodePengadaan:async function(e){try{await Ce.delete("metode-pengadaan",e._id,e.nama),this.loadData()}catch(r){console.error("Error deleting metode pengadaan:",r)}},view:function(){return(0,Je.default)("div",{class:"max-w-7xl mx-auto"},[(0,Je.default)("div",{class:"mb-6"},[(0,Je.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Jenis dan Metode Pengadaan"),(0,Je.default)("p",{class:"text-gray-600 mt-1"},"Kelola data jenis dan metode pengadaan")]),(0,Je.default)("div",{class:"mb-8"},[(0,Je.default)("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between mb-4 gap-4"},[(0,Je.default)("div",[(0,Je.default)("h2",{class:"text-xl font-semibold text-gray-900"},"Jenis Pengadaan"),(0,Je.default)("p",{class:"text-gray-600 text-sm"},"Kelola data jenis pengadaan")]),(0,Je.default)("button",{class:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg flex items-center gap-2 transition-colors",onclick:()=>this.openCreateModal()},[(0,Je.default)("i",{class:"ri-add-line"}),"Tambah Jenis Pengadaan"])]),(0,Je.default)("div",{class:"mb-6"},[(0,Je.default)("div",{class:"relative"},[(0,Je.default)("input",{type:"text",placeholder:"Cari jenis pengadaan...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:this.searchQuery,oninput:e=>{this.searchQuery=e.target.value,this.handleSearch()}}),(0,Je.default)("i",{class:"ri-search-line absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"})])]),(0,Je.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,Je.default)("div",{class:"overflow-x-auto"},[(0,Je.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,Je.default)("thead",{class:"bg-gray-50"},[(0,Je.default)("tr",[(0,Je.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Kode"),(0,Je.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nama"),(0,Je.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Deskripsi"),(0,Je.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,Je.default)("tbody",{class:"bg-white divide-y divide-gray-200"},[this.filteredJenisPengadaan.length===0?(0,Je.default)("tr",[(0,Je.default)("td",{class:"px-6 py-4 text-center text-gray-500",colspan:4},"Tidak ada data jenis pengadaan")]):this.filteredJenisPengadaan.map(e=>(0,Je.default)("tr",{class:"hover:bg-gray-50"},[(0,Je.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},e.kode),(0,Je.default)("td",{class:"px-6 py-4 text-sm text-gray-900"},e.nama),(0,Je.default)("td",{class:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate"},e.deskripsi||"-"),(0,Je.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},[(0,Je.default)("button",{class:"text-green-600 hover:text-green-900 mr-3",onclick:()=>this.manageMetode(e),title:"Kelola Metode Pengadaan"},[(0,Je.default)("i",{class:"ri-settings-line"})]),(0,Je.default)("button",{class:"text-blue-600 hover:text-blue-900 mr-3",onclick:()=>this.openEditModal(e)},[(0,Je.default)("i",{class:"ri-edit-line"})]),(0,Je.default)("button",{class:"text-red-600 hover:text-red-900",onclick:()=>this.deleteJenisPengadaan(e)},[(0,Je.default)("i",{class:"ri-delete-bin-line"})])])]))])])])])]),(0,Je.default)("div",{class:"mb-8"},[(0,Je.default)("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between mb-4 gap-4"},[(0,Je.default)("div",[(0,Je.default)("h2",{class:"text-xl font-semibold text-gray-900"},"Metode Pengadaan"),(0,Je.default)("p",{class:"text-gray-600 text-sm"},"Kelola data metode pengadaan")]),(0,Je.default)("button",{class:`bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg flex items-center gap-2 transition-colors ${this.jenisPengadaanList.length===0?"opacity-50 cursor-not-allowed":""}`,onclick:()=>{this.jenisPengadaanList.length>0&&this.openCreateMetodeModal(this.jenisPengadaanList[0])},disabled:this.jenisPengadaanList.length===0},[(0,Je.default)("i",{class:"ri-add-line"}),"Tambah Metode Pengadaan"])]),(0,Je.default)("div",{class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[(0,Je.default)("div",{class:"overflow-x-auto"},[(0,Je.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,Je.default)("thead",{class:"bg-gray-50"},[(0,Je.default)("tr",[(0,Je.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Jenis Pengadaan"),(0,Je.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Kode"),(0,Je.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nama"),(0,Je.default)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Deskripsi"),(0,Je.default)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,Je.default)("tbody",{class:"bg-white divide-y divide-gray-200"},[this.filteredMetodePengadaan.length===0?(0,Je.default)("tr",[(0,Je.default)("td",{class:"px-6 py-4 text-center text-gray-500",colspan:5},this.jenisPengadaanList.length===0?"Tidak ada data jenis pengadaan":"Tidak ada data metode pengadaan")]):this.filteredMetodePengadaan.map(e=>(0,Je.default)("tr",{class:"hover:bg-gray-50"},[(0,Je.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},[(0,Je.default)("div",[(0,Je.default)("div",{class:"text-sm font-medium text-gray-900"},e.jenisPengadaanId.kode),(0,Je.default)("div",{class:"text-sm text-gray-500"},e.jenisPengadaanId.nama)])]),(0,Je.default)("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},e.kode),(0,Je.default)("td",{class:"px-6 py-4 text-sm text-gray-900"},e.nama),(0,Je.default)("td",{class:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate"},e.deskripsi||"-"),(0,Je.default)("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},[(0,Je.default)("button",{class:"text-blue-600 hover:text-blue-900 mr-3",onclick:()=>this.openEditMetodeModal(e)},[(0,Je.default)("i",{class:"ri-edit-line"})]),(0,Je.default)("button",{class:"text-red-600 hover:text-red-900",onclick:()=>this.deleteMetodePengadaan(e)},[(0,Je.default)("i",{class:"ri-delete-bin-line"})])])]))])])])])]),this.showJenisModal&&(0,Je.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},[(0,Je.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-md w-full"},[(0,Je.default)("div",{class:"bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-t-xl"},[(0,Je.default)("div",{class:"flex items-center justify-between"},[(0,Je.default)("div",{class:"flex items-center space-x-3"},[(0,Je.default)("div",{class:"w-10 h-10 bg-white bg-opacity-75 rounded-full flex items-center justify-center"},[(0,Je.default)("i",{class:this.formData._id?"ri-edit-line text-xl text-blue-600":"ri-add-line text-xl text-blue-600"})]),(0,Je.default)("div",[(0,Je.default)("h3",{class:"text-xl font-bold"},this.formData._id?"Edit Jenis Pengadaan":"Tambah Jenis Pengadaan"),(0,Je.default)("p",{class:"text-white text-opacity-80 text-sm"},this.formData._id?"Edit data jenis pengadaan":"Tambah data jenis pengadaan baru")])]),(0,Je.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>{this.showJenisModal=!1,this.formData={_id:null}}},[(0,Je.default)("i",{class:"ri-close-fill"})])])]),(0,Je.default)("div",{class:"p-6"},[(0,Je.default)("div",{class:"space-y-4"},[(0,Je.default)("div",[(0,Je.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Kode"),(0,Je.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500",placeholder:"Contoh: JP001, JP002...",value:this.formData.kode,oninput:e=>{this.formData.kode=e.target.value}})]),(0,Je.default)("div",[(0,Je.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Nama"),(0,Je.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500",placeholder:"Masukkan nama jenis pengadaan",value:this.formData.nama,oninput:e=>{this.formData.nama=e.target.value}})]),(0,Je.default)("div",[(0,Je.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Deskripsi"),(0,Je.default)("textarea",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500",placeholder:"Masukkan deskripsi (opsional)",rows:3,value:this.formData.deskripsi,oninput:e=>{this.formData.deskripsi=e.target.value}})])])]),(0,Je.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-xl"},[(0,Je.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 rounded-lg text-gray-700 font-medium",onclick:()=>{this.showJenisModal=!1,this.formData={_id:null}}},[(0,Je.default)("span","Batal")]),(0,Je.default)("button",{class:`px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg font-medium ${this.isLoadingJenis?"opacity-50 cursor-not-allowed":""}`,disabled:this.isLoadingJenis,onclick:()=>this.saveJenisPengadaan()},[(0,Je.default)("span",this.isLoadingJenis?"Menyimpan...":this.formData._id?"Update":"Simpan")])])])]),this.showMetodeModal&&(0,Je.default)("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},[(0,Je.default)("div",{class:"bg-white rounded-xl shadow-2xl max-w-md w-full"},[(0,Je.default)("div",{class:"bg-gradient-to-r from-green-500 to-emerald-600 text-white p-6 rounded-t-xl"},[(0,Je.default)("div",{class:"flex items-center justify-between"},[(0,Je.default)("div",{class:"flex items-center space-x-3"},[(0,Je.default)("div",{class:"w-10 h-10 bg-white bg-opacity-75 rounded-full flex items-center justify-center"},[(0,Je.default)("i",{class:this.metodeFormData._id?"ri-edit-line text-xl text-blue-600":"ri-add-line text-xl text-blue-600"})]),(0,Je.default)("div",[(0,Je.default)("h3",{class:"text-xl font-bold"},this.metodeFormData._id?"Edit Metode Pengadaan":"Tambah Metode Pengadaan"),(0,Je.default)("p",{class:"text-white text-opacity-80 text-sm"},this.metodeFormData._id?"Edit data metode pengadaan":"Tambah data metode pengadaan baru")])]),(0,Je.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>{this.showMetodeModal=!1,this.metodeFormData={_id:null}}},[(0,Je.default)("i",{class:"ri-close-fill"})])])]),(0,Je.default)("div",{class:"p-6"},[(0,Je.default)("div",{class:"space-y-4"},[(0,Je.default)("div",[(0,Je.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Jenis Pengadaan"),(0,Je.default)("select",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500",value:this.metodeFormData.jenisPengadaanId,oninput:e=>{this.metodeFormData.jenisPengadaanId=e.target.value}},[(0,Je.default)("option",{value:""},"Pilih Jenis Pengadaan..."),this.jenisPengadaanList.map(e=>(0,Je.default)("option",{value:e._id},`${e.kode} - ${e.nama}`))])]),(0,Je.default)("div",[(0,Je.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Kode"),(0,Je.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500",placeholder:"Contoh: MP001, MP002...",value:this.metodeFormData.kode,oninput:e=>{this.metodeFormData.kode=e.target.value}})]),(0,Je.default)("div",[(0,Je.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Nama"),(0,Je.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500",placeholder:"Masukkan nama metode pengadaan",value:this.metodeFormData.nama,oninput:e=>{this.metodeFormData.nama=e.target.value}})]),(0,Je.default)("div",[(0,Je.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},"Deskripsi"),(0,Je.default)("textarea",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500",placeholder:"Masukkan deskripsi (opsional)",rows:3,value:this.metodeFormData.deskripsi,oninput:e=>{this.metodeFormData.deskripsi=e.target.value}})])])]),(0,Je.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-xl"},[(0,Je.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 rounded-lg text-gray-700 font-medium",onclick:()=>{this.showMetodeModal=!1,this.metodeFormData={_id:null}}},[(0,Je.default)("span","Batal")]),(0,Je.default)("button",{class:`px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-medium ${this.isLoadingMetode?"opacity-50 cursor-not-allowed":""}`,disabled:this.isLoadingMetode,onclick:()=>this.saveMetodePengadaan()},[(0,Je.default)("span",this.isLoadingMetode?"Menyimpan...":this.metodeFormData._id?"Update":"Simpan")])])])])])}},ji=Jo;var P=sr(lr(),1);Wr();var Yo={isLoading:!1,currentUser:null,activeTab:"informasi",anggaranList:[],kinerjaList:[],subKegiatanList:[],pejabatList:[],pengadaanList:[],paketKegiatanList:[],kontrakList:[],currentKontrakContext:{anggaranId:null,kodeRekeningId:null,subKegiatanId:null},showModal:!1,modalMode:"create",isModalLoading:!1,formData:{subKegiatanId:"",kode:"",nama:"",deskripsi:"",budgetYear:"",status:"draft",estimatedBudget:0,actualBudget:0,startDate:"",endDate:"",location:""},selectedSubKegiatan:null,expandedAccordions:new Set,expandedKodeRekeningAccordions:new Set,kodeRekeningCache:new Map,maxCacheSize:100,preventAutoExpand:!0,showKinerjaModal:!1,isKinerjaModalLoading:!1,editingKinerjaId:null,kinerjaFormData:{lokasi:"",penggunaAnggaranId:""},showPaketModal:!1,paketModalMode:"create",isPaketModalLoading:!1,paketFormData:{anggaranId:"",kodeRekeningId:"",uraian:"",volume:1,satuan:"",hargaSatuan:0,budgetYear:"",deskripsi:"",createdBy:"",updatedBy:""},showKontrakModal:!1,kontrakModalMode:"create",isKontrakModalLoading:!1,kontrakFormData:{paketKegiatanId:"",kodeSirupLkpp:"",penyediaId:"",noKontrak:"",tglKontrak:"",noSpmk:"",tglSpmk:"",jangkaWaktu:0,jangkaWaktuUnit:"Hari",tglPelaksanaanDari:"",tglPelaksanaanSampai:"",lokasi:"",hps:0,nilaiKontrak:0,tipe:"Konstruksi",metodePengadaanId:"",kualifikasiPengadaan:"Prakualifikasi",budgetYear:"",deskripsi:""},penyediaList:[],metodePengadaanList:[],tahapanPekerjaanTabs:new Map,showTargetModal:!1,targetModalMode:"create",isTargetModalLoading:!1,editingTargetId:null,targetFormData:{kontrakId:"",tanggal:"",targetFisik:0,targetDana:0,targetDanaRp:0,keterangan:""},targetTrackingData:new Map,currentKontrakForTargetData:null,terminData:[],isSavingTermin:!1,currentKontrakForTermin:null,terminTrackingData:new Map,jaminanData:[],isSavingJaminan:!1,currentKontrakForJaminan:null,jaminanTrackingData:new Map,defaultTahapanTab:"informasi",currentAllocationInfo:{totalAllocation:0,usedAllocation:0,remainingAllocation:0},oninit:function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),P.default.route.set("/login");return}if(this.currentUser=et.getUserData(),console.log("Pengadaan.js - Current user data:",this.currentUser),console.log("Pengadaan.js - namaPerangkatDaerah:",this.currentUser?.namaPerangkatDaerah),console.log("Pengadaan.js - subPerangkatDaerah:",this.currentUser?.subPerangkatDaerah),this.currentUser.role!=="operator"){be.warning("Halaman ini hanya dapat diakses oleh operator"),P.default.route.set("/dashboard");return}if(!this.currentUser.subPerangkatDaerahId){be.warning("Informasi unit kerja tidak ditemukan. Silakan masuk kembali."),P.default.route.set("/login");return}this.loadData()},loadData:async function(){this.isLoading=!0,P.default.redraw();try{this.activeTab==="informasi"?await this.loadInformasiData():this.activeTab==="pengadaan"?await this.loadPengadaanData():this.activeTab==="paket-kegiatan"?await this.loadPaketKegiatanData():this.activeTab==="kontrak"&&await this.loadKontrakData()}catch(e){console.error("Error loading data:",e),e.code===500||e.response&&e.response.status===500?console.log("500 error received, but may be due to empty data - not showing error toast"):be.error("Gagal memuat data")}this.isLoading=!1,P.default.redraw()},loadInformasiData:async function(){try{let r=et.getUserData().subPerangkatDaerahId;if(!r){be.warning("Informasi unit kerja tidak ditemukan");return}let f=new Date().getFullYear(),i=["2026-Murni","2026-PAK"][0];this.formData.budgetYear=i;let t=await Ce.request(`/api/kinerja?subPerangkatDaerahId=${r}&budgetYear=${encodeURIComponent(i)}`);this.kinerjaList=t.data||[];try{let x=await Ce.request("/api/pejabat?jabatanFungsional=Pengguna Anggaran");this.pejabatList=x.data||[],console.log("Pejabat data loaded:",this.pejabatList)}catch(x){console.error("Failed to load pejabat data:",x),this.pejabatList=[]}let n=[],c=new Set;if(this.kinerjaList.forEach(x=>{x.anggaranId&&x.anggaranId._id&&c.add(x.anggaranId._id)}),c.size>0){let x=Array.from(c).map(g=>Ce.request(`/api/anggaran/${g}`));n=(await Promise.all(x)).map(g=>g.data).filter(g=>g)}this.anggaranList=n;let b=new Set;if(this.anggaranList.forEach(x=>{x.subKegiatanId&&b.add(x.subKegiatanId._id||x.subKegiatanId)}),this.kinerjaList.forEach(x=>{x.subKegiatanId&&b.add(x.subKegiatanId._id||x.subKegiatanId)}),b.size>0){let w=(await Ce.getAll("subkegiatan")).data||[];this.subKegiatanList=w.filter(g=>b.has(g._id))}else this.subKegiatanList=[]}catch(e){console.error("Error loading informasi data:",e),e.code===500||e.response&&e.response.status===500?console.log("500 error received, but may be due to empty data - not showing error toast"):be.error("Gagal memuat data informasi unit kerja")}},loadPengadaanData:async function(){try{await this.loadInformasiData();let r=et.getUserData().subPerangkatDaerahId,f=new Date().getFullYear(),i=["2026-Murni","2026-PAK"][0];if(!r){be.warning("Informasi unit kerja tidak ditemukan");return}try{let[t,n]=await Promise.all([Ce.getAll("penyedia"),Ce.getAll("metode-pengadaan")]);this.penyediaList=t.data||[],this.metodePengadaanList=n.data||[]}catch(t){console.error("Error loading penyedia/metode pengadaan data:",t),this.penyediaList=[],this.metodePengadaanList=[]}try{await this.loadPaketKegiatanData()}catch(t){console.error("Error loading paket kegiatan data:",t),this.paketKegiatanList=[]}try{await this.loadKontrakData()}catch(t){console.error("Error loading kontrak data:",t),this.kontrakList=[]}console.log("Pengadaan data loaded, penyedia:",this.penyediaList.length,"metode pengadaan:",this.metodePengadaanList.length,"paket kegiatan:",this.paketKegiatanList.length,"kontrak:",this.kontrakList.length)}catch(e){console.error("Error loading pengadaan data:",e),be.error("Gagal memuat data pengadaan")}},loadPaketKegiatanData:async function(){try{await this.loadInformasiData();let r=et.getUserData().subPerangkatDaerahId,f=new Date().getFullYear(),i=["2026-Murni","2026-PAK"][0];if(!r){be.warning("Informasi unit kerja tidak ditemukan");return}let t={};this.kinerjaList.forEach(w=>{let g=w.anggaranId?._id||w.anggaranId,o=w.subKegiatanId?._id||w.subKegiatanId;t[w._id]||(t[w._id]={kinerja:w,anggaranId:g,subKegiatanId:o,kodeRekeningIds:new Set});let u=this.anggaranList.find(h=>h._id===g);u&&u.allocations&&u.allocations.forEach(h=>{if(h.kodeRekeningId){let l=typeof h.kodeRekeningId=="string"?h.kodeRekeningId:h.kodeRekeningId._id||h.kodeRekeningId;t[w._id].kodeRekeningIds.add(l)}})});let n=`subPerangkatDaerahId=${r}&budgetYear=${encodeURIComponent(i)}`,c=new Set,b=new Set;if(Object.values(t).forEach(w=>{b.add(w.anggaranId),w.kodeRekeningIds.forEach(g=>c.add(g))}),b.size>0){let w=Array.from(b);n+=`&anggaranIds=${w.join(",")}`}if(c.size>0){let w=Array.from(c);n+=`&kodeRekeningIds=${w.join(",")}`}console.log("Loading paket kegiatan with query:",n);let x=await Ce.request(`/api/paketkegiatan?${n}`);this.paketKegiatanList=x.data||[],this.paketKegiatanList.length===0&&console.log("No paket kegiatan data found - this is normal for new installations")}catch(e){console.error("Error loading paket kegiatan data:",e),e.code===500||e.response&&e.response.status===500?(console.log("500 error received, but may be due to empty data - not showing error toast"),this.paketKegiatanList=[]):(be.error("Gagal memuat data paket kegiatan"),this.paketKegiatanList=[])}},loadKontrakData:async function(){try{await this.loadPaketKegiatanData();let r=et.getUserData().subPerangkatDaerahId,f=new Date().getFullYear(),i=["2026-Murni","2026-PAK"][0];if(!r){be.warning("Informasi unit kerja tidak ditemukan");return}let t=new Set,n=new Set;this.paketKegiatanList.forEach(x=>{if(x.kodeRekeningId){let w=typeof x.kodeRekeningId=="string"?x.kodeRekeningId:x.kodeRekeningId._id||x.kodeRekeningId;t.add(w)}if(x.anggaranId){let w=typeof x.anggaranId=="string"?x.anggaranId:x.anggaranId._id||x.anggaranId;n.add(w)}});let c=`subPerangkatDaerahId=${r}&budgetYear=${encodeURIComponent(i)}`;if(t.size>0){let x=Array.from(t);c+=`&kodeRekeningIds=${x.join(",")}`}if(n.size>0){let x=Array.from(n);c+=`&anggaranIds=${x.join(",")}`}console.log("Loading kontrak with query:",c);let b=await Ce.request(`/api/kontrak?${c}`);this.kontrakList=b.data||[],await this.loadKontrakRelatedData(),console.log("Kontrak data loaded:",this.kontrakList.length,"kontrak found")}catch(e){console.error("Error loading kontrak data:",e),e.code===500||e.response&&e.response.status===500?(console.log("500 error received, but may be due to empty data - not showing error toast"),this.kontrakList=[]):(be.error("Gagal memuat data kontrak"),this.kontrakList=[])}},loadKontrakRelatedData:async function(){try{if(this.penyediaList.length===0)try{let e=await Ce.getAll("penyedia");this.penyediaList=e.data||[]}catch(e){console.error("Error loading penyedia data for kontrak:",e),this.penyediaList=[]}try{await this.loadPaketKegiatanData()}catch(e){console.error("Error refreshing paket kegiatan data for kontrak:",e)}this.kontrakList.forEach(e=>{if(e.penyediaId){let r=typeof e.penyediaId=="string"?e.penyediaId:e.penyediaId._id||e.penyediaId,f=this.penyediaList.find(a=>a._id===r);f&&(e.penyediaId=f)}if(e.paketKegiatanId){let r=typeof e.paketKegiatanId=="string"?e.paketKegiatanId:e.paketKegiatanId._id||e.paketKegiatanId,f=this.paketKegiatanList.find(a=>a._id===r);f&&(e.paketKegiatanId=f)}})}catch(e){console.error("Error loading related data for kontrak:",e)}},toggleAccordion:function(e){this.expandedAccordions.has(e)?this.expandedAccordions.delete(e):(this.expandedAccordions.add(e),this.ensureKodeRekeningDataLoaded(e)),P.default.redraw()},toggleKodeRekeningAccordion:function(e){let r=typeof e=="string"?e:e&&e._id?e._id:String(e);this.expandedKodeRekeningAccordions.has(r)?this.expandedKodeRekeningAccordions.delete(r):this.expandedKodeRekeningAccordions.add(r),P.default.redraw()},ensureKodeRekeningDataLoaded:function(e){console.log("=== DEBUG: ensureKodeRekeningDataLoaded called for subKegiatanId:",e);let r=this.getKodeRekeningAllocationsForSubKegiatan(e);console.log("=== DEBUG: Found allocations:",r.length),console.log("=== DEBUG: Allocation details:",r.map(a=>({anggaranId:a.anggaranId,kodeRekeningId:a.kodeRekeningId,isTemp:a.kodeRekeningId&&a.kodeRekeningId._temp,kodeId:a.kodeRekeningId&&a.kodeRekeningId._id})));let f=r.filter(a=>a.kodeRekeningId&&a.kodeRekeningId._temp).map(a=>a.kodeRekeningId._id);if(console.log("=== DEBUG: Missing IDs found:",f.length,f),f.length>0)console.log("Fetching missing kode rekening data for IDs:",f),this.fetchMissingKodeRekeningData(f,r);else{console.log("=== DEBUG: No missing IDs found, checking if data needs refresh...");let a=r.filter(i=>i.kodeRekeningId&&i.kodeRekeningId._id).map(i=>i.kodeRekeningId._id);a.length>0&&(console.log("=== DEBUG: Forcing refresh for IDs:",a),this.fetchMissingKodeRekeningData(a,r))}},openCreateModal:function(){this.modalMode="create",this.formData={subKegiatanId:"",kode:"",nama:"",deskripsi:"",budgetYear:this.formData.budgetYear||"2026-Murni",status:"draft",estimatedBudget:0,actualBudget:0,startDate:"",endDate:"",location:""},this.showModal=!0,P.default.redraw()},closeModal:function(){this.showModal=!1,this.formData={subKegiatanId:"",kode:"",nama:"",deskripsi:"",budgetYear:"2026-Murni",status:"draft",estimatedBudget:0,actualBudget:0,startDate:"",endDate:"",location:""},P.default.redraw()},savePengadaan:async function(){if(!this.formData.subKegiatanId||!this.formData.kode||!this.formData.nama||!this.formData.budgetYear){be.warning("SubKegiatan, kode, nama, dan tahun anggaran harus diisi");return}this.isModalLoading=!0,P.default.redraw();try{let e=et.getUserData(),r={...this.formData,subPerangkatDaerahId:e.subPerangkatDaerahId,createdBy:e.username,updatedBy:e.username};await Ce.create("pengadaan",r),this.closeModal(),this.loadPengadaanData()}catch(e){console.error("Error saving pengadaan:",e)}this.isModalLoading=!1,P.default.redraw()},editItem:function(e){this.modalMode="edit",this.formData={subKegiatanId:e.subKegiatanId?._id||e.subKegiatanId,kode:e.kode,nama:e.nama,deskripsi:e.deskripsi||"",budgetYear:e.budgetYear,status:e.status,estimatedBudget:e.estimatedBudget||0,actualBudget:e.actualBudget||0,startDate:e.startDate?e.startDate.split("T")[0]:"",endDate:e.endDate?e.endDate.split("T")[0]:"",location:e.location||""},this.showModal=!0,P.default.redraw()},deleteItem:function(e){Ce.delete("pengadaan",e._id,e.nama),setTimeout(()=>this.loadPengadaanData(),1e3)},editPaketKegiatan:function(e){this.paketModalMode="edit",this.paketFormData={_id:e._id,anggaranId:e.anggaranId?._id||e.anggaranId,kodeRekeningId:e.kodeRekeningId?._id||e.kodeRekeningId,uraian:e.uraian||"",volume:e.volume||1,satuan:e.satuan||"",hargaSatuan:e.hargaSatuan||0,budgetYear:e.budgetYear||"2026-Murni",deskripsi:e.deskripsi||"",status:e.status||"draft"},this.showPaketModal=!0,P.default.redraw()},deletePaketKegiatan:async function(e){try{await Ce.delete("paketkegiatan",e._id,e.uraian),await this.loadPaketKegiatanData()}catch(r){console.error("Error deleting paket kegiatan:",r)}},editKinerjaInfo:function(e){let r=this.kinerjaList.filter(f=>(f.subKegiatanId?._id||f.subKegiatanId)===e);if(r.length>0){let f=r[0];this.editingKinerjaId=f._id,this.kinerjaFormData={lokasi:f.lokasi||this.currentUser.subPerangkatDaerah?.perangkatDaerahId?.namaPemda||"",penggunaAnggaranId:f.penggunaAnggaran?._id||f.penggunaAnggaran||""}}else this.editingKinerjaId=null,this.kinerjaFormData={lokasi:this.currentUser.subPerangkatDaerah?.perangkatDaerahId?.namaPemda||"",penggunaAnggaranId:""};this.showKinerjaModal=!0,P.default.redraw()},closeKinerjaModal:function(){this.showKinerjaModal=!1,this.editingKinerjaId=null,this.kinerjaFormData={lokasi:"",penggunaAnggaranId:""},P.default.redraw()},closePaketModal:function(){this.showPaketModal=!1,this.paketModalMode="create",this.paketFormData={anggaranId:"",kodeRekeningId:"",uraian:"",volume:1,satuan:"",hargaSatuan:0,budgetYear:"",deskripsi:"",createdBy:"",updatedBy:""},P.default.redraw()},openTargetModal:function(e,r=null){this.targetModalMode=r?"edit":"create",this.editingTargetId=r?r._id:null,this.targetFormData={kontrakId:e._id,tanggal:r&&r.tanggal?r.tanggal.split("T")[0]:"",targetFisik:r&&r.targetFisik||0,targetDana:r&&r.targetDana||0,targetDanaRp:r&&r.targetDanaRp||0,keterangan:r&&r.keterangan||""},this.currentKontrakForValidation=e,this.showTargetModal=!0,P.default.redraw()},editTarget:function(e,r){this.targetModalMode="edit",this.editingTargetId=r._id,this.targetFormData={kontrakId:e._id,tanggal:r.tanggal?r.tanggal.split("T")[0]:"",targetFisik:r.targetFisik||0,targetDana:r.targetDana||0,targetDanaRp:r.targetDanaRp||0,keterangan:r.keterangan||""},this.currentKontrakForValidation=e,console.log("Edit target - kontrakId:",e._id,"targetId:",r._id),this.showTargetModal=!0,P.default.redraw()},deleteTarget:function(e,r,f){let a=`Target Progress ${f}`;ia("Apakah Anda yakin ingin menghapus target progress ini?",async()=>{try{await Ce.delete("target",r,a),be.success("Target progress berhasil dihapus"),await this.loadTargetData(e._id),this.showTargetModal&&this.closeTargetModal(),P.default.redraw()}catch(i){console.error("Error deleting target:",i)}},()=>{console.log("Penghapusan target progress dibatalkan")})},closeTargetModal:function(){this.showTargetModal=!1,this.targetModalMode="create",this.editingTargetId=null,this.currentKontrakForValidation=null,this.targetFormData={kontrakId:"",tanggal:"",targetFisik:0,targetDana:0,targetDanaRp:0,keterangan:""},P.default.redraw()},closeKontrakModal:function(){this.showKontrakModal=!1,this.kontrakModalMode="create",this.kontrakFormData={paketKegiatanId:"",kodeSirupLkpp:"",penyediaId:"",noKontrak:"",tglKontrak:"",noSpmk:"",tglSpmk:"",jangkaWaktu:0,jangkaWaktuUnit:"Hari",tglPelaksanaanDari:"",tglPelaksanaanSampai:"",lokasi:"",hps:0,nilaiKontrak:0,tipe:"Konstruksi",metodePengadaanId:"",kualifikasiPengadaan:"Prakualifikasi",budgetYear:"",deskripsi:""},P.default.redraw()},calculateEndDate:function(){let{tglPelaksanaanDari:e,jangkaWaktu:r,jangkaWaktuUnit:f}=this.kontrakFormData;if(!e||!r||r<=0){this.kontrakFormData.tglPelaksanaanSampai="",P.default.redraw();return}let a=new Date(e);if(isNaN(a.getTime())){this.kontrakFormData.tglPelaksanaanSampai="",P.default.redraw();return}let i=new Date(a);switch(f){case"Hari":i.setDate(i.getDate()+parseInt(r));break;case"Minggu":i.setDate(i.getDate()+parseInt(r)*7);break;case"Bulan":i.setMonth(i.getMonth()+parseInt(r));break;case"Tahun":i.setFullYear(i.getFullYear()+parseInt(r));break;default:i.setDate(i.getDate()+parseInt(r))}let t=i.toISOString().split("T")[0];this.kontrakFormData.tglPelaksanaanSampai=t,P.default.redraw()},getDefaultLokasi:function(e){let r=this.kinerjaList.filter(a=>(a.subKegiatanId?._id||a.subKegiatanId)===e),f="Tidak ditentukan";if(r.length>0&&r[0].lokasi)f=r[0].lokasi;else if(this.currentUser.subPerangkatDaerah?.perangkatDaerahId?.namaPemda){let a=this.currentUser.subPerangkatDaerah.perangkatDaerahId.namaPemda;a&&(a=a.replace(/^ Pemerintah\s+/,""),a=a.replace(/^Pemkab\s+/,"Kabupaten "),a=a.replace(/^Pemkab\s+/,"Kabupaten "),a=a.replace(/^Pemkot\s+/,"Kota "),a=a.replace(/^Kabupaten\s+([A-Za-z\s]+)/,"Kabupaten $1"),a=a.replace(/^Kota\s+([A-Za-z\s]+)/,"Kota $1"),a=a.replace(/^Pemkot\s+/,"Kota ")),f=a}return f},getFormattedLocation:function(){if(this.currentUser.subPerangkatDaerah?.perangkatDaerahId?.namaPemda){let e=this.currentUser.subPerangkatDaerah.perangkatDaerahId.namaPemda;if(console.log("Original namaPemda:",e),e)return e=e.replace(/^.*?(Kota|Kabupaten)\s+/,"$1 "),e=e.replace(/^\s+/,""),e=e.replace(/^ Pemerintah\s+/,""),e=e.replace(/^\s+/,"Kabupaten "),e=e.replace(/^Pemkab\s+/,"Kabupaten "),e=e.replace(/^Pemkot\s+/,"Kota "),e=e.replace(/^Clinton\s+/,""),e=e.replace(/^Democratic\s+/,""),e=e.replace(/^Democrats\s+/,""),e=e.replace(/^Kabupaten\s+([A-Za-z\s]+)/,"Kabupaten $1"),e=e.replace(/^Kota\s+([A-Za-z\s]+)/,"Kota $1"),e=e.replace(/^Pemkot\s+/,"Kota "),console.log("Cleaned namaPemda:",e),e||"Tidak ditentukan"}return"Tidak ditentukan"},renderTahapanPekerjaanTabs:function(e){this.tahapanPekerjaanTabs.has(e._id)||this.tahapanPekerjaanTabs.set(e._id,{activeTab:this.defaultTahapanTab,formData:{}});let f=this.tahapanPekerjaanTabs.get(e._id).activeTab;return(0,P.default)("div",{class:"mt-4"},[(0,P.default)("div",{class:"border-b border-gray-200"},[(0,P.default)("nav",{class:"flex space-x-8"},[(0,P.default)("button",{class:`py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${f==="informasi"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:()=>{let a=this.tahapanPekerjaanTabs.get(e._id);a.activeTab="informasi",P.default.redraw()}},[(0,P.default)("i",{class:"ri-information-line mr-2"}),"Informasi"]),(0,P.default)("button",{class:`py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${f==="target"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:()=>{let a=this.tahapanPekerjaanTabs.get(e._id);if(a.activeTab="target",this.currentKontrakForTargetData=e._id,!this.targetTrackingData.has(e._id))this.loadTargetData(e._id);else{let i=this.targetTrackingData.get(e._id);i&&i.length>0}P.default.redraw()}},[(0,P.default)("i",{class:"ri-target-fill mr-2"}),"Target"]),(0,P.default)("button",{class:`py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${f==="termin"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:()=>{let a=this.tahapanPekerjaanTabs.get(e._id);if(a.activeTab="termin",this.currentKontrakForTermin=e._id,!this.terminTrackingData.has(e._id))this.loadTerminData(e._id);else{let i=this.terminTrackingData.get(e._id);i&&i.length>0&&(this.terminData=i)}P.default.redraw()}},[(0,P.default)("i",{class:"ri-timer-line mr-2"}),"Termin"]),(0,P.default)("button",{class:`py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${f==="jaminan"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:()=>{let a=this.tahapanPekerjaanTabs.get(e._id);if(a.activeTab="jaminan",this.currentKontrakForJaminan=e._id,!this.jaminanTrackingData.has(e._id))this.loadJaminanData(e._id);else{let i=this.jaminanTrackingData.get(e._id);i&&i.length>0&&(this.jaminanData=i)}P.default.redraw()}},[(0,P.default)("i",{class:"ri-shield-check-line mr-2"}),"Jaminan"])])]),(0,P.default)("div",{class:"p-4"},[f==="informasi"&&(0,P.default)("div",{class:"bg-white"},[(0,P.default)("div",{class:"bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-t-lg"},[(0,P.default)("div",{class:"flex items-center space-x-3"},[(0,P.default)("div",{class:"w-10 h-10 bg-white bg-opacity-75 rounded-full flex items-center justify-center"},[(0,P.default)("i",{class:"ri-file-contract-fill text-lg"})]),(0,P.default)("div",[(0,P.default)("h3",{class:"text-lg font-bold"},"Informasi Kontrak"),(0,P.default)("p",{class:"text-white text-opacity-80 text-sm"},"Detail informasi tahapan pekerjaan")])])]),(0,P.default)("div",{class:"p-6 space-y-4"},[(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,P.default)("i",{class:"ri-hashtag mr-1 text-blue-500"}),"No. Kontrak"]),(0,P.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm font-mono text-gray-900"},e.noKontrak||"N/A")]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,P.default)("i",{class:"ri-calendar-line mr-1 text-green-500"}),"Tgl. Kontrak"]),(0,P.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-900"},e.tglKontrak?new Date(e.tglKontrak).toLocaleDateString("id-ID"):"N/A")])]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,P.default)("i",{class:"ri-building-line mr-1 text-purple-500"}),"Nama Penyedia (Penyedia B/J)"]),(0,P.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-900"},e.penyediaId?.NamaVendor||"N/A")]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,P.default)("i",{class:"ri-file-text-line mr-1 text-orange-500"}),"No. SPMK"]),(0,P.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm font-mono text-gray-900"},e.noSpmk||"N/A")])]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,P.default)("i",{class:"ri-calendar-check-line mr-1 text-indigo-500"}),"Tgl. SPMK"]),(0,P.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-900"},e.tglSpmk?new Date(e.tglSpmk).toLocaleDateString("id-ID"):"N/A")]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,P.default)("i",{class:"ri-calendar-event-line mr-1 text-red-500"}),"Tgl Pelaksanaan - selesai"]),(0,P.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-900"},e.tglPelaksanaanSampai?new Date(e.tglPelaksanaanSampai).toLocaleDateString("id-ID"):"N/A")])]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,P.default)("i",{class:"ri-map-pin-line mr-1 text-teal-500"}),"Lokasi Kegiatan"]),(0,P.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-900"},e.lokasi||"N/A")]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,P.default)("i",{class:"ri-money-dollar-circle-line mr-1 text-yellow-500"}),"Nilai Kontrak"]),(0,P.default)("div",{class:"px-3 py-2 bg-green-50 border border-green-200 rounded-md text-sm font-bold text-green-800"},`Rp ${e.nilaiKontrak?.toLocaleString("id-ID")||"0"}`)])])])]),f==="target"&&(()=>{this.currentKontrakForTargetData=e._id,this.targetTrackingData.has(e._id)||this.loadTargetData(e._id);let a=this.targetTrackingData.get(e._id)||[];return(0,P.default)("div",{class:"space-y-4"},[(0,P.default)("div",{class:"flex justify-between items-center"},[(0,P.default)("h4",{class:"text-lg font-semibold text-gray-800 flex items-center"},[(0,P.default)("i",{class:"ri-target-line mr-2 text-blue-500"}),"Target Progress"]),(0,P.default)("button",{class:"px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white text-sm font-medium rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200 flex items-center space-x-2",onclick:i=>{i.preventDefault(),this.openTargetModal(e)}},[(0,P.default)("i",{class:"ri-add-line"}),(0,P.default)("span","Tambah Target")])]),e.tglPelaksanaanDari&&e.tglPelaksanaanSampai&&(0,P.default)("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4"},[(0,P.default)("div",{class:"flex items-center text-sm text-blue-700"},[(0,P.default)("i",{class:"ri-information-line mr-2"}),"Periode Kontrak: ",(0,P.default)("span",{class:"font-medium"},new Date(e.tglPelaksanaanDari).toLocaleDateString("id-ID")),(0,P.default)("span",{class:"mx-1"},"-"),(0,P.default)("span",{class:"font-medium"},new Date(e.tglPelaksanaanSampai).toLocaleDateString("id-ID"))])]),(0,P.default)("div",{class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},[(0,P.default)("table",{class:"w-full"},[(0,P.default)("thead",{class:"bg-gray-50"},[(0,P.default)("tr",[(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tanggal"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Target Fisik (%)"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Target Dana (%)"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Target Dana (Rp)"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Keterangan"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,P.default)("tbody",{class:"bg-white divide-y divide-gray-200"},a.length>0?a.map((i,t)=>(0,P.default)("tr",{key:i._id||t},[(0,P.default)("td",{class:"px-4 py-3 text-sm text-gray-900"},new Date(i.tanggal).toLocaleDateString("id-ID")),(0,P.default)("td",{class:"px-4 py-3 text-sm text-gray-900"},`${i.targetFisik||i.target_fisik||0}%`),(0,P.default)("td",{class:"px-4 py-3 text-sm text-gray-900"},`${i.targetDana||i.target_dana||0}%`),(0,P.default)("td",{class:"px-4 py-3 text-sm text-gray-900"},`Rp ${new Intl.NumberFormat("id-ID").format(i.targetDanaRp||i.target_dana_rp||0)}`),(0,P.default)("td",{class:"px-4 py-3 text-sm text-gray-900"},i.keterangan||"-"),(0,P.default)("td",{class:"px-4 py-3 text-sm"},[(0,P.default)("button",{class:"text-blue-600 hover:text-blue-800 text-sm font-medium mr-3",onclick:n=>{n.preventDefault(),this.editTarget(e,i)}},[(0,P.default)("i",{class:"ri-edit-line mr-1"}),"Edit"]),(0,P.default)("button",{class:"text-red-600 hover:text-red-800 text-sm font-medium",onclick:n=>{n.preventDefault(),this.deleteTarget(e,i._id,i.tanggal)}},[(0,P.default)("i",{class:"ri-delete-bin-line mr-1"}),"Hapus"])])])):[(0,P.default)("tr",[(0,P.default)("td",{class:"px-4 py-8 text-center text-gray-500",colSpan:6},[(0,P.default)("i",{class:"ri-target-line text-4xl text-gray-300 mb-2 block"}),"Belum ada target progress",(0,P.default)("div",{class:"text-sm text-gray-400 mt-1"},'Klik "Tambah Target" untuk menambahkan target progress')])])])])]),a.length>0&&(()=>{let i=a.reduce((c,b)=>c+(b.targetFisik||b.target_fisik||0),0),t=a.reduce((c,b)=>c+(b.targetDana||b.target_dana||0),0),n=i===100&&t===100;return(0,P.default)("div",{class:`rounded-lg p-3 mt-4 ${n?"bg-green-50 border border-green-200":"bg-orange-50 border border-orange-200"}`},[(0,P.default)("div",{class:"flex items-start"},[(0,P.default)("i",{class:`${n?"ri-check-line text-green-500":"ri-alert-line text-orange-500"} mr-2 mt-0.5`}),(0,P.default)("div",{class:"text-sm"},[(0,P.default)("div",{class:`font-medium mb-1 ${n?"text-green-700":"text-orange-700"}`},"Status Validasi Target:"),(0,P.default)("div",{class:`${n?"text-green-600":"text-orange-600"}`},n?"Target progress sudah mencapai 100% untuk fisik dan dana!":"Target progress belum mencapai 100% untuk fisik dan dana"),(0,P.default)("div",{class:`mt-2 text-xs ${n?"text-green-600":"text-orange-600"}`},["Total Fisik: ",(0,P.default)("span",{class:"font-medium"},`${i}%`)," | Total Dana: ",(0,P.default)("span",{class:"font-medium"},`${t}%`)])])])])})(),(0,P.default)("div",{class:"bg-amber-50 border border-amber-200 rounded-lg p-3 mt-4"},[(0,P.default)("div",{class:"flex items-start"},[(0,P.default)("i",{class:"ri-warning-line text-amber-500 mr-2 mt-0.5"}),(0,P.default)("div",{class:"text-sm text-amber-700"},[(0,P.default)("div",{class:"font-medium mb-1"},"Catatan Validasi:"),(0,P.default)("ul",{class:"list-disc list-inside space-y-1"},[(0,P.default)("li","Tanggal target harus berada dalam periode kontrak"),(0,P.default)("li","Target total harus mencapai 100% untuk fisik dan dana"),(0,P.default)("li","Target dana dalam Rupiah akan dihitung otomatis dari persentase")])])])])])})(),f==="termin"&&(()=>{this.currentKontrakForTermin=e._id,this.terminTrackingData.has(e._id)||this.loadTerminData(e._id);let a=this.terminTrackingData.get(e._id)||[];return a.length>0&&this.terminData.length===0&&(this.terminData=a),this.terminData||(this.terminData=[]),(0,P.default)("div",{class:"space-y-4"},[(0,P.default)("div",{class:"flex justify-between items-center"},[(0,P.default)("h4",{class:"text-lg font-semibold text-gray-800 flex items-center"},[(0,P.default)("i",{class:"ri-timer-line mr-2 text-green-500"}),"Termin Pembayaran"]),(0,P.default)("button",{class:"px-4 py-2 bg-gradient-to-r from-green-500 to-teal-600 text-white text-sm font-medium rounded-lg hover:from-green-600 hover:to-teal-700 transition-all duration-200 flex items-center space-x-2",onclick:()=>this.addTerminRow()},[(0,P.default)("i",{class:"ri-add-line"}),(0,P.default)("span","Tambah Termin")])]),(0,P.default)("div",{class:"bg-green-50 border border-green-200 rounded-lg p-3 mb-4"},[(0,P.default)("div",{class:"flex items-center text-sm text-green-700"},[(0,P.default)("i",{class:"ri-information-line mr-2"}),"Nilai Kontrak: ",(0,P.default)("span",{class:"font-medium"},`Rp ${(e.nilaiKontrak||0).toLocaleString("id-ID")}`)])]),(0,P.default)("div",{class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},[(0,P.default)("table",{class:"w-full"},[(0,P.default)("thead",{class:"bg-gray-50"},[(0,P.default)("tr",[(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Termin"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"% Termin"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Jumlah Dana (Rp)"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"% Progress"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,P.default)("tbody",{class:"bg-white divide-y divide-gray-200"},[this.terminData.length>0?this.terminData.map((i,t)=>(0,P.default)("tr",{key:t},[(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("input",{type:"text",class:"w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:border-green-500 focus:ring-1 focus:ring-green-200",value:i.termin||"",placeholder:"I, II, Pertama, Kedua...",oninput:n=>{i.termin=n.target.value,this.calculateTerminPercentages(),P.default.redraw()}})]),(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("input",{type:"number",class:"w-full px-3 py-2 border border-gray-200 rounded text-sm bg-gray-50",value:i.terminPercent||0,readonly:!0,placeholder:"0"})]),(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("input",{type:"text",class:"w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:border-green-500 focus:ring-1 focus:ring-green-200",value:i.jumlahDana?i.jumlahDana.toLocaleString("id-ID"):"",placeholder:"0",oninput:n=>{let c=n.target.value.replace(/[^\d]/g,"");i.jumlahDana=parseInt(c)||0,n.target.value=i.jumlahDana.toLocaleString("id-ID"),this.validateTerminTotals(),P.default.redraw()}})]),(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("input",{type:"number",min:"0",max:"100",step:"0.01",class:"w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:border-green-500 focus:ring-1 focus:ring-green-200",value:i.progressPercent||0,placeholder:"0-100",oninput:n=>{i.progressPercent=parseFloat(n.target.value)||0,this.validateTerminTotals(),P.default.redraw()}})]),(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("button",{class:"text-red-600 hover:text-red-800 text-sm font-medium",onclick:()=>this.removeTerminRow(t)},[(0,P.default)("i",{class:"ri-delete-bin-line mr-1"}),"Hapus"])])])):[(0,P.default)("tr",[(0,P.default)("td",{class:"px-4 py-8 text-center text-gray-500",colSpan:5},[(0,P.default)("i",{class:"ri-timer-line text-4xl text-gray-300 mb-2 block"}),"Belum ada termin pembayaran",(0,P.default)("div",{class:"text-sm text-gray-400 mt-1"},'Klik "Tambah Termin" untuk menambahkan termin pembayaran')])])],this.terminData.length>0&&(0,P.default)("tr",{class:"bg-gray-50 font-semibold"},[(0,P.default)("td",{class:"px-4 py-3 text-sm text-gray-900"},"TOTAL"),(0,P.default)("td",{class:"px-4 py-3 text-sm text-gray-900"},`${this.terminData.length} Termin`),(0,P.default)("td",{class:"px-4 py-3 text-sm text-gray-900"},`Rp ${this.terminData.reduce((i,t)=>i+(t.jumlahDana||0),0).toLocaleString("id-ID")}`),(0,P.default)("td",{class:"px-4 py-3 text-sm text-gray-900"},`${this.terminData.reduce((i,t)=>i+(t.progressPercent||0),0).toFixed(2)}%`),(0,P.default)("td",{class:"px-4 py-3 text-sm"},"")])])])]),(0,P.default)("div",{class:"space-y-3 mt-4"},[(()=>{let i=this.terminData.reduce((c,b)=>c+(b.jumlahDana||0),0),t=e.nilaiKontrak||0,n=i<=t;return(0,P.default)("div",{class:`rounded-lg p-3 ${n?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`},[(0,P.default)("div",{class:"flex items-start"},[(0,P.default)("i",{class:`${n?"ri-check-line text-green-500":"ri-error-warning-line text-red-500"} mr-2 mt-0.5`}),(0,P.default)("div",{class:"text-sm"},[(0,P.default)("div",{class:`font-medium mb-1 ${n?"text-green-700":"text-red-700"}`},"Validasi Jumlah Dana:"),(0,P.default)("div",{class:`${n?"text-green-600":"text-red-600"}`},`Total Jumlah Dana: Rp ${i.toLocaleString("id-ID")} / Rp ${t.toLocaleString("id-ID")}`),!n&&(0,P.default)("div",{class:"text-red-600 text-xs mt-1"},`Melebihi nilai kontrak sebesar Rp ${(i-t).toLocaleString("id-ID")}`)])])])})(),(()=>{let i=this.terminData.reduce((n,c)=>n+(c.progressPercent||0),0),t=Math.abs(i-100)<.01;return(0,P.default)("div",{class:`rounded-lg p-3 ${t?"bg-green-50 border border-green-200":"bg-orange-50 border border-orange-200"}`},[(0,P.default)("div",{class:"flex items-start"},[(0,P.default)("i",{class:`${t?"ri-check-line text-green-500":"ri-alert-line text-orange-500"} mr-2 mt-0.5`}),(0,P.default)("div",{class:"text-sm"},[(0,P.default)("div",{class:`font-medium mb-1 ${t?"text-green-700":"text-orange-700"}`},"Validasi Progress:"),(0,P.default)("div",{class:`${t?"text-green-600":"text-orange-600"}`},`Total Progress: ${i.toFixed(2)}%`),!t&&(0,P.default)("div",{class:"text-orange-600 text-xs mt-1"},i<100?`Kurang ${(100-i).toFixed(2)}% untuk mencapai 100%`:`Lebih ${(i-100).toFixed(2)}% dari 100%`)])])])})()]),this.terminData.length>0&&(0,P.default)("div",{class:"flex justify-end mt-6"},[(0,P.default)("button",{class:`px-6 py-3 font-medium rounded-lg transition-all duration-200 flex items-center space-x-2 ${this.isTerminValid()?"bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white shadow-lg hover:shadow-xl":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,onclick:()=>this.saveTerminData(e),disabled:!this.isTerminValid()||this.isSavingTermin},[this.isSavingTermin?(0,P.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,P.default)("i",{class:"ri-save-line"}),(0,P.default)("span",this.isSavingTermin?"Menyimpan...":"Simpan Semua Termin")])])])})(),f==="jaminan"&&(()=>{this.currentKontrakForJaminan=e._id,this.jaminanTrackingData.has(e._id)||this.loadJaminanData(e._id);let a=this.jaminanTrackingData.get(e._id)||[];return a.length>0&&this.jaminanData.length===0&&(this.jaminanData=a),this.jaminanData||(this.jaminanData=[]),(0,P.default)("div",{class:"space-y-4"},[(0,P.default)("div",{class:"flex justify-between items-center"},[(0,P.default)("h4",{class:"text-lg font-semibold text-gray-800 flex items-center"},[(0,P.default)("i",{class:"ri-shield-check-line mr-2 text-purple-500"}),"Jaminan"]),(0,P.default)("button",{class:"px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white text-sm font-medium rounded-lg hover:from-purple-600 hover:to-indigo-700 transition-all duration-200 flex items-center space-x-2",onclick:()=>this.addJaminanRow(e)},[(0,P.default)("i",{class:"ri-add-line"}),(0,P.default)("span","Tambah Jaminan")])]),e.tglPelaksanaanDari&&e.tglPelaksanaanSampai&&(0,P.default)("div",{class:"bg-purple-50 border border-purple-200 rounded-lg p-3 mb-4"},[(0,P.default)("div",{class:"flex items-center text-sm text-purple-700"},[(0,P.default)("i",{class:"ri-information-line mr-2"}),"Periode Kontrak: ",(0,P.default)("span",{class:"font-medium"},new Date(e.tglPelaksanaanDari).toLocaleDateString("id-ID")),(0,P.default)("span",{class:"mx-1"},"-"),(0,P.default)("span",{class:"font-medium"},new Date(e.tglPelaksanaanSampai).toLocaleDateString("id-ID"))])]),(0,P.default)("div",{class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},[(0,P.default)("table",{class:"w-full"},[(0,P.default)("thead",{class:"bg-gray-50"},[(0,P.default)("tr",[(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nomor"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Jenis"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tanggal Mulai"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tanggal Berakhir"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nilai (Rp)"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tanggal Terbit"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Penerbit"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,P.default)("tbody",{class:"bg-white divide-y divide-gray-200"},[this.jaminanData.length>0?this.jaminanData.map((i,t)=>(0,P.default)("tr",{key:t},[(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("input",{type:"text",class:"w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-200",value:i.nomor||"",placeholder:"Nomor jaminan",oninput:n=>{i.nomor=n.target.value,P.default.redraw()}})]),(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("select",{class:"w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-200",value:i.jenis||"",onchange:n=>{i.jenis=n.target.value,P.default.redraw()}},[(0,P.default)("option",{value:""},"Pilih Jenis"),(0,P.default)("option",{value:"Bank Garansi"},"Bank Garansi"),(0,P.default)("option",{value:"Surety Bond"},"Surety Bond"),(0,P.default)("option",{value:"Jaminan dari Lembaga Keuangan Non-Bank"},"Jaminan dari Lembaga Keuangan Non-Bank")])]),(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("input",{type:"date",class:"w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-200",value:i.tanggalMulai||"",oninput:n=>{i.tanggalMulai=n.target.value,P.default.redraw()}})]),(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("input",{type:"date",class:"w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-200",value:i.tanggalBerakhir||"",oninput:n=>{i.tanggalBerakhir=n.target.value,P.default.redraw()}})]),(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("input",{type:"text",class:"w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-200",value:i.nilai?i.nilai.toLocaleString("id-ID"):"",placeholder:"0",oninput:n=>{let c=n.target.value.replace(/[^\d]/g,"");i.nilai=parseInt(c)||0,n.target.value=i.nilai.toLocaleString("id-ID"),this.validateJaminanTotals(),P.default.redraw()}})]),(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("input",{type:"date",class:"w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-200",value:i.tanggalTerbit||"",oninput:n=>{i.tanggalTerbit=n.target.value,P.default.redraw()}})]),(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("input",{type:"text",class:"w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-200",value:i.penerbit||"",placeholder:"Nama penerbit",oninput:n=>{i.penerbit=n.target.value,P.default.redraw()}})]),(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("button",{class:"text-red-600 hover:text-red-800 text-sm font-medium",onclick:n=>{n.preventDefault();let c=`Jaminan ${i.nomor||t+1}`,b=Ce.delete;Ce.delete=async(x,w,g)=>{try{await b.call(Ce,x,w,g),console.log("Refreshing jaminan data after deletion..."),this.jaminanTrackingData.delete(e._id),await this.loadJaminanData(e._id),P.default.redraw()}catch(o){throw console.error("Error in delete with refresh:",o),o}},Ce.delete("jaminan",i._id,c)}},[(0,P.default)("i",{class:"ri-delete-bin-line mr-1"}),"Hapus"])])])):[(0,P.default)("tr",[(0,P.default)("td",{class:"px-4 py-8 text-center text-gray-500",colSpan:8},[(0,P.default)("i",{class:"ri-shield-check-line text-4xl text-gray-300 mb-2 block"}),"Belum ada jaminan",(0,P.default)("div",{class:"text-sm text-gray-400 mt-1"},'Klik "Tambah Jaminan" untuk menambahkan jaminan')])])]])])]),(0,P.default)("div",{class:"space-y-3 mt-4"},[(()=>{let i=this.jaminanData.reduce((c,b)=>c+(b.nilai||0),0),t=e.nilaiKontrak||0,n=i<=t;return(0,P.default)("div",{class:`rounded-lg p-3 ${n?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`},[(0,P.default)("div",{class:"flex items-start"},[(0,P.default)("i",{class:`${n?"ri-check-line text-green-500":"ri-error-warning-line text-red-500"} mr-2 mt-0.5`}),(0,P.default)("div",{class:"text-sm"},[(0,P.default)("div",{class:`font-medium mb-1 ${n?"text-green-700":"text-red-700"}`},"Validasi Nilai Jaminan:"),(0,P.default)("div",{class:`${n?"text-green-600":"text-red-600"}`},`Total Nilai Jaminan: Rp ${i.toLocaleString("id-ID")} / Rp ${t.toLocaleString("id-ID")}`),!n&&(0,P.default)("div",{class:"text-red-600 text-xs mt-1"},`Melebihi nilai kontrak sebesar Rp ${(i-t).toLocaleString("id-ID")}`)])])])})()]),this.jaminanData.length>0&&(0,P.default)("div",{class:"flex justify-end mt-6"},[(0,P.default)("button",{class:`px-6 py-3 font-medium rounded-lg transition-all duration-200 flex items-center space-x-2 ${this.isJaminanValid()?"bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white shadow-lg hover:shadow-xl":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,onclick:()=>this.saveJaminanData(e),disabled:!this.isJaminanValid()||this.isSavingJaminan},[this.isSavingJaminan?(0,P.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,P.default)("i",{class:"ri-save-line"}),(0,P.default)("span",this.isSavingJaminan?"Menyimpan...":"Simpan Semua Jaminan")])]),(0,P.default)("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4"},[(0,P.default)("div",{class:"flex items-start"},[(0,P.default)("i",{class:"ri-information-line text-blue-500 mr-2 mt-0.5"}),(0,P.default)("div",{class:"text-sm text-blue-700"},[(0,P.default)("div",{class:"font-medium mb-1"},"Catatan Validasi Jaminan:"),(0,P.default)("ul",{class:"list-disc list-inside space-y-1"},[(0,P.default)("li","Tanggal terbit jaminan harus lebih awal dari tanggal mulai kontrak"),(0,P.default)("li","Tanggal mulai jaminan default mengikuti tanggal mulai kontrak"),(0,P.default)("li","Tanggal berakhir jaminan default mengikuti tanggal selesai kontrak"),(0,P.default)("li","Tanggal mulai jaminan harus lebih awal dari tanggal berakhir jaminan"),(0,P.default)("li","Nilai jaminan tidak boleh melebihi nilai kontrak")])])])])])})()])])},onPenyediaChange:function(){let e=this.penyediaList.find(r=>r._id===this.kontrakFormData.penyediaId);e?(this.kontrakFormData.pimpinanPenyedia=e.NamaPimpinan||"",this.kontrakFormData.alamatPenyedia=e.Alamat||"",this.kontrakFormData.telpPenyedia=e.Telepon||""):(this.kontrakFormData.pimpinanPenyedia="",this.kontrakFormData.alamatPenyedia="",this.kontrakFormData.telpPenyedia="")},savePaketKegiatan:async function(){if(!this.paketFormData.anggaranId||!this.paketFormData.kodeRekeningId||!this.paketFormData.uraian||this.paketFormData.volume<=0||!this.paketFormData.satuan||this.paketFormData.hargaSatuan<=0||!this.paketFormData.budgetYear){be.warning("Semua field harus diisi dengan benar");return}if(this.paketModalMode==="edit"){let f=this.paketKegiatanList.find(a=>a._id===this.paketFormData._id);if(f){let a=f.volume*f.hargaSatuan,i=this.paketFormData.volume*this.paketFormData.hargaSatuan;if(i!==a){let t=this.getKodeRekeningAllocationsForSubKegiatan(this.selectedSubKegiatan).find(n=>n.kodeRekeningId._id===this.paketFormData.kodeRekeningId||n.kodeRekeningId===this.paketFormData.kodeRekeningId);if(t){let c=this.getPaketKegiatanForKodeRekening(this.paketFormData.kodeRekeningId).filter(x=>x._id!==this.paketFormData._id).reduce((x,w)=>x+(w.jumlah||0),0),b=c+i;if(b>t.amount){let x=t.amount-c;be.warning(`Anggaran tidak mencukupi untuk perubahan ini. Jumlah yang dibutuhkan: Rp ${i.toLocaleString("id-ID")}. Sisa anggaran: Rp ${x.toLocaleString("id-ID")}. Total yang akan terpakai: Rp ${b.toLocaleString("id-ID")} (melebihi batas Rp ${t.amount.toLocaleString("id-ID")})`);return}}}}}let e=this.paketFormData.volume*this.paketFormData.hargaSatuan,r=this.getKodeRekeningAllocationsForSubKegiatan(this.selectedSubKegiatan).find(f=>f.kodeRekeningId._id===this.paketFormData.kodeRekeningId||f.kodeRekeningId===this.paketFormData.kodeRekeningId);if(r){let a=this.getPaketKegiatanForKodeRekening(this.paketFormData.kodeRekeningId).reduce((t,n)=>t+(n.jumlah||0),0),i=a+e;if(i>r.amount){let t=r.amount-a;be.warning(`Anggaran tidak mencukupi. Jumlah yang dibutuhkan: Rp ${e.toLocaleString("id-ID")}. Sisa anggaran: Rp ${t.toLocaleString("id-ID")}. Total yang akan terpakai: Rp ${i.toLocaleString("id-ID")} (melebihi batas Rp ${r.amount.toLocaleString("id-ID")})`);return}}this.isPaketModalLoading=!0,P.default.redraw();try{let f=et.getUserData(),a={...this.paketFormData,subKegiatanId:this.selectedSubKegiatan,subPerangkatDaerahId:f.subPerangkatDaerahId,createdBy:f.username,updatedBy:f.username};this.paketModalMode==="create"?(await Ce.create("paketkegiatan",a),be.success("Paket kegiatan berhasil dibuat")):(await Ce.update("paketkegiatan",this.paketFormData._id,a),be.success("Paket kegiatan berhasil diperbarui")),this.closePaketModal(),console.log("Paket kegiatan saved successfully, refreshing data..."),await this.loadPaketKegiatanData(),console.log("Data refreshed, paketKegiatanList length:",this.paketKegiatanList.length),P.default.redraw(),console.log("Mithril redraw called")}catch(f){console.error("Error saving paket kegiatan:",f)}this.isPaketModalLoading=!1,P.default.redraw()},saveKontrak:async function(){if(!this.kontrakFormData.paketKegiatanId){be.warning("Paket Kegiatan harus dipilih");return}if(!this.kontrakFormData.noKontrak){be.warning("Nomor Kontrak harus diisi");return}if(this.kontrakList.some(f=>this.kontrakModalMode==="edit"&&f._id===this.kontrakFormData._id?!1:f.noKontrak&&f.noKontrak.trim().toLowerCase()===this.kontrakFormData.noKontrak.trim().toLowerCase())){be.error(`Nomor Kontrak "${this.kontrakFormData.noKontrak}" sudah digunakan. Mohon gunakan nomor kontrak yang berbeda.`);return}if(!this.kontrakFormData.tglKontrak){be.warning("Tanggal Kontrak harus diisi");return}if(!this.kontrakFormData.noSpmk){be.warning("Nomor SPMK harus diisi");return}if(!this.kontrakFormData.tglSpmk){be.warning("Tanggal SPMK harus diisi");return}if(!this.kontrakFormData.jangkaWaktu){be.warning("Jangka Waktu harus diisi");return}if(!this.kontrakFormData.penyediaId){be.warning("Penyedia harus dipilih");return}if(!this.kontrakFormData.metodePengadaanId){be.warning("Metode Pengadaan harus dipilih");return}if(!this.kontrakFormData.nilaiKontrak||this.kontrakFormData.nilaiKontrak<=0){be.warning("Nilai Kontrak harus diisi dan lebih dari 0");return}if(this.kontrakFormData.nilaiKontrak>this.currentAllocationInfo.remainingAllocation){be.warning(`Nilai kontrak melebihi sisa alokasi (Max: Rp ${this.currentAllocationInfo.remainingAllocation.toLocaleString("id-ID")})`);return}if(!this.kontrakFormData.kodeSirupLkpp){be.warning("Kode SIRUP LKPP harus diisi");return}if(!this.kontrakFormData.hps||this.kontrakFormData.hps<=0){be.warning("HPS harus diisi dan lebih dari 0");return}if(!this.kontrakFormData.tglPelaksanaanDari){be.warning("Tanggal Pelaksanaan (Dari) harus diisi");return}if(!this.kontrakFormData.tglPelaksanaanSampai){be.warning("Tanggal Pelaksanaan (Sampai) harus diisi");return}if(!this.kontrakFormData.lokasi){be.warning("Lokasi harus diisi");return}let r=et.getUserData();this.kontrakFormData.subPerangkatDaerahId=r.subPerangkatDaerahId,this.kontrakFormData.budgetYear=`${r.budgetYear?.year||"2026"}-${r.budgetYear?.status||"Murni"}`,this.kontrakFormData.createdBy=r.userId,this.kontrakFormData.updatedBy=r.userId,this.kontrakFormData.jangkaWaktuUnit||(this.kontrakFormData.jangkaWaktuUnit="Hari"),this.kontrakFormData.tipe||(this.kontrakFormData.tipe="Konstruksi"),this.kontrakFormData.kualifikasiPengadaan||(this.kontrakFormData.kualifikasiPengadaan="Prakualifikasi"),this.isKontrakModalLoading=!0,P.default.redraw();try{let f;this.kontrakModalMode==="create"?f=await Ce.create("kontrak",this.kontrakFormData):f=await Ce.update("kontrak",this.kontrakFormData._id,this.kontrakFormData),console.log("Kontrak save response:",f),console.log("Response type:",typeof f),console.log("Response keys:",f?Object.keys(f):"null"),f?(be.success(`Kontrak berhasil ${this.kontrakModalMode==="create"?"disimpan":"diperbarui"}`),this.closeKontrakModal(),console.log("Modal closed, new state:",this.showKontrakModal),await this.loadKontrakData(),await this.loadPengadaanData()):console.error("Save failed - no response data:",f)}catch(f){console.error("Error saving kontrak:",f)}this.isKontrakModalLoading=!1,P.default.redraw()},editKontrak:function(e){if(console.log("Editing kontrak:",e),this.kontrakModalMode="edit",this.kontrakFormData={_id:e._id,paketKegiatanId:e.paketKegiatanId?._id||e.paketKegiatanId||"",kodeSirupLkpp:e.kodeSirupLkpp||"",penyediaId:e.penyediaId?._id||e.penyediaId||"",noKontrak:e.noKontrak||"",tglKontrak:e.tglKontrak?e.tglKontrak.split("T")[0]:"",noSpmk:e.noSpmk||"",tglSpmk:e.tglSpmk?e.tglSpmk.split("T")[0]:"",jangkaWaktu:e.jangkaWaktu||0,jangkaWaktuUnit:e.jangkaWaktuUnit||"Hari",tglPelaksanaanDari:e.tglPelaksanaanDari?e.tglPelaksanaanDari.split("T")[0]:"",tglPelaksanaanSampai:e.tglPelaksanaanSampai?e.tglPelaksanaanSampai.split("T")[0]:"",lokasi:e.lokasi||"",hps:e.hps||0,nilaiKontrak:e.nilaiKontrak||0,tipe:e.tipe||"Konstruksi",metodePengadaanId:e.metodePengadaanId?._id||e.metodePengadaanId||"",kualifikasiPengadaan:e.kualifikasiPengadaan||"Prakualifikasi",budgetYear:e.budgetYear||"",deskripsi:e.deskripsi||""},this.kontrakFormData.penyediaId&&this.onPenyediaChange(),e.paketKegiatanId){let r=e.paketKegiatanId?._id||e.paketKegiatanId,f=this.paketKegiatanList.find(a=>a._id===r);if(f){this.currentKontrakContext={anggaranId:f.anggaranId?._id||f.anggaranId,kodeRekeningId:f.kodeRekeningId?._id||f.kodeRekeningId,subKegiatanId:f.subKegiatanId?._id||f.subKegiatanId};let a=f.subKegiatanId?._id||f.subKegiatanId,i=f.kodeRekeningId?._id||f.kodeRekeningId;i&&a&&(this.currentAllocationInfo=this.calculateAllocationInfoForKodeRekening(i,a))}}this.showKontrakModal=!0,P.default.redraw()},deleteKontrak:async function(e){try{await Ce.delete("kontrak",e._id,e.noKontrak),await this.loadKontrakData(),await this.loadPengadaanData()}catch(r){console.error("Delete kontrak error:",r)}},calculateTargetDanaRp:function(e){if(!this.currentKontrakForValidation)return 0;let r=this.currentKontrakForValidation.nilaiKontrak||0;return Math.round(e/100*r)},onTargetDanaChange:function(){let e=this.calculateTargetDanaRp(this.targetFormData.targetDana);this.targetFormData.targetDanaRp=e,P.default.redraw()},onTargetFisikChange:function(){P.default.redraw()},loadTargetData:async function(e){try{let f=(await Ce.request(`/api/target/by-kontrak/${e}`)).data||[];return this.targetTrackingData.set(e,f),console.log(`Loaded ${f.length} target entries for kontrak ${e}`),P.default.redraw(),f}catch(r){return console.error("Error loading target data for kontrak:",e,r),r.response&&r.response.status===404?(this.targetTrackingData.set(e,[]),P.default.redraw(),[]):(this.targetTrackingData.set(e,[]),P.default.redraw(),[])}},compareTermin:function(e,r){let f=t=>{let n=t.toLowerCase().trim(),c={i:1,ii:2,iii:3,iv:4,v:5,vi:6,vii:7,viii:8,ix:9,x:10,xi:11,xii:12,xiii:13,xiv:14,xv:15,xvi:16,xvii:17,xviii:18,xix:19,xx:20};if(/^\d+$/.test(n))return parseInt(n);if(c[n])return c[n];let b={pertama:1,kedua:2,ketiga:3,keempat:4,kelima:5,keenam:6,ketujuh:7,kedelapan:8,kesembilan:9,kesepuluh:10,awal:1,akhir:999,terakhir:999};return b[n]?b[n]:n.charCodeAt(0)},a=f(e),i=f(r);return a-i},loadTerminData:async function(e){try{let f=(await Ce.request(`/api/termin/by-kontrak/${e}`)).data||[],a=f.map(i=>({termin:i.termin,terminPercent:i.persentaseDana,jumlahDana:i.jumlahDana,progressPercent:i.progressPersen}));return a.sort((i,t)=>this.compareTermin(i.termin,t.termin)),this.terminTrackingData.set(e,a),console.log(`Loaded ${f.length} termin entries for kontrak ${e}`),this.currentKontrakForTermin===e&&(this.terminData=a),P.default.redraw(),a}catch(r){return console.error("Error loading termin data for kontrak:",e,r),r.response&&r.response.status===404?(this.terminTrackingData.set(e,[]),this.currentKontrakForTermin===e&&(this.terminData=[]),P.default.redraw(),[]):(this.terminTrackingData.set(e,[]),this.currentKontrakForTermin===e&&(this.terminData=[]),P.default.redraw(),[])}},getTargetData:function(e){return this.targetTrackingData.has(e)?this.targetTrackingData.get(e):(this.loadTargetData(e),null)},validateTargetDate:function(){if(!this.targetFormData.tanggal||!this.currentKontrakForValidation)return{valid:!1,message:"Tanggal target harus diisi"};let e=new Date(this.targetFormData.tanggal),r=new Date(this.currentKontrakForValidation.tglPelaksanaanDari),f=new Date(this.currentKontrakForValidation.tglPelaksanaanSampai);return isNaN(r.getTime())||isNaN(f.getTime())?{valid:!1,message:"Data tanggal pelaksanaan kontrak tidak lengkap"}:e<r?{valid:!1,message:"Tanggal target tidak boleh lebih awal dari Tgl Pelaksanaan"}:e>f?{valid:!1,message:"Tanggal target tidak boleh lebih akhir dari Tgl Selesai"}:{valid:!0}},validateFinalTarget:function(){let e=this.currentKontrakForValidation?.nilaiKontrak||0;return(this.targetFormData.targetFisik===100||this.targetFormData.targetDana===100)&&(this.targetFormData.targetFisik!==100||this.targetFormData.targetDana!==100)?{valid:!1,message:"Target akhir harus mencapai 100% untuk both fisik dan dana"}:{valid:!0}},saveTarget:async function(){if(!this.targetFormData.tanggal){be.warning("Tanggal target harus diisi");return}if(this.targetFormData.targetFisik<=0||this.targetFormData.targetDana<=0){be.warning("Target fisik dan dana harus lebih dari 0%");return}if(this.targetFormData.targetFisik>100||this.targetFormData.targetDana>100){be.warning("Target fisik dan dana tidak boleh melebihi 100%");return}let e=this.validateTargetDate();if(!e.valid){be.warning(e.message);return}if(this.targetFormData.targetFisik===100||this.targetFormData.targetDana===100){let r=this.validateFinalTarget();if(!r.valid){be.warning(r.message);return}}if(!this.targetFormData.keterangan){be.warning("Keterangan harus diisi");return}if(this.targetFormData.targetDanaRp<=0){be.warning("Target Dana (Rp) harus lebih dari 0");return}this.isTargetModalLoading=!0,P.default.redraw();try{let r=this.targetFormData.kontrakId,f={kontrakId:r,tanggal:this.targetFormData.tanggal,targetFisik:this.targetFormData.targetFisik,targetDana:this.targetFormData.targetDana,targetDanaRp:this.targetFormData.targetDanaRp,keterangan:this.targetFormData.keterangan,createdBy:this.currentUser.username,updatedBy:this.currentUser.username};this.targetModalMode==="create"?(await Ce.create("target",f),be.success("Target progress berhasil ditambahkan")):(await Ce.update("target",this.editingTargetId,f),be.success("Target progress berhasil diperbarui")),this.targetTrackingData.delete(r);let a=r;this.closeTargetModal(),console.log(`Reloading target data for kontrak: ${r}`),await this.loadTargetData(r),P.default.redraw(),setTimeout(()=>{console.log("Additional redraw after target save"),P.default.redraw()},200)}catch(r){console.error("Error saving target:",r)}this.isTargetModalLoading=!1,P.default.redraw()},addTerminRow:function(){let e=["I","II","III","IV","V"],r=this.terminData.length,a={termin:e[r]||`Termin ${r+1}`,terminPercent:0,jumlahDana:0,progressPercent:0};this.terminData.push(a),this.terminData.sort((i,t)=>this.compareTermin(i.termin,t.termin)),this.calculateTerminPercentages(),P.default.redraw()},removeTerminRow:function(e){e>=0&&e<this.terminData.length&&(this.terminData.splice(e,1),this.calculateTerminPercentages(),P.default.redraw())},calculateTerminPercentages:function(){if(this.terminData.length===0)return;let e=Math.floor(100/this.terminData.length),r=100%this.terminData.length;this.terminData.forEach((f,a)=>{f.terminPercent=e+(a<r?1:0)}),P.default.redraw()},validateTerminTotals:function(){P.default.redraw()},isTerminValid:function(){if(this.terminData.length===0)return!1;for(let f of this.terminData)if(!f.termin||f.termin.trim()===""||f.jumlahDana<=0||f.progressPercent<0||f.progressPercent>100)return!1;let e=this.terminData.reduce((f,a)=>f+(a.jumlahDana||0),0),r=this.terminData.reduce((f,a)=>f+(a.progressPercent||0),0);return!(Math.abs(r-100)>.01)},saveTerminData:async function(e){if(!this.isTerminValid()){be.warning("Data termin tidak valid. Pastikan semua field terisi dan total progress 100%");return}this.isSavingTermin=!0,P.default.redraw();try{let f=(await Ce.request(`/api/termin/by-kontrak/${e._id}`)).data||[];for(let t of f)await Ce.delete("termin",t._id,`Termin ${t.termin}`);let a=this.terminData.map(t=>({kontrakId:e._id,termin:t.termin,persentaseDana:t.terminPercent||t.persentaseDana,jumlahDana:t.jumlahDana,progressPersen:t.progressPercent||t.progressPersen,createdBy:this.currentUser.username,updatedBy:this.currentUser.username}));for(let t of a)await Ce.create("termin",t);this.terminTrackingData.delete(e._id);let i=e._id;this.terminData=[],console.log(`Reloading termin data for kontrak: ${e._id}`),await this.loadTerminData(i),be.success(`Data termin berhasil disimpan untuk kontrak ${e.noKontrak}`),P.default.redraw()}catch(r){console.error("Error saving termin data:",r),be.error("Gagal menyimpan data termin")}this.isSavingTermin=!1,P.default.redraw()},saveKinerjaInfo:async function(){if(!this.editingKinerjaId){be.warning("Data kinerja tidak ditemukan");return}this.isKinerjaModalLoading=!0,P.default.redraw();try{await Ce.update("kinerja",this.editingKinerjaId,this.kinerjaFormData),this.closeKinerjaModal(),this.loadInformasiData()}catch(e){console.error("Error saving kinerja info:",e)}this.isKinerjaModalLoading=!1,P.default.redraw()},addJaminanRow:function(e){let r=e.tglPelaksanaanDari?e.tglPelaksanaanDari.split("T")[0]:"",f=e.tglPelaksanaanSampai?e.tglPelaksanaanSampai.split("T")[0]:"",a={nomor:"",jenis:"",tanggalMulai:r,tanggalBerakhir:f,nilai:0,tanggalTerbit:"",penerbit:""};this.jaminanData.push(a),P.default.redraw()},deleteJaminan:function(e,r,f){let a=`Jaminan ${r.nomor||f+1}`;ia("Apakah Anda yakin ingin menghapus jaminan ini?",async()=>{try{r._id?(await Ce.delete("jaminan",r._id,a),be.success("Jaminan berhasil dihapus"),this.jaminanTrackingData.delete(e._id),await this.loadJaminanData(e._id)):(this.removeJaminanRow(f),be.success("Jaminan berhasil dihapus")),P.default.redraw()}catch(i){console.error("Error deleting jaminan:",i)}},()=>{console.log("Penghapusan jaminan dibatalkan")})},removeJaminanRow:function(e){e>=0&&e<this.jaminanData.length&&(this.jaminanData.splice(e,1),this.validateJaminanTotals(),P.default.redraw())},validateJaminanTotals:function(){if(this.jaminanData.length>0&&this.currentKontrakForJaminan){let e=this.kontrakList.find(r=>r._id===this.currentKontrakForJaminan);if(e){let r=!1;for(let f of this.jaminanData)if(f.tanggalMulai&&f.tanggalBerakhir&&f.tanggalTerbit&&!this.validateJaminanDates(f,e).valid){r=!0;break}this.hasJaminanDateErrors=r}}P.default.redraw()},isJaminanValid:function(){if(this.jaminanData.length===0)return!1;for(let e of this.jaminanData)if(!e.nomor||e.nomor.trim()===""||!e.jenis||e.jenis.trim()===""||!e.tanggalMulai||e.tanggalMulai.trim()===""||!e.tanggalBerakhir||e.tanggalBerakhir.trim()===""||!e.nilai||e.nilai<=0||!e.tanggalTerbit||e.tanggalTerbit.trim()===""||!e.penerbit||e.penerbit.trim()==="")return!1;return!0},validateJaminanDates:function(e,r){let f=[];if(!r.tglPelaksanaanDari||!r.tglPelaksanaanSampai)return f.push("Data periode kontrak tidak lengkap untuk validasi tanggal jaminan"),{valid:!1,errors:f};let a=new Date(r.tglPelaksanaanDari),i=new Date(r.tglPelaksanaanSampai),t=new Date(e.tanggalMulai),n=new Date(e.tanggalBerakhir);return new Date(e.tanggalTerbit)>=a&&f.push("Tanggal terbit jaminan harus lebih awal dari tanggal mulai kontrak"),t>a&&f.push("Tanggal mulai jaminan tidak boleh lebih akhir dari tanggal mulai kontrak"),n<i&&f.push("Tanggal berakhir jaminan tidak boleh lebih awal dari tanggal selesai kontrak"),t>=n&&f.push("Tanggal mulai jaminan harus lebih awal dari tanggal berakhir jaminan"),{valid:f.length===0,errors:f}},loadJaminanData:async function(e){try{let f=(await Ce.request(`/api/jaminan/by-kontrak/${e}`)).data||[],a=f.map(i=>({_id:i._id,nomor:i.nomor,jenis:i.jenis,tanggalMulai:i.tanggalMulai?i.tanggalMulai.split("T")[0]:"",tanggalBerakhir:i.tanggalBerakhir?i.tanggalBerakhir.split("T")[0]:"",nilai:i.nilai,tanggalTerbit:i.tanggalTerbit?i.tanggalTerbit.split("T")[0]:"",penerbit:i.penerbit}));return this.jaminanTrackingData.set(e,a),console.log(`Loaded ${f.length} jaminan entries for kontrak ${e}`),this.currentKontrakForJaminan===e&&(this.jaminanData=a),P.default.redraw(),a}catch(r){return console.error("Error loading jaminan data for kontrak:",e,r),r.response&&r.response.status===404?(this.jaminanTrackingData.set(e,[]),this.currentKontrakForJaminan===e&&(this.jaminanData=[]),P.default.redraw(),[]):(this.jaminanTrackingData.set(e,[]),this.currentKontrakForJaminan===e&&(this.jaminanData=[]),P.default.redraw(),[])}},saveJaminanData:async function(e){if(!this.isJaminanValid()){be.warning("Data jaminan tidak valid. Pastikan semua field terisi dengan benar");return}for(let r of this.jaminanData){let f=this.validateJaminanDates(r,e);if(!f.valid){be.warning(`Validasi tanggal gagal untuk jaminan ${r.nomor}: ${f.errors.join(", ")}`);return}}this.isSavingJaminan=!0,P.default.redraw();try{let f=(await Ce.request(`/api/jaminan/by-kontrak/${e._id}`)).data||[];for(let t of f)await Ce.request(`/api/jaminan/${t._id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Ft.getToken()}`}});let a=this.jaminanData.map(t=>({kontrakId:e._id,nomor:t.nomor,jenis:t.jenis,tanggalMulai:t.tanggalMulai,tanggalBerakhir:t.tanggalBerakhir,nilai:t.nilai,tanggalTerbit:t.tanggalTerbit,penerbit:t.penerbit,createdBy:this.currentUser.username,updatedBy:this.currentUser.username}));for(let t of a)await Ce.create("jaminan",t);this.jaminanTrackingData.delete(e._id);let i=e._id;this.jaminanData=[],console.log(`Reloading jaminan data for kontrak: ${e._id}`),await this.loadJaminanData(i),be.success(`Data jaminan berhasil disimpan untuk kontrak ${e.noKontrak}`),P.default.redraw()}catch(r){console.error("Error saving jaminan data:",r),be.error("Gagal menyimpan data jaminan")}this.isSavingJaminan=!1,P.default.redraw()},getKinerjaForSubKegiatan:function(e){return this.kinerjaList.filter(r=>(r.subKegiatanId?._id||r.subKegiatanId)===e)},getAnggaranForSubKegiatan:function(e){return this.anggaranList.filter(r=>(r.subKegiatanId?._id||r.subKegiatanId)===e)},getTotalBudgetForSubKegiatan:function(e){return this.getAnggaranForSubKegiatan(e).reduce((a,i)=>a+(i.totalAmount||0),0)},getPengadaanForSubKegiatan:function(e){return this.pengadaanList.filter(r=>(r.subKegiatanId?._id||r.subKegiatanId)===e)},getPaketKegiatanForKodeRekening:function(e){return this.paketKegiatanList.filter(r=>(r.kodeRekeningId?._id||r.kodeRekeningId)===e)},getKodeRekeningAllocations:function(e,r){let f=this.anggaranList.find(a=>a._id===e);return!f||!f.allocations?[]:f.allocations.filter(a=>a.kodeRekeningId&&a.amount>0)},getKodeRekeningAllocationsForSubKegiatan:function(e){let r=[],f=new Set;return this.anggaranList.filter(a=>(a.subKegiatanId?._id||a.subKegiatanId)===e).forEach(a=>{a.allocations&&a.allocations.forEach(i=>{if(i.kodeRekeningId&&i.amount>0){let t=i.kodeRekeningId;if(typeof t=="string"){let n=this.kodeRekeningCache.get(t);n?t=n:(f.add(t),t={_id:t,code:"Loading...",name:"Loading...",fullCode:"Loading...",_temp:!0})}else!t.fullCode&&t.code&&(t.fullCode=t.code);r.push({...i,anggaranId:a._id,subKegiatanId:e,kodeRekeningId:t})}})}),f.size>0&&(console.log("Auto-fetching kode rekening data for IDs:",Array.from(f)),this.fetchMissingKodeRekeningData(Array.from(f),r)),r},fetchMissingKodeRekeningData:async function(e,r){try{console.log("Inside fetchMissingKodeRekeningData with IDs:",e);let f=e.filter(t=>!this.kodeRekeningCache.has(t));if(f.length===0){r.forEach(t=>{if(t.kodeRekeningId&&t.kodeRekeningId._temp){let n=t.kodeRekeningId._id,c=this.kodeRekeningCache.get(n);c&&(t.kodeRekeningId=c)}}),console.log("All data cached, triggering redraw"),P.default.redraw();return}console.log("Making API call with uncachedIds:",f);let i=(await Ce.request(`/api/koderekening?ids=${f.join(",")}`)).data||[];console.log("API Response received:",i),i.forEach(t=>{this.kodeRekeningCache.set(t._id,{...t,fullCode:t.fullCode||t.code||"XX"})}),this.manageCacheSize(),console.log("Cached data:",Array.from(this.kodeRekeningCache.entries())),console.log("Before updating allocations:",r.map(t=>({id:t.kodeRekeningId._id,temp:t.kodeRekeningId._temp}))),r.forEach(t=>{if(t.kodeRekeningId&&t.kodeRekeningId._temp){let n=t.kodeRekeningId._id,c=this.kodeRekeningCache.get(n);if(c)t.kodeRekeningId=c,console.log("Updated allocation for ID:",n,"with data:",c);else{let b={_id:n,code:"XX",name:"Data Not Found",fullCode:"XX"};this.kodeRekeningCache.set(n,b),t.kodeRekeningId=b,console.log("Using fallback data for ID:",n)}}}),this.manageCacheSize(),console.log("After updating allocations:",r.map(t=>({id:t.kodeRekeningId._id,name:t.kodeRekeningId.name}))),console.log("Calling m.redraw() after API fetch"),P.default.redraw()}catch(f){console.error("Error fetching kode rekening data:",f)}},manageCacheSize:function(){if(this.kodeRekeningCache.size>this.maxCacheSize){let e=this.kodeRekeningCache.size-this.maxCacheSize,r=Array.from(this.kodeRekeningCache.keys());for(let f=0;f<e;f++)this.kodeRekeningCache.delete(r[f]);console.log(`Cache cleaned: removed ${e} entries, current size: ${this.kodeRekeningCache.size}`)}},getFullKodeRekeningCode:function(e){if(!e)return"XX";if(e.fullCode)return e.fullCode;let r=[];return e.parentCode&&r.push(e.parentCode),e.code&&r.push(e.code),r.length>0?r.join("."):e.code||"XX"},getKodeRekeningDisplayInfo:function(e){if(!e)return{name:"Loading...",code:"Loading...",fullDisplay:"Loading... - Loading..."};let r=e.name||e.nama||"Loading...",f=this.getFullKodeRekeningCode(e),a=`${f} - ${r}`;return{name:r,code:f,fullDisplay:a}},getTotalPaketJumlahForSubKegiatan:function(e){return this.paketKegiatanList.filter(r=>r.subKegiatanId===e).reduce((r,f)=>r+(f.jumlah||0),0)},openPaketModal:function(e){e&&(this.paketFormData.anggaranId=e.anggaranId,this.paketFormData.kodeRekeningId=e.kodeRekeningId._id||e.kodeRekeningId,this.selectedSubKegiatan=e.subKegiatanId);let r=et.getBudgetYear(),f="2026-Murni";r&&typeof r=="object"?f=`${r.year||2026}-${r.status||"Murni"}`:typeof r=="string"&&(f=r),this.paketFormData.budgetYear=f,this.paketModalMode="create",this.showPaketModal=!0,P.default.redraw()},openKontrakModal:async function(e=null){if(this.currentKontrakContext={anggaranId:null,kodeRekeningId:null,subKegiatanId:null},this.paketKegiatanList.length===0){console.log("Loading paket kegiatan data for kontrak modal...");try{await this.loadPaketKegiatanData()}catch(f){console.error("Failed to load paket kegiatan data for kontrak modal:",f),be.warning("Gagal memuat data paket kegiatan. Silakan coba lagi.");return}}if(e){this.kontrakFormData.paketKegiatanId=e;let f=this.paketKegiatanList.find(a=>a._id===e);f&&(this.currentKontrakContext.anggaranId=f.anggaranId?._id||f.anggaranId,this.currentKontrakContext.kodeRekeningId=f.kodeRekeningId?._id||f.kodeRekeningId,this.currentKontrakContext.subKegiatanId=f.subKegiatanId?._id||f.subKegiatanId,this.selectedSubKegiatan||(this.selectedSubKegiatan=this.currentKontrakContext.subKegiatanId))}let r=this.selectedSubKegiatan;if(!r&&e){let f=this.paketKegiatanList.find(a=>a._id===e);f&&(r=f.subKegiatanId)}this.currentKontrakContext.kodeRekeningId&&r?this.currentAllocationInfo=this.calculateAllocationInfoForKodeRekening(this.currentKontrakContext.kodeRekeningId,r):this.currentAllocationInfo={totalAllocation:0,usedAllocation:0,remainingAllocation:0},r?this.kontrakFormData.lokasi=this.getDefaultLokasi(r):this.kontrakFormData.lokasi=this.getFormattedLocation(),this.kontrakModalMode="create",this.showKontrakModal=!0,P.default.redraw()},getKontrakForPaketKegiatan:function(e){return this.kontrakList.filter(r=>(r.paketKegiatanId?._id||r.paketKegiatanId)===e)},getKontrakForKodeRekening:function(e){return this.kontrakList.filter(r=>!!(r.kodeRekeningId===e||r.paketKegiatanId&&(r.paketKegiatanId.kodeRekeningId?._id||r.paketKegiatanId.kodeRekeningId)===e))},calculateAllocationInfoForKodeRekening:function(e,r){let f=this.getKodeRekeningAllocationsForSubKegiatan(r).find(c=>(typeof c.kodeRekeningId=="string"?c.kodeRekeningId:c.kodeRekeningId._id||c.kodeRekeningId)===e);if(!f)return{totalAllocation:0,usedAllocation:0,remainingAllocation:0};let a=f.amount,t=this.getKontrakForKodeRekening(e).reduce((c,b)=>c+(b.nilaiKontrak||0),0),n=Math.max(0,a-t);return{totalAllocation:a,usedAllocation:t,remainingAllocation:n}},getFullCode:function(e){let r=[];return e.kegiatanId?.programId?.bidangId?.urusanId?.kode&&r.push(e.kegiatanId.programId.bidangId.urusanId.kode),e.kegiatanId?.programId?.bidangId?.kode&&r.push(e.kegiatanId.programId.bidangId.kode),e.kegiatanId?.programId?.kode&&r.push(e.kegiatanId.programId.kode),e.kegiatanId?.kode&&r.push(e.kegiatanId.kode),r.push(e.kode),r.join(".")},view:function(){return!this.currentUser||this.currentUser.role!=="operator"?(0,P.default)("div",{class:"flex justify-center items-center h-64"},[(0,P.default)("div",{class:"text-center"},[(0,P.default)("i",{class:"ri-shield-user-line text-6xl text-gray-400 mb-4"}),(0,P.default)("h3",{class:"text-lg font-semibold text-gray-600"},"Akses Ditolak"),(0,P.default)("p",{class:"text-gray-500"},"Halaman ini hanya dapat diakses oleh operator")])]):(0,P.default)("div",{class:"space-y-6"},[(0,P.default)("div",{class:"flex justify-between items-center"},[(0,P.default)("div",[(0,P.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Pengadaan"),(0,P.default)("p",{class:"text-gray-600 mt-1"},`Unit Kerja: ${this.currentUser.subPerangkatDaerah?.nama||"Tidak ditemukan"}`)]),(0,P.default)("div",{class:"flex items-center space-x-4"},[(0,P.default)("button",{class:"px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white text-sm font-medium rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl",onclick:()=>this.loadData()},[(0,P.default)("i",{class:"ri-refresh-line mr-2"}),"Refresh"])])]),(0,P.default)("div",{class:"bg-white rounded-lg shadow-sm border border-gray-200"},[(0,P.default)("div",{class:"border-b border-gray-200"},[(0,P.default)("nav",{class:"flex space-x-8 px-6","aria-label":"Tabs"},[(0,P.default)("button",{class:`py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${this.activeTab==="informasi"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:async()=>{this.activeTab="informasi",this.expandedAccordions.clear(),this.expandedKodeRekeningAccordions.clear(),P.default.redraw(),await this.loadInformasiData()}},[(0,P.default)("i",{class:"ri-information-line mr-2"}),"Informasi"]),(0,P.default)("button",{class:`py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${this.activeTab==="paket-kegiatan"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:async()=>{this.activeTab="paket-kegiatan",this.expandedAccordions.clear(),this.expandedKodeRekeningAccordions.clear(),P.default.redraw(),await this.loadPaketKegiatanData()}},[(0,P.default)("i",{class:"ri-archive-line mr-2"}),"Paket Kegiatan"]),(0,P.default)("button",{class:`py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${this.activeTab==="pengadaan"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:async()=>{this.activeTab="pengadaan",this.expandedAccordions.clear(),this.expandedKodeRekeningAccordions.clear(),P.default.redraw(),await this.loadPengadaanData()}},[(0,P.default)("i",{class:"ri-shopping-bag-line mr-2"}),"Kontrak Pengadaan"]),(0,P.default)("button",{class:`py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${this.activeTab==="kontrak"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:async()=>{this.activeTab="kontrak",this.expandedAccordions.clear(),this.expandedKodeRekeningAccordions.clear(),P.default.redraw(),await this.loadKontrakData()}},[(0,P.default)("i",{class:"ri-file-contract-line mr-2"}),"Tahapan Pekerjaan"])])]),(0,P.default)("div",{class:"p-6"},[this.isLoading?(0,P.default)("div",{class:"flex justify-center items-center h-64"},[(0,P.default)("div",{class:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):this.activeTab==="informasi"?(0,P.default)("div",{class:"space-y-4"},[this.subKegiatanList.length===0?(0,P.default)("div",{class:"text-center py-12"},[(0,P.default)("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 mb-4"},[(0,P.default)("i",{class:"ri-information-fill text-blue-500"})]),(0,P.default)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Belum ada data anggaran"),(0,P.default)("p",{class:"text-gray-500"},"Buat data anggaran terlebih dahulu untuk melihat informasi subkegiatan")]):this.subKegiatanList.map(e=>(0,P.default)("div",{class:"border border-gray-200 rounded-lg"},[(0,P.default)("button",{class:"w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors",onclick:()=>this.toggleAccordion(e._id)},[(0,P.default)("div",[(0,P.default)("div",{class:"flex items-center space-x-3"},[(0,P.default)("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-center",style:(this.expandedAccordions.has(e._id)?"background-color: #3B82F6; color: white;":"background-color: #E5E7EB; color: #6B7280;")+" overflow: hidden; white-space: nowrap; text-overflow: ellipsis;"},this.getFullCode(e)||"XX"),(0,P.default)("div",[(0,P.default)("h3",{class:"font-semibold text-gray-900"},e.nama||"Nama SubKegiatan"),(0,P.default)("p",{class:"text-xs text-gray-500 mt-0.5"},this.getFullCode(e)||"XX")])])]),(0,P.default)("div",{class:"flex items-center space-x-2"},[(0,P.default)("span",{class:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${this.getAnggaranForSubKegiatan(e._id).length>0?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`},`Rp ${this.getTotalBudgetForSubKegiatan(e._id).toLocaleString("id-ID")}`),(0,P.default)("i",{class:`ri-arrow-${this.expandedAccordions.has(e._id)?"up":"down"}-line text-gray-400`})])]),this.expandedAccordions.has(e._id)&&(0,P.default)("div",{class:"px-4 pb-4 border-t border-gray-200 bg-gray-50"},[(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pt-4"},[(0,P.default)("div",{class:"bg-white rounded-lg p-4 border border-gray-200"},[(0,P.default)("div",{class:"flex items-center mb-3"},[(0,P.default)("div",{class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-2"},[(0,P.default)("i",{class:"ri-bar-chart-line text-blue-600 text-sm"})]),(0,P.default)("h4",{class:"font-semibold text-gray-900"},"Kinerja")]),(0,P.default)("div",{class:"space-y-2"},[(0,P.default)("p",{class:"text-sm text-gray-600"},e.kinerja||"Tidak ada data kinerja"),this.getKinerjaForSubKegiatan(e._id).length>0&&(0,P.default)("div",{class:"mt-2"},[(0,P.default)("p",{class:"text-xs text-gray-500 mb-1"},`${this.getKinerjaForSubKegiatan(e._id).length} target kinerja:`),this.getKinerjaForSubKegiatan(e._id).slice(0,3).map(r=>(0,P.default)("div",{class:"text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded mb-1"},[`${r.targetValue||0} ${r.subKegiatanId?.satuan||e.satuan||"unit"} (${r.status||"planning"})`])),this.getKinerjaForSubKegiatan(e._id).length>3&&(0,P.default)("p",{class:"text-xs text-gray-500"},`... dan ${this.getKinerjaForSubKegiatan(e._id).length-3} lainnya`)])])]),(0,P.default)("div",{class:"bg-white rounded-lg p-4 border border-gray-200"},[(0,P.default)("div",{class:"flex items-center mb-3"},[(0,P.default)("div",{class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-2"},[(0,P.default)("i",{class:"ri-line-chart-line text-green-600 text-sm"})]),(0,P.default)("h4",{class:"font-semibold text-gray-900"},"Indikator")]),(0,P.default)("p",{class:"text-sm text-gray-600"},e.indikator||"Tidak ada indikator")]),(0,P.default)("div",{class:"bg-white rounded-lg p-4 border border-gray-200"},[(0,P.default)("div",{class:"flex items-center mb-3"},[(0,P.default)("div",{class:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mr-2"},[(0,P.default)("i",{class:"ri-scales-line text-purple-600 text-sm"})]),(0,P.default)("h4",{class:"font-semibold text-gray-900"},"Satuan")]),(0,P.default)("p",{class:"text-sm text-gray-600"},e.satuan||"Tidak ada satuan")])]),this.getAnggaranForSubKegiatan(e._id).length>0&&(0,P.default)("div",{class:"mt-4 bg-white rounded-lg p-4 border border-gray-200"},[(0,P.default)("div",{class:"flex items-center mb-3"},[(0,P.default)("div",{class:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center mr-2"},[(0,P.default)("i",{class:"ri-money-dollar-circle-line text-yellow-600 text-sm"})]),(0,P.default)("h4",{class:"font-semibold text-gray-900"},"Anggaran")]),(0,P.default)("div",{class:"space-y-2"},[this.getAnggaranForSubKegiatan(e._id).map(r=>(0,P.default)("div",{class:"bg-yellow-50 border border-yellow-200 rounded p-3"},[(0,P.default)("div",{class:"flex justify-between items-center mb-2"},[(0,P.default)("span",{class:"text-sm font-medium text-gray-900"},`Tahun: ${r.budgetYear||"Tidak ditentukan"}`),(0,P.default)("span",{class:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"},`Rp ${(r.totalAmount||0).toLocaleString("id-ID")}`)]),r.allocations&&r.allocations.length>0&&(0,P.default)("div",{class:"text-xs text-gray-600"},[`${r.allocations.length} alokasi kode rekening`])]))])]),(0,P.default)("div",{class:"mt-4 bg-white rounded-lg p-4 border border-gray-200"},[(0,P.default)("div",{class:"flex items-center justify-between mb-3"},[(0,P.default)("div",{class:"flex items-center"},[(0,P.default)("div",{class:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mr-2"},[(0,P.default)("i",{class:"ri-map-pin-line text-purple-600 text-sm"})]),(0,P.default)("h4",{class:"font-semibold text-gray-900"},"Informasi Tambahan")]),(0,P.default)("button",{class:"px-3 py-1.5 bg-blue-500 text-white text-sm font-medium rounded hover:bg-blue-600 transition-colors",onclick:()=>this.editKinerjaInfo(e._id)},"Edit")]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",{class:"space-y-2"},[(0,P.default)("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Lokasi"),(()=>{let r=this.kinerjaList.filter(a=>(a.subKegiatanId?._id||a.subKegiatanId)===e._id),f="Tidak ditentukan";if(r.length>0&&r[0].lokasi)f=r[0].lokasi;else if(this.currentUser.subPerangkatDaerah?.perangkatDaerahId?.namaPemda){let a=this.currentUser.subPerangkatDaerah.perangkatDaerahId.namaPemda;a=a.replace(/^Pemkab\s+/,"Kabupaten "),a=a.replace(/^Pemkot\s+/,"Kota "),a=a.replace(/^Kabupaten\s+([A-Za-z\s]+)/,"Kabupaten $1"),a=a.replace(/^Kota\s+([A-Za-z\s]+)/,"Kota $1"),a&&(a=a.replace(/^Pemerintah\s+/,""),a=a.replace(/^Pemkab\s+/,"Kabupaten "),a=a.replace(/^Pemkot\s+/,"Kota ")),f=a}else console.log("Current user data:",this.currentUser),console.log("SubPerangkatDaerah data:",this.currentUser.subPerangkatDaerah);return(0,P.default)("div",{class:"text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded"},f)})()]),(0,P.default)("div",{class:"space-y-2"},[(0,P.default)("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Pengguna Anggaran"),(()=>{let r=this.kinerjaList.filter(i=>(i.subKegiatanId?._id||i.subKegiatanId)===e._id),f=r.length>0&&r[0].penggunaAnggaran,a="Tidak ditentukan";if(f)a=`${f.nama} (${f.jabatanFungsional})`;else if(this.pejabatList.length>0){let i=this.pejabatList[0];a=`${i.nama} (${i.jabatanFungsional})`}return(0,P.default)("div",{class:"text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded"},a)})()])])])])]))]):this.activeTab==="paket-kegiatan"?(0,P.default)("div",{class:"space-y-4"},[this.subKegiatanList.length===0?(0,P.default)("div",{class:"text-center py-12"},[(0,P.default)("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 mb-4"},[(0,P.default)("i",{class:"ri-archive-fill text-blue-500"})]),(0,P.default)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Belum ada subkegiatan"),(0,P.default)("p",{class:"text-gray-500"},"Buat data anggaran terlebih dahulu untuk melihat paket kegiatan")]):this.subKegiatanList.map(e=>(0,P.default)("div",{class:"border border-gray-200 rounded-lg"},[(0,P.default)("button",{class:"w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors",onclick:()=>this.toggleAccordion(e._id)},[(0,P.default)("div",[(0,P.default)("div",{class:"flex items-center space-x-3"},[(0,P.default)("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-center",style:(this.expandedAccordions.has(e._id)?"background-color: #8B5CF6; color: white;":"background-color: #E5E7EB; color: #6B7280;")+" overflow: hidden; white-space: nowrap; text-overflow: ellipsis;"},this.getFullCode(e)||"XX"),(0,P.default)("div",[(0,P.default)("h3",{class:"font-semibold text-gray-900"},e.nama||"Nama SubKegiatan"),(0,P.default)("p",{class:"text-xs text-gray-500 mt-0.5"},this.getFullCode(e)||"XX")])])]),(0,P.default)("div",{class:"flex items-center space-x-2"},[(0,P.default)("span",{class:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${this.getKodeRekeningAllocationsForSubKegiatan(e._id).length>0?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`},`${this.getKodeRekeningAllocationsForSubKegiatan(e._id).length} kode rekening`),(0,P.default)("i",{class:`ri-arrow-${this.expandedAccordions.has(e._id)?"up":"down"}-line text-gray-400`})])]),this.expandedAccordions.has(e._id)&&(0,P.default)("div",{class:"px-4 pb-4 border-t border-gray-200 bg-gray-50"},[(0,P.default)("div",{class:"space-y-4 pt-4"},[this.getKodeRekeningAllocationsForSubKegiatan(e._id).length===0?(0,P.default)("div",{class:"text-center py-8"},[(0,P.default)("div",{class:"mx-auto flex items-center justify-center h-10 w-10 rounded-full bg-gray-100 mb-3"},[(0,P.default)("i",{class:"ri-money-dollar-circle-fill text-blue-500"})]),(0,P.default)("p",{class:"text-sm text-gray-500 mb-3"},"Belum ada alokasi kode rekening untuk subkegiatan ini"),(0,P.default)("p",{class:"text-xs text-gray-400"},"Tambahkan alokasi kode rekening pada data anggaran")]):this.getKodeRekeningAllocationsForSubKegiatan(e._id).map(r=>{let f=typeof r.kodeRekeningId=="string"?r.kodeRekeningId:r.kodeRekeningId._id||r.kodeRekeningId,a=this.getPaketKegiatanForKodeRekening(f),i=a.reduce((t,n)=>t+(n.jumlah||0),0);return(0,P.default)("div",{class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},[(0,P.default)("button",{class:"w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors",onclick:()=>this.toggleKodeRekeningAccordion(f)},[(0,P.default)("div",[(()=>{let t=this.getKodeRekeningDisplayInfo(r.kodeRekeningId);return[(0,P.default)("h4",{class:"font-semibold text-gray-900"},t.name||"Loading..."),(0,P.default)("p",{class:"text-sm text-gray-500"},t.code||"Loading...")]})()]),(0,P.default)("div",{class:"flex items-center space-x-2"},[(0,P.default)("span",{class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800"},`Rp ${r.amount.toLocaleString("id-ID")}`),(0,P.default)("span",{class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"},`${a.length} paket`),(0,P.default)("i",{class:`ri-arrow-${this.expandedKodeRekeningAccordions.has(f)?"up":"down"}-line text-gray-400`})])]),this.expandedKodeRekeningAccordions.has(f)&&(0,P.default)("div",{class:"border-t border-gray-200 bg-gray-50"},[(0,P.default)("div",{class:"p-4"},[a.length===0?(0,P.default)("div",{class:"text-center py-8"},[(0,P.default)("div",{class:"mx-auto flex items-center justify-center h-10 w-10 rounded-full bg-gray-100 mb-3"},[(0,P.default)("i",{class:"ri-inbox-fill text-blue-500"})]),(0,P.default)("p",{class:"text-sm text-gray-500 mb-3"},"Belum ada data Paket Kegiatan"),(0,P.default)("button",{class:"px-3 py-1.5 bg-purple-500 text-white text-sm font-medium rounded hover:bg-purple-600 transition-colors",onclick:()=>this.openPaketModal(r)},"Tambah Paket")]):(0,P.default)("div",[(0,P.default)("div",{class:"flex justify-between items-center mb-4"},[(0,P.default)("h5",{class:"text-sm font-semibold text-gray-900"},`Paket Kegiatan (${a.length})`),(0,P.default)("button",{class:"px-3 py-1.5 bg-gradient-to-r from-purple-500 to-indigo-600 text-white text-sm font-medium rounded hover:from-purple-600 hover:to-indigo-700 transition-all duration-200 flex items-center",onclick:()=>this.openPaketModal(r)},[(0,P.default)("i",{class:"ri-add-line mr-1"}),"Tambah Paket"])]),(0,P.default)("div",{class:"overflow-x-auto"},[(0,P.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,P.default)("thead",{class:"bg-gray-50"},[(0,P.default)("tr",[(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"No"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Uraian"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Volume"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Satuan"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Harga Satuan"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Jumlah"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,P.default)("tbody",{class:"bg-white divide-y divide-gray-200"},[a.map((t,n)=>(0,P.default)("tr",{class:"hover:bg-gray-50"},[(0,P.default)("td",{class:"px-4 py-3 whitespace-nowrap"},[(0,P.default)("div",{class:"text-sm font-medium text-gray-900"},`${n+1}.`)]),(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("div",{class:"text-sm font-medium text-gray-900"},t.uraian||"-")]),(0,P.default)("td",{class:"px-4 py-3 whitespace-nowrap"},[(0,P.default)("div",{class:"text-sm text-gray-900"},t.volume?.toLocaleString("id-ID")||"0")]),(0,P.default)("td",{class:"px-4 py-3 whitespace-nowrap"},[(0,P.default)("div",{class:"text-sm text-gray-900"},t.satuan||"-")]),(0,P.default)("td",{class:"px-4 py-3 whitespace-nowrap"},[(0,P.default)("div",{class:"text-sm text-gray-900"},`Rp ${t.hargaSatuan?.toLocaleString("id-ID")||"0"}`)]),(0,P.default)("td",{class:"px-4 py-3 whitespace-nowrap"},[(0,P.default)("div",{class:"text-sm font-medium text-gray-900"},`Rp ${t.jumlah?.toLocaleString("id-ID")||"0"}`)]),(0,P.default)("td",{class:"px-4 py-3 whitespace-nowrap text-sm font-medium"},[(0,P.default)("button",{class:"text-blue-600 hover:text-blue-900 mr-3",onclick:()=>this.editPaketKegiatan(t)},"Edit"),(0,P.default)("button",{class:"text-red-600 hover:text-red-900",onclick:()=>this.deletePaketKegiatan(t)},"Hapus")])]))])])])])])])])})])])]))]):this.activeTab==="pengadaan"?(0,P.default)("div",{class:"space-y-4"},[this.subKegiatanList.length===0?(0,P.default)("div",{class:"text-center py-12"},[(0,P.default)("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 mb-4"},[(0,P.default)("i",{class:"ri-shopping-bag-fill text-blue-500"})]),(0,P.default)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Belum ada subkegiatan"),(0,P.default)("p",{class:"text-gray-500"},"Buat data anggaran terlebih dahulu untuk mengelola pengadaan")]):this.subKegiatanList.map(e=>(0,P.default)("div",{class:"border border-gray-200 rounded-lg"},[(0,P.default)("button",{class:"w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors",onclick:()=>this.toggleAccordion(e._id)},[(0,P.default)("div",[(0,P.default)("div",{class:"flex items-center space-x-3"},[(0,P.default)("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-center",style:(this.expandedAccordions.has(e._id)?"background-color: #10B981; color: white;":"background-color: #E5E7EB; color: #6B7280;")+" overflow: hidden; white-space: nowrap; text-overflow: ellipsis;"},this.getFullCode(e)||"XX"),(0,P.default)("div",[(0,P.default)("h3",{class:"font-semibold text-gray-900"},e.nama||"Nama SubKegiatan"),(0,P.default)("p",{class:"text-xs text-gray-500 mt-0.5"},this.getFullCode(e)||"XX")])])]),(0,P.default)("div",{class:"flex items-center space-x-2"},[(0,P.default)("span",{class:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${this.getKodeRekeningAllocationsForSubKegiatan(e._id).length>0?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`},`${this.getKodeRekeningAllocationsForSubKegiatan(e._id).length} kode rekening`),(0,P.default)("i",{class:`ri-arrow-${this.expandedAccordions.has(e._id)?"up":"down"}-line text-gray-400`})])]),this.expandedAccordions.has(e._id)&&(0,P.default)("div",{class:"px-4 pb-4 border-t border-gray-200 bg-gray-50"},[(0,P.default)("div",{class:"space-y-4 pt-4"},[this.getKodeRekeningAllocationsForSubKegiatan(e._id).length===0?(0,P.default)("div",{class:"text-center py-8"},[(0,P.default)("div",{class:"mx-auto flex items-center justify-center h-10 w-10 rounded-full bg-gray-100 mb-3"},[(0,P.default)("i",{class:"ri-money-dollar-circle-fill text-blue-500"})]),(0,P.default)("p",{class:"text-sm text-gray-500 mb-3"},"Belum ada alokasi kode rekening untuk subkegiatan ini"),(0,P.default)("p",{class:"text-xs text-gray-400"},"Tambahkan alokasi kode rekening pada data anggaran")]):this.getKodeRekeningAllocationsForSubKegiatan(e._id).map(r=>{let f=typeof r.kodeRekeningId=="string"?r.kodeRekeningId:r.kodeRekeningId._id||r.kodeRekeningId,a=this.getPaketKegiatanForKodeRekening(f),i=this.getKontrakForKodeRekening(f);return(0,P.default)("div",{class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},[(0,P.default)("button",{class:"w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors",onclick:()=>this.toggleKodeRekeningAccordion(f)},[(0,P.default)("div",[(()=>{let t=this.getKodeRekeningDisplayInfo(r.kodeRekeningId);return[(0,P.default)("h4",{class:"font-semibold text-gray-900"},t.name||"Loading..."),(0,P.default)("p",{class:"text-sm text-gray-500"},t.code||"Loading...")]})()]),(0,P.default)("div",{class:"flex items-center space-x-2"},[(0,P.default)("span",{class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-emerald-100 text-emerald-800"},`Rp ${r.amount.toLocaleString("id-ID")}`),(0,P.default)("span",{class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800"},`${a.length} paket`),(0,P.default)("span",{class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-800"},`${i.length} kontrak`),(0,P.default)("i",{class:`ri-arrow-${this.expandedKodeRekeningAccordions.has(f)?"up":"down"}-line text-gray-400`})])]),this.expandedKodeRekeningAccordions.has(f)&&(0,P.default)("div",{class:"border-t border-gray-200 bg-gray-50"},[(0,P.default)("div",{class:"p-4"},[i.length===0?(0,P.default)("div",{class:"text-center py-6 border-2 border-dashed border-gray-300 rounded-lg"},[(0,P.default)("i",{class:"ri-file-contract-line text-2xl text-gray-400 mb-2 block"}),(0,P.default)("p",{class:"text-sm text-gray-500"},"Belum ada pengadaan untuk kode rekening ini"),(0,P.default)("button",{class:"mt-2 px-3 py-1.5 bg-orange-500 text-white text-sm font-medium rounded hover:bg-orange-600 transition-colors",onclick:async()=>await this.openKontrakModal(a.length>0?a[0]._id:null)},"Tambah Pengadaan")]):(0,P.default)("div",[(0,P.default)("div",{class:"flex justify-between items-center mb-4"},[(0,P.default)("h5",{class:"text-sm font-semibold text-gray-900"},`Kontrak (${i.length})`),a.length>0&&(0,P.default)("button",{class:"px-3 py-1.5 bg-gradient-to-r from-orange-500 to-red-600 text-white text-sm font-medium rounded hover:from-orange-600 hover:to-red-700 transition-all duration-200 flex items-center",onclick:async()=>await this.openKontrakModal(a[0]._id)},[(0,P.default)("i",{class:"ri-add-line mr-1"}),"Tambah Pengadaan"])]),(0,P.default)("div",{class:"overflow-x-auto"},[(0,P.default)("table",{class:"min-w-full divide-y divide-gray-200"},[(0,P.default)("thead",{class:"bg-gray-50"},[(0,P.default)("tr",[(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"No"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Kode SIRUP LKPP"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Penyedia"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"No. Kontrak"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nilai Kontrak"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tipe"),(0,P.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,P.default)("tbody",{class:"bg-white divide-y divide-gray-200"},[i.map((t,n)=>(0,P.default)("tr",{class:"hover:bg-gray-50"},[(0,P.default)("td",{class:"px-4 py-3 whitespace-nowrap"},[(0,P.default)("div",{class:"text-sm font-medium text-gray-900"},`${n+1}.`)]),(0,P.default)("td",{class:"px-4 py-3 whitespace-nowrap"},[(0,P.default)("div",{class:"text-sm font-mono text-gray-900 bg-gray-100 px-2 py-1 rounded"},t.kodeSirupLkpp||"-")]),(0,P.default)("td",{class:"px-4 py-3"},[(0,P.default)("div",{class:"text-sm font-medium text-gray-900"},t.penyediaId?.NamaVendor||"Penyedia Tidak Ditemukan"),t.penyediaId?.NamaPimpinan&&(0,P.default)("div",{class:"text-xs text-gray-500"},t.penyediaId.NamaPimpinan)]),(0,P.default)("td",{class:"px-4 py-3 whitespace-nowrap"},[(0,P.default)("div",{class:"text-sm text-gray-900"},t.noKontrak||"-"),t.tglKontrak&&(0,P.default)("div",{class:"text-xs text-gray-500"},new Date(t.tglKontrak).toLocaleDateString("id-ID"))]),(0,P.default)("td",{class:"px-4 py-3 whitespace-nowrap"},[(0,P.default)("div",{class:"text-sm font-medium text-gray-900"},`Rp ${t.nilaiKontrak?.toLocaleString("id-ID")||"0"}`)]),(0,P.default)("td",{class:"px-4 py-3 whitespace-nowrap"},[(0,P.default)("span",{class:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.tipe==="Konstruksi"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`},t.tipe||"Konstruksi")]),(0,P.default)("td",{class:"px-4 py-3 whitespace-nowrap text-sm font-medium"},[(0,P.default)("button",{class:"text-blue-600 hover:text-blue-900 mr-3",onclick:()=>this.editKontrak(t)},"Edit"),(0,P.default)("button",{class:"text-red-600 hover:text-red-900",onclick:()=>this.deleteKontrak(t)},"Hapus")])]))])])])])])])])})])])]))]):this.activeTab==="kontrak"?(0,P.default)("div",{class:"space-y-4"},[this.subKegiatanList.length===0?(0,P.default)("div",{class:"text-center py-12"},[(0,P.default)("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 mb-4"},[(0,P.default)("i",{class:"ri-file-contract-fill text-blue-500"})]),(0,P.default)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Belum ada subkegiatan"),(0,P.default)("p",{class:"text-gray-500"},"Buat data anggaran terlebih dahulu untuk mengelola tahapan pekerjaan")]):this.subKegiatanList.map(e=>(0,P.default)("div",{class:"border border-gray-200 rounded-lg"},[(0,P.default)("button",{class:"w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors",onclick:()=>this.toggleAccordion(e._id)},[(0,P.default)("div",[(0,P.default)("div",{class:"flex items-center space-x-3"},[(0,P.default)("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-center",style:(this.expandedAccordions.has(e._id)?"background-color: #8B5CF6; color: white;":"background-color: #E5E7EB; color: #6B7280;")+" overflow: hidden; white-space: nowrap; text-overflow: ellipsis;"},this.getFullCode(e)||"XX"),(0,P.default)("div",[(0,P.default)("h3",{class:"font-semibold text-gray-900"},e.nama||"Nama SubKegiatan"),(0,P.default)("p",{class:"text-xs text-gray-500 mt-0.5"},this.getFullCode(e)||"XX")])])]),(0,P.default)("div",{class:"flex items-center space-x-2"},[(0,P.default)("span",{class:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${this.getKodeRekeningAllocationsForSubKegiatan(e._id).length>0?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`},`${this.getKodeRekeningAllocationsForSubKegiatan(e._id).length} kode rekening`),(0,P.default)("i",{class:`ri-arrow-${this.expandedAccordions.has(e._id)?"up":"down"}-line text-gray-400`})])]),this.expandedAccordions.has(e._id)&&(0,P.default)("div",{class:"px-4 pb-4 border-t border-gray-200 bg-gray-50"},[(0,P.default)("div",{class:"space-y-4 pt-4"},[this.getKodeRekeningAllocationsForSubKegiatan(e._id).length===0?(0,P.default)("div",{class:"text-center py-8"},[(0,P.default)("div",{class:"mx-auto flex items-center justify-center h-10 w-10 rounded-full bg-gray-100 mb-3"},[(0,P.default)("i",{class:"ri-money-dollar-circle-fill text-blue-500"})]),(0,P.default)("p",{class:"text-sm text-gray-500 mb-3"},"Belum ada alokasi kode rekening untuk subkegiatan ini"),(0,P.default)("p",{class:"text-xs text-gray-400"},"Tambahkan alokasi kode rekening pada data anggaran")]):this.getKodeRekeningAllocationsForSubKegiatan(e._id).map(r=>{let f=typeof r.kodeRekeningId=="string"?r.kodeRekeningId:r.kodeRekeningId._id||r.kodeRekeningId,a=this.getKontrakForKodeRekening(f);return(0,P.default)("div",{class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},[(0,P.default)("button",{class:"w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors",onclick:()=>this.toggleKodeRekeningAccordion(f)},[(0,P.default)("div",[(()=>{let i=this.getKodeRekeningDisplayInfo(r.kodeRekeningId);return[(0,P.default)("h4",{class:"font-semibold text-gray-900"},i.name||"Loading..."),(0,P.default)("p",{class:"text-sm text-gray-500"},i.code||"Loading...")]})()]),(0,P.default)("div",{class:"flex items-center space-x-2"},[(0,P.default)("span",{class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-indigo-100 text-indigo-800"},`Rp ${r.amount.toLocaleString("id-ID")}`),(0,P.default)("span",{class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-800"},`${a.length} kontrak`),(0,P.default)("i",{class:`ri-arrow-${this.expandedKodeRekeningAccordions.has(f)?"up":"down"}-line text-gray-400`})])]),this.expandedKodeRekeningAccordions.has(f)&&(0,P.default)("div",{class:"border-t border-gray-200 bg-gray-50"},[(0,P.default)("div",{class:"p-4"},[a.length===0?(0,P.default)("div",{class:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg"},[(0,P.default)("i",{class:"ri-timeline-line text-2xl text-gray-400 mb-2 block"}),(0,P.default)("p",{class:"text-sm text-gray-500 mb-3"},"Belum ada tahapan pekerjaan untuk kode rekening ini"),(0,P.default)("p",{class:"text-xs text-gray-400 mb-4"},"Tahapan pekerjaan akan muncul setelah kontrak pengadaan dibuat"),(0,P.default)("button",{class:"px-4 py-2 bg-purple-500 text-white text-sm font-medium rounded hover:bg-purple-600 transition-colors",onclick:()=>{be.info("Fitur tambah tahap pekerjaan akan segera hadir")}},"Tambah Tahap Pekerjaan")]):(0,P.default)("div",[(0,P.default)("div",{class:"space-y-4"},[a.map((i,t)=>(0,P.default)("div",{class:"bg-white border border-gray-200 rounded-lg p-4"},[(0,P.default)("div",{class:"flex items-center justify-between mb-3"},[(0,P.default)("div",[(0,P.default)("h6",{class:"text-sm font-semibold text-gray-900"},`${t+1}. Kontrak ${i.noKontrak||"N/A"}`),(0,P.default)("p",{class:"text-xs text-gray-500"},i.penyediaId?.NamaVendor||"Penyedia tidak diketahui")]),(0,P.default)("span",{class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800"},`Rp ${i.nilaiKontrak?.toLocaleString("id-ID")||"0"}`)]),this.renderTahapanPekerjaanTabs(i)]))])])])])])})])])]))]):null])]),this.showKinerjaModal&&(0,P.default)("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onclick:e=>{e.target===e.currentTarget&&this.closeKinerjaModal()}},[(0,P.default)("div",{class:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-lg bg-white"},[(0,P.default)("div",{class:"bg-gradient-to-r from-purple-500 to-pink-600 text-white p-6 rounded-t-lg"},[(0,P.default)("div",{class:"flex items-center justify-between"},[(0,P.default)("div",{class:"flex items-center space-x-3"},[(0,P.default)("div",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center"},[(0,P.default)("i",{class:"ri-edit-line text-xl text-white"})]),(0,P.default)("div",[(0,P.default)("h3",{class:"text-xl font-bold"},"Edit Informasi Kinerja"),(0,P.default)("p",{class:"text-white text-opacity-80 text-sm"},"Update lokasi dan pengguna anggaran")])]),(0,P.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeKinerjaModal()},[(0,P.default)("i",{class:"ri-close-fill"})])])]),(0,P.default)("div",{class:"p-6 max-h-96 overflow-y-auto"},[(0,P.default)("div",{class:"space-y-6"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-map-pin-line mr-1 text-red-500"}),"Lokasi"]),(0,P.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Masukkan lokasi pelaksanaan",value:this.kinerjaFormData.lokasi,oninput:e=>this.kinerjaFormData.lokasi=e.target.value})]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-user-line mr-1 text-blue-500"}),"Pengguna Anggaran"]),(0,P.default)("select",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.kinerjaFormData.penggunaAnggaranId,onchange:e=>this.kinerjaFormData.penggunaAnggaranId=e.target.value},[(0,P.default)("option",{value:""},"Pilih Pengguna Anggaran"),this.pejabatList.map(e=>(0,P.default)("option",{value:e._id,key:e._id},`${e.nama} (${e.jabatanFungsional})`))])])])]),(0,P.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-lg"},[(0,P.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.closeKinerjaModal()},[(0,P.default)("i",{class:"ri-close-fill"}),(0,P.default)("span","Batal")]),(0,P.default)("button",{class:`px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 ${this.isKinerjaModalLoading?"opacity-50 cursor-not-allowed":""}`,onclick:()=>this.saveKinerjaInfo(),disabled:this.isKinerjaModalLoading},[this.isKinerjaModalLoading?(0,P.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,P.default)("i",{class:"ri-save-line"}),(0,P.default)("span",this.isKinerjaModalLoading?"Menyimpan...":"Simpan")])])])]),this.showPaketModal&&(0,P.default)("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onclick:e=>{e.target===e.currentTarget&&this.closePaketModal()}},[(0,P.default)("div",{class:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-lg bg-white"},[(0,P.default)("div",{class:"bg-gradient-to-r from-purple-500 to-pink-600 text-white p-6 rounded-t-lg"},[(0,P.default)("div",{class:"flex items-center justify-between"},[(0,P.default)("div",{class:"flex items-center space-x-3"},[(0,P.default)("div",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center"},[(0,P.default)("i",{class:`ri-${this.paketModalMode==="create"?"add":"edit"}-line text-xl text-white`})]),(0,P.default)("div",[(0,P.default)("h3",{class:"text-xl font-bold"},this.paketModalMode==="create"?"Tambah Paket Kegiatan":"Edit Paket Kegiatan"),(0,P.default)("p",{class:"text-white text-opacity-80 text-sm"},"Formulir input paket kegiatan")])]),(0,P.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closePaketModal()},[(0,P.default)("i",{class:"ri-close-fill"})])])]),(0,P.default)("div",{class:"p-6 max-h-96 overflow-y-auto"},[(0,P.default)("div",{class:"space-y-6"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-file-text-line mr-1 text-blue-500"}),"Uraian Paket"]),(0,P.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Masukkan uraian paket kegiatan",value:this.paketFormData.uraian,oninput:e=>this.paketFormData.uraian=e.target.value})]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-numbers-line mr-1 text-green-500"}),"Volume"]),(0,P.default)("input",{type:"number",min:"0.01",step:"0.01",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"0.00",value:this.paketFormData.volume,oninput:e=>this.paketFormData.volume=parseFloat(e.target.value)||0})]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-scales-line mr-1 text-purple-500"}),"Satuan"]),(0,P.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Contoh: Meter, Liter, Unit",value:this.paketFormData.satuan,oninput:e=>this.paketFormData.satuan=e.target.value})])]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-money-dollar-circle-line mr-1 text-yellow-500"}),"Harga Satuan (Rp)"]),(0,P.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"0",value:this.paketFormData.hargaSatuan?this.paketFormData.hargaSatuan.toLocaleString("id-ID"):"",oninput:e=>{let r=e.target.value.replace(/[^\d]/g,"");this.paketFormData.hargaSatuan=parseInt(r)||0,e.target.value=this.paketFormData.hargaSatuan.toLocaleString("id-ID")}})]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-calculator-line mr-1 text-indigo-500"}),"Jumlah Total (Rp)"]),(0,P.default)("div",{class:"px-4 py-3 bg-gray-100 border-2 border-gray-200 rounded-lg"},[(0,P.default)("span",{class:"text-lg font-bold text-gray-900"},`Rp ${(this.paketFormData.volume*this.paketFormData.hargaSatuan).toLocaleString("id-ID")}`)])]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-calendar-line mr-1 text-red-500"}),"Tahun Anggaran"]),(0,P.default)("div",{class:"px-4 py-3 bg-gray-100 border-2 border-gray-200 rounded-lg text-gray-900"},[(0,P.default)("span",{class:"font-medium"},(()=>{let e=et.getBudgetYear();return e&&typeof e=="object"?`${e.year||2026}-${e.status||"Murni"}`:e||"2026-Murni"})())])]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-file-text-line mr-1 text-gray-500"}),"Deskripsi"]),(0,P.default)("textarea",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-gray-500 focus:ring-2 focus:ring-gray-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Deskripsi paket kegiatan (opsional)",value:this.paketFormData.deskripsi||"",oninput:e=>this.paketFormData.deskripsi=e.target.value,rows:3})])])]),(0,P.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-lg"},[(0,P.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.closePaketModal()},[(0,P.default)("i",{class:"ri-close-fill"}),(0,P.default)("span","Batal")]),(0,P.default)("button",{class:`px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 ${this.isPaketModalLoading?"opacity-50 cursor-not-allowed":""}`,onclick:()=>this.savePaketKegiatan(),disabled:this.isPaketModalLoading},[this.isPaketModalLoading?(0,P.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,P.default)("i",{class:"ri-save-line"}),(0,P.default)("span",this.isPaketModalLoading?"Menyimpan...":"Simpan")])])])]),this.showTargetModal&&(0,P.default)("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onclick:e=>{e.target===e.currentTarget&&this.closeTargetModal()}},[(0,P.default)("div",{class:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-lg bg-white"},[(0,P.default)("div",{class:"bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-t-lg"},[(0,P.default)("div",{class:"flex items-center justify-between"},[(0,P.default)("div",{class:"flex items-center space-x-3"},[(0,P.default)("div",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center"},[(0,P.default)("i",{class:"ri-target-fill text-xl text-white"})]),(0,P.default)("div",[(0,P.default)("h3",{class:"text-xl font-bold"},this.targetModalMode==="create"?"Tambah Target":"Edit Target"),(0,P.default)("p",{class:"text-white text-opacity-80 text-sm"},"Formulir input target tahapan pekerjaan")])]),(0,P.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeTargetModal()},[(0,P.default)("i",{class:"ri-close-fill"})])])]),(0,P.default)("div",{class:"p-6 max-h-96 overflow-y-auto"},[(0,P.default)("div",{class:"space-y-6"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-calendar-line mr-1 text-red-500"}),"Tanggal"]),this.currentKontrakForValidation&&(0,P.default)("div",{class:"mb-2 p-2 bg-gray-100 rounded text-sm"},[(0,P.default)("div",{class:"text-gray-600 mb-1"},"Periode Pelaksanaan Kontrak:"),(0,P.default)("div",{class:"flex space-x-4"},[(0,P.default)("div",[(0,P.default)("span",{class:"text-gray-500 text-xs"},"Mulai: "),(0,P.default)("span",{class:"font-semibold text-gray-800"},this.currentKontrakForValidation.tglPelaksanaanDari?new Date(this.currentKontrakForValidation.tglPelaksanaanDari).toLocaleDateString("id-ID"):"Tidak ditentukan")]),(0,P.default)("div",[(0,P.default)("span",{class:"text-gray-500 text-xs"},"Selesai: "),(0,P.default)("span",{class:"font-semibold text-gray-800"},this.currentKontrakForValidation.tglPelaksanaanSampai?new Date(this.currentKontrakForValidation.tglPelaksanaanSampai).toLocaleDateString("id-ID"):"Tidak ditentukan")])])]),(0,P.default)("input",{type:"date",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.targetFormData.tanggal,oninput:e=>this.targetFormData.tanggal=e.target.value,min:this.currentKontrakForValidation?.tglPelaksanaanDari||"",max:this.currentKontrakForValidation?.tglPelaksanaanSampai||""}),(0,P.default)("span",{class:"text-xs text-gray-500 mt-1 block"},"(Tanggal harus berada dalam periode pelaksanaan kontrak)")]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-progress-1-line mr-1 text-blue-500"}),"Target Fisik (%)"]),(0,P.default)("input",{type:"number",min:"0",max:"100",step:"0.01",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"0.00",value:this.targetFormData.targetFisik,oninput:e=>{this.targetFormData.targetFisik=parseFloat(e.target.value)||0,this.onTargetFisikChange()}})]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-money-dollar-circle-line mr-1 text-green-500"}),"Target Dana (%)"]),(0,P.default)("input",{type:"number",min:"0",max:"100",step:"0.01",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"0.00",value:this.targetFormData.targetDana,oninput:e=>{this.targetFormData.targetDana=parseFloat(e.target.value)||0,this.onTargetDanaChange()}})])]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-money-dollar-box-line mr-1 text-yellow-500"}),"Target Dana (Rp)"]),this.currentKontrakForValidation&&(0,P.default)("div",{class:"mb-2 p-2 bg-gray-100 rounded text-sm"},[(0,P.default)("span",{class:"text-gray-600"},"Nilai Kontrak: "),(0,P.default)("span",{class:"font-semibold text-gray-800"},`Rp ${(this.currentKontrakForValidation.nilaiKontrak||0).toLocaleString("id-ID")}`),(0,P.default)("span",{class:"text-gray-500 ml-2"},"(Dasar perhitungan otomatis)")]),(0,P.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"0",value:this.targetFormData.targetDanaRp?this.targetFormData.targetDanaRp.toLocaleString("id-ID"):"",oninput:e=>{let r=e.target.value.replace(/[^\d]/g,"");this.targetFormData.targetDanaRp=parseInt(r)||0,e.target.value=this.targetFormData.targetDanaRp.toLocaleString("id-ID")}}),this.targetFormData.targetDana>0&&this.currentKontrakForValidation&&(0,P.default)("div",{class:"mt-2 p-2 bg-blue-50 rounded border border-blue-200"},[(0,P.default)("div",{class:"text-xs text-blue-700"},[(0,P.default)("span","Perhitungan: "),(0,P.default)("span",{class:"font-mono"},`${this.targetFormData.targetDana}% \xD7 Rp ${(this.currentKontrakForValidation.nilaiKontrak||0).toLocaleString("id-ID")} = `),(0,P.default)("span",{class:"font-bold"},`Rp ${(this.targetFormData.targetDana/100*(this.currentKontrakForValidation.nilaiKontrak||0)).toLocaleString("id-ID")}`)])]),(0,P.default)("div",{class:"flex justify-between items-center mt-1"},[(0,P.default)("span",{class:"text-xs text-gray-500"},"(Dapat diedit untuk pembulatan atau penyesuaian)"),(0,P.default)("button",{class:"text-xs text-blue-600 hover:text-blue-800 underline",onclick:()=>{this.onTargetDanaChange(),P.default.redraw(),be.info("Target Dana (Rp) dihitung ulang dari persentase")}},"Hitung Ulang dari Persentase")])]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-file-text-line mr-1 text-gray-500"}),"Keterangan"]),(0,P.default)("textarea",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-gray-500 focus:ring-2 focus:ring-gray-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Keterangan target progress (contoh: Pekerjaan awal, persiapan material)",value:this.targetFormData.keterangan,oninput:e=>this.targetFormData.keterangan=e.target.value,rows:3})]),(0,P.default)("div",{class:"bg-blue-50 rounded-lg p-4 border border-blue-200"},[(0,P.default)("div",{class:"flex items-center mb-2"},[(0,P.default)("i",{class:"ri-information-line text-blue-500 mr-2"}),(0,P.default)("h5",{class:"text-sm font-semibold text-blue-900"},"Validasi Target")]),(0,P.default)("div",{class:"text-sm text-blue-800"},[(0,P.default)("p","\u2022 Tanggal harus berada dalam periode pelaksanaan kontrak"),(0,P.default)("p","\u2022 Target akhir harus mencapai 100% untuk fisik dan dana"),(0,P.default)("p","\u2022 Target Dana (Rp) dihitung otomatis dari persentase \xD7 nilai kontrak")])])])]),(0,P.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-lg"},[(0,P.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.closeTargetModal()},[(0,P.default)("i",{class:"ri-close-fill"}),(0,P.default)("span","Batal")]),(0,P.default)("button",{class:`px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 ${this.isTargetModalLoading?"opacity-50 cursor-not-allowed":""}`,onclick:()=>this.saveTarget(),disabled:this.isTargetModalLoading},[this.isTargetModalLoading?(0,P.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,P.default)("i",{class:"ri-save-line"}),(0,P.default)("span",this.isTargetModalLoading?"Menyimpan...":"Simpan")])])])]),this.showKontrakModal&&(0,P.default)("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onclick:e=>{e.target===e.currentTarget&&this.closeKontrakModal()}},[(0,P.default)("div",{class:"relative top-20 mx-auto p-5 border w-11/12 md:w-4/5 xl:w-2/3 shadow-lg rounded-lg bg-white max-h-[90vh] overflow-y-auto"},[(0,P.default)("div",{class:"bg-gradient-to-r from-orange-500 to-red-600 text-white p-6 rounded-t-lg"},[(0,P.default)("div",{class:"space-y-4"},[(0,P.default)("div",{class:"flex items-center justify-between"},[(0,P.default)("div",{class:"flex items-center space-x-3"},[(0,P.default)("div",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center"},[(0,P.default)("i",{class:"ri-file-contract-fill text-xl text-white"})]),(0,P.default)("div",[(0,P.default)("h3",{class:"text-xl font-bold"},this.kontrakModalMode==="create"?"Tambah Pengadaan":"Edit Pengadaan"),(0,P.default)("p",{class:"text-white text-opacity-80 text-sm"},"Formulir input kontrak pengadaan")])]),(0,P.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeKontrakModal()},[(0,P.default)("i",{class:"ri-close-fill"})])]),this.currentAllocationInfo.totalAllocation>0&&(0,P.default)("div",{class:"bg-gray-800 rounded-lg p-4 border-2 border-gray-600 shadow-xl"},[(0,P.default)("div",{class:"flex items-center space-x-2 mb-3"},[(0,P.default)("i",{class:"ri-money-dollar-circle-line text-xl text-yellow-400"}),(0,P.default)("h4",{class:"font-bold text-white text-lg"},"Informasi Alokasi Anggaran")]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4"},[(0,P.default)("div",[(0,P.default)("div",{class:"text-gray-300 text-sm font-medium uppercase tracking-wide"},"Total Alokasi"),(0,P.default)("div",{class:"font-bold text-xl text-white"},`Rp ${this.currentAllocationInfo.totalAllocation.toLocaleString("id-ID")}`)]),(0,P.default)("div",[(0,P.default)("div",{class:"text-orange-400 text-sm font-medium uppercase tracking-wide"},"Sudah Digunakan"),(0,P.default)("div",{class:"font-bold text-xl text-orange-300"},`Rp ${this.currentAllocationInfo.usedAllocation.toLocaleString("id-ID")}`)]),(0,P.default)("div",[(0,P.default)("div",{class:this.currentAllocationInfo.remainingAllocation>0?"text-green-400":"text-red-400",className:"text-sm font-medium uppercase tracking-wide"},"Sisa Anggaran"),(0,P.default)("div",{class:"font-bold text-xl",style:this.currentAllocationInfo.remainingAllocation<=0?"color: #F87171;":"color: #34D399;"},`Rp ${this.currentAllocationInfo.remainingAllocation.toLocaleString("id-ID")}`)])])])])]),(0,P.default)("div",{class:"p-6"},[(0,P.default)("div",{class:"space-y-6"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-archive-line mr-1 text-purple-500"}),"Paket Kegiatan"]),(0,P.default)("select",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.kontrakFormData.paketKegiatanId||"",onchange:e=>{if(this.kontrakFormData.paketKegiatanId=e.target.value,e.target.value){let r=this.paketKegiatanList.find(f=>f._id===e.target.value);if(r){this.currentKontrakContext.anggaranId=r.anggaranId?._id||r.anggaranId,this.currentKontrakContext.kodeRekeningId=r.kodeRekeningId?._id||r.kodeRekeningId,this.currentKontrakContext.subKegiatanId=r.subKegiatanId?._id||r.subKegiatanId;let f=r.subKegiatanId?._id||r.subKegiatanId,a=r.kodeRekeningId?._id||r.kodeRekeningId;a&&f&&(this.currentAllocationInfo=this.calculateAllocationInfoForKodeRekening(a,f))}}}},[(0,P.default)("option",{value:""},"Pilih Paket Kegiatan"),this.paketKegiatanList.filter(e=>{let r=et.getUserData(),f=e.subPerangkatDaerahId?._id||e.subPerangkatDaerahId;if(f&&f!==r.subPerangkatDaerahId)return!1;let a=e.subKegiatanId?._id||e.subKegiatanId;if(this.selectedSubKegiatan&&a!==this.selectedSubKegiatan)return!1;if(this.currentKontrakContext.anggaranId){let i=e.anggaranId?._id||e.anggaranId;if(i&&i!==this.currentKontrakContext.anggaranId)return!1}if(this.currentKontrakContext.kodeRekeningId){let i=e.kodeRekeningId?._id||e.kodeRekeningId;if(i&&i!==this.currentKontrakContext.kodeRekeningId)return!1}return!0}).map(e=>{let r=e.uraian||"Paket tanpa uraian",f=e.volume||0,a=e.satuan||"",i=`${r} (${f} ${a})`;return(0,P.default)("option",{value:e._id,key:e._id},i)})])]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-barcode-line mr-1 text-blue-500"}),"Kode SIRUP LKPP"]),(0,P.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Masukkan kode SIRUP LKPP",value:this.kontrakFormData.kodeSirupLkpp||"",oninput:e=>this.kontrakFormData.kodeSirupLkpp=e.target.value})]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-building-line mr-1 text-green-500"}),"Penyedia B/J"]),(0,P.default)("select",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.kontrakFormData.penyediaId||"",onchange:e=>{this.kontrakFormData.penyediaId=e.target.value,this.onPenyediaChange()}},[(0,P.default)("option",{value:""},"Pilih Penyedia"),this.penyediaList.map(e=>(0,P.default)("option",{value:e._id,key:e._id},e.NamaVendor))])])]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-user-line mr-1 text-purple-500"}),"Pimpinan Penyedia B/J"]),(0,P.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Otomatis terisi saat memilih penyedia",value:this.kontrakFormData.pimpinanPenyedia||"",readonly:!0})]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-map-pin-line mr-1 text-amber-500"}),"Alamat Penyedia B/J"]),(0,P.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Otomatis terisi saat memilih penyedia",value:this.kontrakFormData.alamatPenyedia||"",readonly:!0})])]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-phone-line mr-1 text-indigo-500"}),"Telp. Penyedia B/J"]),(0,P.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Otomatis terisi saat memilih penyedia",value:this.kontrakFormData.telpPenyedia||"",readonly:!0})]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-file-contract-line mr-1 text-red-500"}),"No. Kontrak"]),(0,P.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Masukkan nomor kontrak",value:this.kontrakFormData.noKontrak||"",oninput:e=>this.kontrakFormData.noKontrak=e.target.value})])]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-calendar-line mr-1 text-blue-500"}),"Tgl Kontrak"]),(0,P.default)("input",{type:"date",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.kontrakFormData.tglKontrak||"",oninput:e=>this.kontrakFormData.tglKontrak=e.target.value})]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-file-text-line mr-1 text-green-500"}),"No. SPMK"]),(0,P.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Masukkan nomor SPMK",value:this.kontrakFormData.noSpmk||"",oninput:e=>this.kontrakFormData.noSpmk=e.target.value})])]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-calendar-check-line mr-1 text-purple-500"}),"Tgl SPMK"]),(0,P.default)("input",{type:"date",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.kontrakFormData.tglSpmk||"",oninput:e=>this.kontrakFormData.tglSpmk=e.target.value})]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-time-line mr-1 text-amber-500"}),"Jangka Waktu"]),(0,P.default)("div",{class:"flex items-center space-x-2"},[(0,P.default)("input",{type:"number",min:"1",class:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"0",value:this.kontrakFormData.jangkaWaktu||0,oninput:e=>{this.kontrakFormData.jangkaWaktu=parseInt(e.target.value)||0,this.calculateEndDate()}}),(0,P.default)("select",{class:"px-3 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.kontrakFormData.jangkaWaktuUnit||"Hari",onchange:e=>{this.kontrakFormData.jangkaWaktuUnit=e.target.value,this.calculateEndDate()}},[(0,P.default)("option",{value:"Hari"},"Hari"),(0,P.default)("option",{value:"Minggu"},"Minggu"),(0,P.default)("option",{value:"Bulan"},"Bulan"),(0,P.default)("option",{value:"Tahun"},"Tahun")])])])]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-calendar-event-line mr-1 text-red-500"}),"Tgl. Pelaksanaan (Dari)"]),(0,P.default)("input",{type:"date",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.kontrakFormData.tglPelaksanaanDari||"",oninput:e=>{this.kontrakFormData.tglPelaksanaanDari=e.target.value,this.calculateEndDate()}})]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-calendar-event-line mr-1 text-pink-500"}),"Tgl. Pelaksanaan (Sampai)"]),(0,P.default)("input",{type:"date",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-pink-500 focus:ring-2 focus:ring-pink-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.kontrakFormData.tglPelaksanaanSampai||"",oninput:e=>this.kontrakFormData.tglPelaksanaanSampai=e.target.value}),(0,P.default)("span",{class:"text-xs text-gray-500 mt-1 block"},"(Dapat diubah manual untuk hari libur)")])]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-map-pin-line mr-1 text-teal-500"}),"Lokasi"]),(0,P.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-teal-500 focus:ring-2 focus:ring-teal-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Lokasi pelaksanaan",value:this.kontrakFormData.lokasi||"",oninput:e=>this.kontrakFormData.lokasi=e.target.value})])]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-money-dollar-circle-line mr-1 text-yellow-500"}),"HPS (Rp)"]),(0,P.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"0",value:this.kontrakFormData.hps?this.kontrakFormData.hps.toLocaleString("id-ID"):"",oninput:e=>{let r=e.target.value.replace(/[^\d]/g,"");this.kontrakFormData.hps=parseInt(r)||0,e.target.value=this.kontrakFormData.hps.toLocaleString("id-ID")}})]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-money-dollar-box-line mr-1 text-green-500"}),"Nilai Kontrak (Rp)",this.currentAllocationInfo.remainingAllocation>0&&(0,P.default)("span",{class:"ml-2 text-xs text-orange-600 font-normal"},`(Max: Rp ${this.currentAllocationInfo.remainingAllocation.toLocaleString("id-ID")})`)]),(0,P.default)("input",{type:"text",class:`w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-200 transition-all duration-200 bg-gray-50 focus:bg-white ${this.kontrakFormData.nilaiKontrak>this.currentAllocationInfo.remainingAllocation&&this.currentAllocationInfo.remainingAllocation>0?"border-red-400 focus:border-red-500 focus:ring-red-200":"border-gray-200 focus:border-green-500 focus:ring-green-200"}`,placeholder:"0",value:this.kontrakFormData.nilaiKontrak?this.kontrakFormData.nilaiKontrak.toLocaleString("id-ID"):"",oninput:e=>{let r=e.target.value.replace(/[^\d]/g,"");this.kontrakFormData.nilaiKontrak=parseInt(r)||0,e.target.value=this.kontrakFormData.nilaiKontrak.toLocaleString("id-ID")}}),this.kontrakFormData.nilaiKontrak>this.currentAllocationInfo.remainingAllocation&&this.currentAllocationInfo.remainingAllocation>0&&(0,P.default)("div",{class:"mt-2 p-2 bg-red-50 border border-red-200 rounded text-red-700 text-sm flex items-center"},[(0,P.default)("i",{class:"ri-warning-line mr-2"}),`Nilai kontrak melebihi sisa anggaran sebesar Rp ${this.currentAllocationInfo.remainingAllocation.toLocaleString("id-ID")}. Kelebihan: Rp ${(this.kontrakFormData.nilaiKontrak-this.currentAllocationInfo.remainingAllocation).toLocaleString("id-ID")}`])])]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-settings-line mr-1 text-blue-500"}),"Tipe"]),(0,P.default)("select",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.kontrakFormData.tipe||"Konstruksi",onchange:e=>this.kontrakFormData.tipe=e.target.value},[(0,P.default)("option",{value:"Konstruksi"},"Konstruksi"),(0,P.default)("option",{value:"Non Konstruksi"},"Non Konstruksi")])]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-route-line mr-1 text-purple-500"}),"Metode Pengadaan"]),(0,P.default)("select",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.kontrakFormData.metodePengadaanId||"",onchange:e=>this.kontrakFormData.metodePengadaanId=e.target.value},[(0,P.default)("option",{value:""},"Pilih Metode Pengadaan"),this.metodePengadaanList.map(e=>(0,P.default)("option",{value:e._id,key:e._id},e.nama))])])]),(0,P.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-star-line mr-1 text-amber-500"}),"Kualifikasi Pengadaan"]),(0,P.default)("select",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.kontrakFormData.kualifikasiPengadaan||"Prakualifikasi",onchange:e=>this.kontrakFormData.kualifikasiPengadaan=e.target.value},[(0,P.default)("option",{value:"Prakualifikasi"},"Prakualifikasi"),(0,P.default)("option",{value:"Pascakualifikasi"},"Pascakualifikasi")])]),(0,P.default)("div",[(0,P.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,P.default)("i",{class:"ri-file-text-line mr-1 text-gray-500"}),"Deskripsi"]),(0,P.default)("textarea",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-gray-500 focus:ring-2 focus:ring-gray-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Deskripsi kontrak (opsional)",value:this.kontrakFormData.deskripsi||"",oninput:e=>this.kontrakFormData.deskripsi=e.target.value,rows:3})])])])]),this.currentAllocationInfo.totalAllocation>0&&(0,P.default)("div",{class:"bg-gray-800 rounded-lg p-4 mb-4 border-2 border-gray-600 shadow-xl"},[(0,P.default)("div",{class:"flex items-center justify-between"},[(0,P.default)("div",{class:"flex items-center space-x-2"},[(0,P.default)("i",{class:"ri-money-dollar-circle-line text-lg text-yellow-400"}),(0,P.default)("h5",{class:"font-bold text-white"},"Informasi Alokasi Anggaran")]),(0,P.default)("div",{class:"text-right",style:"min-width: 200px;"},[(0,P.default)("div",{class:"text-sm font-medium",style:this.currentAllocationInfo.remainingAllocation>0?"color: #34D399;":"color: #F87171;"},`Sisa Anggaran: Rp ${this.currentAllocationInfo.remainingAllocation.toLocaleString("id-ID")}`),(0,P.default)("div",{class:"text-xs",style:"color: #D1D5DB;"},`Digunakan: Rp ${this.currentAllocationInfo.usedAllocation.toLocaleString("id-ID")} dari Rp ${this.currentAllocationInfo.totalAllocation.toLocaleString("id-ID")}`)])])]),(0,P.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-lg"},[(0,P.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.closeKontrakModal()},[(0,P.default)("i",{class:"ri-close-fill"}),(0,P.default)("span","Batal")]),(0,P.default)("button",{class:`px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 ${this.isKontrakModalLoading?"opacity-50 cursor-not-allowed":""}`,onclick:()=>this.saveKontrak(),disabled:this.isKontrakModalLoading},[this.isKontrakModalLoading?(0,P.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,P.default)("i",{class:"ri-save-line"}),(0,P.default)("span",this.isKontrakModalLoading?"Menyimpan...":"Simpan")])])])])])}},rn=Yo;var pe=sr(lr(),1);Wr();var Go={isLoading:!1,currentUser:null,activeTab:"informasi",anggaranList:[],kinerjaList:[],subKegiatanList:[],pejabatList:[],monitoringList:[],currentMonitoringContext:{kontrakId:null,budgetYear:null},showModal:!1,modalMode:"create",isModalLoading:!1,formData:{kontrakId:"",realisasiProgress:0,realisasiDana:0,realisasiDanaRp:0,progressFisik:0,progressKeuangan:0,status:"planning",tanggalUpdate:"",keterangan:"",kendala:"",solusi:""},selectedSubKegiatan:null,expandedAccordions:new Set,expandedKodeRekeningAccordions:new Set,kodeRekeningCache:new Map,maxCacheSize:100,preventAutoExpand:!0,kontrakList:[],realisasiTabs:new Map,defaultRealisasiTab:"informasi",oninit:function(){if(!et.isAuthenticated()){be.warning("Silakan masuk terlebih dahulu"),pe.default.route.set("/login");return}if(this.currentUser=et.getUserData(),console.log("Monitoring.js - Current user data:",this.currentUser),console.log("Monitoring.js - namaPerangkatDaerah:",this.currentUser?.namaPerangkatDaerah),console.log("Monitoring.js - subPerangkatDaerah:",this.currentUser?.subPerangkatDaerah),this.currentUser.role!=="operator"){be.warning("Halaman ini hanya dapat diakses oleh operator"),pe.default.route.set("/dashboard");return}if(!this.currentUser.subPerangkatDaerahId){be.warning("Informasi unit kerja tidak ditemukan. Silakan masuk kembali."),pe.default.route.set("/login");return}this.loadData()},loadData:async function(){this.isLoading=!0,pe.default.redraw();try{this.activeTab==="informasi"?await this.loadInformasiData():this.activeTab==="realisasi"&&await this.loadRealisasiData()}catch(e){console.error("Error loading data:",e),e.code===500||e.response&&e.response.status===500?console.log("500 error received, but may be due to empty data - not showing error toast"):be.error("Gagal memuat data")}this.isLoading=!1,pe.default.redraw()},loadInformasiData:async function(){try{let r=et.getUserData().subPerangkatDaerahId;if(!r){be.warning("Informasi unit kerja tidak ditemukan");return}let f=new Date().getFullYear(),i=["2026-Murni","2026-PAK"][0];this.formData.budgetYear=i;let t=await Ce.request(`/api/kinerja?subPerangkatDaerahId=${r}&budgetYear=${encodeURIComponent(i)}`);this.kinerjaList=t.data||[];try{let x=await Ce.request("/api/pejabat?jabatanFungsional=PA");this.pejabatList=x.data||[],console.log("Pejabat data loaded:",this.pejabatList)}catch(x){console.error("Failed to load pejabat data:",x),this.pejabatList=[]}let n=[],c=new Set;if(this.kinerjaList.forEach(x=>{x.anggaranId&&x.anggaranId._id&&c.add(x.anggaranId._id)}),c.size>0){let x=Array.from(c).map(g=>Ce.request(`/api/anggaran/${g}`));n=(await Promise.all(x)).map(g=>g.data).filter(g=>g)}this.anggaranList=n;let b=new Set;if(this.anggaranList.forEach(x=>{x.subKegiatanId&&b.add(x.subKegiatanId._id||x.subKegiatanId)}),this.kinerjaList.forEach(x=>{x.subKegiatanId&&b.add(x.subKegiatanId._id||x.subKegiatanId)}),b.size>0){let w=(await Ce.getAll("subkegiatan")).data||[];this.subKegiatanList=w.filter(g=>b.has(g._id))}else this.subKegiatanList=[]}catch(e){console.error("Error loading informasi data:",e),e.code===500||e.response&&e.response.status===500?console.log("500 error received, but may be due to empty data - not showing error toast"):be.error("Gagal memuat data informasi unit kerja")}},loadRealisasiData:async function(){try{await this.loadInformasiData();let r=et.getUserData().subPerangkatDaerahId,f=new Date().getFullYear(),i=["2026-Murni","2026-PAK"][0];if(!r){be.warning("Informasi unit kerja tidak ditemukan");return}try{await this.loadKontrakData()}catch(t){console.error("Error loading kontrak data:",t),this.kontrakList=[]}console.log("Realisasi data loaded, kontrak:",this.kontrakList.length)}catch(e){console.error("Error loading realisasi data:",e),be.error("Gagal memuat data realisasi")}},loadKontrakData:async function(){try{let r=et.getUserData().subPerangkatDaerahId,f=new Date().getFullYear(),i=["2026-Murni","2026-PAK"][0];if(!r){be.warning("Informasi unit kerja tidak ditemukan");return}let t=`subPerangkatDaerahId=${r}&budgetYear=${encodeURIComponent(i)}`;console.log("Loading kontrak with query:",t);let n=await Ce.request(`/api/kontrak?${t}`);this.kontrakList=n.data||[],console.log("Kontrak data loaded:",this.kontrakList.length,"kontrak found")}catch(e){console.error("Error loading kontrak data:",e),e.code===500||e.response&&e.response.status===500?(console.log("500 error received, but may be due to empty data - not showing error toast"),this.kontrakList=[]):(be.error("Gagal memuat data kontrak"),this.kontrakList=[])}},toggleAccordion:function(e){this.expandedAccordions.has(e)?this.expandedAccordions.delete(e):(this.expandedAccordions.add(e),this.ensureKodeRekeningDataLoaded(e)),pe.default.redraw()},toggleKodeRekeningAccordion:function(e){let r=typeof e=="string"?e:e&&e._id?e._id:String(e);this.expandedKodeRekeningAccordions.has(r)?this.expandedKodeRekeningAccordions.delete(r):this.expandedKodeRekeningAccordions.add(r),pe.default.redraw()},ensureKodeRekeningDataLoaded:function(e){console.log("=== DEBUG: ensureKodeRekeningDataLoaded called for subKegiatanId:",e);let r=this.getKodeRekeningAllocationsForSubKegiatan(e);console.log("=== DEBUG: Found allocations:",r.length),console.log("=== DEBUG: Allocation details:",r.map(a=>({anggaranId:a.anggaranId,kodeRekeningId:a.kodeRekeningId,isTemp:a.kodeRekeningId&&a.kodeRekeningId._temp,kodeId:a.kodeRekeningId&&a.kodeRekeningId._id})));let f=r.filter(a=>a.kodeRekeningId&&a.kodeRekeningId._temp).map(a=>a.kodeRekeningId._id);if(console.log("=== DEBUG: Missing IDs found:",f.length,f),f.length>0)console.log("Fetching missing kode rekening data for IDs:",f),this.fetchMissingKodeRekeningData(f,r);else{console.log("=== DEBUG: No missing IDs found, checking if data needs refresh...");let a=r.filter(i=>i.kodeRekeningId&&i.kodeRekeningId._id).map(i=>i.kodeRekeningId._id);a.length>0&&(console.log("=== DEBUG: Forcing refresh for IDs:",a),this.fetchMissingKodeRekeningData(a,r))}},renderRealisasiTabs:function(e){this.realisasiTabs.has(e._id)||this.realisasiTabs.set(e._id,{activeTab:this.defaultRealisasiTab,formData:{}});let f=this.realisasiTabs.get(e._id).activeTab;return(0,pe.default)("div",{class:"mt-4"},[(0,pe.default)("div",{class:"border-b border-gray-200"},[(0,pe.default)("nav",{class:"flex space-x-8"},[(0,pe.default)("button",{class:`py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${f==="informasi"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:()=>{let a=this.realisasiTabs.get(e._id);a.activeTab="informasi",pe.default.redraw()}},[(0,pe.default)("i",{class:"ri-information-line mr-2"}),"Informasi"]),(0,pe.default)("button",{class:`py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${f==="progress"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:()=>{let a=this.realisasiTabs.get(e._id);a.activeTab="progress",this.currentMonitoringContext.kontrakId=e._id,this.loadMonitoringData(e._id),pe.default.redraw()}},[(0,pe.default)("i",{class:"ri-progress-1-line mr-2"}),"Progress"])])]),(0,pe.default)("div",{class:"p-4"},[f==="informasi"&&(0,pe.default)("div",{class:"bg-white"},[(0,pe.default)("div",{class:"bg-gradient-to-r from-green-500 to-teal-600 text-white p-4 rounded-t-lg"},[(0,pe.default)("div",{class:"flex items-center space-x-3"},[(0,pe.default)("div",{class:"w-10 h-10 bg-white bg-opacity-75 rounded-full flex items-center justify-center"},[(0,pe.default)("i",{class:"ri-file-contract-fill text-lg"})]),(0,pe.default)("div",[(0,pe.default)("h3",{class:"text-lg font-bold"},"Informasi Kontrak"),(0,pe.default)("p",{class:"text-white text-opacity-80 text-sm"},"Detail informasi untuk monitoring")])])]),(0,pe.default)("div",{class:"p-6 space-y-4"},[(0,pe.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,pe.default)("i",{class:"ri-hashtag mr-1 text-blue-500"}),"No. Kontrak"]),(0,pe.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm font-mono text-gray-900"},e.noKontrak||"N/A")]),(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,pe.default)("i",{class:"ri-calendar-line mr-1 text-green-500"}),"Tgl. Kontrak"]),(0,pe.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-900"},e.tglKontrak?new Date(e.tglKontrak).toLocaleDateString("id-ID"):"N/A")])]),(0,pe.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,pe.default)("i",{class:"ri-building-line mr-1 text-purple-500"}),"Nama Penyedia (Penyedia B/J)"]),(0,pe.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-900"},e.penyediaId?.NamaVendor||"N/A")]),(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,pe.default)("i",{class:"ri-file-text-line mr-1 text-orange-500"}),"No. SPMK"]),(0,pe.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm font-mono text-gray-900"},e.noSpmk||"N/A")])]),(0,pe.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,pe.default)("i",{class:"ri-calendar-check-line mr-1 text-indigo-500"}),"Tgl. SPMK"]),(0,pe.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-900"},e.tglSpmk?new Date(e.tglSpmk).toLocaleDateString("id-ID"):"N/A")]),(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,pe.default)("i",{class:"ri-calendar-event-line mr-1 text-red-500"}),"Tgl Pelaksanaan - selesai"]),(0,pe.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-900"},e.tglPelaksanaanSampai?new Date(e.tglPelaksanaanSampai).toLocaleDateString("id-ID"):"N/A")])]),(0,pe.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,pe.default)("i",{class:"ri-map-pin-line mr-1 text-teal-500"}),"Lokasi Kegiatan"]),(0,pe.default)("div",{class:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-900"},e.lokasi||"N/A")]),(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-700 mb-1"},[(0,pe.default)("i",{class:"ri-money-dollar-circle-line mr-1 text-yellow-500"}),"Nilai Kontrak"]),(0,pe.default)("div",{class:"px-3 py-2 bg-green-50 border border-green-200 rounded-md text-sm font-bold text-green-800"},`Rp ${e.nilaiKontrak?.toLocaleString("id-ID")||"0"}`)])])])]),f==="progress"&&(0,pe.default)("div",{class:"space-y-4"},[(0,pe.default)("div",{class:"flex justify-between items-center"},[(0,pe.default)("h4",{class:"text-lg font-semibold text-gray-800 flex items-center"},[(0,pe.default)("i",{class:"ri-progress-1-line mr-2 text-green-500"}),"Progress Monitoring"]),(0,pe.default)("button",{class:"px-4 py-2 bg-gradient-to-r from-green-500 to-teal-600 text-white text-sm font-medium rounded-lg hover:from-green-600 hover:to-teal-700 transition-all duration-200 flex items-center space-x-2",onclick:a=>{a.preventDefault(),this.openMonitoringModal(e)}},[(0,pe.default)("i",{class:"ri-add-line"}),(0,pe.default)("span","Tambah Progress")])]),e.tglPelaksanaanDari&&e.tglPelaksanaanSampai&&(0,pe.default)("div",{class:"bg-green-50 border border-green-200 rounded-lg p-3 mb-4"},[(0,pe.default)("div",{class:"flex items-center text-sm text-green-700"},[(0,pe.default)("i",{class:"ri-information-line mr-2"}),"Periode Kontrak: ",(0,pe.default)("span",{class:"font-medium"},new Date(e.tglPelaksanaanDari).toLocaleDateString("id-ID")),(0,pe.default)("span",{class:"mx-1"},"-"),(0,pe.default)("span",{class:"font-medium"},new Date(e.tglPelaksanaanSampai).toLocaleDateString("id-ID"))])]),(0,pe.default)("div",{class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},[(0,pe.default)("table",{class:"w-full"},[(0,pe.default)("thead",{class:"bg-gray-50"},[(0,pe.default)("tr",[(0,pe.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tanggal Update"),(0,pe.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Progress Fisik (%)"),(0,pe.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Progress Keuangan (%)"),(0,pe.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Realisasi Dana (Rp)"),(0,pe.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),(0,pe.default)("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Aksi")])]),(0,pe.default)("tbody",{class:"bg-white divide-y divide-gray-200"},[(0,pe.default)("tr",[(0,pe.default)("td",{class:"px-4 py-8 text-center text-gray-500",colSpan:6},[(0,pe.default)("i",{class:"ri-progress-1-line text-4xl text-gray-300 mb-2 block"}),"Belum ada data progress monitoring",(0,pe.default)("div",{class:"text-sm text-gray-400 mt-1"},'Klik "Tambah Progress" untuk menambahkan monitoring progress')])])])])]),(0,pe.default)("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4"},[(0,pe.default)("div",{class:"flex items-start"},[(0,pe.default)("i",{class:"ri-information-line text-blue-500 mr-2 mt-0.5"}),(0,pe.default)("div",{class:"text-sm text-blue-700"},[(0,pe.default)("div",{class:"font-medium mb-1"},"Catatan Progress Monitoring:"),(0,pe.default)("ul",{class:"list-disc list-inside space-y-1"},[(0,pe.default)("li","Update progress secara berkala sesuai dengan perkembangan pekerjaan"),(0,pe.default)("li","Pastikan data realisasi dana sesuai dengan progress fisik"),(0,pe.default)("li","Dokumentasikan kendala dan solusi yang dihadapi")])])])])])])])},openMonitoringModal:function(e=null,r=null){this.modalMode=r?"edit":"create",this.currentMonitoringContext.kontrakId=e?e._id:null,this.formData={kontrakId:r?r.kontrakId?._id||r.kontrakId:e?e._id:"",realisasiProgress:r&&r.realisasiProgress||0,realisasiDana:r&&r.realisasiDana||0,realisasiDanaRp:r&&r.realisasiDanaRp||0,progressFisik:r&&r.progressFisik||0,progressKeuangan:r&&r.progressKeuangan||0,status:r&&r.status||"planning",tanggalUpdate:r&&r.tanggalUpdate?r.tanggalUpdate.split("T")[0]:"",keterangan:r&&r.keterangan||"",kendala:r&&r.kendala||"",solusi:r&&r.solusi||""},this.showModal=!0,pe.default.redraw()},closeModal:function(){this.showModal=!1,this.modalMode="create",this.formData={kontrakId:"",realisasiProgress:0,realisasiDana:0,realisasiDanaRp:0,progressFisik:0,progressKeuangan:0,status:"planning",tanggalUpdate:"",keterangan:"",kendala:"",solusi:""},this.currentMonitoringContext.kontrakId=null,pe.default.redraw()},loadMonitoringData:async function(e){try{let f=(await Ce.request(`/api/monitoring/by-kontrak/${e}`)).data||[];return console.log(`Loaded ${f.length} monitoring entries for kontrak ${e}`),pe.default.redraw(),f}catch(r){return console.error("Error loading monitoring data for kontrak:",e,r),r.response&&r.response.status===404?(pe.default.redraw(),[]):(pe.default.redraw(),[])}},saveMonitoring:async function(){if(!this.formData.kontrakId||!this.formData.tanggalUpdate){be.warning("Kontrak dan tanggal update harus diisi");return}this.isModalLoading=!0,pe.default.redraw();try{let e=et.getUserData(),r={...this.formData,subPerangkatDaerahId:e.subPerangkatDaerahId,budgetYear:e.budgetYear?.year?`${e.budgetYear.year}-${e.budgetYear.status}`:"2026-Murni",createdBy:e.username,updatedBy:e.username};this.modalMode==="create"?(await Ce.create("monitoring",r),be.success("Data monitoring berhasil ditambahkan")):be.info("Edit mode will be implemented"),this.closeModal(),this.loadRealisasiData()}catch(e){console.error("Error saving monitoring:",e)}this.isModalLoading=!1,pe.default.redraw()},getKinerjaForSubKegiatan:function(e){return this.kinerjaList.filter(r=>(r.subKegiatanId?._id||r.subKegiatanId)===e)},getAnggaranForSubKegiatan:function(e){return this.anggaranList.filter(r=>(r.subKegiatanId?._id||r.subKegiatanId)===e)},getTotalBudgetForSubKegiatan:function(e){return this.getAnggaranForSubKegiatan(e).reduce((a,i)=>a+(i.totalAmount||0),0)},getKodeRekeningAllocationsForSubKegiatan:function(e){let r=[],f=new Set;return this.anggaranList.filter(a=>(a.subKegiatanId?._id||a.subKegiatanId)===e).forEach(a=>{a.allocations&&a.allocations.forEach(i=>{if(i.kodeRekeningId&&i.amount>0){let t=i.kodeRekeningId;if(typeof t=="string"){let n=this.kodeRekeningCache.get(t);n?t=n:(f.add(t),t={_id:t,code:"Loading...",name:"Loading...",fullCode:"Loading...",_temp:!0})}else!t.fullCode&&t.code&&(t.fullCode=t.code);r.push({...i,anggaranId:a._id,subKegiatanId:e,kodeRekeningId:t})}})}),f.size>0&&(console.log("Auto-fetching kode rekening data for IDs:",Array.from(f)),this.fetchMissingKodeRekeningData(Array.from(f),r)),r},fetchMissingKodeRekeningData:async function(e,r){try{console.log("Inside fetchMissingKodeRekeningData with IDs:",e);let f=e.filter(t=>!this.kodeRekeningCache.has(t));if(f.length===0){r.forEach(t=>{if(t.kodeRekeningId&&t.kodeRekeningId._temp){let n=t.kodeRekeningId._id,c=this.kodeRekeningCache.get(n);c&&(t.kodeRekeningId=c)}}),console.log("All data cached, triggering redraw"),pe.default.redraw();return}console.log("Making API call with uncachedIds:",f);let i=(await Ce.request(`/api/koderekening?ids=${f.join(",")}`)).data||[];console.log("API Response received:",i),i.forEach(t=>{this.kodeRekeningCache.set(t._id,{...t,fullCode:t.fullCode||t.code||"XX"})}),this.manageCacheSize(),console.log("Cached data:",Array.from(this.kodeRekeningCache.entries())),console.log("Before updating allocations:",r.map(t=>({id:t.kodeRekeningId._id,temp:t.kodeRekeningId._temp}))),r.forEach(t=>{if(t.kodeRekeningId&&t.kodeRekeningId._temp){let n=t.kodeRekeningId._id,c=this.kodeRekeningCache.get(n);if(c)t.kodeRekeningId=c,console.log("Updated allocation for ID:",n,"with data:",c);else{let b={_id:n,code:"XX",name:"Data Not Found",fullCode:"XX"};this.kodeRekeningCache.set(n,b),t.kodeRekeningId=b,console.log("Using fallback data for ID:",n)}}}),this.manageCacheSize(),console.log("After updating allocations:",r.map(t=>({id:t.kodeRekeningId._id,name:t.kodeRekeningId.name}))),console.log("Calling m.redraw() after API fetch"),pe.default.redraw()}catch(f){console.error("Error fetching kode rekening data:",f)}},manageCacheSize:function(){if(this.kodeRekeningCache.size>this.maxCacheSize){let e=this.kodeRekeningCache.size-this.maxCacheSize,r=Array.from(this.kodeRekeningCache.keys());for(let f=0;f<e;f++)this.kodeRekeningCache.delete(r[f]);console.log(`Cache cleaned: removed ${e} entries, current size: ${this.kodeRekeningCache.size}`)}},getFullCode:function(e){let r=[];return e.kegiatanId?.programId?.bidangId?.urusanId?.kode&&r.push(e.kegiatanId.programId.bidangId.urusanId.kode),e.kegiatanId?.programId?.bidangId?.kode&&r.push(e.kegiatanId.programId.bidangId.kode),e.kegiatanId?.programId?.kode&&r.push(e.kegiatanId.programId.kode),e.kegiatanId?.kode&&r.push(e.kegiatanId.kode),r.push(e.kode),r.join(".")},getKodeRekeningDisplayInfo:function(e){if(!e)return{name:"Loading...",code:"Loading...",fullDisplay:"Loading... - Loading..."};let r=e.name||e.nama||"Loading...",f=this.getFullKodeRekeningCode(e),a=`${f} - ${r}`;return{name:r,code:f,fullDisplay:a}},getFullKodeRekeningCode:function(e){if(!e)return"XX";if(e.fullCode)return e.fullCode;let r=[];return e.parentCode&&r.push(e.parentCode),e.code&&r.push(e.code),r.length>0?r.join("."):e.code||"XX"},view:function(){return!this.currentUser||this.currentUser.role!=="operator"?(0,pe.default)("div",{class:"flex justify-center items-center h-64"},[(0,pe.default)("div",{class:"text-center"},[(0,pe.default)("i",{class:"ri-shield-user-line text-6xl text-gray-400 mb-4"}),(0,pe.default)("h3",{class:"text-lg font-semibold text-gray-600"},"Akses Ditolak"),(0,pe.default)("p",{class:"text-gray-500"},"Halaman ini hanya dapat diakses oleh operator")])]):(0,pe.default)("div",{class:"space-y-6"},[(0,pe.default)("div",{class:"flex justify-between items-center"},[(0,pe.default)("div",[(0,pe.default)("h1",{class:"text-2xl font-bold text-gray-900"},"Monitoring"),(0,pe.default)("p",{class:"text-gray-600 mt-1"},`Unit Kerja: ${this.currentUser.subPerangkatDaerah?.nama||"Tidak ditemukan"}`)]),(0,pe.default)("div",{class:"flex items-center space-x-4"},[(0,pe.default)("button",{class:"px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white text-sm font-medium rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl",onclick:()=>this.loadData()},[(0,pe.default)("i",{class:"ri-refresh-line mr-2"}),"Refresh"])])]),(0,pe.default)("div",{class:"bg-white rounded-lg shadow-sm border border-gray-200"},[(0,pe.default)("div",{class:"border-b border-gray-200"},[(0,pe.default)("nav",{class:"flex space-x-8 px-6","aria-label":"Tabs"},[(0,pe.default)("button",{class:`py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${this.activeTab==="informasi"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:async()=>{this.activeTab="informasi",this.expandedAccordions.clear(),this.expandedKodeRekeningAccordions.clear(),pe.default.redraw(),await this.loadInformasiData()}},[(0,pe.default)("i",{class:"ri-information-line mr-2"}),"Informasi"]),(0,pe.default)("button",{class:`py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${this.activeTab==="realisasi"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onclick:async()=>{this.activeTab="realisasi",this.expandedAccordions.clear(),this.expandedKodeRekeningAccordions.clear(),pe.default.redraw(),await this.loadRealisasiData()}},[(0,pe.default)("i",{class:"ri-progress-1-line mr-2"}),"Realisasi"])])]),(0,pe.default)("div",{class:"p-6"},[this.isLoading?(0,pe.default)("div",{class:"flex justify-center items-center h-64"},[(0,pe.default)("div",{class:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})]):this.activeTab==="informasi"?(0,pe.default)("div",{class:"space-y-4"},[this.subKegiatanList.length===0?(0,pe.default)("div",{class:"text-center py-12"},[(0,pe.default)("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 mb-4"},[(0,pe.default)("i",{class:"ri-information-fill text-blue-500"})]),(0,pe.default)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Belum ada data anggaran"),(0,pe.default)("p",{class:"text-gray-500"},"Buat data anggaran terlebih dahulu untuk melihat informasi subkegiatan")]):this.subKegiatanList.map(e=>(0,pe.default)("div",{class:"border border-gray-200 rounded-lg"},[(0,pe.default)("button",{class:"w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors",onclick:()=>this.toggleAccordion(e._id)},[(0,pe.default)("div",[(0,pe.default)("div",{class:"flex items-center space-x-3"},[(0,pe.default)("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-center",style:(this.expandedAccordions.has(e._id)?"background-color: #3B82F6; color: white;":"background-color: #E5E7EB; color: #6B7280;")+" overflow: hidden; white-space: nowrap; text-overflow: ellipsis;"},this.getFullCode(e)||"XX"),(0,pe.default)("div",[(0,pe.default)("h3",{class:"font-semibold text-gray-900"},e.nama||"Nama SubKegiatan"),(0,pe.default)("p",{class:"text-xs text-gray-500 mt-0.5"},this.getFullCode(e)||"XX")])])]),(0,pe.default)("div",{class:"flex items-center space-x-2"},[(0,pe.default)("span",{class:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${this.getAnggaranForSubKegiatan(e._id).length>0?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`},`Rp ${this.getTotalBudgetForSubKegiatan(e._id).toLocaleString("id-ID")}`),(0,pe.default)("i",{class:`ri-arrow-${this.expandedAccordions.has(e._id)?"up":"down"}-line text-gray-400`})])]),this.expandedAccordions.has(e._id)&&(0,pe.default)("div",{class:"px-4 pb-4 border-t border-gray-200 bg-gray-50"},[(0,pe.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pt-4"},[(0,pe.default)("div",{class:"bg-white rounded-lg p-4 border border-gray-200"},[(0,pe.default)("div",{class:"flex items-center mb-3"},[(0,pe.default)("div",{class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-2"},[(0,pe.default)("i",{class:"ri-bar-chart-line text-blue-600 text-sm"})]),(0,pe.default)("h4",{class:"font-semibold text-gray-900"},"Kinerja")]),(0,pe.default)("div",{class:"space-y-2"},[(0,pe.default)("p",{class:"text-sm text-gray-600"},e.kinerja||"Tidak ada data kinerja"),this.getKinerjaForSubKegiatan(e._id).length>0&&(0,pe.default)("div",{class:"mt-2"},[(0,pe.default)("p",{class:"text-xs text-gray-500 mb-1"},`${this.getKinerjaForSubKegiatan(e._id).length} target kinerja:`),this.getKinerjaForSubKegiatan(e._id).slice(0,3).map(r=>(0,pe.default)("div",{class:"text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded mb-1"},[`${r.targetValue||0} ${r.subKegiatanId?.satuan||e.satuan||"unit"} (${r.status||"planning"})`])),this.getKinerjaForSubKegiatan(e._id).length>3&&(0,pe.default)("p",{class:"text-xs text-gray-500"},`... dan ${this.getKinerjaForSubKegiatan(e._id).length-3} lainnya`)])])]),(0,pe.default)("div",{class:"bg-white rounded-lg p-4 border border-gray-200"},[(0,pe.default)("div",{class:"flex items-center mb-3"},[(0,pe.default)("div",{class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-2"},[(0,pe.default)("i",{class:"ri-line-chart-line text-green-600 text-sm"})]),(0,pe.default)("h4",{class:"font-semibold text-gray-900"},"Indikator")]),(0,pe.default)("p",{class:"text-sm text-gray-600"},e.indikator||"Tidak ada indikator")]),(0,pe.default)("div",{class:"bg-white rounded-lg p-4 border border-gray-200"},[(0,pe.default)("div",{class:"flex items-center mb-3"},[(0,pe.default)("div",{class:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mr-2"},[(0,pe.default)("i",{class:"ri-scales-line text-purple-600 text-sm"})]),(0,pe.default)("h4",{class:"font-semibold text-gray-900"},"Satuan")]),(0,pe.default)("p",{class:"text-sm text-gray-600"},e.satuan||"Tidak ada satuan")])]),this.getAnggaranForSubKegiatan(e._id).length>0&&(0,pe.default)("div",{class:"mt-4 bg-white rounded-lg p-4 border border-gray-200"},[(0,pe.default)("div",{class:"flex items-center mb-3"},[(0,pe.default)("div",{class:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center mr-2"},[(0,pe.default)("i",{class:"ri-money-dollar-circle-line text-yellow-600 text-sm"})]),(0,pe.default)("h4",{class:"font-semibold text-gray-900"},"Anggaran")]),(0,pe.default)("div",{class:"space-y-2"},[this.getAnggaranForSubKegiatan(e._id).map(r=>(0,pe.default)("div",{class:"bg-yellow-50 border border-yellow-200 rounded p-3"},[(0,pe.default)("div",{class:"flex justify-between items-center mb-2"},[(0,pe.default)("span",{class:"text-sm font-medium text-gray-900"},`Tahun: ${r.budgetYear||"Tidak ditentukan"}`),(0,pe.default)("span",{class:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"},`Rp ${(r.totalAmount||0).toLocaleString("id-ID")}`)]),r.allocations&&r.allocations.length>0&&(0,pe.default)("div",{class:"text-xs text-gray-600"},[`${r.allocations.length} alokasi kode rekening`])]))])]),(0,pe.default)("div",{class:"mt-4 bg-white rounded-lg p-4 border border-gray-200"},[(0,pe.default)("div",{class:"flex items-center justify-between mb-3"},[(0,pe.default)("div",{class:"flex items-center"},[(0,pe.default)("div",{class:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mr-2"},[(0,pe.default)("i",{class:"ri-map-pin-line text-purple-600 text-sm"})]),(0,pe.default)("h4",{class:"font-semibold text-gray-900"},"Informasi Tambahan")])]),(0,pe.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,pe.default)("div",{class:"space-y-2"},[(0,pe.default)("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Lokasi"),(()=>{let r=this.kinerjaList.filter(a=>(a.subKegiatanId?._id||a.subKegiatanId)===e._id),f="Tidak ditentukan";if(r.length>0&&r[0].lokasi)f=r[0].lokasi;else if(this.currentUser.subPerangkatDaerah?.perangkatDaerahId?.namaPemda){let a=this.currentUser.subPerangkatDaerah.perangkatDaerahId.namaPemda;a=a.replace(/^Pemkab\s+/,"Kabupaten "),a=a.replace(/^Pemkot\s+/,"Kota "),a=a.replace(/^Kabupaten\s+([A-Za-z\s]+)/,"Kabupaten $1"),a=a.replace(/^Kota\s+([A-Za-z\s]+)/,"Kota $1"),a&&(a=a.replace(/^ Pemerintah\s+/,""),a=a.replace(/^Pemkab\s+/,"Kabupaten "),a=a.replace(/^Pemkot\s+/,"Kota ")),f=a}else console.log("Current user data:",this.currentUser),console.log("SubPerangkatDaerah data:",this.currentUser.subPerangkatDaerah);return(0,pe.default)("div",{class:"text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded"},f)})()]),(0,pe.default)("div",{class:"space-y-2"},[(0,pe.default)("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Pengguna Anggaran"),(()=>{let r=this.kinerjaList.filter(i=>(i.subKegiatanId?._id||i.subKegiatanId)===e._id),f=r.length>0&&r[0].penggunaAnggaran,a="Tidak ditentukan";if(f)a=`${f.nama} (${f.jabatanFungsional})`;else if(this.pejabatList.length>0){let i=this.pejabatList[0];a=`${i.nama} (${i.jabatanFungsional})`}return(0,pe.default)("div",{class:"text-sm text-gray-900 bg-gray-50 px-3 py-2 rounded"},a)})()])])])])]))]):this.activeTab==="realisasi"?(0,pe.default)("div",{class:"space-y-4"},[this.subKegiatanList.length===0?(0,pe.default)("div",{class:"text-center py-12"},[(0,pe.default)("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 mb-4"},[(0,pe.default)("i",{class:"ri-progress-1-fill text-blue-500"})]),(0,pe.default)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Belum ada subkegiatan"),(0,pe.default)("p",{class:"text-gray-500"},"Buat data anggaran terlebih dahulu untuk melihat data realisasi")]):this.subKegiatanList.map(e=>(0,pe.default)("div",{class:"border border-gray-200 rounded-lg"},[(0,pe.default)("button",{class:"w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors",onclick:()=>this.toggleAccordion(e._id)},[(0,pe.default)("div",[(0,pe.default)("div",{class:"flex items-center space-x-3"},[(0,pe.default)("div",{class:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-center",style:(this.expandedAccordions.has(e._id)?"background-color: #10B981; color: white;":"background-color: #E5E7EB; color: #6B7280;")+" overflow: hidden; white-space: nowrap; text-overflow: ellipsis;"},this.getFullCode(e)||"XX"),(0,pe.default)("div",[(0,pe.default)("h3",{class:"font-semibold text-gray-900"},e.nama||"Nama SubKegiatan"),(0,pe.default)("p",{class:"text-xs text-gray-500 mt-0.5"},this.getFullCode(e)||"XX")])])]),(0,pe.default)("div",{class:"flex items-center space-x-2"},[(0,pe.default)("span",{class:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${this.getKodeRekeningAllocationsForSubKegiatan(e._id).length>0?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`},`${this.getKodeRekeningAllocationsForSubKegiatan(e._id).length} kode rekening`),(0,pe.default)("i",{class:`ri-arrow-${this.expandedAccordions.has(e._id)?"up":"down"}-line text-gray-400`})])]),this.expandedAccordions.has(e._id)&&(0,pe.default)("div",{class:"px-4 pb-4 border-t border-gray-200 bg-gray-50"},[(0,pe.default)("div",{class:"space-y-4 pt-4"},[this.getKodeRekeningAllocationsForSubKegiatan(e._id).length===0?(0,pe.default)("div",{class:"text-center py-8"},[(0,pe.default)("div",{class:"mx-auto flex items-center justify-center h-10 w-10 rounded-full bg-gray-100 mb-3"},[(0,pe.default)("i",{class:"ri-money-dollar-circle-fill text-blue-500"})]),(0,pe.default)("p",{class:"text-sm text-gray-500 mb-3"},"Belum ada alokasi kode rekening untuk subkegiatan ini"),(0,pe.default)("p",{class:"text-xs text-gray-400"},"Tambahkan alokasi kode rekening pada data anggaran")]):this.getKodeRekeningAllocationsForSubKegiatan(e._id).map(r=>{let f=typeof r.kodeRekeningId=="string"?r.kodeRekeningId:r.kodeRekeningId._id||r.kodeRekeningId,a=this.kontrakList.filter(i=>i.kodeRekeningId===f||i.paketKegiatanId?.kodeRekeningId===f);return(0,pe.default)("div",{class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},[(0,pe.default)("button",{class:"w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors",onclick:()=>this.toggleKodeRekeningAccordion(f)},[(0,pe.default)("div",[(()=>{let i=this.getKodeRekeningDisplayInfo(r.kodeRekeningId);return[(0,pe.default)("h4",{class:"font-semibold text-gray-900"},i.name||"Loading..."),(0,pe.default)("p",{class:"text-sm text-gray-500"},i.code||"Loading...")]})()]),(0,pe.default)("div",{class:"flex items-center space-x-2"},[(0,pe.default)("span",{class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-emerald-100 text-emerald-800"},`Rp ${r.amount.toLocaleString("id-ID")}`),(0,pe.default)("span",{class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800"},`${a.length} kontrak`),(0,pe.default)("i",{class:`ri-arrow-${this.expandedKodeRekeningAccordions.has(f)?"up":"down"}-line text-gray-400`})])]),this.expandedKodeRekeningAccordions.has(f)&&(0,pe.default)("div",{class:"border-t border-gray-200 bg-gray-50"},[(0,pe.default)("div",{class:"p-4"},[a.length===0?(0,pe.default)("div",{class:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg"},[(0,pe.default)("i",{class:"ri-progress-1-line text-2xl text-gray-400 mb-2 block"}),(0,pe.default)("p",{class:"text-sm text-gray-500 mb-3"},"Belum ada kontrak untuk monitoring pada kode rekening ini"),(0,pe.default)("p",{class:"text-xs text-gray-400 mb-4"},"Kontrak akan muncul setelah pengadaan dibuat")]):(0,pe.default)("div",[(0,pe.default)("div",{class:"space-y-4"},[a.map((i,t)=>(0,pe.default)("div",{class:"bg-white border border-gray-200 rounded-lg p-4"},[(0,pe.default)("div",{class:"flex items-center justify-between mb-3"},[(0,pe.default)("div",[(0,pe.default)("h6",{class:"text-sm font-semibold text-gray-900"},`${t+1}. Kontrak ${i.noKontrak||"N/A"}`),(0,pe.default)("p",{class:"text-xs text-gray-500"},i.penyediaId?.NamaVendor||"Penyedia tidak diketahui")]),(0,pe.default)("span",{class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800"},`Rp ${i.nilaiKontrak?.toLocaleString("id-ID")||"0"}`)]),this.renderRealisasiTabs(i)]))])])])])])})])])]))]):null])]),this.showModal&&(0,pe.default)("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onclick:e=>{e.target===e.currentTarget&&this.closeModal()}},[(0,pe.default)("div",{class:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-lg bg-white"},[(0,pe.default)("div",{class:"bg-gradient-to-r from-green-500 to-teal-600 text-white p-6 rounded-t-lg"},[(0,pe.default)("div",{class:"flex items-center justify-between"},[(0,pe.default)("div",{class:"flex items-center space-x-3"},[(0,pe.default)("div",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center"},[(0,pe.default)("i",{class:"ri-progress-1-fill text-xl text-white"})]),(0,pe.default)("div",[(0,pe.default)("h3",{class:"text-xl font-bold"},this.modalMode==="create"?"Tambah Progress":"Edit Progress"),(0,pe.default)("p",{class:"text-white text-opacity-80 text-sm"},"Formulir input progress monitoring")])]),(0,pe.default)("button",{class:"w-8 h-8 bg-blue-600 bg-opacity-25 rounded-full flex items-center justify-center",onclick:()=>this.closeModal()},[(0,pe.default)("i",{class:"ri-close-fill"})])])]),(0,pe.default)("div",{class:"p-6 max-h-96 overflow-y-auto"},[(0,pe.default)("div",{class:"space-y-6"},[(0,pe.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,pe.default)("i",{class:"ri-progress-1-line mr-1 text-blue-500"}),"Progress Fisik (%)"]),(0,pe.default)("input",{type:"number",min:"0",max:"100",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"0-100",value:this.formData.progressFisik,oninput:e=>this.formData.progressFisik=parseFloat(e.target.value)||0})]),(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,pe.default)("i",{class:"ri-money-dollar-circle-line mr-1 text-green-500"}),"Progress Keuangan (%)"]),(0,pe.default)("input",{type:"number",min:"0",max:"100",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"0-100",value:this.formData.progressKeuangan,oninput:e=>this.formData.progressKeuangan=parseFloat(e.target.value)||0})])]),(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,pe.default)("i",{class:"ri-money-dollar-box-line mr-1 text-yellow-500"}),"Realisasi Dana (Rp)"]),(0,pe.default)("input",{type:"text",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"0",value:this.formData.realisasiDanaRp?this.formData.realisasiDanaRp.toLocaleString("id-ID"):"",oninput:e=>{let r=e.target.value.replace(/[^\d]/g,"");this.formData.realisasiDanaRp=parseInt(r)||0,e.target.value=this.formData.realisasiDanaRp.toLocaleString("id-ID")}})]),(0,pe.default)("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,pe.default)("i",{class:"ri-information-line mr-1 text-purple-500"}),"Status"]),(0,pe.default)("select",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.formData.status,onchange:e=>this.formData.status=e.target.value},[(0,pe.default)("option",{value:"planning"},"Planning"),(0,pe.default)("option",{value:"in_progress"},"In Progress"),(0,pe.default)("option",{value:"completed"},"Completed"),(0,pe.default)("option",{value:"on_hold"},"On Hold"),(0,pe.default)("option",{value:"cancelled"},"Cancelled")])]),(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,pe.default)("i",{class:"ri-calendar-line mr-1 text-red-500"}),"Tanggal Update"]),(0,pe.default)("input",{type:"date",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-red-500 focus:ring-2 focus:ring-red-200 transition-all duration-200 bg-gray-50 focus:bg-white",value:this.formData.tanggalUpdate,oninput:e=>this.formData.tanggalUpdate=e.target.value})])]),(0,pe.default)("div",[(0,pe.default)("label",{class:"block text-sm font-semibold text-gray-800 mb-2"},[(0,pe.default)("i",{class:"ri-file-text-line mr-1 text-gray-500"}),"Keterangan"]),(0,pe.default)("textarea",{class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-gray-500 focus:ring-2 focus:ring-gray-200 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Keterangan progress (opsional)",value:this.formData.keterangan,oninput:e=>this.formData.keterangan=e.target.value,rows:3})])])]),(0,pe.default)("div",{class:"flex justify-end gap-3 pt-6 border-t border-gray-200 bg-gray-50 px-6 py-4 rounded-b-lg"},[(0,pe.default)("button",{class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.closeModal()},[(0,pe.default)("i",{class:"ri-close-fill"}),(0,pe.default)("span","Batal")]),(0,pe.default)("button",{class:`px-6 py-3 bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 ${this.isModalLoading?"opacity-50 cursor-not-allowed":""}`,onclick:()=>this.saveMonitoring(),disabled:this.isModalLoading},[this.isModalLoading?(0,pe.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,pe.default)("i",{class:"ri-save-line"}),(0,pe.default)("span",this.isModalLoading?"Menyimpan...":"Simpan")])])])])])}},an=Go;var dt=sr(lr(),1);var Ho={oninit:function(e){this.userData=et.getUserData(),this.isEditing=!1,this.isLoading=!1,this.errors={},this.formData={username:this.userData.username||"",email:this.userData.email||""}},validateForm:function(){return this.errors={},!this.formData.username||this.formData.username.trim().length===0?this.errors.username="Username harus diisi":this.formData.username.length<3&&(this.errors.username="Username minimal 3 karakter"),!this.formData.email||this.formData.email.trim().length===0?this.errors.email="Email harus diisi":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.formData.email)||(this.errors.email="Format email tidak valid"),Object.keys(this.errors).length===0},toggleEdit:function(){this.isEditing?(this.formData={username:this.userData.username||"",email:this.userData.email||""},this.errors={}):(this.formData={username:this.userData.username||"",email:this.userData.email||""},this.errors={}),this.isEditing=!this.isEditing},updateField:function(e,r){this.formData[e]=r,this.errors[e]&&(this.errors[e]="",dt.default.redraw())},handleUpdateProfile:async function(){if(!this.validateForm()){be.warning("Silakan perbaiki kesalahan dalam form"),dt.default.redraw();return}this.isLoading=!0,dt.default.redraw();try{let e=this.userData.token?JSON.parse(atob(this.userData.token.split(".")[1])).userId:null;if(!e){be.error("ID pengguna tidak ditemukan");return}let r=await Ce.update("user",e,{username:this.formData.username.trim(),email:this.formData.email.trim()});this.userData.username=this.formData.username.trim(),this.userData.email=this.formData.email.trim();let f=Ft.getAuthData();f&&f.userData&&(f.userData.username=this.formData.username.trim(),f.userData.email=this.formData.email.trim(),sessionStorage.setItem("authData",JSON.stringify(f))),this.isEditing=!1,this.errors={},be.success("Profil berhasil diperbarui")}catch(e){console.error("Error updating profile:",e)}finally{this.isLoading=!1,dt.default.redraw()}},view:function(){let e=this.userData;return(0,dt.default)("div",{class:"max-w-4xl mx-auto"},[(0,dt.default)("div",{class:"mb-8"},[(0,dt.default)("div",{class:"md:flex md:items-center md:justify-between"},[(0,dt.default)("div",{class:"flex-1 min-w-0"},[(0,dt.default)("h2",{class:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate"},"Profil Pengguna"),(0,dt.default)("p",{class:"mt-1 text-sm text-gray-500"},"Kelola informasi akun Anda")]),(0,dt.default)("div",{class:"mt-4 flex md:mt-0 md:ml-4 space-x-3"},[(0,dt.default)("button",{class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200",onclick:()=>dt.default.route.set("/dashboard")},[(0,dt.default)("i",{class:"text-lg mr-2 ri-arrow-left-line"}),"Tutup"])])])]),(0,dt.default)("div",{class:"space-y-6"},[(0,dt.default)("div",{class:"bg-white shadow rounded-lg"},[(0,dt.default)("div",{class:"px-4 py-5 sm:p-6"},[(0,dt.default)("div",{class:"flex items-center justify-between mb-6"},[(0,dt.default)("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Informasi Profil"),(0,dt.default)("button",{class:`inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium ${this.isEditing?"text-gray-700 bg-white hover:bg-gray-50 border-gray-300":"text-white bg-blue-600 hover:bg-blue-700"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500`,onclick:()=>this.toggleEdit()},[(0,dt.default)("i",{class:`text-lg mr-2 ${this.isEditing?"ri-close-line":"ri-edit-line"}`}),this.isEditing?"Batal":"Edit Profil"])]),(0,dt.default)("div",{class:"grid grid-cols-1 gap-6 sm:grid-cols-2"},[(0,dt.default)("div",{class:"sm:col-span-2"},[(0,dt.default)("div",{class:"flex items-center"},[(0,dt.default)("div",{class:"h-20 w-20 rounded-full bg-blue-600 flex items-center justify-center text-white text-2xl font-medium mr-4"},e.username?e.username.charAt(0).toUpperCase():"U"),(0,dt.default)("div",[(0,dt.default)("h4",{class:"text-xl font-medium text-gray-900"},e.username||"Username"),(0,dt.default)("p",{class:"text-sm text-gray-500"},e.email||"Email belum diisi")])])]),(0,dt.default)("div",[(0,dt.default)("label",{class:"block text-sm font-medium text-gray-700"},[(0,dt.default)("i",{class:"ri-user-line mr-1 text-blue-500"}),"Username"]),this.isEditing?(0,dt.default)("div",[(0,dt.default)("input",{type:"text",class:`mt-1 block w-full border-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200 ${this.errors.username?"border-red-300 focus:border-red-500 focus:ring-red-200 bg-red-50":"border-gray-200 focus:border-blue-500 focus:ring-blue-200 bg-gray-50 focus:bg-white"}`,value:this.formData.username,oninput:r=>this.updateField("username",r.target.value),placeholder:"Masukkan username...",disabled:this.isLoading}),this.errors.username&&(0,dt.default)("p",{class:"mt-2 text-sm text-red-600 flex items-center"},[(0,dt.default)("i",{class:"ri-error-warning-line mr-1"}),this.errors.username])]):(0,dt.default)("p",{class:"mt-1 text-sm text-gray-900"},e.username||"-")]),(0,dt.default)("div",[(0,dt.default)("label",{class:"block text-sm font-medium text-gray-700"},[(0,dt.default)("i",{class:"ri-mail-line mr-1 text-blue-500"}),"Email"]),this.isEditing?(0,dt.default)("div",[(0,dt.default)("input",{type:"email",class:`mt-1 block w-full border-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 transition-all duration-200 ${this.errors.email?"border-red-300 focus:border-red-500 focus:ring-red-200 bg-red-50":"border-gray-200 focus:border-blue-500 focus:ring-blue-200 bg-gray-50 focus:bg-white"}`,value:this.formData.email,oninput:r=>this.updateField("email",r.target.value),placeholder:"Masukkan email...",disabled:this.isLoading}),this.errors.email&&(0,dt.default)("p",{class:"mt-2 text-sm text-red-600 flex items-center"},[(0,dt.default)("i",{class:"ri-error-warning-line mr-1"}),this.errors.email])]):(0,dt.default)("p",{class:"mt-1 text-sm text-gray-900"},e.email||"-")]),(0,dt.default)("div",[(0,dt.default)("label",{class:"block text-sm font-medium text-gray-700"},"Role"),(0,dt.default)("p",{class:"mt-1 text-sm text-gray-900 capitalize"},e.role||"-")]),(0,dt.default)("div",[(0,dt.default)("label",{class:"block text-sm font-medium text-gray-700"},"Tahun Anggaran"),(0,dt.default)("p",{class:"mt-1 text-sm text-gray-900"},typeof e.budgetYear=="object"&&e.budgetYear.year?`${e.budgetYear.year} (${e.budgetYear.status||"Murni"})`:e.budgetYear||"-")]),e.namaPerangkatDaerah?(0,dt.default)("div",{class:"sm:col-span-2"},[(0,dt.default)("label",{class:"block text-sm font-medium text-gray-700"},"Organisasi"),(0,dt.default)("p",{class:"mt-1 text-sm text-gray-900"},e.namaPerangkatDaerah)]):null]),this.isEditing?(0,dt.default)("div",{class:"mt-6 flex justify-end space-x-3 border-t border-gray-200 pt-6"},[(0,dt.default)("button",{type:"button",class:"px-6 py-3 bg-white hover:bg-gray-50 border-2 border-gray-300 hover:border-gray-400 rounded-lg text-gray-700 font-medium transition-all duration-200 flex items-center space-x-2",onclick:()=>this.toggleEdit(),disabled:this.isLoading},[(0,dt.default)("i",{class:"ri-close-line"}),(0,dt.default)("span","Batal")]),(0,dt.default)("button",{type:"button",class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",onclick:()=>this.handleUpdateProfile(),disabled:this.isLoading},[this.isLoading?(0,dt.default)("i",{class:"ri-loader-4-line animate-spin"}):(0,dt.default)("i",{class:"ri-save-line"}),(0,dt.default)("span",this.isLoading?"Menyimpan...":"Simpan Perubahan")])]):null])]),(0,dt.default)("div",{class:"bg-white shadow rounded-lg"},[(0,dt.default)("div",{class:"px-4 py-5 sm:p-6"},[(0,dt.default)("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-4"},"Keamanan"),(0,dt.default)("p",{class:"text-sm text-gray-500 mb-4"},"Fitur ubah password akan tersedia soon. Hubungi administrator jika Anda perlu mengubah password."),(0,dt.default)("div",{class:"bg-blue-50 border border-blue-200 rounded-md p-4"},[(0,dt.default)("div",{class:"flex"},[(0,dt.default)("div",{class:"flex-shrink-0"},[(0,dt.default)("i",{class:"ri-information-line text-blue-400 text-lg"})]),(0,dt.default)("div",{class:"ml-3"},[(0,dt.default)("h3",{class:"text-sm font-medium text-blue-800"},"Informasi Keamanan"),(0,dt.default)("div",{class:"mt-2 text-sm text-blue-700"},[(0,dt.default)("p","Untuk keamanan akun Anda, pastikan untuk:"),(0,dt.default)("ul",{class:"list-disc list-inside mt-2 space-y-1"},[(0,dt.default)("li","Gunakan password yang kuat dan unik"),(0,dt.default)("li","Jangan bagikan informasi login kepada orang lain"),(0,dt.default)("li","Logout setelah selesai menggunakan sistem")])])])])])])]),(0,dt.default)("div",{class:"bg-white shadow rounded-lg"},[(0,dt.default)("div",{class:"px-4 py-5 sm:p-6"},[(0,dt.default)("h3",{class:"text-lg leading-6 font-medium text-gray-900 mb-4"},"Informasi Sistem"),(0,dt.default)("div",{class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},[(0,dt.default)("div",[(0,dt.default)("label",{class:"block text-sm font-medium text-gray-700"},"Status Autentikasi"),(0,dt.default)("div",{class:"mt-1 flex items-center"},[(0,dt.default)("div",{class:"h-2 w-2 bg-green-400 rounded-full mr-2"}),(0,dt.default)("p",{class:"text-sm text-gray-900"},"Terhubung")])]),(0,dt.default)("div",[(0,dt.default)("label",{class:"block text-sm font-medium text-gray-700"},"Sesi"),(0,dt.default)("p",{class:"mt-1 text-sm text-gray-900"},"Aktif")]),(0,dt.default)("div",[(0,dt.default)("label",{class:"block text-sm font-medium text-gray-700"},"Waktu Login"),(0,dt.default)("p",{class:"mt-1 text-sm text-gray-900"},new Date().toLocaleString("id-ID"))]),(0,dt.default)("div",[(0,dt.default)("label",{class:"block text-sm font-medium text-gray-700"},"Perangkat"),(0,dt.default)("p",{class:"mt-1 text-sm text-gray-900"},navigator.platform||"Unknown")])])])])])])}},Oi=Ho;var $i=e=>({onmatch:()=>et.isAuthenticated()?{view:()=>(0,Gt.default)(Ta,{},(0,Gt.default)(e))}:(Gt.default.route.set("/login"),ga)}),Jr=e=>({onmatch:()=>{if(!et.isAuthenticated())return Gt.default.route.set("/login"),ga;let r=et.getUserData(),f=et.getRole(),a=et.isAdmin();return a?{view:()=>(0,Gt.default)(Ta,{},(0,Gt.default)(e))}:{view:()=>(0,Gt.default)("div",{class:"min-h-screen bg-gray-50 flex items-center justify-center"},[(0,Gt.default)("div",{class:"max-w-md w-full bg-white rounded-lg shadow-lg p-6 text-center"},[(0,Gt.default)("div",{class:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"},[(0,Gt.default)("i",{class:"ri-shield-cross-line text-2xl text-red-600"})]),(0,Gt.default)("h2",{class:"text-xl font-semibold text-gray-900 mb-2"},"Akses Ditolak"),(0,Gt.default)("p",{class:"text-gray-600 mb-4"},"Halaman ini hanya dapat diakses oleh Administrator."),(0,Gt.default)("p",{class:"text-sm text-gray-500 mb-6"},`Role Anda: ${f||"undefined"} | isAdmin: ${a}`),(0,Gt.default)("button",{class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200",onclick:()=>Gt.default.route.set("/dashboard")},"Kembali ke Dashboard")])])}}}),Pa=e=>({onmatch:()=>{if(!et.isAuthenticated())return Gt.default.route.set("/login"),ga;let r=et.getUserData(),f=et.getRole(),a=et.isOperator();return a?{view:()=>(0,Gt.default)(Ta,{},(0,Gt.default)(e))}:{view:()=>(0,Gt.default)("div",{class:"min-h-screen bg-gray-50 flex items-center justify-center"},[(0,Gt.default)("div",{class:"max-w-md w-full bg-white rounded-lg shadow-lg p-6 text-center"},[(0,Gt.default)("div",{class:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"},[(0,Gt.default)("i",{class:"ri-shield-cross-line text-2xl text-red-600"})]),(0,Gt.default)("h2",{class:"text-xl font-semibold text-gray-900 mb-2"},"Akses Ditolak"),(0,Gt.default)("p",{class:"text-gray-600 mb-4"},"Halaman ini hanya dapat diakses oleh Operator."),(0,Gt.default)("p",{class:"text-sm text-gray-500 mb-6"},`Role Anda: ${f||"undefined"} | isOperator: ${a}`),(0,Gt.default)("button",{class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200",onclick:()=>Gt.default.route.set("/dashboard")},"Kembali ke Dashboard")])])}}}),Wo=e=>({onmatch:()=>{if(!et.isAuthenticated())return Gt.default.route.set("/login"),ga;let r=et.getUserData(),f=et.getRole();return f==="vendor"?{view:()=>(0,Gt.default)(e)}:{view:()=>(0,Gt.default)("div",{class:"min-h-screen bg-gray-50 flex items-center justify-center"},[(0,Gt.default)("div",{class:"max-w-md w-full bg-white rounded-lg shadow-lg p-6 text-center"},[(0,Gt.default)("div",{class:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"},[(0,Gt.default)("i",{class:"ri-shield-cross-line text-2xl text-red-600"})]),(0,Gt.default)("h2",{class:"text-xl font-semibold text-gray-900 mb-2"},"Akses Ditolak"),(0,Gt.default)("p",{class:"text-gray-600 mb-4"},"Halaman ini hanya dapat diakses oleh Vendor."),(0,Gt.default)("p",{class:"text-sm text-gray-500 mb-6"},`Role Anda: ${f||"undefined"}`),(0,Gt.default)("button",{class:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200",onclick:()=>Gt.default.route.set("/dashboard")},"Kembali ke Dashboard")])])}}});Gt.default.route.prefix="";Gt.default.route(document.body,"/",{"/":{render:()=>(0,Gt.default)(ga,{setTitle:e=>{document.title=e+" - SIMRAPU"}})},"/login":{render:()=>(0,Gt.default)(ga,{setTitle:e=>{document.title=e+" - SIMRAPU"}})},"/dashboard":$i(ni),"/operator-dashboard":Pa(ii),"/vendor-layout":Wo(oi),"/operator-pengadaan":Pa(rn),"/operator-monitoring":Pa(an),"/bidang-subkegiatan":Jr(li),"/perangkat-daerah":Jr(pi),"/kode-rekening":Jr(Ma),"/kode-rekening-sumber-dana":Jr(hi),"/anggaran":Jr(mi),"/kinerja":Jr(bi),"/realisasi":Jr(yi),"/pencapaian":Jr(vi),"/evaluasi-realisasi":Jr(wi),"/evaluasi-kinerja":Jr(xi),"/laporan-anggaran":Jr(ki),"/laporan-realisasi":Jr(Si),"/laporan-kinerja":Jr(Pi),"/laporan-konsolidasi":Jr(_i),"/penyedia":Jr(Di),"/jenis-pengadaan":Jr(ji),"/pengadaan":Pa(rn),"/monitoring":Pa(an),"/profile":$i(Oi)});})();
/*! Bundled license information:

mongoose/dist/browser.umd.js:
  (*! For license information please see browser.umd.js.LICENSE.txt *)
*/
